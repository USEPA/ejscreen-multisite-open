<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Utility to create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total — pctiles_lookup_create • EJAM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Utility to create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total — pctiles_lookup_create"><meta property="og:description" content="Utility to create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EJAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/0_webapp.html">0. Using EJAM as a Web App</a>
    </li>
    <li>
      <a href="../articles/1_installing.html">1. Installing the EJAM package</a>
    </li>
    <li>
      <a href="../articles/2_quickstart.html">2. Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/3_analyzing.html">3. Basics of Using EJAM for Analysis in RStudio</a>
    </li>
    <li>
      <a href="../articles/4_advanced.html">4. Advanced Features</a>
    </li>
    <li>
      <a href="../articles/5_ejscreenapi.html">5. Using the EJScreen API via EJAM</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/USEPA/EJAM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Utility to create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</h1>
    <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/R/utils_pctiles_lookup_create.R" class="external-link"><code>R/utils_pctiles_lookup_create.R</code></a></small>
    <div class="hidden name"><code>pctiles_lookup_create.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Utility to create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pctiles_lookup_create</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  zone.vector <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  zoneOverallName <span class="op">=</span> <span class="st">"USA"</span>,</span>
<span>  wts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  usecollapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  type <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>data.frame with numeric data. Each column will be examined to calculate
mean,   and percentiles, for each zone</p></dd>


<dt>zone.vector</dt>
<dd><p>optional names of states or regions, for example. same length as wts, or rows in mydf</p></dd>


<dt>zoneOverallName</dt>
<dd><p>optional. Default is USA.</p></dd>


<dt>wts</dt>
<dd><p>leave as default since weighted percentiles of blockgroups are not used for EJScreen percentiles anymore</p></dd>


<dt>usecollapse</dt>
<dd><p>logical, whether to use collapse::fquantile()
instead of Hmisc package wtd.quantile and stats pkg quantile,
to test before fully removing dependency on Hmisc and also speed it up.</p></dd>


<dt>type</dt>
<dd><p>DO NOT CHANGE - moot for EJScreen/EJAM - SEE SOURCE CODE - Hmisc pkg wtd.quantile type "1/n" was used here in the past and possibly by EJScreen
(EJScreen no longer uses weighted percentiles so this is moot for the weighted case)
but collapse pkg fquantile is now used here to avoid Hmisc dependency
and fquantile type 4 seems to be the same as Hmisc type "1/n" but that has not been confirmed,
and this function by default uses fquantile type 1, the inverse of the ECDF however,
which seems simpler than using type 4 which does linear interpolation between points of the ECDF!
***  NEED TO CONFIRM IF THAT CREATES A TABLE DIFFERENT THAN WHAT EJSCREEN WOULD CREATE</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>EJScreen assigns each indicator in each block group a percentile value via python script, using
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.percentileofscore.html" class="external-link">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.percentileofscore.html</a></p>
<p>The way the python function is used as of 2023 is that percentileofscore is 80% if</p>
<p>80% of all indicator values (statewide or nationwide, depending on the type being calculated)</p>
<p>are less than (NOT equal to) the indicator value</p>
<p>in the specified block group (since kind="strict").</p>
<p>The percentile recorded in the EJScreen dataset is the floor of that,</p>
<p>meaning if the 81.9% of values are less than x, the percentile is reported as 81.</p>
<p>The EJScreen python script used to create percentile lookup tables is in a file</p>
<p>called cal_statepctile_0222.py and the key lines of code and functions it uses are</p>
<p>pctile = math.floor(stats.percentileofscore(barray, indicatorscore, kind="strict"))</p>
<p>binvalue = getBinvalue(pctile)</p>
<p>and</p>
<p>def getBinvalue(pct):</p>
<p>if pct is None:
return 0
else:
if pct &gt;= 95:
return 11
elif pct &gt;= 90 and pct &lt; 95:
return 10
elif pct &gt;= 80 and pct &lt; 90:
return 9
elif pct &gt;= 70 and pct &lt; 80:
return 8
elif pct &gt;= 60 and pct &lt; 70:
return 7
elif pct &gt;= 50 and pct &lt; 60:
return 6
elif pct &gt;= 40 and pct &lt; 50:
return 5
elif pct &gt;= 30 and pct &lt; 40:
return 4
elif pct &gt;= 20 and pct &lt; 30:
return 3
elif pct &gt;= 10 and pct &lt; 20:
return 2
else:
return 1</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mark Corrales.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

