<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>EJAM - Environmental Justice Analysis Multisite tool — EJAM • EJAM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="EJAM - Environmental Justice Analysis Multisite tool — EJAM"><meta property="og:description" content="EJAM provides functions and data for very fast proximity analysis
for a large number of locations, or &quot;buffers&quot;, summarizing conditions at each location.
It summarizes conditions as the conditions for the average resident in the buffer at that location.
A buffer or location here is defined as the area within a specified distance of a specified site.
A site of facility in this package is defined as a single geographic point (by latitude and longitude).
The functions here will be somewhat generalized, but the specific datasets included here enable an
environmental justice (EJ) proximity analysis of US EPA's EJScreen data, including
environmental indicators (e.g., local traffic score, or estimated PM2.5 concentration)
and demographic indicators (e.g., percent low-income),
for the populations estimated to live within a specified distance (e.g., 1 mile) from
one or more sites, typically EPA-regulated facilities.
This means the tools can provide the same information that an EJScreen standard report provides,
but for a large number of reports (one for each site)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EJAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/0_webapp.html">0. Using EJAM as a Web App</a>
    </li>
    <li>
      <a href="../articles/1_installing.html">1. Installing the EJAM package</a>
    </li>
    <li>
      <a href="../articles/2_quickstart.html">2. Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/3_analyzing.html">3. Basics of Using EJAM for Analysis in RStudio</a>
    </li>
    <li>
      <a href="../articles/4_advanced.html">4. Advanced Features</a>
    </li>
    <li>
      <a href="../articles/5_ejscreenapi.html">5. Using the EJScreen API via EJAM</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/USEPA/EJAM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EJAM - Environmental Justice Analysis Multisite tool</h1>
    <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/R/EJAM-package.R" class="external-link"><code>R/EJAM-package.R</code></a></small>
    <div class="hidden name"><code>EJAM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>EJAM provides functions and data for very fast proximity analysis
for a large number of locations, or "buffers", summarizing conditions at each location.
It summarizes conditions as the conditions for the average resident in the buffer at that location.
A buffer or location here is defined as the area within a specified distance of a specified site.
A site of facility in this package is defined as a single geographic point (by latitude and longitude).</p>
<p>The functions here will be somewhat generalized, but the specific datasets included here enable an
environmental justice (EJ) proximity analysis of US EPA's EJScreen data, including
environmental indicators (e.g., local traffic score, or estimated PM2.5 concentration)
and demographic indicators (e.g., percent low-income),
for the populations estimated to live within a specified distance (e.g., 1 mile) from
one or more sites, typically EPA-regulated facilities.
This means the tools can provide the same information that an EJScreen standard report provides,
but for a large number of reports (one for each site).</p>
    </div>


    <div id="vignette">
    <h2><strong>Vignette</strong></h2>
    <p>Walk-through guides will be available via <code>vignette(package = "EJAM")</code> or &lt;EJAM-vignette.html&gt; and
pdf or html format documentation of functions and data will be at &lt;EJAM.pdf&gt; or &lt;EJAM.html&gt;
Also see the README file.</p>
    </div>
    <div id="key-functions-">
    <h2><strong>Key Functions:</strong></h2>
    
<ul><li><p><strong><code>run_app()</code></strong> Launch the web app (R Shiny interface)</p></li>
<li><p><strong><code><a href="ejamit.html">ejamit()</a></code></strong> Get results (tables, maps, plots) without the web app interface, largely by using these key functions:</p><ol><li><p>Getting key datasets and indexing blocks, if not yet done, via <code><a href="dataload_from_pins.html">dataload_from_pins()</a></code> and <code><a href="indexblocks.html">indexblocks()</a></code></p></li>
<li><p><strong><code><a href="getblocksnearby.html">getblocksnearby()</a></code></strong>  Very fast method to buffer, identifying which blocks are
within specified distance of point(s) like sites/facilities, and get distance to each.</p></li>
<li><p><strong><code><a href="doaggregate.html">doaggregate()</a></code></strong> Summarize demographic and environmental indicators from <strong><a href="blockgroupstats.html">blockgroupstats</a></strong>.rda (see below)
within each place, weighted using blockwts (for average resident within specified distance of site (e.g., facility),
or in each shapefile or FIPS-defined location).</p></li>
</ol></li>
</ul></div>
    <div id="data-files-available-as-examples-">
    <h2><strong>Data files available as examples:</strong></h2>
    
<ul><li><p><strong>Excel files to read into ejamit()</strong> or getblocksnearby() are in the local source package files in EJAM/inst/testdata/latlon</p></li>
<li><p><a href="testpoints_10.html">testpoints_10</a>.rda  and larger datasets each provide a random test points data.frame with columns lat lon (and a unique site id)</p></li>
<li><p><code><a href="testpoints_n.html">testpoints_n()</a></code> can generate random test points at places weighted by population, FRS facilities, blockgroup, area, block</p></li>
<li><p><a href="testoutput_getblocksnearby_10pts_1miles.html">testoutput_getblocksnearby_10pts_1miles</a>.rda and larger datasets are sample outputs of getblocksnearbyviaQuadTree or just getblocksnearby(),
to try as inputs to doaggregate()</p></li>
</ul></div>
    <div id="specifying-buffer-sites-facilities-">
    <h2><strong>Specifying buffer sites / facilities:</strong></h2>
    <p>A user can specify locations, via an interface, and that shiny app returns</p><ul><li><p><em><code>sitepoints</code></em>, a data.table with fields lat, lon, and can have a unique site id.
A user-specified table with maybe 100, 1k, 10k+ points (centers of circular buffers).
Examples of test data are</p></li>
</ul><p>One can specify sitepoints, with lat/lon coordinates of the places to be analyzed (sites or facilities),
or can specify areas to be analyzed in general,
in one of these ways:</p><ul><li><p><strong>Point locations uploaded</strong> (lat, lon coordinates) - these could be regulated facilities
for which you already have locations, or could be any other types of points uploaded in a spreadsheet.</p></li>
<li><p><strong>Shapefiles uploaded</strong> to directly define the areas to include instead of using circular buffers around points</p></li>
<li><p><strong>FIPS</strong> to specify a list of counties or tracts or blockgroups, for example, to be compared.</p></li>
<li><p><strong>NAICS or SIC code</strong> Industry categories selected from a list of codes or names, or uploaded in a table.
The NAICS are 2-digit to 6-digit codes that specify sectors or types of facilities, such as
325 - Chemical Manufacturing, or 325211 - Plastics Material and Resin Manufacturing.</p></li>
<li><p><strong>Facility IDs</strong> - EPA Facility Registry Service (FRS) ID numbers or FRS Program ID numbers</p></li>
<li><p><strong>Program System Types</strong> - picking a whole category of regulated sites, such as all GHG reporters or all TRI reporters.</p></li>
<li><p><strong>MACT Subpart</strong> to specify Clean Air Act NESHAP program Max. Achievable Control Tech.
source categories (types of air emissions sources) defined by subpart such as OOOO.</p></li>
</ul><p>Some additional details on some of these:</p>
<p><strong>- BY INDUSTRIAL SECTOR/ NAICS:</strong></p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    Interface lets user select NAICS from pulldown, or type <span class="cf">in</span> NAICS </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    Interface returns a vector of one or more naics codes,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    to be converted to sitepoints.</span></code></pre><p></p></div><ul><li><p><strong><code><a href="latlon_from_naics.html">latlon_from_naics()</a></code></strong> takes NAICS codes and returns a data.table of site points.
Relies on ** frs_by_naics.rda**  A data.table, needed to get lat lon by naics.
Need to update FRS data used here regularly, ideally frequently.
2023 version has columns   REGISTRY_ID,  NAICS, lat, lon</p>
<p>NAICS codes also can be selected by text search of industry names or by categories of codes, via <code><a href="naics_from_any.html">naics_from_any()</a></code></p></li>
</ul><p><strong>- BY FACILITY ID or PROGRAM ID:</strong></p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    Interface so user can upload FRS REGISTRY_ID or PROGRAM ID csv<span class="sc">/</span>xls file, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    Interface returns a list of REGISTRY_ID values from a copy of the EPA facility registry <span class="fu">service</span> (FRS) data  </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    to be converted to sitepoints.</span></code></pre><p></p></div><ul><li><p><strong><code><a href="frs_from_regid.html">frs_from_regid()</a></code></strong> takes REGISTRY_ID values and returns a data.table of site points.
Relies on <strong>frs</strong> data.table with columns REGISTRY_ID, lat, lon, etc.</p></li>
<li><p><strong><code><a href="frs_from_programid.html">frs_from_programid()</a></code></strong> takes EPA program-specific site ID values and returns a data.table of site points.
Relies on <strong><a href="frs_by_programid.html">frs_by_programid</a></strong> data.table with columns program, pgm_sys_id, REGISTRY_ID, lat, lon</p></li>
</ul><p><strong>- BY LAT/LON POINT:</strong></p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    Interface so user can specify or upload latitude <span class="fu">longitude</span> (and optionally a unique site id and other columns like sitename),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    when using [<span class="fu">ejamit</span>()] which <span class="cf">in</span> turn uses [<span class="fu">latlon_from_anything</span>()].</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    The app keeps track of the sitepoints data.table with an assigned ejam_uniq_id that is just the row number.</span></code></pre><p></p></div>
    </div>
    <div id="buffering-to-find-site-block-distances-">
    <h2><strong>Buffering to find site-block-distances:</strong></h2>
    <p>Input: <strong><code>sitepoints</code></strong> data.table from user picking points</p>
<p>Columns are lat, lon</p><ul><li><p><strong><code><a href="getblocksnearby.html">getblocksnearby()</a></code></strong> which by default uses <em><code><a href="getblocksnearbyviaQuadTree.html">getblocksnearbyviaQuadTree()</a></code></em>
Returns <code>sites2blocks</code>
Requires index called localtree that is build from dataset <a href="quaddata.html">quaddata</a></p></li>
<li><p><strong>sites2blocks</strong>   Created by <code><a href="getblocksnearby.html">getblocksnearby()</a></code> to be passed to  <code><a href="doaggregate.html">doaggregate()</a></code>
This is a data table with maybe 100k to 1m rows (assume 1k blocks within 3 miles of each site, or 100 blocks within 1 mile),
<code>sites2blocks[ , .(ejam_uniq_id, blockid, distance or dist)]</code></p><ul><li><p>ejam_uniq_id    (the row number 1 through N of the site)</p></li>
<li><p>blockid     for join to blockwts</p></li>
<li><p>distance  (in miles, from block to site) (0 or irrelevant for noncircular buffers,
since a block is only in this table if in one or more buffers,
unless analysis is for residents within x miles of the edges of some shapes, like facility boundaries)</p></li>
</ul></li>
</ul></div>
    <div id="data-files-used-for-distance-calculation-">
    <h2><strong>Data files used for distance calculation:</strong></h2>
    
<ul><li><p>** quaddata.rda** data.table with point location of internal point for each of 8 million Census blocks
is used prior to or during startup of EJAM to create an index stored in memory, called localtree.</p>
<p>quaddata can be obtained using <code><a href="dataload_from_pins.html">dataload_from_pins()</a></code></p>
<p>localtree is the index made from quaddata via <code><a href="indexblocks.html">indexblocks()</a></code> (using the SearchTrees package)</p></li>
</ul><p>Those are used in getblocksnearby with some sitepoints to create a temporary object called sites2blocks:</p>
    </div>
    <div id="summarizing-indicators-in-buffers-">
    <h2><strong>Summarizing indicators in buffers:</strong></h2>
    <p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  INPUT IS  <span class="st">`</span><span class="at">sites2blocks</span><span class="st">`</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  OUTPUT IS results_overall, results_bysite, and other summary stats  <span class="do">####</span></span></code></pre><p></p></div><ul><li><p><strong><code><a href="doaggregate.html">doaggregate()</a></code></strong> = function(sites2blocks) This summarizes in each buffer and for all unique residents across all buffers.</p></li>
<li><p><strong><a href="blockgroupstats.html">blockgroupstats</a></strong> a data.table with 220k rows (blockgroups) and hundreds of indicator columns.
Will need bgid not just bgfips, to join to blockwts$bgid
Needs to be updated each time EJScreen is updated.</p></li>
<li><p><strong><a href="bgej.html">bgej</a></strong> a data.table like blockgroupstats but for the EJ Index raw scores.</p></li>
<li><p><strong><a href="usastats.html">usastats</a></strong> and <strong><a href="statestats.html">statestats</a></strong>  data.table lookup of 100 percentiles and means
(for each indicator in blockgroupstats, and bgej) in each zone (USA, or a state or DC, PR).
Need to update each time blockgroupstats is updated. Taken from EJScreen data or ejscreen package file lookupUSA and lookupStates</p></li>
<li><p><strong>blockwts</strong> see <code><a href="dataload_from_pins.html">dataload_from_pins()</a></code>
Required by <code><a href="doaggregate.html">doaggregate()</a></code>. A data.table of 6-8m rows</p><ul><li><p>blockwt  The fraction of parent blockgroup decennial pop that is in this one block</p></li>
<li><p>block_radius_miles squared times pi would equal the land plus water area in square miles</p></li>
<li><p>blockid (integer key  for join to sites2blocks)</p></li>
<li><p>bgid   integer key instead of bgfips - For sum(blockwt), by=bgid, and for join to blockgroupstats$bgid.
bgid is more efficient than bgfips. bgfips is not here but is in a bgid2fips data.table</p></li>
</ul></li>
</ul></div>
    <div id="output-results-for-user-">
    <h2><strong>Output results for user:</strong></h2>
    <p><code><a href="ejamit.html">ejamit()</a></code> (or <code><a href="doaggregate.html">doaggregate()</a></code>) provides the following outputs:</p><ul><li><p><strong>results_overall</strong>   one row data.table, like results_by_site, but just one row with
aggregated results for all unique residents.</p></li>
<li><p><strong>results_by_site</strong>   results for individual sites (buffers) - a data.table of results,
one row per ejam_uniq_id (i.e., each site analyzed), one column per indicator</p></li>
<li><p><strong>results_bybg_people</strong>  results for each block group, to allow for showing the distribution of each
indicator across everyone within each demographic group.</p></li>
<li><p><strong>longnames</strong>  descriptive long names for the indicators in the above outputs</p></li>
<li><p><strong>count_of_blocks_near_multiple_sites</strong>  additional detail</p></li>
</ul></div>
    <div id="identification-of-nearby-residents-methodology-">
    <h2><strong>Identification of nearby residents -- methodology:</strong></h2>
    <p>The identification of nearby residents is currently done in a way that includes all 2020 Census blocks whose
"internal point" (a lat/lon provided by the Census Bureau) is within the specified distance of the facility point.
This is taken from the EJScreen block weights file, but can also be independently calculated.</p>
<p>The summary or aggregation or "rollup" within the buffer is done by calculating the
population-weighted average block group score among all the people residing in the buffer.</p>
<p>Since the blockgroup population counts are from American Community Survey (ACS) estimates,
but the block population counts are from a decennial census, the totals for a blockgroup differ.
The amount each partial blockgroup contributes to the buffer's overall score is based on
the estimated number of residents from that blockgroup who are in the buffer.
This is based on the fraction of the blockgroup population that is estimated to be in the buffer,
and that fraction is calculated as the fraction of the blockgroup's decennial census block population
that is in the census blocks inside the buffer.</p>
<p>A given block is considered entirely inside or entirely outside the buffer,
and those are used to more accurately estimate what fraction of a given block group's
population is inside the buffer. This is more accurate and faster than areal apportionment of block groups.
Census blocks are generally so small relative to typical buffers that this is very accurate -
it is least accurate if a very small buffer distance is specified
in an extremely low density rural area where a block can be geographically large.
Although it is rarely if ever a significant issue (for reasonable, useful buffer sizes),
an even more accurate approach in those cases might be either areal apportionment of blocks,
which is very slow and assumes residents are evenly spread out across the full block's area,
or else an approach that uses higher resolution estimates of residential locations than even
the Decennial census blocks can provide, such as a dasymetric map approach.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Useful links:</p><ul><li><p><a href="https://github.com/USEPA/EJAM" class="external-link">https://github.com/USEPA/EJAM</a></p></li>
</ul></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mark Corrales.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

