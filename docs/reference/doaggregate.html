<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="getblocksnearby() and doaggregate() are the two key functions that run ejamit().
doaggregate() takes a set of sites like facilities and the
set of blocks that are near each,
combines those with indicator scores for block groups, and
aggregates the numbes within each place and across all overall."><title>Summarize environmental and demographic indicators at each location and overall — doaggregate • EJAM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarize environmental and demographic indicators at each location and overall — doaggregate"><meta property="og:description" content="getblocksnearby() and doaggregate() are the two key functions that run ejamit().
doaggregate() takes a set of sites like facilities and the
set of blocks that are near each,
combines those with indicator scores for block groups, and
aggregates the numbes within each place and across all overall."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/0_webapp.html">0. Using EJAM as a Web App</a>
    <a class="dropdown-item" href="../articles/1_installing.html">1. Installing the EJAM package</a>
    <a class="dropdown-item" href="../articles/2_quickstart.html">2. Quick Start Guide</a>
    <a class="dropdown-item" href="../articles/3_analyzing.html">3. Basics of Using EJAM for Analysis in RStudio</a>
    <a class="dropdown-item" href="../articles/4_advanced.html">4. Advanced Features</a>
    <a class="dropdown-item" href="../articles/5_ejscreenapi.html">5. Using the EJScreen API via EJAM</a>
    <a class="dropdown-item" href="../articles/6_future_plans.html">6. Future Plans and Ideas for EJAM</a>
    <a class="dropdown-item" href="../articles/what_is_ejam.html">What is EJAM?</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/EJAM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Summarize environmental and demographic indicators at each location and overall</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/R/doaggregate.R" class="external-link"><code>R/doaggregate.R</code></a></small>
      <div class="d-none name"><code>doaggregate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>getblocksnearby() and doaggregate() are the two key functions that run ejamit().
<code>doaggregate()</code> takes a set of sites like facilities and the
set of blocks that are near each,
combines those with indicator scores for block groups, and
aggregates the numbes within each place and across all overall.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">doaggregate</span><span class="op">(</span></span>
<span>  <span class="va">sites2blocks</span>,</span>
<span>  sites2states_or_latlon <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  countcols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  popmeancols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calculatedcols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subgroups_type <span class="op">=</span> <span class="st">"nh"</span>,</span>
<span>  include_ejindexes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  calculate_ratios <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extra_demog <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  need_proximityscore <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  infer_sitepoints <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  called_by_ejamit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  updateProgress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silentinteractive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  testing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>sites2blocks</dt>
<dd><p>data.table of distances in miles between all sites (facilities) and
nearby Census block internal points, with columns ejam_uniq_id, blockid, distance,
created by getblocksnearby  function.
See <a href="sites2blocks_example10pts_1miles.html">sites2blocks_example10pts_1miles</a> aka <a href="testoutput_getblocksnearby_10pts_1miles.html">testoutput_getblocksnearby_10pts_1miles</a> dataset in package, as input to this function</p></dd>


<dt>sites2states_or_latlon</dt>
<dd><p>data.table or just data.frame, with columns ejam_uniq_id (each unique one in sites2blocks) and ST (2-character State abbreviation) or lat and lon</p></dd>


<dt>radius</dt>
<dd><p>Optional radius in miles to limit analysis to. By default this function uses
all the distances that were provided in the output of getblocksnearby(),
and reports radius estimated as rounded max of distance values in inputs to doaggregate.
But there may be cases where you want to run getblocksnearby() once for 10 miles, say,
on a very long list of sites (1,000 or more, say), and then get summary results for
1, 3, 5, and 10 miles without having to redo the getblocksnearby() part for each radius.
This lets you just run getblocksnearby() once for the largest radius, and then query those
results to get doaggregate() to summarize at any distance that is less than or equal to the
original radius analyzed by getblocksnearby().</p></dd>


<dt>countcols</dt>
<dd><p>character vector of names of variables  to aggregate within a buffer
using a sum of counts, like, for example, the number of people for whom a
poverty ratio is known, the count of which is the exact denominator needed
to correctly calculate percent low income.</p></dd>


<dt>popmeancols</dt>
<dd><p>character vector of names of variables to aggregate within a buffer
using population weighted mean.</p></dd>


<dt>calculatedcols</dt>
<dd><p>character vector of names of variables to aggregate within a buffer
using formulas that have to be specified.</p></dd>


<dt>subgroups_type</dt>
<dd><p>Optional (uses default). Set this to
"nh" for non-hispanic race subgroups as in Non-Hispanic White Alone, nhwa and others in names_d_subgroups_nh;
"alone" for EJScreen v2.2 style race subgroups as in    White Alone, wa and others in names_d_subgroups_alone;
"both" for both versions. Possibly another option is "original" or "default" but work in progress.</p></dd>


<dt>include_ejindexes</dt>
<dd><p>whether to calculate EJ Indexes and return that information</p></dd>


<dt>calculate_ratios</dt>
<dd><p>whether to calculate and return ratio of each indicator to its US and State overall mean</p></dd>


<dt>extra_demog</dt>
<dd><p>if should include more indicators from EJScreen v2.2 report,
on language, more age groups, gender, percent with disability, poverty, etc.</p></dd>


<dt>need_proximityscore</dt>
<dd><p>whether to calculate proximity scores</p></dd>


<dt>infer_sitepoints</dt>
<dd><p>set to TRUE to try to infer the lat,lon of each site around which the blocks in sites2blocks were found.
lat,lon of each site will be approximated as average of nearby blocks, although a more accurate slower way would
be to use reported distance of each of 3 of the furthest block points and triangulate</p></dd>


<dt>called_by_ejamit</dt>
<dd><p>Set to TRUE by ejamit() to suppress some outputs even if ejamit(silentinteractive=F)</p></dd>


<dt>updateProgress</dt>
<dd><p>progress bar function used for shiny app</p></dd>


<dt>silentinteractive</dt>
<dd><p>Set to TRUE to see results in RStudio console.
Set to FALSE to prevent long output showing in console in RStudio when in interactive mode</p></dd>


<dt>testing</dt>
<dd><p>used while testing this function</p></dd>


<dt>...</dt>
<dd><p>more to pass to another function? Not used currently.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>list with named elements:</p><ul><li><p><strong><code>results_overall</code></strong>   one row data.table, like results_by_site, but just one row with
aggregated results for all unique residents.</p></li>
<li><p><strong><code>results_by_site</code></strong>   results for individual sites (buffers) - a data.table of results,
one row per ejam_uniq_id, one column per indicator</p></li>
<li><p><strong>results_bybg_people</strong>  results for each block group, to allow for showing the distribution of each
indicator across everyone within each demographic group.</p></li>
<li><p><strong>longnames</strong>  descriptive long names for the indicators in the above outputs</p></li>
<li><p><strong>count_of_blocks_near_multiple_sites</strong>  additional detail</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For all examples, see <code><a href="getblocksnearbyviaQuadTree.html">getblocksnearbyviaQuadTree()</a></code></p>
<p><code>doaggregate()</code> is the code run after <code><a href="getblocksnearby.html">getblocksnearby()</a></code> (or a related function for
polygons or FIPS Census units) has identified which blocks are nearby.</p>
<p><code>doaggregate()</code> aggregates the blockgroup scores to create a summary of each indicator,
as a raw score and US percentile and State percentile,
in each buffer (i.e., near each facility):</p><ul><li><p><strong>SUMS OF COUNTS</strong>: for population count, or number of households or Hispanics, etc.</p></li>
<li><p><strong>POPULATION-WEIGHTED MEANS</strong>: for  Environmental indicators, but also any percentage indicator
for which the universe (denominator) is population count (rather than households, persons age 25up, etc.)</p>
<p><em><strong>EJ Indexes</strong>:</em> The way EJScreen
does this is apparently finding the pop wtd mean of EJ Index raw scores,
not the EJ Index formula applied to the summarized demographic score and aggregated envt number.</p></li>
<li><p><strong>CALCULATED BY FORMULA</strong>: Buffer or overall score calculated via formulas using aggregated counts,
such as percent low income = sum of counts low income / sum of counts of denominator,
which in this case is the count of those for whom the poverty ratio is known. Assuming no rounding errors,
this method should give the same result as using a weighted mean of percentages, where the weights are
the correct denominator like count of those for whom the poverty ratio is known.</p></li>
<li><p><strong>LOOKED UP</strong>: Aggregated scores are converted into percentile terms via lookup tables (US or State version).</p></li>
</ul><p>This function requires the following datasets:</p><ul><li><p>blockwts: data.table with these columns: blockid , bgid, blockwt</p></li>
<li><p>quaddata data.table used to create localtree, a quad tree index of block points
(and localtree that is created when package is loaded)</p></li>
<li><p>blockgroupstats - A data.table (such as EJScreen demographic and environmental data by blockgroup?)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="ejamit.html">ejamit</a>   <code><a href="getblocksnearby.html">getblocksnearby()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Mark Corrales.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

