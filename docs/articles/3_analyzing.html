<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="3. Basics of Using EJAM for Analysis in RStudio">
<title>Basics of Using EJAM for Analysis in RStudio • EJAM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basics of Using EJAM for Analysis in RStudio">
<meta property="og:description" content="3. Basics of Using EJAM for Analysis in RStudio">
<meta property="og:image" content="usepa.github.io/EJAM/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6>
    <a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM</a>
    <a class="dropdown-item" href="../articles/0_webapp.html">Using EJAM</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>For analysts using R</h6>
    <a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a>
    <a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a>
    <a class="dropdown-item" href="../articles/3_analyzing.html">Basics of Using EJAM for Analysis in RStudio</a>
    <a class="dropdown-item" href="../articles/4_advanced.html">Advanced Features</a>
    <a class="dropdown-item" href="../articles/5_ejscreenapi.html">Using the EJScreen API via EJAM</a>
    <a class="dropdown-item" href="../articles/6_future_plans.html">Future Plans and Ideas for EJAM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/EJAM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Basics of Using EJAM for Analysis in RStudio</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/vignettes/3_analyzing.Rmd" class="external-link"><code>vignettes/3_analyzing.Rmd</code></a></small>
      <div class="d-none name"><code>3_analyzing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="key-functions">Key Functions<a class="anchor" aria-label="anchor" href="#key-functions"></a>
</h2>
<ul>
<li><p><strong><code><a href="../reference/run_app.html">run_app()</a></code></strong> to launch the web app
locally (to run in RStudio on a single computer rather than on a
server)</p></li>
<li><p><strong><code><a href="../reference/ejamit.html">ejamit()</a></code></strong> provides most results in
just one function, and they can be viewed using
<code><a href="../reference/ejam2report.html">ejam2report()</a></code> and <code><a href="../reference/ejam2excel.html">ejam2excel()</a></code>. Sample input
to <code><a href="../reference/ejamit.html">ejamit()</a></code> is in <code>testpoints_10</code> and sample
output is in <code>testoutput_ejamit_10pts_1miles</code>.
<code><a href="../reference/ejamit.html">ejamit()</a></code> especially relies on
<code><a href="../reference/getblocksnearby.html">getblocksnearby()</a></code> and <code><a href="../reference/doaggregate.html">doaggregate()</a></code>:</p></li>
<li><p><code><a href="../reference/getblocksnearby.html">getblocksnearby()</a></code> takes a set of points (e.g.,
facilities) and finds the Census blocks near each. Sample input is in
<code>testpoints_100</code>, and sample output is in
<code>testoutput_getblocksnearby_10pts_1miles</code></p></li>
<li><p><code><a href="../reference/doaggregate.html">doaggregate()</a></code> takes the list of blocks near each
point, joins it to blockgroup indicators like from EJScreen, and
aggregates at each buffered point as well as for the overall set of
unique blocks (residents). Sample input is in
<code>testoutput_getblocksnearby_10pts_1miles</code> and sample output
is in <code>testoutput_doaggregate_10pts_1miles</code></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="key-groups-of-functions">Key groups of functions<a class="anchor" aria-label="anchor" href="#key-groups-of-functions"></a>
</h2>
<p>The EJAM package reference manual has a complete list of documented
functions, grouped by category. There are several categories of
functions listed there:</p>
<ul>
<li>Key Functions <code><a href="../reference/ejamit.html">ejamit()</a></code>, <code><a href="../reference/ejam2report.html">ejam2report()</a></code>,
<code><a href="../reference/ejam2excel.html">ejam2excel()</a></code>, <code><a href="../reference/ejam2map.html">ejam2map()</a></code>,
<code><a href="../reference/ejam2ratios.html">ejam2ratios()</a></code>
</li>
<li>Specify Points by Lat/Lon</li>
<li>Specify Facilities by ID</li>
<li>Specify Facility Type</li>
<li>Specify Places by Shapefile</li>
<li>Specify Counties, etc./FIPS tools</li>
<li>Blocks, Distances, Residents - e.g.,
<code><a href="../reference/getblocksnearby.html">getblocksnearby()</a></code>
</li>
<li>Calculating and Aggregating</li>
<li>Viewing Results (using the overall functions above)</li>
<li>Test Data (if EJAM is installed, try
<code>browseURL(system.file("testdata", package = "EJAM"))</code>)</li>
<li>Utilities for finding URL or API info</li>
<li>etc.</li>
</ul>
<p>Also see <code>data("EJAM")</code> and see
?<code><a href="../reference/dataload_from_pins.html">dataload_from_pins()</a></code> and <code>usastats</code>,
<code>statestats</code></p>
</div>
<div class="section level2">
<h2 id="points-nearby-residents">POINTS &amp; NEARBY RESIDENTS<a class="anchor" aria-label="anchor" href="#points-nearby-residents"></a>
</h2>
<p>EJAM offers a variety of ways to specify the places to be analyzed
and compared. Once you specify some list of places, EJAM will analyze
them as a whole (overall), and also individually so that you can compare
places to each other.</p>
<p>Places analyzed and compared can be any of the following:</p>
<ul>
<li>Points, defining all residents within X miles of each point</li>
<li>Polygons (from shapefiles), such as redlining zones, higher risk
areas based on modeling, etc.</li>
<li>Census Units such as Counties or other types of Census Units defined
by FIPS code (e.g., Counties in one State)</li>
</ul>
<p>Groups will be available in another type of analysis, not yet
implemented. Groups will let you get statistics for each group, to
compare categories of places. Whole groups of points/ polygons/ census
areas will be treated as the units of analysis. This will allow you to
define groups of points, for example, and get a summary for each group,
such as residents near any of the facilities of one type. This enables
comparison of categories of places, such as analyzing 3 types of
facilities at once with results aggregated for each type, or comparing
redlining zones grouped by grade, or comparing areas with some feature
(poor air quality, or receiving grants, etc.) versus areas without that
trait, all limited to one State or Region, for example.</p>
<p>To analyze points and the circular areas around each one, you can
specify the points in two basic ways:</p>
<ul>
<li>A list of points defined by coordinates or by EPA ID numbers for
each point</li>
<li>All points that are the locations of EPA-regulated facilities of a
certain type. The categories that can be used include the
following:</li>
<li>EPA Program (e.g., all greenhouse gas reporting facilities)</li>
<li>Industry type, based on NAICS code (e.g., )</li>
</ul>
<div class="section level3">
<h3 id="compare-all-points-in-a-category">Compare all Points in a Category<a class="anchor" aria-label="anchor" href="#compare-all-points-in-a-category"></a>
</h3>
</div>
<div class="section level3">
<h3 id="specify-points-where-you-want-to-center-the-circular-buffers">Specify points (where you want to center the circular buffers)<a class="anchor" aria-label="anchor" href="#specify-points-where-you-want-to-center-the-circular-buffers"></a>
</h3>
<p>You can define locations as all residents within X miles of any one
or more of the specified points, and you can define those points in a
few ways. One way is to upload a table of coordinates – latitude and
longitude for each point, one row per site, with columns called lat and
lon (or some synonyms that work).</p>
<p>The simplest way to do that in the RStudio console is something like
<code>x &lt;- ejamit()</code>, which prompts you to upload a spreadsheet
with lat lon columns, and asks you for the radius.</p>
<p>You can also specify a set of facilities by uploading their Registry
ID numbers in a table, or using other identifiers. For example, there is
a function <code><a href="../reference/latlon_from_programid.html">latlon_from_programid()</a></code> in the examples
below.</p>
<p>You can define circular buffers around a set of EPA-regulated
facilities in a few other ways as well, such as by NAICS (or SIC)
industry names or codes, EPA program covering the set of facilities
(e.g., all greenhouse gas reporters), or a Clean Air Act MACT
subpart.</p>
<div class="section level4">
<h4 id="by-industry-naics">by Industry (NAICS)<a class="anchor" aria-label="anchor" href="#by-industry-naics"></a>
</h4>
<p>You can specify sites by NAICS, but it is important to note the FRS
lacks NAICS info for many regulated facilities!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"paint and coating"</span>, children <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt;      code     n2     n3     n4     n5     n6                            name</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;                          &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  32551     32    325   3255  32551  32551 Paint and Coating Manufacturing</span></span>
<span><span class="co">#&gt; 2: 325510     32    325   3255  32551 325510 Paint and Coating Manufacturing</span></span>
<span><span class="co">#&gt; 3: 325510     32    325   3255  32551 325510 Paint and Coating Manufacturing</span></span>
<span><span class="co">#&gt;                                    num_name</span></span>
<span><span class="co">#&gt;                                      &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  32551 - Paint and Coating Manufacturing</span></span>
<span><span class="co">#&gt; 2: 325510 - Paint and Coating Manufacturing</span></span>
<span><span class="co">#&gt; 3: 325510 - Paint and Coating Manufacturing</span></span>
<span><span class="co">## note latlon_from_naics() requires the frs_by_naics dataset, which it tries to load on demand.</span></span>
<span><span class="co"># head(latlon_from_naics(325510)) # has about 1,000 facilities</span></span>
<span></span>
<span><span class="co">## All sectors with this phrase in their NAICS title</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  x &lt;- ejamit(frs_from_naics("paint and coating"), 1)</span></span></code></pre></div>
<p>See many more examples of working with NAICS, in a section below.</p>
</div>
<div class="section level4">
<h4 id="by-facility-using-epa-registry-id">by Facility, using EPA Registry ID<a class="anchor" aria-label="anchor" href="#by-facility-using-epa-registry-id"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note frs_from_regid() and latlon_from_regid() require the frs dataset, which they try to load on demand.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/frs_from_regid.html">frs_from_regid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">110071293460</span>, <span class="fl">110000333826</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## interactively upload file with table of REGISTRY_ID values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latlon_from_regid.html">latlon_from_regid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/EJAMejscreenapi/man/read_csv_or_xl.html" class="external-link">read_csv_or_xl</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">REGISTRY_ID</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## and run through EJAM</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ejamit.html">ejamit</a></span><span class="op">(</span><span class="fu"><a href="../reference/latlon_from_regid.html">latlon_from_regid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/EJAMejscreenapi/man/read_csv_or_xl.html" class="external-link">read_csv_or_xl</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">REGISTRY_ID</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#  # still debugging Island Areas validation here!</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="by-facility-using-epa-program-system-id">by Facility, using EPA Program System ID<a class="anchor" aria-label="anchor" href="#by-facility-using-epa-program-system-id"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># latlon_from_programid() requires access to the frs_by_programid dataset, which it tries to load on demand.</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs_by_programid"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/latlon_from_programid.html">latlon_from_programid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XJW000012435"</span>, <span class="st">"00768SRTRSROAD1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="by-epa-regulatory-program">by EPA Regulatory Program<a class="anchor" aria-label="anchor" href="#by-epa-regulatory-program"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note latlon_from_programid() requires the frs and frs_by_programid datasets, which it tries to load on demand.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs_by_programid"</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## Map of over 10,000 facilities in FRS identified as in the E-Grid power plant database</span></span>
<span>  </span>
<span>  <span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latlon_from_program.html">latlon_from_program</a></span><span class="op">(</span><span class="st">"EGRID"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## In just 1 State</span></span>
<span>  <span class="va">pts</span><span class="op">[</span>, <span class="va">ST</span> <span class="op">:=</span> <span class="fu"><a href="../reference/state_from_latlon.html">state_from_latlon</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">lat</span>, lon <span class="op">=</span> <span class="va">lon</span><span class="op">)</span><span class="op">$</span><span class="va">ST</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="va">pts</span><span class="op">[</span><span class="va">ST</span> <span class="op">==</span> <span class="st">"TX"</span>, <span class="op">]</span>, radius <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## 10 largest programs (including State programs in the dataset)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Count.of.facilities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">frs_by_programid</span><span class="op">$</span><span class="va">program</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Largest Federal lists (many of the codes represent State databases)</span></span>
<span>  </span>
<span>  <span class="va">epa_programs_counts</span> <span class="op">&lt;-</span> <span class="va">frs_by_programid</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"program"</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">epa_programs_counts</span><span class="op">$</span><span class="va">fed</span> <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[A-Z]{2}[-]"</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">epa_programs_counts</span><span class="op">$</span><span class="va">program</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">epa_programs_counts</span><span class="op">[</span><span class="va">fed</span> <span class="op">==</span> <span class="cn">TRUE</span>, <span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span>, <span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="by-mact-subpart-hazardous-air-pollutant-source-category">by MACT Subpart (hazardous air pollutant source category)<a class="anchor" aria-label="anchor" href="#by-mact-subpart-hazardous-air-pollutant-source-category"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note latlon_from_mactsubpart() requires the frs_by_mact dataset, which it tries to load on demand</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs_by_mact"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Search by name of category</span></span>
<span>  <span class="va">mact_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"ethylene"</span>, <span class="va">mact_table</span><span class="op">$</span><span class="va">title</span>, ignore.case <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">eto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/latlon_from_mactsubpart.html">latlon_from_mactsubpart</a></span><span class="op">(</span><span class="st">"O"</span> <span class="op">)</span>, </span>
<span>    <span class="fu"><a href="../reference/latlon_from_mactsubpart.html">latlon_from_mactsubpart</a></span><span class="op">(</span><span class="st">"WWWWW"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co">#  Map the category</span></span>
<span>  <span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="va">eto</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Browse the full list of categories</span></span>
<span>  <span class="co"># mact_table[ , c("N", "subpart", "title")]</span></span>
<span>  </span>
<span>  <span class="co"># The 10 largest categories</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">mact_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mact_table</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"subpart"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Many facilities lack latitude longitude information in this database</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/latlon_from_mactsubpart.html">latlon_from_mactsubpart</a></span><span class="op">(</span><span class="st">"A"</span>, include_if_no_latlon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/latlon_from_mactsubpart.html">latlon_from_mactsubpart</a></span><span class="op">(</span><span class="st">"A"</span>, include_if_no_latlon <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/latlon_from_mactsubpart.html">latlon_from_mactsubpart</a></span><span class="op">(</span><span class="st">"OOOO"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="working-with-naics-codes-industry-codes">Working with NAICS Codes (Industry Codes)<a class="anchor" aria-label="anchor" href="#working-with-naics-codes-industry-codes"></a>
</h3>
<div class="section level4">
<h4 id="naics-codes-to-map-or-analyze-facilities-in-one-industrial-sector">NAICS Codes to Map or Analyze Facilities in one Industrial
Sector<a class="anchor" aria-label="anchor" href="#naics-codes-to-map-or-analyze-facilities-in-one-industrial-sector"></a>
</h4>
<p>NAICS/industry categories</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/naics_categories.html">naics_categories</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Also see https://www.naics.com/search/</span></span>
<span><span class="co">#&gt;                                                                               [,1]</span></span>
<span><span class="co">#&gt; 11 - Agriculture, Forestry, Fishing and Hunting                                 11</span></span>
<span><span class="co">#&gt; 21 - Mining, Quarrying, and Oil and Gas Extraction                              21</span></span>
<span><span class="co">#&gt; 22 - Utilities                                                                  22</span></span>
<span><span class="co">#&gt; 23 - Construction                                                               23</span></span>
<span><span class="co">#&gt; 42 - Wholesale Trade                                                            42</span></span>
<span><span class="co">#&gt; 51 - Information                                                                51</span></span>
<span><span class="co">#&gt; 52 - Finance and Insurance                                                      52</span></span>
<span><span class="co">#&gt; 53 - Real Estate and Rental and Leasing                                         53</span></span>
<span><span class="co">#&gt; 54 - Professional, Scientific, and Technical Services                           54</span></span>
<span><span class="co">#&gt; 55 - Management of Companies and Enterprises                                    55</span></span>
<span><span class="co">#&gt; 56 - Administrative and Support and Waste Management and Remediation Services   56</span></span>
<span><span class="co">#&gt; 61 - Educational Services                                                       61</span></span>
<span><span class="co">#&gt; 62 - Health Care and Social Assistance                                          62</span></span>
<span><span class="co">#&gt; 71 - Arts, Entertainment, and Recreation                                        71</span></span>
<span><span class="co">#&gt; 72 - Accommodation and Food Services                                            72</span></span>
<span><span class="co">#&gt; 81 - Other Services (except Public Administration)                              81</span></span>
<span><span class="co">#&gt; 92 - Public Administration                                                      92</span></span>
<span><span class="co">#&gt; 31 - Manufacturing                                                              31</span></span>
<span><span class="co">#&gt; 32 - Manufacturing                                                              32</span></span>
<span><span class="co">#&gt; 33 - Manufacturing                                                              33</span></span>
<span><span class="co">#&gt; 44 - Retail Trade                                                               44</span></span>
<span><span class="co">#&gt; 45 - Retail Trade                                                               45</span></span>
<span><span class="co">#&gt; 48 - Transportation and Warehousing                                             48</span></span>
<span><span class="co">#&gt; 49 - Transportation and Warehousing                                             49</span></span>
<span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_categories.html">naics_categories</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>,<span class="fu">.</span><span class="op">(</span><span class="va">name</span>,<span class="va">code</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; Also see https://www.naics.com/search/</span></span>
<span><span class="co">#&gt;                                                                              name</span></span>
<span><span class="co">#&gt;                                                                            &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1:                                                                 Accommodation</span></span>
<span><span class="co">#&gt;  2:                                           Administration of Economic Programs</span></span>
<span><span class="co">#&gt;  3:                              Administration of Environmental Quality Programs</span></span>
<span><span class="co">#&gt;  4: Administration of Housing Programs, Urban Planning, and Community Development</span></span>
<span><span class="co">#&gt;  5:                                     Administration of Human Resource Programs</span></span>
<span><span class="co">#&gt;  6:                                           Administrative and Support Services</span></span>
<span><span class="co">#&gt;  7:                                                            Air Transportation</span></span>
<span><span class="co">#&gt;  8:                                               Ambulatory Health Care Services</span></span>
<span><span class="co">#&gt;  9:                                Amusement, Gambling, and Recreation Industries</span></span>
<span><span class="co">#&gt; 10:                                             Animal Production and Aquaculture</span></span>
<span><span class="co">#&gt;      code</span></span>
<span><span class="co">#&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:   721</span></span>
<span><span class="co">#&gt;  2:   926</span></span>
<span><span class="co">#&gt;  3:   924</span></span>
<span><span class="co">#&gt;  4:   925</span></span>
<span><span class="co">#&gt;  5:   923</span></span>
<span><span class="co">#&gt;  6:   561</span></span>
<span><span class="co">#&gt;  7:   481</span></span>
<span><span class="co">#&gt;  8:   621</span></span>
<span><span class="co">#&gt;  9:   713</span></span>
<span><span class="co">#&gt; 10:   112</span></span>
<span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_categories.html">naics_categories</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span>,<span class="fu">.</span><span class="op">(</span><span class="va">code</span>,<span class="va">name</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; Also see https://www.naics.com/search/</span></span>
<span><span class="co">#&gt;      code                                            name</span></span>
<span><span class="co">#&gt;     &lt;num&gt;                                          &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1:   111                                 Crop Production</span></span>
<span><span class="co">#&gt;  2:   112               Animal Production and Aquaculture</span></span>
<span><span class="co">#&gt;  3:   113                            Forestry and Logging</span></span>
<span><span class="co">#&gt;  4:   114                   Fishing, Hunting and Trapping</span></span>
<span><span class="co">#&gt;  5:   115 Support Activities for Agriculture and Forestry</span></span>
<span><span class="co">#&gt;  6:   211                          Oil and Gas Extraction</span></span>
<span><span class="co">#&gt;  7:   212                     Mining (except Oil and Gas)</span></span>
<span><span class="co">#&gt;  8:   213                   Support Activities for Mining</span></span>
<span><span class="co">#&gt;  9:   221                                       Utilities</span></span>
<span><span class="co">#&gt; 10:   236                       Construction of Buildings</span></span>
<span></span>
<span><span class="co"># See a data table of facilities in one industry</span></span>
<span><span class="fu"><a href="../reference/dataload_from_pins.html">dataload_from_pins</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Connecting to Posit Connect 2024.01.0 at</span></span>
<span><span class="co">#&gt; &lt;https://rstudio-connect.dmap-stage.aws.epa.gov&gt;</span></span>
<span><span class="co">#&gt; Successfully connected to Posit Connect pins board.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs          - is NOT in memory. Checking local disk... frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; trying to load frs  from EJAM/frs.rda</span></span>
<span><span class="co">#&gt; Client error: (404) Not Found</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  and could NOT download frs from DMAP AWS data commons</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">industryword</span> <span class="op">&lt;-</span> <span class="st">"pulp"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span> <span class="fu"><a href="../reference/frs_from_naics.html">frs_from_naics</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="va">industryword</span><span class="op">)</span><span class="op">$</span><span class="va">code</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Quick map of EPA-regulated facilities in one industrial category,
which you can click on to see popup windows about sites.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note frs_from_naics() requires the frs dataset, which it tries to load on demand.</span></span>
<span><span class="fu"><a href="../reference/dataload_from_pins.html">dataload_from_pins</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Connecting to Posit Connect 2024.01.0 at</span></span>
<span><span class="co">#&gt; &lt;https://rstudio-connect.dmap-stage.aws.epa.gov&gt;</span></span>
<span><span class="co">#&gt; Successfully connected to Posit Connect pins board.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs          - is NOT in memory. Checking local disk... frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; trying to load frs  from EJAM/frs.rda</span></span>
<span><span class="co">#&gt; Client error: (404) Not Found</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  and could NOT download frs from DMAP AWS data commons</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="fu"><a href="../reference/frs_from_naics.html">frs_from_naics</a></span><span class="op">(</span><span class="st">"smelt"</span><span class="op">)</span><span class="op">)</span> <span class="co"># may be slow the 1st time, if it loads frs dataset</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>(but note that this FRS dataset lacks NAICS for most facilities!)</p>
<p>Table of facilities in an industry, plus links to each facility in
ECHO and EJScreen</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">industryword</span> <span class="op">&lt;-</span> <span class="st">"chemical manuf"</span></span>
<span><span class="co">#  industryword &lt;- "smelt"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">mysites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/frs_from_naics.html">frs_from_naics</a></span><span class="op">(</span><span class="va">industryword</span>, children <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span></span>
<span><span class="va">regids</span> <span class="op">&lt;-</span> <span class="va">mysites</span><span class="op">$</span><span class="va">REGISTRY_ID</span></span>
<span><span class="va">link1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/url_echo_facility_webpage.html">url_echo_facility_webpage</a></span><span class="op">(</span><span class="va">regids</span>, as_html <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">link2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/url_ejscreen_report.html">url_ejscreen_report</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">mysites</span><span class="op">$</span><span class="va">lat</span>, lon <span class="op">=</span> <span class="va">mysites</span><span class="op">$</span><span class="va">lon</span>, radius <span class="op">=</span> <span class="fl">3</span>, as_html <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">link3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/url_ejscreenmap.html">url_ejscreenmap</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">mysites</span><span class="op">$</span><span class="va">lat</span>, lon <span class="op">=</span> <span class="va">mysites</span><span class="op">$</span><span class="va">lon</span>,  as_html <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># # same:</span></span>
<span><span class="co"># my_industry &lt;- naics_from_any("chemical manuf",children = F)[,.(code,name)]</span></span>
<span><span class="co"># mysites &lt;- frs_from_naics(my_industry$code)[,1:5]</span></span>
<span><span class="va">mysites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>`ECHO report` <span class="op">=</span> <span class="va">link1</span>, </span>
<span>                 `EJScreen Report` <span class="op">=</span> <span class="va">link2</span>, `EJScreen Map` <span class="op">=</span> <span class="va">link3</span>,</span>
<span>                 <span class="va">mysites</span><span class="op">)</span></span>
<span><span class="va">caption</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mysites</span><span class="op">)</span>, <span class="st">' sites have NAICS matching "'</span>, <span class="va">industryword</span>, <span class="st">'"'</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mysites</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1500</span><span class="op">)</span> <span class="op">{</span><span class="va">mysites</span> <span class="op">&lt;-</span> <span class="va">mysites</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1500</span>, <span class="op">]</span><span class="op">}</span> <span class="co"># &gt;2k rows is too much for client-side DataTables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">caption</span>,<span class="st">'\n'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    <span class="va">mysites</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span>,</span>
<span>    escape <span class="op">=</span> <span class="cn">FALSE</span>,     rownames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    caption <span class="op">=</span> <span class="va">caption</span>,</span>
<span>    filter <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Map of facilities in an industry, plus popups with links to each
facility in ECHO and EJScreen</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="va">mysites</span><span class="op">)</span></span></code></pre></div>
<p>Search using industry codes or text in industry names</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"plastics and rubber"</span><span class="op">)</span> </span>
<span><span class="co">#&gt;     code     n2     n3     n4     n5     n6</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   326     32    326    326    326    326</span></span>
<span><span class="co">#&gt;                                          name</span></span>
<span><span class="co">#&gt;                                        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: Plastics and Rubber Products Manufacturing</span></span>
<span><span class="co">#&gt;                                            num_name</span></span>
<span><span class="co">#&gt;                                              &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 326 - Plastics and Rubber Products Manufacturing</span></span>
<span></span>
<span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="fl">326</span><span class="op">)</span></span>
<span><span class="co">#&gt;     code     n2     n3     n4     n5     n6</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   326     32    326    326    326    326</span></span>
<span><span class="co">#&gt;                                          name</span></span>
<span><span class="co">#&gt;                                        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: Plastics and Rubber Products Manufacturing</span></span>
<span><span class="co">#&gt;                                            num_name</span></span>
<span><span class="co">#&gt;                                              &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 326 - Plastics and Rubber Products Manufacturing</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="fl">326</span>, children <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">code</span>,<span class="va">name</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      code</span></span>
<span><span class="co">#&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    326</span></span>
<span><span class="co">#&gt; 2:   3261</span></span>
<span><span class="co">#&gt; 3:  32611</span></span>
<span><span class="co">#&gt; 4: 326111</span></span>
<span><span class="co">#&gt; 5: 326112</span></span>
<span><span class="co">#&gt; 6: 326113</span></span>
<span><span class="co">#&gt;                                                                         name</span></span>
<span><span class="co">#&gt;                                                                       &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                                Plastics and Rubber Products Manufacturing</span></span>
<span><span class="co">#&gt; 2:                                            Plastics Product Manufacturing</span></span>
<span><span class="co">#&gt; 3: Plastics Packaging Materials and Unlaminated Film and Sheet Manufacturing</span></span>
<span><span class="co">#&gt; 4:                                      Plastics Bag and Pouch Manufacturing</span></span>
<span><span class="co">#&gt; 5:     Plastics Packaging Film and Sheet (including Laminated) Manufacturing</span></span>
<span><span class="co">#&gt; 6:      Unlaminated Plastics Film and Sheet (except Packaging) Manufacturing</span></span>
<span></span>
<span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"pig"</span><span class="op">)</span> </span>
<span><span class="co">#&gt;      code     n2     n3     n4     n5     n6</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   1122     11    112   1122   1122   1122</span></span>
<span><span class="co">#&gt; 2:  11221     11    112   1122  11221  11221</span></span>
<span><span class="co">#&gt; 3: 112210     11    112   1122  11221 112210</span></span>
<span><span class="co">#&gt; 4:  32513     32    325   3251  32513  32513</span></span>
<span><span class="co">#&gt; 5: 325130     32    325   3251  32513 325130</span></span>
<span><span class="co">#&gt;                                       name</span></span>
<span><span class="co">#&gt;                                     &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                     Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 2:                     Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 3:                     Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 4: Synthetic Dye and Pigment Manufacturing</span></span>
<span><span class="co">#&gt; 5: Synthetic Dye and Pigment Manufacturing</span></span>
<span><span class="co">#&gt;                                            num_name</span></span>
<span><span class="co">#&gt;                                              &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                       1122 - Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 2:                      11221 - Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 3:                     112210 - Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 4:  32513 - Synthetic Dye and Pigment Manufacturing</span></span>
<span><span class="co">#&gt; 5: 325130 - Synthetic Dye and Pigment Manufacturing</span></span>
<span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"pig "</span><span class="op">)</span> <span class="co"># space after g</span></span>
<span><span class="co">#&gt;      code     n2     n3     n4     n5     n6                name</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;              &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   1122     11    112   1122   1122   1122 Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 2:  11221     11    112   1122  11221  11221 Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 3: 112210     11    112   1122  11221 112210 Hog and Pig Farming</span></span>
<span><span class="co">#&gt;                        num_name</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   1122 - Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 2:  11221 - Hog and Pig Farming</span></span>
<span><span class="co">#&gt; 3: 112210 - Hog and Pig Farming</span></span>
<span></span>
<span><span class="co"># a OR b,  a AND b,  etc.</span></span>
<span><span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"plastics"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"rubber"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setops.html" class="external-link">fintersect</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">name</span>,<span class="va">code</span><span class="op">)</span><span class="op">]</span> <span class="co">#  a AND b</span></span>
<span><span class="co">#&gt;                                                   name   code</span></span>
<span><span class="co">#&gt;                                                 &lt;char&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          Plastics and Rubber Products Manufacturing    326</span></span>
<span><span class="co">#&gt; 2: Rubber and Plastics Hoses and Belting Manufacturing  32622</span></span>
<span><span class="co">#&gt; 3: Rubber and Plastics Hoses and Belting Manufacturing 326220</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setops.html" class="external-link">funion</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">name</span>,<span class="va">code</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>     <span class="co">#  a OR  b</span></span>
<span><span class="co">#&gt;                                                                         name</span></span>
<span><span class="co">#&gt;                                                                       &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                                 Plastics Material and Resin Manufacturing</span></span>
<span><span class="co">#&gt; 2:                                Plastics and Rubber Products Manufacturing</span></span>
<span><span class="co">#&gt; 3:                                            Plastics Product Manufacturing</span></span>
<span><span class="co">#&gt; 4: Plastics Packaging Materials and Unlaminated Film and Sheet Manufacturing</span></span>
<span><span class="co">#&gt; 5:                                      Plastics Bag and Pouch Manufacturing</span></span>
<span><span class="co">#&gt; 6:     Plastics Packaging Film and Sheet (including Laminated) Manufacturing</span></span>
<span><span class="co">#&gt;      code</span></span>
<span><span class="co">#&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 325211</span></span>
<span><span class="co">#&gt; 2:    326</span></span>
<span><span class="co">#&gt; 3:   3261</span></span>
<span><span class="co">#&gt; 4:  32611</span></span>
<span><span class="co">#&gt; 5: 326111</span></span>
<span><span class="co">#&gt; 6: 326112</span></span>
<span></span>
<span><span class="co"># naics_subcodes_from_code(funion(a,b)[,code])[,.(name,code)]   #  plus children</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setops.html" class="external-link">funion</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">[</span>,<span class="va">code</span><span class="op">]</span>, children <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">name</span>,<span class="va">code</span><span class="op">)</span><span class="op">]</span> <span class="op">)</span> <span class="co">#  same</span></span>
<span><span class="co">#&gt;                                                                         name</span></span>
<span><span class="co">#&gt;                                                                       &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                                Plastics and Rubber Products Manufacturing</span></span>
<span><span class="co">#&gt; 2:                                            Plastics Product Manufacturing</span></span>
<span><span class="co">#&gt; 3: Plastics Packaging Materials and Unlaminated Film and Sheet Manufacturing</span></span>
<span><span class="co">#&gt; 4:                                      Plastics Bag and Pouch Manufacturing</span></span>
<span><span class="co">#&gt; 5:     Plastics Packaging Film and Sheet (including Laminated) Manufacturing</span></span>
<span><span class="co">#&gt; 6:      Unlaminated Plastics Film and Sheet (except Packaging) Manufacturing</span></span>
<span><span class="co">#&gt;      code</span></span>
<span><span class="co">#&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    326</span></span>
<span><span class="co">#&gt; 2:   3261</span></span>
<span><span class="co">#&gt; 3:  32611</span></span>
<span><span class="co">#&gt; 4: 326111</span></span>
<span><span class="co">#&gt; 5: 326112</span></span>
<span><span class="co">#&gt; 6: 326113</span></span></code></pre></div>
<p>A NAICS code can have many “children” or subcategories under it</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dataload_from_pins.html">dataload_from_pins</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Connecting to Posit Connect 2024.01.0 at</span></span>
<span><span class="co">#&gt; &lt;https://rstudio-connect.dmap-stage.aws.epa.gov&gt;</span></span>
<span><span class="co">#&gt; Successfully connected to Posit Connect pins board.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs          - is NOT in memory. Checking local disk... frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; frs         is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/frs.arrow </span></span>
<span><span class="co">#&gt; trying to load frs  from EJAM/frs.rda</span></span>
<span><span class="co">#&gt; Client error: (404) Not Found</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  and could NOT download frs from DMAP AWS data commons</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"frs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"chem"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># about 20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"chem"</span>, children <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># &gt;100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="fu"><a href="../reference/frs_from_naics.html">frs_from_naics</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"chem"</span><span class="op">)</span><span class="op">$</span><span class="va">code</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># a few thousand</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="fu"><a href="../reference/frs_from_naics.html">frs_from_naics</a></span><span class="op">(</span><span class="fu"><a href="../reference/naics_from_any.html">naics_from_any</a></span><span class="op">(</span><span class="st">"chem"</span>, children <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">code</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># &gt;10,000</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="shapefiles">SHAPEFILES<a class="anchor" aria-label="anchor" href="#shapefiles"></a>
</h2>
<div class="section level4">
<h4 id="polygons-in-shapefiles-as-the-places-to-compare">Polygons in shapefiles as the places to compare<a class="anchor" aria-label="anchor" href="#polygons-in-shapefiles-as-the-places-to-compare"></a>
</h4>
<p>You can upload polygons in a shapefile, and use EJAM to analyze them.
See the Shiny app.</p>
<p>See shapefile_from_any() and related functions:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/shapefile_from_any.html">shapefile_from_any</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_from_gdbzip.html">shapefile_from_gdbzip</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_from_gdb.html">shapefile_from_gdb</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">shapefile_from_json</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_from_filepaths.html">shapefile_from_filepaths</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_from_folder.html">shapefile_from_folder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_filepaths_from_folder.html">shapefile_filepaths_from_folder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_filepaths_valid.html">shapefile_filepaths_valid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_clean.html">shapefile_clean</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shapefile_from_sitepoints.html">shapefile_from_sitepoints</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shape_buffered_from_shapefile.html">shape_buffered_from_shapefile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shape_buffered_from_shapefile_points.html">shape_buffered_from_shapefile_points</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shapefile_from_gdbzip.html">shapefile_from_gdbzip</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata/shapes/portland.gdb.zip"</span>, package <span class="op">=</span> <span class="st">"EJAM"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fips-codes">FIPS CODES<a class="anchor" aria-label="anchor" href="#fips-codes"></a>
</h2>
<div class="section level4">
<h4 id="counties-as-the-places-to-compare">Counties as the places to compare<a class="anchor" aria-label="anchor" href="#counties-as-the-places-to-compare"></a>
</h4>
<p>You can compare places defined by FIPS code, such as a group of US
Counties.</p>
<p>Compare all Counties in a State, using EJAM indicators</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Get FIPS of each county in Delaware</span></span>
<span><span class="va">mystate</span> <span class="op">&lt;-</span> <span class="st">"Delaware"</span></span>
<span><span class="va">cfips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fips_counties_from_statename.html">fips_counties_from_statename</a></span><span class="op">(</span><span class="va">mystate</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## You could launch a web browser tab for each of the counties,</span></span>
<span><span class="co">##  to see each of the County reports from EJScreen, like this:</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># sapply(url_ejscreen_report(areaid = cfips), browseURL)</span></span>
<span></span>
<span><span class="co">## Analyze EJ stats for each county in the State</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ejamit.html">ejamit</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="va">cfips</span><span class="op">)</span> <span class="co"># radius not used</span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span>, escape <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/table_tall_from_overall.html">table_tall_from_overall</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_overall</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'ejam_uniq_id'</span>, <span class="st">'pop'</span>, <span class="va">names_d_subgroups_ratio_to_state_avg</span><span class="op">)</span>, with <span class="op">=</span> <span class="cn">F</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mapfastej_counties.html">mapfastej_counties</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fips2countyname.html">fips2countyname</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">$</span><span class="va">ejam_uniq_id</span><span class="op">)</span></span>
<span><span class="co">#cnames &lt;- c("Kent County", "New Castle County", "Sussex County")</span></span>
<span><span class="co">#cnames &lt;- gsub(" County", "", cnames)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">$</span><span class="va">pctlowinc</span>, names.arg <span class="op">=</span> <span class="va">cnames</span>,</span>
<span>        main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'% Low Income by County in '</span>, <span class="va">mystate</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Another example</span></span>
<span><span class="va">mystate</span> <span class="op">&lt;-</span> <span class="st">"Maryland"</span></span>
<span><span class="va">vname</span> <span class="op">&lt;-</span> <span class="st">"% low income"</span></span>
<span><span class="va">xmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ejamit.html">ejamit</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="fu"><a href="../reference/fips_counties_from_statename.html">fips_counties_from_statename</a></span><span class="op">(</span><span class="va">mystate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggblanket</span><span class="fu">::</span><span class="fu"><a href="https://davidhodge931.github.io/ggblanket/reference/gg_col.html" class="external-link">gg_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">xmd</span><span class="op">$</span><span class="va">results_bysite</span>,</span>
<span>                  y <span class="op">=</span> <span class="va">pctlowinc</span>,</span>
<span>                  x <span class="op">=</span> <span class="va">ejam_uniq_id</span>,</span>
<span>                  title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vname</span>, <span class="st">' by County in '</span>, <span class="va">mystate</span><span class="op">)</span>,</span>
<span>                  y_title <span class="op">=</span> <span class="va">vname</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mapfastej_counties.html">mapfastej_counties</a></span><span class="op">(</span><span class="va">xmd</span><span class="op">$</span><span class="va">results_bysite</span>, <span class="st">'state.pctile.pctlowinc'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="exploring-results">EXPLORING RESULTS<a class="anchor" aria-label="anchor" href="#exploring-results"></a>
</h2>
<div class="section level4">
<h4 id="the-most-striking-findings-e-g--which-group-is-most-overrepresented">The most striking findings (e.g., which group is most
overrepresented?)<a class="anchor" aria-label="anchor" href="#the-most-striking-findings-e-g--which-group-is-most-overrepresented"></a>
</h4>
<p>See examples above using ejam2report() but also you can check some
key findings like this:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_1000pts_1miles</span> </span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">results_bysite</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDF.html" class="external-link">setDF</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ratio_benchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.01</span>, <span class="fl">1.50</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ratiodata</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span>, <span class="va">names_d_ratio_to_state_avg</span><span class="op">]</span></span>
<span></span>
<span><span class="va">findings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count_sites_with_n_high_scores.html">count_sites_with_n_high_scores</a></span><span class="op">(</span><span class="va">ratiodata</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># long output to console !</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># the most extreme finding!</span></span>
<span><span class="co">#&gt; [1] "At 3% of these sites, at least 1 of the indicators is at least 5 times the statewide overall average."</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="the-key-facilities-e-g--which-has-the-max-of-or-has-multiple-elevated-ej-indexes">The key facilities (e.g., which has the max of – or has multiple
elevated – EJ indexes?)<a class="anchor" aria-label="anchor" href="#the-key-facilities-e-g--which-has-the-max-of-or-has-multiple-elevated-ej-indexes"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ejamit.html">ejamit</a></span><span class="op">(</span></span>
<span>  sitepoints <span class="op">=</span>  <span class="va">testpoints_100</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">3.1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">out2</span><span class="op">$</span><span class="va">results_summarized</span><span class="op">$</span><span class="va">cols</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="more-summary-findings">More summary findings<a class="anchor" aria-label="anchor" href="#more-summary-findings"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">findings</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="va">findings</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "At 95% of these sites, at least 1 of the indicators is at least 1.01 times the statewide overall average."</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt;      cut</span></span>
<span><span class="co">#&gt; count 1.01   2   5  10</span></span>
<span><span class="co">#&gt;    0    50 708 969 992</span></span>
<span><span class="co">#&gt;    1   162 160  25   2</span></span>
<span><span class="co">#&gt;    2   181  45   0   0</span></span>
<span><span class="co">#&gt;    3   110  32   0   0</span></span>
<span><span class="co">#&gt;    4    79  21   0   0</span></span>
<span><span class="co">#&gt;    5    70  11   0   0</span></span>
<span><span class="co">#&gt;    6    77  13   0   0</span></span>
<span><span class="co">#&gt;    7    82   4   0   0</span></span>
<span><span class="co">#&gt;    8    91   0   0   0</span></span>
<span><span class="co">#&gt;    9    88   0   0   0</span></span>
<span><span class="co">#&gt;    10    4   0   0   0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> , <span class="fl">1</span>, <span class="op">]</span>, <span class="fl">21</span><span class="op">)</span></span>
<span><span class="co">#&gt;      stat</span></span>
<span><span class="co">#&gt; count count cum pct cum_pct</span></span>
<span><span class="co">#&gt;    0     50 994   5     100</span></span>
<span><span class="co">#&gt;    1    162 944  16      95</span></span>
<span><span class="co">#&gt;    2    181 782  18      79</span></span>
<span><span class="co">#&gt;    3    110 601  11      60</span></span>
<span><span class="co">#&gt;    4     79 491   8      49</span></span>
<span><span class="co">#&gt;    5     70 412   7      41</span></span>
<span><span class="co">#&gt;    6     77 342   8      34</span></span>
<span><span class="co">#&gt;    7     82 265   8      27</span></span>
<span><span class="co">#&gt;    8     91 183   9      18</span></span>
<span><span class="co">#&gt;    9     88  92   9       9</span></span>
<span><span class="co">#&gt;    10     4   4   0       0</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> , <span class="fl">1</span>, <span class="op">]</span> </span>
<span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">[</span>, <span class="st">"cum_pct"</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">[</span>, <span class="st">"cum_pct"</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">80</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;      stat</span></span>
<span><span class="co">#&gt; count count cum pct cum_pct</span></span>
<span><span class="co">#&gt;     2   181 782  18      79</span></span>
<span><span class="co">#&gt;     3   110 601  11      60</span></span>
<span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> <span class="fl">1</span>, , <span class="op">]</span></span>
<span><span class="co">#&gt;       stat</span></span>
<span><span class="co">#&gt; cut    count cum pct cum_pct</span></span>
<span><span class="co">#&gt;   1.01    50 994   5     100</span></span>
<span><span class="co">#&gt;   2      708 994  71     100</span></span>
<span><span class="co">#&gt;   5      969 994  97     100</span></span>
<span><span class="co">#&gt;   10     992 994 100     100</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="site-by-site-detailed-results-in-datatable-format-in-rstudio-viewer">Site by site detailed results in datatable format in RStudio
viewer:<a class="anchor" aria-label="anchor" href="#site-by-site-detailed-results-in-datatable-format-in-rstudio-viewer"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_100pts_1miles</span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,   <span class="op">]</span>, escape <span class="op">=</span> <span class="cn">FALSE</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To see all 1,000 sites in table:</span></span>
<span><span class="co">#DT::datatable(out2$results_bysite[1:1000, ], escape = FALSE, rownames = FALSE)</span></span></code></pre></div>
<div class="section level4">
<h4 id="overall-results-for-a-few-key-indicators-as-raw-output-in-console">Overall results for a few key indicators, as raw output in
console:<a class="anchor" aria-label="anchor" href="#overall-results-for-a-few-key-indicators-as-raw-output-in-console"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_100pts_1miles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "results_overall"                     "results_bysite"                     </span></span>
<span><span class="co">#&gt; [3] "results_bybg_people"                 "longnames"                          </span></span>
<span><span class="co">#&gt; [5] "count_of_blocks_near_multiple_sites" "results_summarized"                 </span></span>
<span><span class="co">#&gt; [7] "formatted"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out2</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_d</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  overall   </span></span>
<span><span class="co">#&gt; Demog.Index      0.4375791 </span></span>
<span><span class="co">#&gt; Demog.Index.Supp 0.1559613 </span></span>
<span><span class="co">#&gt; pctlowinc        0.3273222 </span></span>
<span><span class="co">#&gt; pctlingiso       0.07851435</span></span>
<span><span class="co">#&gt; pctunemployed    0.06273723</span></span>
<span><span class="co">#&gt; pctlths          0.132045  </span></span>
<span><span class="co">#&gt; lowlifex         0.1791878 </span></span>
<span><span class="co">#&gt; pctunder5        0.05773662</span></span>
<span><span class="co">#&gt; pctover64        0.1407173 </span></span>
<span><span class="co">#&gt; pctmin           0.5478361</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out2</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_d_subgroups</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 overall    </span></span>
<span><span class="co">#&gt; pcthisp         0.2737942  </span></span>
<span><span class="co">#&gt; pctnhba         0.1462381  </span></span>
<span><span class="co">#&gt; pctnhaa         0.0866459  </span></span>
<span><span class="co">#&gt; pctnhaiana      0.002500135</span></span>
<span><span class="co">#&gt; pctnhnhpia      0.001582896</span></span>
<span><span class="co">#&gt; pctnhotheralone 0.005025789</span></span>
<span><span class="co">#&gt; pctnhmulti      0.03204894 </span></span>
<span><span class="co">#&gt; pctnhwa         0.4521639</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="overall-results-for-the-very-long-list-of-all-indicators-as-raw-output-in-console">Overall results for the very long list of all indicators, as raw
output in console:<a class="anchor" aria-label="anchor" href="#overall-results-for-the-very-long-list-of-all-indicators-as-raw-output-in-console"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_100pts_1miles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">results_overall</span><span class="op">)</span><span class="op">)</span></span>
<span>  , <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="details-of-blocks-near-one-site">DETAILS OF BLOCKS NEAR ONE SITE<a class="anchor" aria-label="anchor" href="#details-of-blocks-near-one-site"></a>
</h2>
<div class="section level4">
<h4 id="detailed-diagnostics-or-stats-on-intermediate-results">Detailed diagnostics or stats on intermediate results<a class="anchor" aria-label="anchor" href="#detailed-diagnostics-or-stats-on-intermediate-results"></a>
</h4>
</div>
<div class="section level4">
<h4 id="getblocksnearby-will-find-residentsblocks-that-are-within-specified-distance">getblocksnearby() will find residents/blocks that are within
specified distance<a class="anchor" aria-label="anchor" href="#getblocksnearby-will-find-residentsblocks-that-are-within-specified-distance"></a>
</h4>
<p>Less than 1 second for 100 sites, but a few seconds for 1,000 sites,
or 500k / hour for this step</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sitepoints</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">testpoints_100</span><span class="op">)</span> </span>
<span><span class="co"># or </span></span>
<span><span class="co"># sitepoints &lt;- testpoints_n(100,"block") # random points</span></span>
<span><span class="va">radius</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">elapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sites2blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getblocksnearby.html">getblocksnearby</a></span><span class="op">(</span></span>
<span>    sitepoints <span class="op">=</span> <span class="va">sitepoints</span>,</span>
<span>    radius <span class="op">=</span> <span class="va">radius</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span> <span class="co"># end of timed function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">elapsed</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="doaggregate-will-summarize-indicators-within-each-buffer-and-overall">doaggregate() will summarize indicators within each buffer and
overall<a class="anchor" aria-label="anchor" href="#doaggregate-will-summarize-indicators-within-each-buffer-and-overall"></a>
</h5>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># out &lt;- doaggregate(testoutput_getblocksnearby_10pts_1miles)</span></span>
<span><span class="va">sites2blocks</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">testoutput_getblocksnearby_10pts_1miles</span><span class="op">)</span></span>
<span><span class="va">elapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> </span>
<span>    <span class="fu"><a href="../reference/doaggregate.html">doaggregate</a></span><span class="op">(</span>sites2blocks <span class="op">=</span> <span class="va">sites2blocks</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Inferring approximate radius is 1 miles, based on distances found.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">elapsed</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.30    0.06    0.86</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "results_overall"                     "results_bysite"                     </span></span>
<span><span class="co">#&gt; [3] "results_bybg_people"                 "longnames"                          </span></span>
<span><span class="co">#&gt; [5] "count_of_blocks_near_multiple_sites"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   9 287</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="see-indicators-aggregated-over-all-people-across-all-sites">See indicators aggregated over all people across all sites<a class="anchor" aria-label="anchor" href="#see-indicators-aggregated-over-all-people-across-all-sites"></a>
</h5>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## view output of batch run aggregation ####</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              overall</span></span>
<span><span class="co">#&gt; ejam_uniq_id NA     </span></span>
<span><span class="co">#&gt; pop          60740.3</span></span>
<span><span class="co">#&gt; lon          NA     </span></span>
<span><span class="co">#&gt; lat          NA     </span></span>
<span><span class="co">#&gt; ST           NA     </span></span>
<span><span class="co">#&gt; statename    NA</span></span>
<span></span>
<span><span class="co">## To see just some subset of indicators, like Environmental only:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_e</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 overall   </span></span>
<span><span class="co">#&gt; pm              8.033511  </span></span>
<span><span class="co">#&gt; o3              60.62275  </span></span>
<span><span class="co">#&gt; cancer          26.52724  </span></span>
<span><span class="co">#&gt; resp            0.2887633 </span></span>
<span><span class="co">#&gt; dpm             0.3634965 </span></span>
<span><span class="co">#&gt; pctpre1960      0.4127978 </span></span>
<span><span class="co">#&gt; traffic.score   179.1214  </span></span>
<span><span class="co">#&gt; proximity.npl   0.3872596 </span></span>
<span><span class="co">#&gt; proximity.rmp   0.5952604 </span></span>
<span><span class="co">#&gt; proximity.tsdf  1.353144  </span></span>
<span><span class="co">#&gt; proximity.npdes 0.01370324</span></span>
<span><span class="co">#&gt; ust             5.488647  </span></span>
<span><span class="co">#&gt; rsei            6492.776</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_d</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  overall   </span></span>
<span><span class="co">#&gt; Demog.Index      0.402214  </span></span>
<span><span class="co">#&gt; Demog.Index.Supp 0.1772926 </span></span>
<span><span class="co">#&gt; pctlowinc        0.3960105 </span></span>
<span><span class="co">#&gt; pctlingiso       0.0681899 </span></span>
<span><span class="co">#&gt; pctunemployed    0.05715225</span></span>
<span><span class="co">#&gt; pctlths          0.148745  </span></span>
<span><span class="co">#&gt; lowlifex         0.2163654 </span></span>
<span><span class="co">#&gt; pctunder5        0.06424071</span></span>
<span><span class="co">#&gt; pctover64        0.1083218 </span></span>
<span><span class="co">#&gt; pctmin           0.4084175</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_d_subgroups</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 overall     </span></span>
<span><span class="co">#&gt; pcthisp         0.2547057   </span></span>
<span><span class="co">#&gt; pctnhba         0.08590507  </span></span>
<span><span class="co">#&gt; pctnhaa         0.0296854   </span></span>
<span><span class="co">#&gt; pctnhaiana      0.008840918 </span></span>
<span><span class="co">#&gt; pctnhnhpia      1.481718e-05</span></span>
<span><span class="co">#&gt; pctnhotheralone 0.0009054944</span></span>
<span><span class="co">#&gt; pctnhmulti      0.02836008  </span></span>
<span><span class="co">#&gt; pctnhwa         0.5915825</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_e_pctile</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        overall</span></span>
<span><span class="co">#&gt; pctile.pm              45     </span></span>
<span><span class="co">#&gt; pctile.o3              46     </span></span>
<span><span class="co">#&gt; pctile.cancer          5      </span></span>
<span><span class="co">#&gt; pctile.resp            4      </span></span>
<span><span class="co">#&gt; pctile.dpm             79     </span></span>
<span><span class="co">#&gt; pctile.pctpre1960      67     </span></span>
<span><span class="co">#&gt; pctile.traffic.score   72     </span></span>
<span><span class="co">#&gt; pctile.proximity.npl   93     </span></span>
<span><span class="co">#&gt; pctile.proximity.rmp   79     </span></span>
<span><span class="co">#&gt; pctile.proximity.tsdf  66     </span></span>
<span><span class="co">#&gt; pctile.proximity.npdes 70     </span></span>
<span><span class="co">#&gt; pctile.ust             79     </span></span>
<span><span class="co">#&gt; pctile.rsei            89</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span> <span class="va">out</span><span class="op">$</span><span class="va">results_overall</span><span class="op">[</span> , <span class="va">..names_d_pctile</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         overall</span></span>
<span><span class="co">#&gt; pctile.Demog.Index      64     </span></span>
<span><span class="co">#&gt; pctile.Demog.Index.Supp 72     </span></span>
<span><span class="co">#&gt; pctile.pctlowinc        69     </span></span>
<span><span class="co">#&gt; pctile.pctlingiso       80     </span></span>
<span><span class="co">#&gt; pctile.pctunemployed    63     </span></span>
<span><span class="co">#&gt; pctile.pctlths          71     </span></span>
<span><span class="co">#&gt; pctile.lowlifex         70     </span></span>
<span><span class="co">#&gt; pctile.pctunder5        64     </span></span>
<span><span class="co">#&gt; pctile.pctover64        30     </span></span>
<span><span class="co">#&gt; pctile.pctmin           59</span></span>
<span><span class="co"># cbind(overall = as.list( out$results_overall[ , ..names_ej_pctile])); cat("\n")</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="visualization-of-findings">VISUALIZATION OF FINDINGS<a class="anchor" aria-label="anchor" href="#visualization-of-findings"></a>
</h2>
<div class="section level5">
<h5 id="histogram-of-indicators-distribution-over-all-people-across-all-sites">Histogram of indicators distribution over all people across all
sites<a class="anchor" aria-label="anchor" href="#histogram-of-indicators-distribution-over-all-people-across-all-sites"></a>
</h5>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">$</span><span class="va">pctile.traffic.score</span>, <span class="fl">10</span>, xlab <span class="op">=</span> <span class="st">"Local traffic scores (expressed as a percentile)"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"count of sites in each bin, out of 1,000 sites"</span>, freq <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Actual distribution of scores nearby, as percentiles, </span></span>
<span><span class="st">     vs flat line = USA overall"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="3_analyzing_files/figure-html/histo-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="distance-plots">Distance plots<a class="anchor" aria-label="anchor" href="#distance-plots"></a>
</h3>
<div class="section level4">
<h4 id="mean-distance-of-each-group">Mean distance of each group<a class="anchor" aria-label="anchor" href="#mean-distance-of-each-group"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_distance_mean_by_group(testoutput_ejamit_1000pts_1miles$results_bybg_people)</span></span>
<span></span>
<span><span class="co"># larger radius reveals more information</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ejamit.html">ejamit</a></span><span class="op">(</span><span class="va">testpoints_100</span>, radius <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Finding blocks nearby.</span></span>
<span><span class="co">#&gt; Analyzing 100 points, radius of 3 miles around each.</span></span>
<span><span class="co">#&gt; Aggregating at each buffer and overall.</span></span>
<span><span class="co">#&gt; Connecting to Posit Connect 2024.01.0 at</span></span>
<span><span class="co">#&gt; &lt;https://rstudio-connect.dmap-stage.aws.epa.gov&gt;</span></span>
<span><span class="co">#&gt; Successfully connected to Posit Connect pins board.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; bgej         - is NOT in memory. Checking local disk... bgej        is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/bgej.arrow </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; bgej        is NOT found locally on disk at ~/../Downloads/EJAMbigfiles/bgej.arrow </span></span>
<span><span class="co">#&gt; trying to load bgej  from EJAM/bgej.rda</span></span>
<span><span class="co">#&gt; Client error: (404) Not Found</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  and could NOT download bgej from DMAP AWS data commons</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_distance_mean_by_group.html">plot_distance_mean_by_group</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">results_bybg_people</span><span class="op">)</span> <span class="co"># or distance_mean_by_group() is a synonym</span></span></code></pre></div>
<p><img src="3_analyzing_files/figure-html/plot_distance_mean_by_group_1-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt;                                 group nearest nearer ratio</span></span>
<span><span class="co">#&gt; Demog.Ind.                Demog.Index   FALSE   TRUE 0.992</span></span>
<span><span class="co">#&gt; Suppl Demog.Ind.     Demog.Index.Supp   FALSE   TRUE 0.991</span></span>
<span><span class="co">#&gt; %Low-inc.                   pctlowinc   FALSE   TRUE 0.976</span></span>
<span><span class="co">#&gt; %Limited English           pctlingiso   FALSE   TRUE 0.984</span></span>
<span><span class="co">#&gt; %Unemployed             pctunemployed   FALSE  FALSE 1.004</span></span>
<span><span class="co">#&gt; %&lt; High School                pctlths   FALSE   TRUE 0.995</span></span>
<span><span class="co">#&gt; %Low life expectancy         lowlifex   FALSE  FALSE 1.003</span></span>
<span><span class="co">#&gt; %&lt; age 5                    pctunder5   FALSE  FALSE 1.003</span></span>
<span><span class="co">#&gt; %&gt; age 64                   pctover64   FALSE  FALSE 1.010</span></span>
<span><span class="co">#&gt; %POC                           pctmin   FALSE  FALSE 1.004</span></span>
<span><span class="co">#&gt; %Hispanic                     pcthisp   FALSE  FALSE 1.000</span></span>
<span><span class="co">#&gt; %Black NHA                    pctnhba   FALSE  FALSE 1.000</span></span>
<span><span class="co">#&gt; %Asian NHA                    pctnhaa   FALSE   TRUE 0.998</span></span>
<span><span class="co">#&gt; %AmerIndian/AK NHA         pctnhaiana    TRUE   TRUE 0.955</span></span>
<span><span class="co">#&gt; %Hawaiian/PI NHA           pctnhnhpia   FALSE  FALSE 1.009</span></span>
<span><span class="co">#&gt; %Other race NHA       pctnhotheralone   FALSE   TRUE 0.974</span></span>
<span><span class="co">#&gt; %multirace NH              pctnhmulti   FALSE   TRUE 0.999</span></span>
<span><span class="co">#&gt; %White NHA                    pctnhwa   FALSE  FALSE 1.000</span></span>
<span><span class="co">#&gt;                      avg_distance_for_group avg_distance_for_nongroup</span></span>
<span><span class="co">#&gt; Demog.Ind.                             1.99                      2.00</span></span>
<span><span class="co">#&gt; Suppl Demog.Ind.                       1.98                      2.00</span></span>
<span><span class="co">#&gt; %Low-inc.                              1.96                      2.01</span></span>
<span><span class="co">#&gt; %Limited English                       1.97                      2.00</span></span>
<span><span class="co">#&gt; %Unemployed                            2.00                      2.00</span></span>
<span><span class="co">#&gt; %&lt; High School                         1.99                      2.00</span></span>
<span><span class="co">#&gt; %Low life expectancy                   2.01                      2.00</span></span>
<span><span class="co">#&gt; %&lt; age 5                               2.00                      2.00</span></span>
<span><span class="co">#&gt; %&gt; age 64                              2.01                      1.99</span></span>
<span><span class="co">#&gt; %POC                                   2.00                      1.99</span></span>
<span><span class="co">#&gt; %Hispanic                              1.99                      1.99</span></span>
<span><span class="co">#&gt; %Black NHA                             1.99                      1.99</span></span>
<span><span class="co">#&gt; %Asian NHA                             2.04                      2.04</span></span>
<span><span class="co">#&gt; %AmerIndian/AK NHA                     1.93                      2.02</span></span>
<span><span class="co">#&gt; %Hawaiian/PI NHA                       2.01                      1.99</span></span>
<span><span class="co">#&gt; %Other race NHA                        1.97                      2.02</span></span>
<span><span class="co">#&gt; %multirace NH                          2.00                      2.00</span></span>
<span><span class="co">#&gt; %White NHA                             1.99                      1.99</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="usepa.github.io/EJAM/reference/distance_by_group.html">distance_by_group</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">results_bybg_people</span>, </span>
<span>  demogvarname <span class="op">=</span> <span class="st">'pctlowinc'</span>, demoglabel <span class="op">=</span> <span class="st">'Low Income'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                group nearest nearer ratio avg_distance_for_group</span></span>
<span><span class="co">#&gt; Low Income pctlowinc    TRUE   TRUE 0.976                   1.96</span></span>
<span><span class="co">#&gt;            avg_distance_for_nongroup</span></span>
<span><span class="co">#&gt; Low Income                      2.01</span></span>
<span></span>
<span><span class="fu"><a href="../reference/distance_by_group_plot.html">distance_by_group_plot</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">results_bybg_people</span>,</span>
<span>  demogvarname <span class="op">=</span> <span class="st">'pctlowinc'</span>, demoglabel <span class="op">=</span> <span class="st">'Low Income'</span><span class="op">)</span></span></code></pre>
<p><img src="3_analyzing_files/figure-html/plot_distance_mean_by_group_1-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="map-blocks-near-1-site">Map blocks near 1 site<a class="anchor" aria-label="anchor" href="#map-blocks-near-1-site"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/plotblocksnearby.html">plotblocksnearby</a></span><span class="op">(</span><span class="va">testpoints_10</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, radius <span class="op">=</span> <span class="fl">3</span>, returnmap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#  returnmap= TRUE is to actually return the leaflet map </span></span>
<span></span>
<span><span class="co"># Use weighting="frs" in testpoints_n() to pick a random FRS facility's block</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="population-density---avg-site-vs-avg-resident">POPULATION DENSITY - AVG SITE VS AVG RESIDENT<a class="anchor" aria-label="anchor" href="#population-density---avg-site-vs-avg-resident"></a>
</h2>
<div class="section level3">
<h3 id="sites-vary-widely-in-count-of-blocks-nearby-depending-on-population-density">Sites vary widely in count of blocks nearby, depending on population
density<a class="anchor" aria-label="anchor" href="#sites-vary-widely-in-count-of-blocks-nearby-depending-on-population-density"></a>
</h3>
<ul>
<li>what blocks are near each site</li>
<li>how far are they</li>
<li>how many blocks are typically near a given site (population density
varies)</li>
<li>how many sites are near a block (residents with &gt; 1 site
nearby)</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_100pts_1miles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="fu"><a href="../reference/popshare_p_lives_at_what_pct.html">popshare_p_lives_at_what_pct</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">$</span><span class="va">pop</span>, p <span class="op">=</span> <span class="fl">0.50</span>, astext <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    6% of places account for 50% of the total population (approx.)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="fu"><a href="../reference/popshare_at_top_n.html">popshare_at_top_n</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span><span class="op">$</span><span class="va">pop</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, astext <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    1, 5, 10 places account for 18%, 46%, 58% of the total population</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Also could use this example intermediate step dataset </span></span>
<span><span class="co">## of n sites, with thousands of nearby blocks:</span></span>
<span><span class="co"># sites2blocks &lt;- data.table::copy(testoutput_getblocksnearby_10pts_1miles)</span></span>
<span><span class="va">radius</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sitepoints</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">testpoints_100</span><span class="op">)</span> </span>
<span><span class="va">sites2blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getblocksnearby.html">getblocksnearby</a></span><span class="op">(</span><span class="va">sitepoints</span>, <span class="va">radius</span>, quadtree <span class="op">=</span> <span class="va">localtree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/getblocks_summarize_blocks_per_site.html">getblocks_summarize_blocks_per_site</a></span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">)</span> </span>
<span><span class="co"># print() shows more info returned invisibly</span></span>
<span><span class="fu"><a href="../reference/getblocks_diagnostics.html">getblocks_diagnostics</a></span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">)</span></span>
<span><span class="co"># Use data.table package here</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># Very few blocks are within a radius of 1/4 mile.</span></span>
<span><span class="co"># Hundreds are often within 1 mile, but sometimes there are </span></span>
<span><span class="co"># only a handful or even zero.</span></span>
<span><span class="va">s2b_stats</span> <span class="op">&lt;-</span> <span class="va">sites2blocks</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span></span>
<span>  avgDistance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  blocksfound <span class="op">=</span> <span class="va">.N</span>, </span>
<span>  blocks_within_1mile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">distance</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  blocks_within_0.75   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">distance</span> <span class="op">&lt;=</span> <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>  blocks_within_0.25  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">distance</span> <span class="op">&lt;=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'ejam_uniq_id'</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">blocksfound</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">s2b_stats</span>, <span class="va">ejam_uniq_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># CDF of how many blocks are nearby a site</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"How many blocks are near each facility?"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"# of blocks (whose internal point is) within 1 mile of each site"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">)</span>,<span class="st">" facilities ranked by # of blocks nearby"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span>, probs <span class="op">=</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Histogram of how many blocks are nearby a site</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">[</span>,<span class="va">.N</span>, by <span class="op">=</span> <span class="st">"ejam_uniq_id"</span><span class="op">]</span><span class="op">[</span>, <span class="va">N</span><span class="op">]</span>, <span class="fl">20</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"How many blocks are nearby?"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Frequency (# of sites)"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"A given site may have zero to hundreds of blocks nearby"</span>, </span>
<span>     sub <span class="op">=</span> <span class="st">"A typical site in this example has about 100 blocks nearby"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">s2b_stats</span>,  rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># more summaries showing there may be only 1 block or hundreds within 1 mile</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span>, probs <span class="op">=</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># map the sites with popups about how many blocks were found near each</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">'ejam_uniq_id'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sitepoints</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">sitepoints</span><span class="op">$</span><span class="va">ejam_uniq_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span>length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sitepoints</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">s2b_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sitepoints</span>, <span class="va">s2b_stats</span>, by <span class="op">=</span> <span class="st">"ejam_uniq_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mapfast.html">mapfast</a></span><span class="op">(</span><span class="va">s2b_stats</span>, radius <span class="op">=</span> <span class="va">radius</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Some places have very few -- if any -- blocks within 1 mile</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ejam_uniq_id'</span>, <span class="st">'blocks_within_1mile'</span><span class="op">)</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Some places have hundreds nearby: a 1 mile radius is huge </span></span>
<span><span class="co"># within a dense urban area</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ejam_uniq_id'</span>, <span class="st">'blocks_within_1mile'</span><span class="op">)</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">densest</span> <span class="op">&lt;-</span> <span class="va">s2b_stats</span><span class="op">$</span><span class="va">ejam_uniq_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span></span>
<span>  <span class="va">s2b_stats</span><span class="op">$</span><span class="va">blocks_within_1mile</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plotblocksnearby.html">plotblocksnearby</a></span><span class="op">(</span>sitepoints <span class="op">=</span> <span class="va">sitepoints</span><span class="op">[</span><span class="va">sitepoints</span><span class="op">$</span><span class="va">ejam_uniq_id</span> <span class="op">==</span> <span class="va">densest</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Within a 1 mile radius, the blocks found tend to be about 2/3 of a mile from the site at the center.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">s2b_stats</span><span class="op">$</span><span class="va">avgDistance</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>DRAFT/beta</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.2.2 beta</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
