<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>1. Installing the EJAM package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">1. Installing the EJAM package</h1>



<div id="ejam-setup-for-r-users" class="section level1">
<h1>EJAM Setup for R users</h1>
<p>EJAM is not only a web app built in shiny R, it is also an R package,
using the <a href="https://thinkr-open.github.io/golem/" class="uri" target="_blank" rel="noreferrer noopener" title="https://thinkr-open.github.io/golem/">golem</a> framework.</p>
<p>The development version of the app can be installed from the github
USEPA github repository. It can be installed locally as an R package,
and the data or functions can be used outside of the shiny app
interface, if you want to reuse data or code, or want to do customized
analysis or explore the data in R.</p>
<div id="install-the-ejam-r-package-and-related-packages" class="section level2">
<h2>Install the EJAM R package (and related packages)</h2>
<div id="to-install-directly-from-github-starting-from-rstudio" class="section level3">
<h3>to install directly from GitHub, starting from RStudio</h3>
<p>If you know how to clone and build from source in RStudio, feel free
to skip ahead to that topic.</p>
<p>If you just want to install EJAM but not work with source code, you
can try this approach:</p>
<p>Try to install the packages like this (which will download and build
from source, automatically):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) {<span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)}</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAMejscreenapi&#39;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAMbatch.summarizer&#39;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAM&#39;</span>)</span></code></pre></div>
<p>Note that to install EJAM this way, you will need to have access to
the GitHub repositories on EPA’s enterprise github site, at <a href="https://github.com/USEPA" class="uri" target="_blank" rel="noreferrer noopener" title="https://github.com/USEPA">USEPA
GitHub</a>. Unless/ until those repositories related to EJAM are public,
you would need to be signed in on EPA’s network, and for internal-only
repositories, may need to use VPN.</p>
<p>If installing that way does not work, you might need to do the
following:</p>
<ol style="list-style-type: decimal">
<li>create GitHub personal access token with ‘repo scope’</li>
</ol>
<ul>
<li>Go to <a href="https://github.com/settings/tokens" class="uri" target="_blank" rel="noreferrer noopener">https://github.com/settings/tokens</a> and
select Tokens (classic) on the left-hand side. Then click ‘Generate New
Token’ -&gt; Generate new token (classic).</li>
<li>Give it a name and select all boxes under repo scope. Scroll down
and click ‘Generate Token’.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>set GitHub credentials in Rstudio</li>
</ol>
<ul>
<li>one-time login: from the console, run credentials::set_github_pat().
Paste in your PAT to the login popup under ‘Token’.</li>
<li>store credentials long-term: run
<code>usethis::edit_r_environ()</code> to open your .Renviron file and
and add a line with your PAT in this format:
<code>GITHUB_PAT = &#39;abc&#39;</code></li>
<li>You can specify an extra argument <code>scope = &#39;project&#39;</code> if
you only want the PAT to work for a particular Rstudio project.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Install the packages using
<code>devtools::install_github()</code></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) {<span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)}</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAMejscreenapi&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAMbatch.summarizer&#39;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;USEPA/EJAM&#39;</span>)</span></code></pre></div>
</div>
<div id="if-you-need-the-full-source-code-and-want-to-buildinstall-in-rstudio-on-your-own" class="section level3">
<h3>if you need the full source code and want to build/install in
RStudio on your own</h3>
<p>There are 3 EJAM-specific packages as of 1/2024 that EJAM needs, all
of which are in EPA-internal repositories:</p>
<p>Essential packages only available on the <a href="https://github.com/USEPA/EJAM" class="uri" target="_blank" rel="noreferrer noopener" title="github.com/USEPA/EJAM">USEPA github</a>
(not CRAN) are:</p>
<ul>
<li><a href="https://github.com/USEPA/EJAM#readme" class="uri" target="_blank" rel="noreferrer noopener" title="github.com/USEPA/EJAM">EJAM</a></li>
<li><a href="https://github.com/USEPA/EJAMejscreenapi#readme" class="uri" target="_blank" rel="noreferrer noopener" title="github.com/USEPA/EJAMejscreenapi">EJAMejscreenapi</a></li>
<li><a href="https://github.com/USEPA/EJAMbatch.summarizer#readme" class="uri" target="_blank" rel="noreferrer noopener" title="github.com/USEPA/EJAMbatch.summarizer">EJAMbatch.summarizer</a></li>
</ul>
<p>Options for getting the source package:</p>
<ol style="list-style-type: lower-alpha">
<li><p>One way to get each source package is that in RStudio you can
click New Project, Version Control, Git, and enter the repository URL.
It will download the full source package, which has additional files
related to development that you do not need if you just want to use the
package.</p></li>
<li><p>Yet another way to get the full source package is to use a
browser to go to the repository page, such as <a href="https://github.com/USEPA/EJAM" class="uri" target="_blank" rel="noreferrer noopener" title="github.com/USEPA/EJAM">USEPA github</a>
and then click the green “Code” button, and download and unzip the zip
file that contains the package.</p></li>
<li><p>A third way is to Clone or Fork the package via GitHub Desktop or
from the GitHub site.</p></li>
<li><p>At some point, a .zip or .tar version of the bundled package will
be provided as well.</p></li>
</ol>
<p>Regardless of how you got the full source code, you would then need
to build/install the package from source on your computer using RStudio
menus or using the devtools package, for example.</p>
<div id="cran-packages-needed" class="section level4">
<h4>CRAN packages needed</h4>
<p>EJAM needs a number of other packages to be installed that are
available from CRAN. Trying to load and attach EJAM with require(EJAM)
or library(EJAM) will alert you to those other packages you need to
install if you don’t already have them.</p>
<p>You could also see the list of CRAN packages needed by looking at the
<code>DESCRIPTION</code> file in the R package source code root folder
(as can be found in the code repository).</p>
</div>
</div>
</div>
<div id="initialize-loadattach-package" class="section level2">
<h2>Initialize: load/attach package</h2>
<p>Once the right R packages are installed, to use EJAM in the console
you can start by loading and attaching the package, using library or
require. It should automatically download some data and build an
index.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(EJAM)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or library(EJAM)</span></span></code></pre></div>
<p>That should be all you need to do.</p>
<p>Just in case you need more details on how that works, the following
describes the code used by the package to get the data and build an
index.</p>
<div id="details-on-the-automatic-data-downloads" class="section level3">
<h3>Details on the automatic data downloads</h3>
<p>To work in the RStudio console, EJAM needs some datasets not stored
as part of the package. However, they already should be downloaded and
loaded into memory automatically as soon as you use
<code>require(EJAM)</code> assuming that the current version of
[EJAM:::on.Attach()] source code uses
<code>asap_aws &lt;- TRUE; asap_index &lt;- TRUE; asap_bg</code>. If you
want to be sure or if something is missing, you can do this
manually:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dataload_from_pins</span>(<span class="st">&#39;all&#39;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It takes some time for the large downloads, while EJAM is still in development.</span></span></code></pre></div>
<p>Attaching the package actually checks for copies in memory first
(e.g., <code>exists(&quot;quaddata&quot;, envir = globalenv())</code>), then local
disk (using <code>EJAM:::dataload_from_local()</code> looking in the
data folder of the (source or installed) package, as defined by
<code>EJAM:::app_sys()</code>), then finally tries to download any still
needed, using <code>dataload_from_pins()</code>.</p>
</div>
<div id="details-on-the-indexing-of-blocks" class="section level3">
<h3>Details on the indexing of blocks</h3>
<p>EJAM also needs to build the index of about 8 million US block
locations (one internal point for each block), which takes a few
seconds. EJAM does this automatically when attached via
<code>require(EJAM)</code> or <code>library(EJAM)</code>, by creating an
object called <code>localtree</code> based on the <code>quaddata</code>
object obtained as mentioned above. Some functions check for it and try
to build the index on the fly if it is missing. You can also (re)build
it manually:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">indexblocks</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Checking for index of Census blocks (localtree)...</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The index of Census block groups localtree index of blocks appears to have been created.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
