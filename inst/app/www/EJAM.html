<!DOCTYPE html>
<html>
  <head>
    <title>Package 'EJAM' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'EJAM'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">EJAM Environmental Justice Analysis Multisite tool</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">Tools for summarizing environmental and demographic indicators 
    (such as those in EJScreen) for residents living near any one of a number of 
    specific sites. It uses quad tree search/indexing of block locations, data.table, etc.
    to provide very fast identification of nearby blocks, distances, and 
    aggregation of indicators within each distance. It can be uses as a web app, with the user interface provided by R shiny.</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>Mark Corrales</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">Mark Corrales &lt;corrales.mark@epa.gov&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">MIT + file LICENSE.md</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">2.2.1</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-10-21 04:18:36 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source"></td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list">
<li class="help-index-item"><a href="#dot-onAttach">.onAttach - Do slow initialization steps - Download data, load key data into RAM, create index to all US blocks
Note this duplicates some code in global.R, and see source code here to adjust settings.</a></li>
<li class="help-index-item"><a href="#all_equal_functions">helper function for checking possibly different versions of a function with same name in 2 packages</a></li>
<li class="help-index-item"><a href="#app_run_EJAM">app_run_EJAM - identical to run_app(), just an alias</a></li>
<li class="help-index-item"><a href="#app_server">app_server - EJAM app server</a></li>
<li class="help-index-item"><a href="#avg.in.us">avg.in.us (DATA) national averages of key indicators, for convenience</a></li>
<li class="help-index-item"><a href="#bg_cenpop2020">bg_cenpop2020 (DATA) data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group</a></li>
<li class="help-index-item"><a href="#bg_from_county">bg_from_county - Analyze US Counties as if they were sites, to get EJ indicators summary for each county</a></li>
<li class="help-index-item"><a href="#bgej">bgej (DATA) EJScreen EJ Indexes for Census block groups</a></li>
<li class="help-index-item"><a href="#bgpts">bgpts (DATA) lat lon of popwtd center of blockgroup, and count of blocks per block group</a></li>
<li class="help-index-item"><a href="#blockgroupstats">blockgroupstats (DATA) EJScreen demographic and environmental indicators for Census block groups</a></li>
<li class="help-index-item"><a href="#colcounter">colcounter - Count columns with Value (at or) above (or below) threshold</a></li>
<li class="help-index-item"><a href="#colcounter_summary">colcounter_summary - Summarize how many rows have N columns at or above (or below) various thresholds?
Like colcounter or cols.above.count
but will handle multiple thresholds to compare to each indicator, etc.
Table of counts, percents, cumulative counts, cumulative percents
of places with N, or at least N, of the indicators
at or above the benchmark(s)</a></li>
<li class="help-index-item"><a href="#colcounter_summary_all">colcounter_summary_all - Summarize count (and percent) of rows with exactly (and at least) N cols &gt;= various thresholds
A wrapper for 4 functions: Returns four tables,
using colcounter_summary(), colcounter_summary_pct(),
colcounter_summary_cum(), colcounter_summary_cum_pct()</a></li>
<li class="help-index-item"><a href="#colcounter_summary_cum">colcounter_summary_cum - Summarize how many rows have AT LEAST N columns at or above (or below) various thresholds
See colcounter_summary() for more info and examples.</a></li>
<li class="help-index-item"><a href="#colcounter_summary_cum_pct">Summarize what percent of rows have AT LEAST N columns at or above (or below) various thresholds</a></li>
<li class="help-index-item"><a href="#colcounter_summary_pct">colcounter_summary_pct - Summarize what percent of rows have N columns at or above (or below) various thresholds</a></li>
<li class="help-index-item"><a href="#count_sites_with_n_high_scores">count_sites_with_n_high_scores</a></li>
<li class="help-index-item"><a href="#counties_as_sites">counties_as_sites</a></li>
<li class="help-index-item"><a href="#dataload_from_aws">dataload_from_aws - utility to load datasets from AWS DMAP Data Commons, into memory</a></li>
<li class="help-index-item"><a href="#dataload_from_entirefolder">dataload_from_entirefolder
loads into global environment all .rda files found in specified folder</a></li>
<li class="help-index-item"><a href="#dataload_from_local">dataload_from_local
utility for R analysts/developers to store large block data locally instead of redownloading from AWS</a></li>
<li class="help-index-item"><a href="#dataload_from_package">dataload_from_package - utility to load a couple of datasets using data immediately instead of relying on lazy loading</a></li>
<li class="help-index-item"><a href="#datapack">See info about the data sets in one or more packages - internal utility function
Wrapper for data() and gets memory size of objects and silently returns a data.frame</a></li>
<li class="help-index-item"><a href="#datawrite_to_aws">datawrite_to_aws -  NOT YET WORKING - AccessDenied
Write object(s) like a dataset to DMAP Data Commons, formatted as .arrow or .rda</a></li>
<li class="help-index-item"><a href="#datawrite_to_local">datawrite_to_local
Write large object(s) like EJAM datasets to local disk for convenience during app/pkg development, formatted as .arrow or .rda</a></li>
<li class="help-index-item"><a href="#distance_by_group">distance_by_group - Avg distance of each demog group (of multiple groups)
Same as plot_distance_mean_by_group() but no plot by default</a></li>
<li class="help-index-item"><a href="#distance_by_group_by_site">distance_by_group_by_site - DRAFT FUNCTION</a></li>
<li class="help-index-item"><a href="#distance_by_group_plot">distance_by_group_plot or plot_distance_cdf_by_group</a></li>
<li class="help-index-item"><a href="#distance_by_group1">distance_by_group1  -  JUST ONE GROUP
Get average distance for ONE demographic group versus everyone else</a></li>
<li class="help-index-item"><a href="#distance_cdf_by_group_plot">distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONLY ONE demographic group that are within each distance</a></li>
<li class="help-index-item"><a href="#distance_mean_by_group">distance_mean_by_group - Avg distance of each demog group (of multiple groups)
Same as plot_distance_mean_by_group() but no plot by default</a></li>
<li class="help-index-item"><a href="#distance_via_surfacedistance">distance_via_surfacedistance - convert surface distance to actual distance</a></li>
<li class="help-index-item"><a href="#doaggregate">doaggregate - Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</a></li>
<li class="help-index-item"><a href="#dupenames">helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</a></li>
<li class="help-index-item"><a href="#dupeRfiles">dupeRfiles
utility for developer to find similarly named .R files in 2 separate folders of source code,
whether or not they are packages.</a></li>
<li class="help-index-item"><a href="#ejam2excel">ejam2excel
Format the results of ejamit() for excel and optionally save .xlsx file</a></li>
<li class="help-index-item"><a href="#ejamit">ejamit - Get complete EJ analysis numbers (demographic and environmental indicators) near a list of locations</a></li>
<li class="help-index-item"><a href="#ejampackages">ejampackages (DATA) list of names of key EJAM-related R packages</a></li>
<li class="help-index-item"><a href="#ejscreenit_for_ejam">ejscreenit_for_ejam - DRAFT
Wrapper for ejscreenit() from EJAMejscreenapi package, to use in EJAM app - NOT USED CURRENTLY</a></li>
<li class="help-index-item"><a href="#fips_counties_from_state_abbrev">fips_counties_from_state_abbrev</a></li>
<li class="help-index-item"><a href="#fips_counties_from_statefips">fips_counties_from_statefips</a></li>
<li class="help-index-item"><a href="#fips_counties_from_statename">fips_counties_from_statename</a></li>
<li class="help-index-item"><a href="#fips_from_table">fips_from_table
Just read the codes in one column of a table obtained from something like read.csv, or excel, etc.</a></li>
<li class="help-index-item"><a href="#fips_lead_zero">fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.</a></li>
<li class="help-index-item"><a href="#fips_state_from_state_abbrev">fips_state_from_state_abbrev</a></li>
<li class="help-index-item"><a href="#fips_state_from_statename">fips_state_from_statename</a></li>
<li class="help-index-item"><a href="#fipsbg_from_anyfips">fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS</a></li>
<li class="help-index-item"><a href="#format_gt_table">format_gt_table</a></li>
<li class="help-index-item"><a href="#format_results_overall">format_results_overall
Format the results_overall part of the output of ejamit() or doaggregate()</a></li>
<li class="help-index-item"><a href="#frs">frs (DATA) EPA Facility Registry Service table of regulated sites</a></li>
<li class="help-index-item"><a href="#frs_by_mact">frs_by_mact (DATA) MACT NESHAP subpart(s) that each EPA-regulated site is subject to</a></li>
<li class="help-index-item"><a href="#frs_by_naics">frs_by_naics (DATA) data.table of NAICS code(s) for each EPA-regulated site in Facility Registry Service</a></li>
<li class="help-index-item"><a href="#frs_by_programid">frs_by_programid (DATA) data.table of Program System ID code(s) for each EPA-regulated site in
the Facility Registry Service</a></li>
<li class="help-index-item"><a href="#frs_by_sic">frs_by_sic (DATA) data.table of SIC code(s) for each EPA-regulated site in Facility Registry Service</a></li>
<li class="help-index-item"><a href="#frs_clean">frs_clean - utility to clean Facility Registry Service dataset when updating it
This is just a helper function used to create the dataset saved as data for use in EJAM</a></li>
<li class="help-index-item"><a href="#frs_from_naics">frs_from_naics - Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_program">frs_from_program - Use EPA Program acronym like TRIS to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_programid">frs_from_programid - Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_regid">frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_sic">frs_from_sic - Use SIC code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_siteid">frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_sitename">frs_from_sitename - Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text</a></li>
<li class="help-index-item"><a href="#frs_is_valid">frs_is_valid - Validate FRS Registry ID list uploads</a></li>
<li class="help-index-item"><a href="#frsprogramcodes">frsprogramcodes DATA EPA programs listed in Facility Registry Service</a></li>
<li class="help-index-item"><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape - find blocks that are in a polygon, using internal point of block - WORK IN PROGRESS ****</a></li>
<li class="help-index-item"><a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points - add buffer around shape (points, here)</a></li>
<li class="help-index-item"><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints - convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points</a></li>
<li class="help-index-item"><a href="#getblocks_diagnostics">getblocks_diagnostics - Get summary stats on counts of blocks (unique vs doublecounted) near sites</a></li>
<li class="help-index-item"><a href="#getblocks_summarize_blocks_per_site">getblocks_summarize_blocks_per_site - Get summary stats on counts of blocks near various sites</a></li>
<li class="help-index-item"><a href="#getblocks_summarize_sites_per_block">getblocks_summarize_sites_per_block - Get summary stats on how many sites are near various blocks (residents)</a></li>
<li class="help-index-item"><a href="#getblocksnearby">getblocksnearby - Fast way to find nearby points - finds distance to each Census block centroid nearby</a></li>
<li class="help-index-item"><a href="#getblocksnearby_from_fips">getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided</a></li>
<li class="help-index-item"><a href="#getblocksnearby_from_fips_OLD">getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided</a></li>
<li class="help-index-item"><a href="#getblocksnearby2">getblocksnearby2 - Key buffering function - wrapper redirecting to the right version of getblocksnearby()
DRAFT / WAS WORK IN PROGRESS</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered - find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2 - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING - DRAFT / WORK IN PROGRESS</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree3">getblocksnearbyviaQuadTree3 - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING
DRAFT / WAS WORK IN PROGRESS</a></li>
<li class="help-index-item"><a href="#high_pctiles_tied_with_min">high_pctiles_tied_with_min (DATA) internal data used to handle cases where multiple places are tied for the lowest indicator score</a></li>
<li class="help-index-item"><a href="#indexblocks">indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment</a></li>
<li class="help-index-item"><a href="#input_names_listing">input_names_listing
Utility checking values of input$ that appear in this code
See appsilon pkg shiny.info now</a></li>
<li class="help-index-item"><a href="#islandareas">islandareas (DATA) table, bounds info on lat lon of US Island Areas</a></li>
<li class="help-index-item"><a href="#lat_alias">lat_alias, lon_alias (DATA) Synonyms for lat and lon</a></li>
<li class="help-index-item"><a href="#latlon_as.numeric">latlon_as.numeric - Strip non-numeric characters from a vector</a></li>
<li class="help-index-item"><a href="#latlon_df_clean">latlon_df_clean - Find and clean up latitude and longitude columns in a data.frame</a></li>
<li class="help-index-item"><a href="#latlon_from_anything">latlon_from_anything - Flexibly get lat/lon from file, data.frame, data.table, or lat/lon vectors</a></li>
<li class="help-index-item"><a href="#latlon_from_mactsubpart">latlon_from_mactsubpart
Get point locations for US EPA-regulated facilities that have
sources subject to Maximum Achievable Control Technology (MACT) standards
under the Clean Air Act.</a></li>
<li class="help-index-item"><a href="#latlon_from_naics">latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</a></li>
<li class="help-index-item"><a href="#latlon_from_program">latlon_from_program - Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others</a></li>
<li class="help-index-item"><a href="#latlon_from_programid">latlon_from_programid - Get lat lon, Registry ID, and NAICS, for given FRS Program System ID</a></li>
<li class="help-index-item"><a href="#latlon_from_regid">latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID</a></li>
<li class="help-index-item"><a href="#latlon_from_sic">latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)</a></li>
<li class="help-index-item"><a href="#latlon_from_siteid">latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID</a></li>
<li class="help-index-item"><a href="#latlon_infer">latlon_infer - guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</a></li>
<li class="help-index-item"><a href="#latlon_is.available">latlon_is.available
check if not NA using !is.na()</a></li>
<li class="help-index-item"><a href="#latlon_is.islandareas">latlon_is.islandareas
Check lat lon coordinates to see if each is approx. in general area of US Island Areas Guam, USVI, Amer Samoa or N Marianas
See islandareas</a></li>
<li class="help-index-item"><a href="#latlon_is.possible">latlon_is.possible
check if between -180 and +180</a></li>
<li class="help-index-item"><a href="#latlon_is.usa">latlon_is.usa
Check lat lon coordinates to see if each is approx. in general area of USA excluding Island Areas</a></li>
<li class="help-index-item"><a href="#latlon_is.valid">latlon_is.valid - Validate latitudes and longitudes</a></li>
<li class="help-index-item"><a href="#latlon_join_on_blockid">latlon_join_on_blockid - get lat,lon of each block internal point via blockid
get expanded version of sites2blocks data.table, with new lat,lon columns</a></li>
<li class="help-index-item"><a href="#lookup_pctile">lookup_pctile (synonym for pctile_from_raw_lookup)</a></li>
<li class="help-index-item"><a href="#mact_table">mact_table (DATA) MACT NESHAP subparts (the code and the description)</a></li>
<li class="help-index-item"><a href="#map_facilities">map_facilities</a></li>
<li class="help-index-item"><a href="#map_facilities_proxy">map_facilities_proxy</a></li>
<li class="help-index-item"><a href="#metadata_add">helper function for package to set attributes of a dataset</a></li>
<li class="help-index-item"><a href="#metadata_check">helper function in updating the package metadata</a></li>
<li class="help-index-item"><a href="#NAICS">NAICS (DATA) named list of all NAICS code numbers and industry name for each</a></li>
<li class="help-index-item"><a href="#naics_categories">naics_categories - See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</a></li>
<li class="help-index-item"><a href="#naics_download">naics_download - script to download NAICS file with code and name of sector</a></li>
<li class="help-index-item"><a href="#naics_findwebscrape">naics_findwebscrape - for query term, show list of roughly matching NAICS, scraped from web
This finds more than just naics_from_any() does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</a></li>
<li class="help-index-item"><a href="#naics_from_any">naics_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</a></li>
<li class="help-index-item"><a href="#naics_from_code">naics_from_code - search for industry names by NAICS code(s), 2-6 digits long each
See naics_from_any() which uses this</a></li>
<li class="help-index-item"><a href="#naics_from_federalregister">naics_from_federalregister - DRAFT WORK IN PROGRESS</a></li>
<li class="help-index-item"><a href="#naics_from_name">naics_from_name - search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See naics_from_any() which uses this</a></li>
<li class="help-index-item"><a href="#naics_subcodes_from_code">naics_subcodes_from_code - find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.</a></li>
<li class="help-index-item"><a href="#naics_url_of_code">naics_url_of_code - Get URL for page with info about industry sector(s) by NAICS
See (https://naics.com) for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#naics_validation">naics_validation - Validate NAIC uploads</a></li>
<li class="help-index-item"><a href="#naics2children">naics2children - See NAICS codes queried plus all children of any of those
Used by naics_find()</a></li>
<li class="help-index-item"><a href="#naicstable">naicstable (DATA) data.table of NAICS code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3,4,5,and 6-digit NAICS that this code falls under, where relevant for given length</a></li>
<li class="help-index-item"><a href="#names_d">list of demographic indicator names</a></li>
<li class="help-index-item"><a href="#names_e">list of environmental indicator names</a></li>
<li class="help-index-item"><a href="#names_whichlist">names_whichlist
See which of the lists of names a single term appears in</a></li>
<li class="help-index-item"><a href="#names_whichlist_multi">names_whichlist_multi
See which lists of names the given indicator names are in</a></li>
<li class="help-index-item"><a href="#names_whichlist_multi_key">names_whichlist_multi_key
See which key lists of names the given indicator names are in</a></li>
<li class="help-index-item"><a href="#namez">list of lists of indicator names</a></li>
<li class="help-index-item"><a href="#pctile_from_raw_lookup">pctile_from_raw_lookup - Find approx wtd percentiles in lookup table that is in memory</a></li>
<li class="help-index-item"><a href="#pctiles_lookup_create">pctiles_lookup_create - create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</a></li>
<li class="help-index-item"><a href="#plot_barplot_ratios">plot_barplot_ratios
Make barplot of ratios of demographic score to its average</a></li>
<li class="help-index-item"><a href="#plot_demogshare_by_distance">plot_demogshare_by_distance - work in progress</a></li>
<li class="help-index-item"><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances</a></li>
<li class="help-index-item"><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group
Barplot of Average Proximity to sites, by Demographic Group (vs everyone else)</a></li>
<li class="help-index-item"><a href="#plotblocksnearby">plotblocksnearby - Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby</a></li>
<li class="help-index-item"><a href="#popshare_at_top_n">popshare_at_top_n
What fraction of total population is accounted for by the top n places?</a></li>
<li class="help-index-item"><a href="#popshare_at_top_x_pct">popshare_at_top_x_pct
What fraction of total population is accounted for by the top X percent of places?</a></li>
<li class="help-index-item"><a href="#popshare_p_lives_at_what_n">popshare_p_lives_at_what_n</a></li>
<li class="help-index-item"><a href="#popshare_p_lives_at_what_pct">popshare_p_lives_at_what_pct</a></li>
<li class="help-index-item"><a href="#popup_from_any">popup_from_any - Simple map popup from a data.table or data.frame, one point per row
Creates popup vector that leaflet::addCircles or leaflet::addPopups can use.
Works similarly to EJAMejscreenapi::popup_from_df, but now extends to data.table</a></li>
<li class="help-index-item"><a href="#proximity.score.in.miles">proximity.score.in.miles - convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used</a></li>
<li class="help-index-item"><a href="#proxistat2">proxistat2 - Calculate a proximity score for every blockgroup - WORK IN PROGRESS
Indicator of proximity of each blockgroups to some set of facilities or sites.</a></li>
<li class="help-index-item"><a href="#quaddata">data.table used to create index of all US block point locations</a></li>
<li class="help-index-item"><a href="#regionstats">regionstats (DATA) (obsolete) data.table of 100 percentiles and means for each EPA Region.</a></li>
<li class="help-index-item"><a href="#rmost">rmost - utility to rm(list=ls()) but not remove key datasets EJAM uses</a></li>
<li class="help-index-item"><a href="#rrtable">rrtable
Calculate risk ratios of avg E in group D / in everyone not in group D</a></li>
<li class="help-index-item"><a href="#run_app">run_app - Launch the Shiny Application in RStudio</a></li>
<li class="help-index-item"><a href="#setdiff_yx">setdiff_yx
utility just like setdiff except for y,x instead of x,y</a></li>
<li class="help-index-item"><a href="#setdiff2">setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y</a></li>
<li class="help-index-item"><a href="#SIC">SIC (DATA) named list of all SIC code numbers and category name for each</a></li>
<li class="help-index-item"><a href="#sic_categories">sic_categories - See the names of SIC industrial categories and their codes
Easy way to view, in RStudio console, the SIC categories.
SIC all are 4-digit codes, like 7218 - Industrial launderers</a></li>
<li class="help-index-item"><a href="#sic_from_any">sic_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</a></li>
<li class="help-index-item"><a href="#sic_from_code">sic_from_code - search for industry names by SIC code(s), 4 digits each</a></li>
<li class="help-index-item"><a href="#sic_from_name">sic_from_name - search for industry names and SIC codes by query string
query by parts of words, etc. in the industry name.</a></li>
<li class="help-index-item"><a href="#sic_subcodes_from_code">sic_subcodes_from_code - find subcategories of the given overall SIC industry code(s)
Given 3-digit SIC code, for example, get all SIC that start with those digits.</a></li>
<li class="help-index-item"><a href="#sictable">sictable (DATA) data.table of SIC code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3, and 4-digit SIC that this code falls under, where relevant for given length</a></li>
<li class="help-index-item"><a href="#siteid_from_naics">latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</a></li>
<li class="help-index-item"><a href="#siteid_from_sic">latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)</a></li>
<li class="help-index-item"><a href="#sites2blocks_example1000pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#sites2blocks_example100pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#sites2blocks_example10pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#speedtable_expand">speedtable_expand
Utility used by speedtest() and speedtable_summarize()</a></li>
<li class="help-index-item"><a href="#speedtable_summarize">speedtable_summarize
utility used by speedtest()</a></li>
<li class="help-index-item"><a href="#speedtest">speedtest
Run EJAM analysis for several radii and numbers of sitepoints,
recording how long each step takes</a></li>
<li class="help-index-item"><a href="#speedtest_plot">speedtest_plot
utility to plot output of speedtest(), rate of points analyzed per hour</a></li>
<li class="help-index-item"><a href="#ST_by_site_from_sites2blocks">ST_by_site_from_sites2blocks - Get State that each site is in, from a table of siteid, blockid, distance</a></li>
<li class="help-index-item"><a href="#state_from_blockid">state_from_blockid
given vector of blockids, get state abbreviation of each</a></li>
<li class="help-index-item"><a href="#state_from_blocktable">state_from_blocktable
given data.table with blockid column, get state abbreviation of each</a></li>
<li class="help-index-item"><a href="#state_from_fips">state_from_fips
Get the State abbreviations of all blockgroups within the input FIPS</a></li>
<li class="help-index-item"><a href="#state_from_latlon">state_from_latlon - find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful</a></li>
<li class="help-index-item"><a href="#stateinfo">stateinfo (DATA) data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</a></li>
<li class="help-index-item"><a href="#stateinfo2">stateinfo2 (DATA) data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</a></li>
<li class="help-index-item"><a href="#states_infer">states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS</a></li>
<li class="help-index-item"><a href="#states_shapefile">states_shapefile (DATA) US States boundaries 2020 shapefile from TIGER</a></li>
<li class="help-index-item"><a href="#statestats">statestats (DATA) data.frame of 100 percentiles and means for each US State and PR and DC.</a></li>
<li class="help-index-item"><a href="#statestats_query">statestats_query - convenient way to see mean, pctiles of Env or Demog indicators from lookup table</a></li>
<li class="help-index-item"><a href="#statestats_queryd">statestats_queryd - convenient way to see mean, pctiles of DEMOG indicators from lookup table</a></li>
<li class="help-index-item"><a href="#statestats_querye">statestats_querye - convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table</a></li>
<li class="help-index-item"><a href="#structure.of.output.list">structure.of.output.list - See info about list of results
Utility to print summary info about the output of ejamit or doaggregate</a></li>
<li class="help-index-item"><a href="#tablefixed">tablefixed - Table of counts of integer values zero through maxbin</a></li>
<li class="help-index-item"><a href="#test_regid">test_regid (DATA) test data, vector of EPA FRS Registry ID numbers</a></li>
<li class="help-index-item"><a href="#testoutput_doaggregate_1000pts_1miles">test output of doaggregate()</a></li>
<li class="help-index-item"><a href="#testoutput_doaggregate_100pts_1miles">test output of doaggregate()</a></li>
<li class="help-index-item"><a href="#testoutput_doaggregate_10pts_1miles">test output of doaggregate()</a></li>
<li class="help-index-item"><a href="#testoutput_ejamit_1000pts_1miles">test output of ejamit()</a></li>
<li class="help-index-item"><a href="#testoutput_ejamit_100pts_1miles">test output of ejamit()</a></li>
<li class="help-index-item"><a href="#testoutput_ejamit_10pts_1miles">test output of ejamit()</a></li>
<li class="help-index-item"><a href="#testoutput_getblocksnearby_1000pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#testoutput_getblocksnearby_100pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#testoutput_getblocksnearby_10pts_1miles">test output of getblocksnearby(), and is an input to doaggregate()</a></li>
<li class="help-index-item"><a href="#testpoints_10">test points data.frame with columns siteid, lat, lon</a></li>
<li class="help-index-item"><a href="#testpoints_100">test points data.frame with columns siteid, lat, lon</a></li>
<li class="help-index-item"><a href="#testpoints_1000">test points data.frame with columns siteid, lat, lon</a></li>
<li class="help-index-item"><a href="#testpoints_10000">test points data.frame with columns siteid, lat, lon</a></li>
<li class="help-index-item"><a href="#testpoints_n">testpoints_n - Random points in USA - average resident, facility, BG, block, or square mile
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.</a></li>
<li class="help-index-item"><a href="#trilaterate_sites2blocks">trilaterate_sites2blocks - Estimate lat,lon of each siteid, from outputs of getblocksnearby()
get data.table with siteid, lat,lon of each site (eg for when you did not save sitepoints info)</a></li>
<li class="help-index-item"><a href="#unshared">setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y</a></li>
<li class="help-index-item"><a href="#url_4table">url_4table - Create URLs in columns</a></li>
<li class="help-index-item"><a href="#url_bookmark_save">url_bookmark_save
save bookmarked EJScreen session (map location and indicator)</a></li>
<li class="help-index-item"><a href="#url_bookmark_text">url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)</a></li>
<li class="help-index-item"><a href="#url_get_eparest_chunked_by_id">url_get_eparest_chunked_by_id - experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</a></li>
<li class="help-index-item"><a href="#url_get_via_url">url_get_via_url - helper function work in progress: GET json via url of ejscreen ejquery map services</a></li>
<li class="help-index-item"><a href="#url_getacs_epaquery">url_getacs_epaquery - experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</a></li>
<li class="help-index-item"><a href="#url_getacs_epaquery_chunked">url_getacs_epaquery_chunked - experimental/ work in progress: in chunks, get ACS data via EPA API</a></li>
<li class="help-index-item"><a href="#url_naics.com">url_naics.com - Get URL for page with info about industry sectors by text query term
See (https://naics.com) for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#usastats">usastats (DATA) data.frame of 100 percentiles and means</a></li>
<li class="help-index-item"><a href="#usastats_means">usastats_means - convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_query">usastats_query - convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_queryd">usastats_queryd - convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_querye">usastats_querye - convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table</a></li>
<li class="help-index-item"><a href="#varname2color_ejam">varname2color_ejam - helper function - for color coding excel sheet columns
Convert R variable name of indicator to appropriate color for header row in Excel</a></li>
<li class="help-index-item"><a href="#varname2varcategory_ejam">varname2varcategory_ejam - helper function - given indicator names, look up what category each is</a></li>
<li class="help-index-item"><a href="#varname2vartype_ejam">varname2vartype_ejam - helper function - given indicator names, look up what type each is</a></li>
<li class="help-index-item"><a href="#vartype_cat2color_ejam">vartype_cat2color_ejam - helper function - assign fill color to shade excel cells by indicator type and category
Use color shading to make spreadsheet easier to use, grouping the indicators</a></li>
<li class="help-index-item"><a href="#xls_formatting2">xls_formatting2 - Format EJAM tabular outputs for saving as Excel spreadsheet</a></li>
</ul>

    <hr>
    <div class="manual-pages-content">
<div class="container manual-page" id="dot-onAttach">

<a href="#dot-onAttach" class="help-page-title"><h2>.onAttach - Do slow initialization steps - Download data, load key data into RAM, create index to all US blocks
Note this duplicates some code in global.R, and see source code here to adjust settings.</h2></a>

<h3>Description</h3>

<p>.onAttach - Do slow initialization steps - Download data, load key data into RAM, create index to all US blocks
Note this duplicates some code in global.R, and see source code here to adjust settings.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">.onAttach<span class="token punctuation">(</span>libname<span class="token punctuation">,</span> pkgname<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>libname</code></td>
<td>
<p>na</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkgname</code></td>
<td>
<p>na</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Does this even happen if connect server runs app as a regular shiny app without loading all?
In what order? see app.R too ***
</p>

<hr>
</div>
<div class="container manual-page" id="all_equal_functions">

<a href="#all_equal_functions" class="help-page-title"><h2>helper function for checking possibly different versions of a function with same name in 2 packages</h2></a>

<h3>Description</h3>

<p>helper function for checking possibly different versions of a function with same name in 2 packages
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">all_equal_functions<span class="token punctuation">(</span>
  fun <span class="token operator">=</span> <span class="token string">"latlon_infer"</span><span class="token punctuation">,</span>
  package1 <span class="token operator">=</span> <span class="token string">"EJAM"</span><span class="token punctuation">,</span>
  package2 <span class="token operator">=</span> <span class="token string">"EJAMejscreenapi"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>quoted name of function, like "latlon_infer"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package1</code></td>
<td>
<p>quoted name of package, like "EJAM"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package2</code></td>
<td>
<p>quoted name of package, like "EJAMejscreenapi"</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>TRUE or FALSE
</p>


<h3>See Also</h3>

<p><code><a href="#dupenames">dupenames()</a></code> <code><a href="https://r-universe.dev/manuals/base.html#all.equal">all.equal.function()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="app_run_EJAM">

<a href="#app_run_EJAM" class="help-page-title"><h2>app_run_EJAM - identical to run_app(), just an alias</h2></a>

<h3>Description</h3>

<p>launch Shiny web app from RStudio
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">app_run_EJAM<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token string">"server"</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="app_server">

<a href="#app_server" class="help-page-title"><h2>app_server - EJAM app server</h2></a>

<h3>Description</h3>

<p>app_server - EJAM app server
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">app_server<span class="token punctuation">(</span>input<span class="token punctuation">,</span> output<span class="token punctuation">,</span> session<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>input, output, session</code></td>
<td>
<p>Internal parameters for shiny.
DO NOT REMOVE.</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="avg.in.us">

<a href="#avg.in.us" class="help-page-title"><h2>avg.in.us (DATA) national averages of key indicators, for convenience</h2></a>

<h3>Description</h3>

<p>also available via <a href="#usastats">usastats</a>
</p>

<hr>
</div>
<div class="container manual-page" id="bg_cenpop2020">

<a href="#bg_cenpop2020" class="help-page-title"><h2>bg_cenpop2020 (DATA) data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group</h2></a>

<h3>Description</h3>

<p>bg_cenpop2020 (DATA) data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group
</p>


<h3>Details</h3>

<p>also see attributes(bg_cenpop2020) for source URL and date
</p>


<h3>See Also</h3>

<p><a href="#blockgroupstats">blockgroupstats</a>
</p>

<hr>
</div>
<div class="container manual-page" id="bg_from_county">

<a href="#bg_from_county" class="help-page-title"><h2>bg_from_county - Analyze US Counties as if they were sites, to get EJ indicators summary for each county</h2></a>

<h3>Description</h3>

<p>bg_from_county - Analyze US Counties as if they were sites, to get EJ indicators summary for each county
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>County FIPS vector (ideally as character not numeric values)</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with all pairs of county fips - bgid, and a unique siteid assigned to each county
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'01001'</span><span class="token punctuation">,</span><span class="token string">'72153'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># Largest US Counties by ACS Population Totals:</span>
 blockgroupstats<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>ST <span class="token operator">=</span> ST<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> countypop <span class="token operator">=</span> sum<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  by<span class="token operator">=</span>.<span class="token punctuation">(</span>FIPS <span class="token operator">=</span> substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span><span class="token operator">-</span>countypop<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>
  CountyPopulation <span class="token operator">=</span> prettyNum<span class="token punctuation">(</span>countypop<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FIPS<span class="token punctuation">,</span> ST<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="bgej">

<a href="#bgej" class="help-page-title"><h2>bgej (DATA) EJScreen EJ Indexes for Census block groups</h2></a>

<h3>Description</h3>

<p>bgej (DATA) EJScreen EJ Indexes for Census block groups
</p>


<h3>Details</h3>


<ul><li>
<p> As of 08/2023 it was the EJScreen 2.2 version of data, which used ACS 2017-2021.
</p>
</li></ul>
<p>Each year this should be re-created as for the latest version.
</p>
<p>See <a href="https://www.epa.gov/ejscreen" target="_blank">https://www.epa.gov/ejscreen</a>
</p>

<hr>
</div>
<div class="container manual-page" id="bgpts">

<a href="#bgpts" class="help-page-title"><h2>bgpts (DATA) lat lon of popwtd center of blockgroup, and count of blocks per block group</h2></a>

<h3>Description</h3>

<p>This is just a list of US block groups and how many blocks are in each...
It also has the lat and lon roughly of each blockgroup
</p>


<h3>Details</h3>

<p>The point used for each bg is the Census 2020 population weighted mean
of the blocks' internal points. It gives an approximation of where people live
and where each bg is, which is useful for some situations.
</p>
<pre>
  As of 8/2023 it is the EJScreen 2.2 version of data, which uses ACS 2017-2021
  and Census 2020. it has all US States, DC, PR, but not  "AS" "GU" "MP" "VI"
  
  How lat lon were estimated:

 # Now, for Census 2020 blocks, create pop wtd centroids lat lon for each block group #### 
 #  using  blockwts and   blockpoints
 
 bgpts_blocks &lt;- copy(blockpoints) # not essential but ok to make sure we do not change blockpoints itself by reference in data.table operations
 # all.equal(bgpts$blockid , blockwts$blockid)
 bgpts_blocks[ , bgid    := blockwts$bgid]
 bgpts_blocks[ , blockwt := blockwts$blockwt]
 # get pop wtd mean of lat, and same for lon, by bgid
 bgpts &lt;- bgpts_blocks[ , lapply(.SD, FUN = function(x) stats::weighted.mean(x, w = blockwt, na.rm = TRUE)), .SDcols = c('lat', 'lon') , by = 'bgid']
 rm( bgpts_blocks)
 # add the bgfips column, so it has bgfips, bgid, lat, lon
 # all.equal(bgpts$bgid,bgid2fips$bgid)
 bgpts[ , bgfips := bgid2fips$bgfips]
 # setnames(bgpts, 'bgfips', 'FIPS')
 
 # BUT NOTE this census2020 block table has PR but lacks "AS" "GU" "MP" "VI" ####
 # &gt; uniqueN( blockid2fips[,substr(blockfips,1,2)])
 # [1] 52
 # length(unique(EJSCREEN_Full_with_AS_CNMI_GU_VI$ST_ABBREV)) # which is in the package EJAMejscreendata
 # [1] 56
 #   dim(bgejam)
 # [1] 242,940    155
 #   dim(bg22)
 # [1] 242,335    157
 #
 # so how do we get latlon for bg in as/gu/mp/vi ?  ?####
 
 # view those block group points on a map (plot only a subset which is enough)
 sam &lt;- sample(seq_along(bgpts$bgid),5000) 
 plot(x = bgpts$lon[sam], y = bgpts$lat[sam], pch = '.')
 
 # view one state, florida, where 12 are the 1st 2 digits of the FIPS:
 # bgpts[bgid2fips[substr(bgfips,1,2) == '12', ], on = 'bgid']
 xx='12'
 mystate &lt;- bgpts[bgid2fips[substr(bgfips, 1, 2) == xx, ], on = 'bgid'][ , .(lon, lat)] 
 plot(mystate, pch = '.')
 rm(mystate, xx)
 
    
  How blockcounts were done: 
   
 need  data.table pkg
  bg_blockcounts &lt;- blockwts[ , .(blockcount = uniqueN(.SD)), by=bgid]
  sum(bg_blockcounts$blockcount == 1)
    # [1] 1874 blockgroups have only 1 block
  sum(bg_blockcounts$blockcount == 1000)  the max is 1000 blocks in a bg
    # # [1] 22
  round(100*table(bg_blockcounts[blockcount &lt;20, blockcount]) / nrow(bg_blockcounts) ,1)
    # about 1 to 3 
    #   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19 
    # 0.8 1.2 1.3 1.4 1.5 2.1 2.2 2.4 2.6 2.8 2.8 3.0 3.0 2.9 3.0 2.9 2.8 2.7 2.5 
    all.equal(bgpts$bgid, bg_blockcounts$bgid)
  bgpts[ , blockcount := bg_blockcounts$blockcount]
  dim(bgpts)   
      # 242335  x    5
  usethis::use_data(bgpts) # saved for EJAM package
  
  </pre>

<hr>
</div>
<div class="container manual-page" id="blockgroupstats">

<a href="#blockgroupstats" class="help-page-title"><h2>blockgroupstats (DATA) EJScreen demographic and environmental indicators for Census block groups</h2></a>

<h3>Description</h3>

<p>The EJScreen dataset (demographic, environmental indicators).
</p>
<p>For EJ Indexes, see <a href="#bgej">bgej</a>
</p>


<h3>Details</h3>


<ul><li>
<p> As of 08/2023 it was the EJScreen 2.2 version of data, which used ACS 2017-2021.
</p>
</li></ul>
<p>Each year this should be re-created as for the latest version.
See attributes(blockgroupstats)
</p>
<p>It is a data.table of US Census blockgroups (not blocks).
With PR, and Island Areas
</p>
<p>See <a href="https://www.epa.gov/ejscreen" target="_blank">https://www.epa.gov/ejscreen</a>
</p>
<p>Column names include bgfips, bgid (for join to blockwt$bgid), pop, pctlowinc, etc.
</p>

<hr>
</div>
<div class="container manual-page" id="colcounter">

<a href="#colcounter" class="help-page-title"><h2>colcounter - Count columns with Value (at or) above (or below) threshold</h2></a>

<h3>Description</h3>

<p>colcounter - Count columns with Value (at or) above (or below) threshold
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  threshold<span class="token punctuation">,</span>
  or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  below <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  one.cut.per.col <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>numeric threshold value to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>if TRUE, include ties (value in x equals threshold)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>if TRUE, used by colcounter to count only the non-NA columns in given row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>below</code></td>
<td>
<p>if TRUE, count x below threshold not above threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>one.cut.per.col</code></td>
<td>
<p>if FALSE, compare 1 threshold to all of x.
If TRUE, specify one threshold per column.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of counts as long as NROW(x)
</p>


<h3>See Also</h3>

<p>colcounter_summary_all() colcounter_summary() colcounter_summary_cum() colcounter_summary_pct() colcounter_summary_cum_pct() tablefixed()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 pdata <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col3<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">### pdata &lt;- EJAM::blockgroupstats[ , names_e_pctile]</span>
  <span class="token comment">## or ## pdata &lt;- ejscreen package file bg22[ , ejscreen package file names.e.pctile]</span>
 pcuts <span class="token operator">&lt;-</span>  <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;- as.vector(keystats_e['highcut', ])</span>
colcounter_summary<span class="token punctuation">(</span>        pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_pct<span class="token punctuation">(</span>    pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum<span class="token punctuation">(</span>    pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

x80 <span class="token operator">&lt;-</span> colcounter<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> threshold <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> T<span class="token punctuation">)</span>
x95 <span class="token operator">&lt;-</span> colcounter<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> threshold <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> T<span class="token punctuation">)</span>
table<span class="token punctuation">(</span>x95<span class="token punctuation">)</span>
tablefixed<span class="token punctuation">(</span>x95<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>at80<span class="token operator">=</span>tablefixed<span class="token punctuation">(</span>x80<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> at95<span class="token operator">=</span>tablefixed<span class="token punctuation">(</span>x95<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="colcounter_summary">

<a href="#colcounter_summary" class="help-page-title"><h2>colcounter_summary - Summarize how many rows have N columns at or above (or below) various thresholds?
Like colcounter or cols.above.count
but will handle multiple thresholds to compare to each indicator, etc.
Table of counts, percents, cumulative counts, cumulative percents
of places with N, or at least N, of the indicators
at or above the benchmark(s)</h2></a>

<h3>Description</h3>

<p>colcounter_summary - Summarize how many rows have N columns at or above (or below) various thresholds?
Like colcounter or cols.above.count
but will handle multiple thresholds to compare to each indicator, etc.
Table of counts, percents, cumulative counts, cumulative percents
of places with N, or at least N, of the indicators
at or above the benchmark(s)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter_summary<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  thresholdlist<span class="token punctuation">,</span>
  or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  below <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  one.cut.per.col <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value,
like percentiles for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholdlist</code></td>
<td>
<p>vector of numeric threshold values to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>if TRUE, include ties (value in x equals threshold)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>if TRUE, used by <code><a href="#colcounter">colcounter()</a></code> to count only the non-NA columns in given row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>below</code></td>
<td>
<p>if TRUE, count x below threshold not above threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>one.cut.per.col</code></td>
<td>
<p>if FALSE, compare each threshold to all of x.
If TRUE, specify one threshold to use for each column.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A table of frequency counts
</p>


<h3>See Also</h3>

<p><code><a href="#colcounter_summary_all">colcounter_summary_all()</a></code> <code><a href="#colcounter_summary">colcounter_summary()</a></code> <code><a href="#colcounter_summary_cum">colcounter_summary_cum()</a></code> <code><a href="#colcounter_summary_pct">colcounter_summary_pct()</a></code> <code><a href="#colcounter_summary_cum_pct">colcounter_summary_cum_pct()</a></code>
</p>
<p><code><a href="#tablefixed">tablefixed()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 pdata <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col3<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">### pdata &lt;- EJAM::blockgroupstats[ , names_e_pctile]</span>
 pcuts <span class="token operator">&lt;-</span>  <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;- as.vector(keystats_e['highcut', ])</span>
colcounter_summary<span class="token punctuation">(</span>        pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_pct<span class="token punctuation">(</span>    pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum<span class="token punctuation">(</span>    pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>
colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a3 <span class="token operator">&lt;-</span> colcounter_summary_all<span class="token punctuation">(</span>    pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span>

x80 <span class="token operator">&lt;-</span> colcounter<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> threshold <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> T<span class="token punctuation">)</span>
x95 <span class="token operator">&lt;-</span> colcounter<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> threshold <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> T<span class="token punctuation">)</span>
table<span class="token punctuation">(</span>x95<span class="token punctuation">)</span>
tablefixed<span class="token punctuation">(</span>x95<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>at80<span class="token operator">=</span>tablefixed<span class="token punctuation">(</span>x80<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> at95<span class="token operator">=</span>tablefixed<span class="token punctuation">(</span>x95<span class="token punctuation">,</span> NCOL<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="colcounter_summary_all">

<a href="#colcounter_summary_all" class="help-page-title"><h2>colcounter_summary_all - Summarize count (and percent) of rows with exactly (and at least) N cols &gt;= various thresholds
A wrapper for 4 functions: Returns four tables,
using colcounter_summary(), colcounter_summary_pct(),
colcounter_summary_cum(), colcounter_summary_cum_pct()</h2></a>

<h3>Description</h3>

<p>colcounter_summary_all - Summarize count (and percent) of rows with exactly (and at least) N cols &gt;= various thresholds
A wrapper for 4 functions: Returns four tables,
using colcounter_summary(), colcounter_summary_pct(),
colcounter_summary_cum(), colcounter_summary_cum_pct()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter_summary_all<span class="token punctuation">(</span>x<span class="token punctuation">,</span> thresholdlist<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value,
like percentiles for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholdlist</code></td>
<td>
<p>vector of numeric threshold values to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to the 4 functions
like or.tied=TRUE, na.rm=TRUE, below=FALSE, one.cut.per.col=FALSE</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p>colcounter_summary_all() colcounter_summary() colcounter_summary_cum() colcounter_summary_pct() colcounter_summary_cum_pct()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
    <span class="token comment"># df &lt;-  bg22[ , names.ej.pctile]</span>
 df <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col3<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 bench <span class="token operator">&lt;-</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
 a3 <span class="token operator">&lt;-</span> colcounter_summary_all<span class="token punctuation">(</span>df<span class="token punctuation">,</span> bench<span class="token punctuation">)</span>
 a3<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'95'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
 a3<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token string">'cum_pct'</span><span class="token punctuation">]</span>
 a3<span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span> a3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
 a3<span class="token punctuation">[</span>dim<span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
 <span class="token comment"># a3['12',,]; a3[13,,]</span>

 barplot<span class="token punctuation">(</span>colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token string">'80'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    ylab<span class="token operator">=</span><span class="token string">'% of places'</span><span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'# of indicators at/above threshold'</span><span class="token punctuation">,</span>
    main<span class="token operator">=</span><span class="token string">'% of places with at least N/12 indicators &gt;=80th percentile'</span><span class="token punctuation">)</span>

 barplot<span class="token punctuation">(</span>colcounter_summary<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> pcuts<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">13</span> <span class="token punctuation">,</span> <span class="token string">'95'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    ylab<span class="token operator">=</span><span class="token string">'# of places'</span><span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'# of indicators at/above threshold'</span><span class="token punctuation">,</span>
    main<span class="token operator">=</span><span class="token string">'# of places with exactly N/12 indicators &gt;=95th percentile'</span><span class="token punctuation">)</span>

  <span class="token comment"># pdata &lt;- ejscreen package file bg22[ , names.e.pctile]</span>
  colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  xs <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">12</span>
  plot<span class="token punctuation">(</span>x<span class="token operator">=</span>xs<span class="token punctuation">,</span> y<span class="token operator">=</span>colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> ylim<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    main<span class="token operator">=</span><span class="token string">'% of places with at least x/12 indicators &gt;=Nth percentile'</span><span class="token punctuation">,</span>
     ylab<span class="token operator">=</span><span class="token string">'% of places'</span><span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'# of indicators'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
  legend<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token string">'topright'</span><span class="token punctuation">,</span> legend <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">'&gt;= '</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'th percentile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   fill <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'gray'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment"># pdata &lt;- bg22[ ,  names.ej.pctile]</span>
  colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  xs <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">12</span>
  plot<span class="token punctuation">(</span>x<span class="token operator">=</span>xs<span class="token punctuation">,</span> y<span class="token operator">=</span>colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> ylim<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    main<span class="token operator">=</span><span class="token string">'% of places with at least x/12 indicators &gt;=Nth percentile'</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'% of places'</span><span class="token punctuation">,</span> 
    xlab<span class="token operator">=</span><span class="token string">'# of indicators'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">)</span>
  points<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> colcounter_summary_cum_pct<span class="token punctuation">(</span>pdata<span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">[</span>xs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
  legend<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token string">'topright'</span><span class="token punctuation">,</span> legend <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">'&gt;= '</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'th percentile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    fill <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'gray'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="colcounter_summary_cum">

<a href="#colcounter_summary_cum" class="help-page-title"><h2>colcounter_summary_cum - Summarize how many rows have AT LEAST N columns at or above (or below) various thresholds
See colcounter_summary() for more info and examples.</h2></a>

<h3>Description</h3>

<p>colcounter_summary_cum - Summarize how many rows have AT LEAST N columns at or above (or below) various thresholds
See colcounter_summary() for more info and examples.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter_summary_cum<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  thresholdlist<span class="token punctuation">,</span>
  or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  below <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  one.cut.per.col <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value,
like percentiles for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholdlist</code></td>
<td>
<p>vector of numeric threshold values to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>if TRUE, include ties (value in x equals threshold)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>if TRUE, used by colcounter to count only the non-NA columns in given row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>below</code></td>
<td>
<p>if TRUE, count x below threshold not above threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>one.cut.per.col</code></td>
<td>
<p>if FALSE, compare each threshold to all of x.
If TRUE, specify one threshold to use for each column.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A table of cumulative frequency counts
</p>


<h3>See Also</h3>

<p>colcounter_summary_all() colcounter_summary() colcounter_summary_cum() colcounter_summary_pct() colcounter_summary_cum_pct()
</p>

<hr>
</div>
<div class="container manual-page" id="colcounter_summary_cum_pct">

<a href="#colcounter_summary_cum_pct" class="help-page-title"><h2>Summarize what percent of rows have AT LEAST N columns at or above (or below) various thresholds</h2></a>

<h3>Description</h3>

<p>Summarize what percent of rows have AT LEAST N columns at or above (or below) various thresholds
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter_summary_cum_pct<span class="token punctuation">(</span>x<span class="token punctuation">,</span> thresholdlist<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value,
like percentiles for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholdlist</code></td>
<td>
<p>vector of numeric threshold values to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to colcounter_summary_cum()
like or.tied=TRUE, na.rm=TRUE, below=FALSE, one.cut.per.col=FALSE</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p>colcounter_summary_all() colcounter_summary() colcounter_summary_cum() colcounter_summary_pct() colcounter_summary_cum_pct()
</p>

<hr>
</div>
<div class="container manual-page" id="colcounter_summary_pct">

<a href="#colcounter_summary_pct" class="help-page-title"><h2>colcounter_summary_pct - Summarize what percent of rows have N columns at or above (or below) various thresholds</h2></a>

<h3>Description</h3>

<p>colcounter_summary_pct - Summarize what percent of rows have N columns at or above (or below) various thresholds
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">colcounter_summary_pct<span class="token punctuation">(</span>x<span class="token punctuation">,</span> thresholdlist<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to threshold value,
like percentiles for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholdlist</code></td>
<td>
<p>vector of numeric threshold values to compare to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to colcounter_summary()
like or.tied=TRUE, na.rm=TRUE, below=FALSE, one.cut.per.col=FALSE</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See examples for colcounter_summary_cum_pct()
</p>


<h3>See Also</h3>

<p>colcounter_summary_all() colcounter_summary() colcounter_summary_cum() colcounter_summary_pct() colcounter_summary_cum_pct()
</p>

<hr>
</div>
<div class="container manual-page" id="count_sites_with_n_high_scores">

<a href="#count_sites_with_n_high_scores" class="help-page-title"><h2>count_sites_with_n_high_scores</h2></a>

<h3>Description</h3>

<p>count_sites_with_n_high_scores
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">count_sites_with_n_high_scores<span class="token punctuation">(</span>
  scores<span class="token punctuation">,</span>
  thresholds <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1.01</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  xwide <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"statewide"</span><span class="token punctuation">,</span> <span class="token string">"nationwide"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>score</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholds</code></td>
<td>
<p>thresholds</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xwide</code></td>
<td>
<p>xwide</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="counties_as_sites">

<a href="#counties_as_sites" class="help-page-title"><h2>counties_as_sites</h2></a>

<h3>Description</h3>

<p>counties_as_sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">counties_as_sites<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>County FIPS vector (ideally as character not numeric values)</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with all pairs of county fips - bgid, and a unique siteid assigned to each county
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'01001'</span><span class="token punctuation">,</span><span class="token string">'72153'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># Largest US Counties by ACS Population Totals:</span>
 blockgroupstats<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>ST <span class="token operator">=</span> ST<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> countypop <span class="token operator">=</span> sum<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  by<span class="token operator">=</span>.<span class="token punctuation">(</span>FIPS <span class="token operator">=</span> substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span><span class="token operator">-</span>countypop<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>
  CountyPopulation <span class="token operator">=</span> prettyNum<span class="token punctuation">(</span>countypop<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FIPS<span class="token punctuation">,</span> ST<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="dataload_from_aws">

<a href="#dataload_from_aws" class="help-page-title"><h2>dataload_from_aws - utility to load datasets from AWS DMAP Data Commons, into memory</h2></a>

<h3>Description</h3>

<p>dataload_from_aws - utility to load datasets from AWS DMAP Data Commons, into memory
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dataload_from_aws<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bgid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockpoints"</span><span class="token punctuation">,</span> <span class="token string">"blockwts"</span><span class="token punctuation">,</span> <span class="token string">"quaddata"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ext <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">".arrow"</span><span class="token punctuation">,</span> <span class="token string">".rda"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  fun <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"arrow::read_ipc_file"</span><span class="token punctuation">,</span> <span class="token string">"load"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  envir <span class="token operator">=</span> globalenv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  mybucket <span class="token operator">=</span> <span class="token string">"dmap-data-commons-oa"</span><span class="token punctuation">,</span>
  mybucketfolder <span class="token operator">=</span> <span class="token string">"EJAM"</span><span class="token punctuation">,</span>
  folder_local_source <span class="token operator">=</span> <span class="token string">"~/../Downloads"</span><span class="token punctuation">,</span>
  justchecking <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  check_server_even_if_justchecking <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>character vector of the quoted names of the data objects like blockwts or quaddata</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>default is parent.frame()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mybucket</code></td>
<td>
<p>where in AWS, like</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mybucketfolder</code></td>
<td>
<p>where in AWS, like EJAM</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder_local_source</code></td>
<td>
<p>path of folder (not ending in forward slash) to
look in for locally saved copies during development
to avoid waiting for download from a server.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justchecking</code></td>
<td>
<p>set to TRUE to get object size (and confirm file is accessible/exists)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_server_even_if_justchecking</code></td>
<td>
<p>set this to TRUE to stop checking server to see if files are there
when justchecking = TRUE. But server is always checked if justchecking = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>only for testing</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See source code for details.
</p>
<p>CURRENTLY TRIES TO USE dataload_from_local() first, during development to avoid slow downloads.
</p>
<p>Also see <a href="https://shiny.posit.co/r/articles/improve/scoping/" target="_blank">https://shiny.posit.co/r/articles/improve/scoping/</a>
</p>
<p>Does it require credentials?
</p>
<p>Use dataload_from_aws(justchecking=TRUE),
</p>
<p>or datapack("EJAM") to get info,
</p>
<p>or tables(),
</p>
<p>or object.size(quaddata)
</p>
<p>NOTE: blockid2fips is HUGE in memory, and is used only in
state_from_blocktable() and state_from_blockid(), which are not always needed by the app,
so maybe should not load this unless/until needed?
</p>
<p>blockid2fips is roughly 600 MB in RAM because it stores 8 million block FIPS as text.
</p>
<p>List 9/2023 was:
</p>

<ul>
<li>
<p> blockid2fips (20 MB on disk, approx 600 MB RAM !!)
</p>
</li>
<li>
<p> quaddata (168 MB on disk, 218 MB RAM)
</p>
</li>
<li>
<p> blockpoints (86 MB on disk, 156 MB RAM)
</p>
</li>
<li>
<p> blockwts (31 MB on disk, 125 MB RAM)
</p>
</li>
<li>
<p> bgid2fips (18 MB RAM)
</p>
</li>
</ul>
<h3>Value</h3>

<p>nothing - just loads data into environment (unless justchecking=T)
</p>


<h3>See Also</h3>

<p><code><a href="#datapack">datapack()</a></code> <code><a href="#dataload_from_aws">dataload_from_aws()</a></code> <code><a href="#dataload_from_package">dataload_from_package()</a></code> <code><a href="#indexblocks">indexblocks()</a></code> <code><a href="#dot-onAttach">.onAttach()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="dataload_from_entirefolder">

<a href="#dataload_from_entirefolder" class="help-page-title"><h2>dataload_from_entirefolder
loads into global environment all .rda files found in specified folder</h2></a>

<h3>Description</h3>

<p>dataload_from_entirefolder
loads into global environment all .rda files found in specified folder
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dataload_from_entirefolder<span class="token punctuation">(</span>folder <span class="token operator">=</span> <span class="token string">"./data"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>path</p>
</td>
</tr></table>
<h3>Value</h3>

<p>nothing. just loads to global envt
</p>

<hr>
</div>
<div class="container manual-page" id="dataload_from_local">

<a href="#dataload_from_local" class="help-page-title"><h2>dataload_from_local
utility for R analysts/developers to store large block data locally instead of redownloading from AWS</h2></a>

<h3>Description</h3>

<p>dataload_from_local
utility for R analysts/developers to store large block data locally instead of redownloading from AWS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dataload_from_local<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bgid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockpoints"</span><span class="token punctuation">,</span> <span class="token string">"blockwts"</span><span class="token punctuation">,</span> <span class="token string">"quaddata"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ext <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">".arrow"</span><span class="token punctuation">,</span> <span class="token string">".rda"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  fun <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"arrow::read_ipc_file"</span><span class="token punctuation">,</span> <span class="token string">"load"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  envir <span class="token operator">=</span> globalenv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  folder_local_source <span class="token operator">=</span> <span class="token string">"~/../Downloads"</span><span class="token punctuation">,</span>
  justchecking <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ext</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder_local_source</code></td>
<td>
<p>Your local folder path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justchecking</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>use defaults</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>rm(bgid2fips, blockid2fips, blockpoints, blockwts, quaddata)
</p>
<p>dataload_from_local(folder_local_source = '.')
</p>

<hr>
</div>
<div class="container manual-page" id="dataload_from_package">

<a href="#dataload_from_package" class="help-page-title"><h2>dataload_from_package - utility to load a couple of datasets using data immediately instead of relying on lazy loading</h2></a>

<h3>Description</h3>

<p>dataload_from_package - utility to load a couple of datasets using data immediately instead of relying on lazy loading
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dataload_from_package<span class="token punctuation">(</span>
  olist <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"blockgroupstats"</span><span class="token punctuation">,</span> <span class="token string">"usastats"</span><span class="token punctuation">,</span> <span class="token string">"statestats"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  envir <span class="token operator">=</span> globalenv<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>olist</code></td>
<td>
<p>vector of strings giving names of objects to load using data().
This could also include other large datasets that are slow to lazyload but not always needed:
"frs", "frs_by_programid ", "frs_by_naics", etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>the environment into which they should be loaded</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Default is to load some but not all the datasets into memory immediately.
blockgroupstats, usastats, statestats, and some others are always essential to EJAM, but
frs and frs_by_programid are huge datasets (and frs_by_sic and frs_by_naics)
and not always used - only to find regulated facilities by ID, etc.
The frs-related datasets here can be roughly 1.5 GB in RAM, perhaps.
</p>


<h3>Value</h3>

<p>Nothing
</p>


<h3>See Also</h3>

<p><code><a href="#datapack">datapack()</a></code> <code><a href="#dataload_from_aws">dataload_from_aws()</a></code> <code><a href="#dataload_from_package">dataload_from_package()</a></code> <code><a href="#indexblocks">indexblocks()</a></code> <code><a href="#dot-onAttach">.onAttach()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> datapack<span class="token punctuation">(</span><span class="token string">"EJAM"</span><span class="token punctuation">)</span>
  subset<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token operator">$</span>size <span class="token operator">&gt;=</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token comment"># at least 100 KB</span>
  grep<span class="token punctuation">(</span><span class="token string">"names_"</span><span class="token punctuation">,</span> x<span class="token operator">$</span>Item<span class="token punctuation">,</span> value <span class="token operator">=</span> T<span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> T<span class="token punctuation">,</span> invert <span class="token operator">=</span> T<span class="token punctuation">)</span> <span class="token comment"># most were like names_d, etc.</span>
  ls<span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token punctuation">(</span><span class="token string">"avg.in.us"</span><span class="token punctuation">,</span> package<span class="token operator">=</span><span class="token string">"EJAM"</span><span class="token punctuation">)</span> <span class="token comment"># lazy load an object into memory and make it visible to user</span>
  ls<span class="token punctuation">(</span><span class="token punctuation">)</span>
  rm<span class="token punctuation">(</span>avg.<span class="token keyword">in</span>.us<span class="token punctuation">,</span> x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="datapack">

<a href="#datapack" class="help-page-title"><h2>See info about the data sets in one or more packages - internal utility function
Wrapper for data() and gets memory size of objects and silently returns a data.frame</h2></a>

<h3>Description</h3>

<p>See info about the data sets in one or more packages - internal utility function
Wrapper for data() and gets memory size of objects and silently returns a data.frame
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span>pkg <span class="token operator">=</span> ejampackages<span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> sortbysize <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>a character vector giving the package(s) to look in for data sets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>len</code></td>
<td>
<p>Only affects what is printed to console - specifies the
number of characters to limit Title to, making it easier to see in the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbysize</code></td>
<td>
<p>if TRUE, sort by increasing size of object, within each package, not alpha.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>do not rely on this much - it was a quick utility. it also creates and leaves in global envt
objects in packages
</p>


<h3>Value</h3>

<p>data.frame with Item and Title as columns
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span><span class="token string">"datasets"</span><span class="token punctuation">)</span>
 datapack<span class="token punctuation">(</span><span class="token string">"MASS"</span><span class="token punctuation">)</span>
 y <span class="token operator">=</span> datapack<span class="token punctuation">(</span><span class="token string">"EJAM"</span><span class="token punctuation">)</span>
 x <span class="token operator">=</span> datapack<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"EJAM"</span><span class="token punctuation">,</span> <span class="token string">"EJAMejscreenapi"</span><span class="token punctuation">,</span> <span class="token string">"EJAMbatch.summarizer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 x<span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token operator">$</span>Package<span class="token punctuation">,</span> x<span class="token operator">$</span>Item<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span>
 tail<span class="token punctuation">(</span>x<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="datawrite_to_aws">

<a href="#datawrite_to_aws" class="help-page-title"><h2>datawrite_to_aws -  NOT YET WORKING - AccessDenied
Write object(s) like a dataset to DMAP Data Commons, formatted as .arrow or .rda</h2></a>

<h3>Description</h3>

<p>datawrite_to_aws -  NOT YET WORKING - AccessDenied
Write object(s) like a dataset to DMAP Data Commons, formatted as .arrow or .rda
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">datawrite_to_aws<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bgid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockpoints"</span><span class="token punctuation">,</span> <span class="token string">"blockwts"</span><span class="token punctuation">,</span> <span class="token string">"quaddata"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ext <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">".arrow"</span><span class="token punctuation">,</span> <span class="token string">".rda"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  fun <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"arrow::write_ipc_file"</span><span class="token punctuation">,</span> <span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  mybucket <span class="token operator">=</span> <span class="token string">"dmap-data-commons-oa"</span><span class="token punctuation">,</span>
  mybucketfolder <span class="token operator">=</span> <span class="token string">"EJAM"</span><span class="token punctuation">,</span>
  justchecking <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>vector of object names to upload</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ext</code></td>
<td>
<p>file .extension appropriate to the format and fun, like ".rda" or ".arrow"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>function to use, but as a character string, like "arrow::write_ipc_file"
but fun is ignored if ext=".rda" since it then just uses s3save()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mybucket</code></td>
<td>
<p>do not need to change</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mybucketfolder</code></td>
<td>
<p>do not need to change</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justchecking</code></td>
<td>
<p>set this to FALSE to actually upload instead of
just viewing in console the commands to be used, to test/check this</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>mybucket &lt;-  'dmap-data-commons-oa' #
</p>
<p>bucket_contents &lt;- data.table::rbindlist(
</p>
<div class="sourceCode"><pre>get_bucket(bucket = mybucket, prefix = "EJAM"),

fill = TRUE
  
)
</pre></div>
<p>bucket_contents
</p>


<h3>Value</h3>

<p>the paths of the objects on server
</p>

<hr>
</div>
<div class="container manual-page" id="datawrite_to_local">

<a href="#datawrite_to_local" class="help-page-title"><h2>datawrite_to_local
Write large object(s) like EJAM datasets to local disk for convenience during app/pkg development, formatted as .arrow or .rda</h2></a>

<h3>Description</h3>

<p>datawrite_to_local
Write large object(s) like EJAM datasets to local disk for convenience during app/pkg development, formatted as .arrow or .rda
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">datawrite_to_local<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bgid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockpoints"</span><span class="token punctuation">,</span> <span class="token string">"blockwts"</span><span class="token punctuation">,</span> <span class="token string">"quaddata"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ext <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">".arrow"</span><span class="token punctuation">,</span> <span class="token string">".rda"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  folder_local_source <span class="token operator">=</span> <span class="token string">"~/../Downloads"</span><span class="token punctuation">,</span>
  fun <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"arrow::write_ipc_file"</span><span class="token punctuation">,</span> <span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  justchecking <span class="token operator">=</span> F<span class="token punctuation">,</span>
  overwrite <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>vector of object names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ext</code></td>
<td>
<p>file .extension appropriate to the format, ".rda" or ".arrow"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder_local_source</code></td>
<td>
<p>path to local folder without slash at end</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>function to use, but as a character string, like "arrow::write_ipc_file"
but fun is ignored if ext=".rda" since it then just uses save()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justchecking</code></td>
<td>
<p>set this to FALSE to actually save instead of
just seeing in console info or the commands to be used, to test/check this</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>Set to TRUE to overwrite file if it exists already, with new copy.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>the paths of the objects as requested to be saved whether or not actually done
</p>


<h3>See Also</h3>

<p><code><a href="#datawrite_to_aws">datawrite_to_aws()</a></code>  <code><a href="#datawrite_to_local">datawrite_to_local()</a></code> <code><a href="#dataload_from_local">dataload_from_local()</a></code> <code><a href="#dataload_from_aws">dataload_from_aws()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># datawrite_to_local(ext = ".arrow", folder_local_source = ".", justchecking = F, overwrite = T)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_by_group">

<a href="#distance_by_group" class="help-page-title"><h2>distance_by_group - Avg distance of each demog group (of multiple groups)
Same as <code><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group()</a></code> but no plot by default</h2></a>

<h3>Description</h3>

<p>Note ratio shown is ratio of distance among others to distance in group,
so values below 1 mean the given demographic group lives closer to facilities.
A value of 0.85 would mean the group is only 85% as far from a site as
@details Note it is in miles assuming input was in miles, and the distance for each resident is
actually the average distance of all residents within their Census block (not block group),
and when a site is very close to the block internal point (like a centroid)
relative to the size of the block, the distance to the average resident in the block is
estimated as 90 percent of the effective radius, which is what the radius of the block
would be if it were the same area in square meters or miles but circular in shape.
This is the approach used in EJScreen to estimate average proximity of a block resident in
cases where the block is extremely close to the site or the site may actually be inside the block,
or exactly on top of the internal point of the block, in which case zero would not be an
appropriate estimate of the distance, hence this adjustment is made in EJAM getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnwhat <span class="token operator">=</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
  graph <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>vector of column names like "pctlowinc" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>vector of labels like "Low Income Residents" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnwhat</code></td>
<td>
<p>If returnwhat is "table", invisibly returns a
data.frame with group, ratio, avg_distance_for_group, avg_distance_for_nongroup.
If returnwhat is "plotfilename" then it returns the full path including filename of a .png in a tempdir
If returnwhat is "plot" then it returns the plot object as needed for xls_formatting2() ?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>see examples in <code><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group()</a></code>
</p>


<h3>Value</h3>

<p>see parameter returnwhat
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code>
</p>
<p><code><a href="#distance_by_group_plot">distance_by_group_plot()</a></code>  <code><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_by_group_by_site">

<a href="#distance_by_group_by_site" class="help-page-title"><h2>distance_by_group_by_site - DRAFT FUNCTION</h2></a>

<h3>Description</h3>

<p>distance_by_group_by_site - DRAFT FUNCTION
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_by_group_by_site<span class="token punctuation">(</span>bybg<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>bybg</code></td>
<td>
<p>such as <code><a href="#ejamit">ejamit()</a></code>$results_bybg_people</p>
</td>
</tr></table>
<h3>Value</h3>

<p>table of ratios, one col per site, one row per indicator
</p>


<h3>See Also</h3>

<p><code><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group()</a></code> <code><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group()</a></code> <code><a href="#distance_by_group">distance_by_group()</a></code> <code><a href="#distance_mean_by_group">distance_mean_by_group()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="distance_by_group_plot">

<a href="#distance_by_group_plot" class="help-page-title"><h2>distance_by_group_plot or plot_distance_cdf_by_group</h2></a>

<h3>Description</h3>

<p>distance_by_group_plot or plot_distance_cdf_by_group
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_by_group_plot<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Value</h3>

<p>see returnwhat parameter
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code> <code><a href="#ejamit">ejamit()</a></code> for examples
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_by_group1">

<a href="#distance_by_group1" class="help-page-title"><h2>distance_by_group1  -  JUST ONE GROUP
Get average distance for ONE demographic group versus everyone else</h2></a>

<h3>Description</h3>

<p>distance_by_group1  -  JUST ONE GROUP
Get average distance for ONE demographic group versus everyone else
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_by_group1<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token string">"Demog.Index"</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> demogvarname
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>e.g., "pctlowinc"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>e.g., "Low Income Residents"</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note on Avg Distance and range of distances in each Demog group, &amp; %D as function of distance:
</p>
<p>We have info on each blockgroup near each site, which means some small % of those bgs are duplicated in this table:
</p>
<div class="sourceCode"><pre>results_bybg_people
</pre></div>
<p>Mostly we want overall (not by site) to know avg and cum distrib of distances in each demog,
</p>
<p>(and also %D as a function of continuous distance),
</p>
<p>and for those stats we would want to take only unique blockgroups from here,
using the shorter distance, so the distribution of distances does not doublecount people.
</p>
<p>But we might also want to see that distribution of distances by D for just 1 site?
</p>
<p>And we might also want to see the %D as a function of continuous distance at just 1 site?
</p>
<p>So to retain flexibility doaggregate() reports all instances of blockgroup-site pairings.
</p>


<h3>Value</h3>

<p>list of 2 numbers: avg_distance_for_group and avg_distance_for_nongroup
</p>


<h3>See Also</h3>

<p><code><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group()</a></code>  <code><a href="#distance_by_group">distance_by_group()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_cdf_by_group_plot">

<a href="#distance_cdf_by_group_plot" class="help-page-title"><h2>distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONLY ONE demographic group that are within each distance</h2></a>

<h3>Description</h3>

<p>distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONLY ONE demographic group that are within each distance
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_cdf_by_group_plot<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  radius_miles <span class="token operator">=</span> round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>results_bybg_people<span class="token operator">$</span>distance_min_avgperson<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token string">"Demog.Index"</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> demogvarname<span class="token punctuation">,</span>
  color1 <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
  color2 <span class="token operator">=</span> <span class="token string">"black"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_miles</code></td>
<td>
<p>miles radius that was max distance analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>name of column in results_bybg_people, e.g., "pctlowinc"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>friendly text name for labelling graphic, like "Low income residents"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color1</code></td>
<td>
<p>color like "red" for demographic group of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color2</code></td>
<td>
<p>color like "gray" for everyone else</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly returns full table of sorted distances of blockgroups, cumulative count of demog group at that block group's distance,
and cumulative count of everyone else in that block group
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> for examples
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_mean_by_group">

<a href="#distance_mean_by_group" class="help-page-title"><h2>distance_mean_by_group - Avg distance of each demog group (of multiple groups)
Same as <code><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group()</a></code> but no plot by default</h2></a>

<h3>Description</h3>

<p>Note ratio shown is ratio of distance among others to distance in group,
so values below 1 mean the given demographic group lives closer to facilities.
A value of 0.85 would mean the group is only 85% as far from a site as
@details Note it is in miles assuming input was in miles, and the distance for each resident is
actually the average distance of all residents within their Census block (not block group),
and when a site is very close to the block internal point (like a centroid)
relative to the size of the block, the distance to the average resident in the block is
estimated as 90 percent of the effective radius, which is what the radius of the block
would be if it were the same area in square meters or miles but circular in shape.
This is the approach used in EJScreen to estimate average proximity of a block resident in
cases where the block is extremely close to the site or the site may actually be inside the block,
or exactly on top of the internal point of the block, in which case zero would not be an
appropriate estimate of the distance, hence this adjustment is made in EJAM getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_mean_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnwhat <span class="token operator">=</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
  graph <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>vector of column names like "pctlowinc" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>vector of labels like "Low Income Residents" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnwhat</code></td>
<td>
<p>If returnwhat is "table", invisibly returns a
data.frame with group, ratio, avg_distance_for_group, avg_distance_for_nongroup.
If returnwhat is "plotfilename" then it returns the full path including filename of a .png in a tempdir
If returnwhat is "plot" then it returns the plot object as needed for xls_formatting2() ?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>see parameter returnwhat
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code>
</p>
<p><code><a href="#distance_by_group_plot">distance_by_group_plot()</a></code>  <code><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_via_surfacedistance">

<a href="#distance_via_surfacedistance" class="help-page-title"><h2>distance_via_surfacedistance - convert surface distance to actual distance</h2></a>

<h3>Description</h3>

<div class="sourceCode"><pre>\preformatted{
    Just a simple formula:
   earthRadius_miles &lt;- 3959
   angle_rad &lt;- x/earthRadius_miles
   # Calculate  radius * cord length
   return( earthRadius_miles * 2*sin(angle_rad/2) )
   }
</pre></div>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_via_surfacedistance<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>surface distance in miles</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="doaggregate">

<a href="#doaggregate" class="help-page-title"><h2>doaggregate - Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</h2></a>

<h3>Description</h3>

<p>This updated 2023 code takes a set of facilities and the set of blocks that are near each,
(as identified previously, in other code that has identified which blocks are nearby)
and combines those with indicator scores for block groups.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">doaggregate<span class="token punctuation">(</span>
  sites2blocks<span class="token punctuation">,</span>
  sites2states_or_latlon <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  countcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  popmeancols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  calculatedcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  include_ejindexes <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  updateProgress <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  need_proximityscore <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  calculate_ratios <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  silentinteractive <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  called_by_ejamit <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  subgroups_type <span class="token operator">=</span> <span class="token string">"nh"</span><span class="token punctuation">,</span>
  infer_sitepoints <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>data.table of distances in miles between all sites (facilities) and
nearby Census block internal points, with columns siteid, blockid, distance,
created by getblocksnearby  function.
See <a href="#sites2blocks_example10pts_1miles">sites2blocks_example10pts_1miles</a> aka <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a> dataset in package, as input to this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sites2states_or_latlon</code></td>
<td>
<p>data.table or just data.frame, with columns siteid (each unique one in sites2blocks) and ST (2-character State abbreviation) or lat and lon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>Optional radius in miles to limit analysis to. By default this function uses
all the distances that were provided in the output of getblocksnearby(),
and reports radius estimated as rounded max of distance values in inputs to doaggregate.
But there may be cases where you want to run getblocksnearby() once for 10 miles, say,
on a very long list of sites (1,000 or more, say), and then get summary results for
1, 3, 5, and 10 miles without having to redo the getblocksnearby() part for each radius.
This lets you just run getblocksnearby() once for the largest radius, and then query those
results to get doaggregate() to summarize at any distance that is less than or equal to the
original radius analyzed by getblocksnearby().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countcols</code></td>
<td>
<p>character vector of names of variables  to aggregate within a buffer
using a sum of counts, like, for example, the number of people for whom a
poverty ratio is known, the count of which is the exact denominator needed
to correctly calculate percent low income.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popmeancols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using population weighted mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calculatedcols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using formulas that have to be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>used while testing this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_ejindexes</code></td>
<td>
<p>whether to calculate EJ Indexes and return that information</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>updateProgress</code></td>
<td>
<p>progress bar function used for shiny app</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>need_proximityscore</code></td>
<td>
<p>whether to calculate proximity scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calculate_ratios</code></td>
<td>
<p>whether to calculate and return ratio of each indicator to its US and State overall mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silentinteractive</code></td>
<td>
<p>Set to TRUE to see results in RStudio console.
Set to FALSE to prevent long output showing in console in RStudio when in interactive mode</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>called_by_ejamit</code></td>
<td>
<p>Set to TRUE by ejamit() to suppress some outputs even if ejamit(silentinteractive=F)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subgroups_type</code></td>
<td>
<p>Optional (uses default). Set this to
"nh" for non-hispanic race subgroups as in Non-Hispanic White Alone, nhwa and others in names_d_subgroups_nh;
"alone" for EJScreen v2.2 style race subgroups as in    White Alone, wa and others in names_d_subgroups_alone;
"both" for both versions. Possibly another option is "original" or "default" but work in progress.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infer_sitepoints</code></td>
<td>
<p>set to TRUE to try to infer the lat,lon of each site around which the blocks in sites2blocks were found.
lat,lon of each site will be approximated as average of nearby blocks, although a more accurate slower way would
be to use reported distance of each of 3 of the furthest block points and triangulate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>more to pass to another function? Not used currently.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>
<p>This function aggregates the blockgroup scores to create a summary of each indicator,
as a raw score and US percentile and State percentile,
in each buffer (i.e., near each facility):
</p>

<ul>
<li> <p><strong>SUMS OF COUNTS</strong>: for population count, or number of households or Hispanics, etc.
</p>
</li>
<li> <p><strong>POPULATION-WEIGHTED MEANS</strong>: for  Environmental indicators.
</p>
<p><em><strong>EJ Indexes</strong>:</em> The way EJScreen
does this is apparently finding the pop wtd mean of EJ Index raw scores,
not the EJ Index formula applied to the summarized demographic score and aggregated envt number.
</p>
</li>
<li> <p><strong>CALCULATED BY FORMULA</strong>: Buffer or overall score calculated via formulas using aggregated counts,
such as percent low income = sum of counts low income / sum of counts of denominator,
which in this case is the count of those for whom the poverty ratio is known.
</p>
</li>
<li> <p><strong>LOOKED UP</strong>: Aggregated scores are converted into percentile terms via lookup tables (US or State version).
</p>
</li>
</ul>
<p>This function requires the following datasets:
</p>

<ul>
<li>
<p> blockwts: data.table with these columns: blockid , bgid, blockwt
</p>
</li>
<li>
<p> quaddata data.table used to create localtree, a quad tree index of block points
(and localtree that is created when package is loaded)
</p>
</li>
<li>
<p> blockgroupstats - A data.table (such as EJScreen demographic and environmental data by blockgroup?)
</p>
</li>
</ul>
<h3>Value</h3>

<p>list with named elements:
</p>

<ul>
<li> <p><strong><code>results_overall</code></strong>   one row data.table, like results_by_site, but just one row with
aggregated results for all unique residents.
</p>
</li>
<li> <p><strong><code>results_by_site</code></strong>   results for individual sites (buffers) - a data.table of results,
one row per siteid, one column per indicator
</p>
</li>
<li> <p><strong>results_bybg_people</strong>  results for each block group, to allow for showing the distribution of each
indicator across everyone within each demographic group.
</p>
</li>
<li> <p><strong>longnames</strong>  descriptive long names for the indicators in the above outputs
</p>
</li>
<li> <p><strong>count_of_blocks_near_multiple_sites</strong>  additional detail
</p>
</li>
</ul>
<h3>See Also</h3>

<p><a href="#ejamit">ejamit</a>   <code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="dupenames">

<a href="#dupenames" class="help-page-title"><h2>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</h2></a>

<h3>Description</h3>

<p>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dupenames<span class="token punctuation">(</span>
  pkg <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">,</span>
  sortbypkg <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  compare.functions <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>one or more package names as vector of strings.
If "all" it checks all installed pkgs, but takes very very long potentially.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbypkg</code></td>
<td>
<p>If TRUE, just returns same thing but sorted by package name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare.functions</code></td>
<td>
<p>If TRUE, sends to console inf about whether body and formals
of the functions are identical between functions of same name from different packages.
Only checks the first 2 copies, not any additional ones (where 3+ pkgs use same name)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This can help find duplicates/conflicts within source code
and make sure they are on search path, for when renaming / moving functions/packages
</p>


<h3>Value</h3>

<p>data.frame with columns Package, Object name (or NA if no dupes)
</p>


<h3>See Also</h3>

<p><code><a href="#all_equal_functions">all_equal_functions()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="dupeRfiles">

<a href="#dupeRfiles" class="help-page-title"><h2>dupeRfiles
utility for developer to find similarly named .R files in 2 separate folders of source code,
whether or not they are packages.</h2></a>

<h3>Description</h3>

<p>see <code><a href="#dupenames">dupenames()</a></code> for when they are all packages.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dupeRfiles<span class="token punctuation">(</span>folder1 <span class="token operator">=</span> <span class="token string">"./R"</span><span class="token punctuation">,</span> folder2 <span class="token operator">=</span> <span class="token string">"../EJAM/R"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>folder1</code></td>
<td>
<p>path</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder2</code></td>
<td>
<p>path</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="ejam2excel">

<a href="#ejam2excel" class="help-page-title"><h2>ejam2excel
Format the results of ejamit() for excel and optionally save .xlsx file</h2></a>

<h3>Description</h3>

<p>ejam2excel
Format the results of ejamit() for excel and optionally save .xlsx file
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ejam2excel<span class="token punctuation">(</span>
  ejamitout<span class="token punctuation">,</span>
  fname <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  save_now <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  overwrite <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  launchexcel <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  interactive_console <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  ok2plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token keyword">in</span>.testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token keyword">in</span>.analysis_title <span class="token operator">=</span> <span class="token string">"EJAM analysis"</span><span class="token punctuation">,</span>
  react.v1_summary_plot <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  radius_or_buffer_in_miles <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  buffer_desc <span class="token operator">=</span> <span class="token string">"Selected Locations"</span><span class="token punctuation">,</span>
  radius_or_buffer_description <span class="token operator">=</span>
    <span class="token string">"Miles radius of circular buffer (or distance used if buffering around polygons)"</span><span class="token punctuation">,</span>
  hyperlink_colnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"EJScreen Report"</span><span class="token punctuation">,</span> <span class="token string">"EJScreen Map"</span><span class="token punctuation">,</span> <span class="token string">"ECHO report"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ejamitout</code></td>
<td>
<p>output of <code><a href="#ejamit">ejamit()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fname</code></td>
<td>
<p>optional name or full path and name of file to save locally, like "out.xlsx"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_now</code></td>
<td>
<p>optional logical, whether to save as a .xlsx file locally or just return workbook object
that can later be written to .xlsx file using <code><a href="https://ycphs.r-universe.dev/manual/openxlsx.html#saveWorkbook">openxlsx::saveWorkbook()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>optional logical, passed to <code><a href="https://ycphs.r-universe.dev/manual/openxlsx.html#saveWorkbook">openxlsx::saveWorkbook()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launchexcel</code></td>
<td>
<p>optional logical, passed to <code><a href="#xls_formatting2">xls_formatting2()</a></code>, whether to launch browser to see spreadsheet immediately</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interactive_console</code></td>
<td>
<p>optional - should set to FALSE when used in code or server. If TRUE,
prompts RStudio user interactively asking where to save the downloaded file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ok2plot</code></td>
<td>
<p>optional logical, passed to  <code><a href="#xls_formatting2">xls_formatting2()</a></code>, whether safe to try and plot or set FALSE if debugging plot problems</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>in.testing</code></td>
<td>
<p>optional logical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>in.analysis_title</code></td>
<td>
<p>optional title as character string</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>react.v1_summary_plot</code></td>
<td>
<p>optional - a plot object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_or_buffer_in_miles</code></td>
<td>
<p>optional radius in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_or_buffer_description</code></td>
<td>
<p>optional text phrase describing places analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyperlink_colnames</code></td>
<td>
<p>optional names of columns with URLs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional additional parameters passed to <code><a href="#xls_formatting2">xls_formatting2()</a></code>, such as
heatmap_colnames, heatmap_cuts, heatmap_colors, etc.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>returns a workbook object for use by openxlsx::saveWorkbook(wb_out, pathname)
or returns just the full path/file name of where it was saved if save_now = TRUE
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  ejam2excel<span class="token punctuation">(</span>testoutput_ejamit_10pts_1miles<span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="ejamit">

<a href="#ejamit" class="help-page-title"><h2>ejamit - Get complete EJ analysis numbers (demographic and environmental indicators) near a list of locations</h2></a>

<h3>Description</h3>

<p>This is the main function in EJAM for users who want to use EJAM from RStudio.
It does essentially what the webapp does to analyze/summarize near a set of points.
See help("EJAM")
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ejamit<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  quadtree <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  silentinteractive <span class="token operator">=</span> F<span class="token punctuation">,</span>
  fips <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  subgroups_type <span class="token operator">=</span> <span class="token string">"nh"</span><span class="token punctuation">,</span>
  calculate_ratios <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  threshold1 <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles, defining circular buffer around a site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical If TRUE, then where not even 1 BLOCK internal point is within radius of a SITE,
it keeps looking past radius, up to maxradius, to find nearest 1 BLOCK.
What EJScreen does in that case is report NA, right? So,
does EJAM really need to report stats on residents presumed to be within radius,
if no block centroid is within radius?
Best estimate might be to report indicators from nearest block centroid which is
probably almost always the one your site is sitting inside of,
but ideally would adjust total count to be a fraction of blockwt based on
what is area of circular buffer as fraction of area of block it is apparently inside of.
Setting this to TRUE can produce unexpected results, which will not match EJScreen numbers.
</p>
<p>Note that if creating a proximity score, by contrast, you instead want to find nearest 1 SITE if none within radius of this BLOCK.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created using indexblocks() which uses the SearchTree package.
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is attached via the .onAttach() function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silentinteractive</code></td>
<td>
<p>Set to FALSE to prevent long output showing in console in RStudio when in interactive mode,
passed to doaggregate() also. app server sets this to TRUE when calling doaggregate() but
ejamit() default is to set this to FALSE when calling doaggregate().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>FIPS code vector if using FIPS instead of sitepoints to specify places to analyze,
such as a list of US Counties or tracts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subgroups_type</code></td>
<td>
<p>Optional (uses default). Set this to
"nh" for non-hispanic race subgroups as in Non-Hispanic White Alone, nhwa and others in names_d_subgroups_nh;
"alone" for EJScreen v2.2 style race subgroups as in    White Alone, wa and others in names_d_subgroups_alone;
"both" for both versions. Possibly another option is "original" or "default" but work in progress.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calculate_ratios</code></td>
<td>
<p>whether to calculate and return ratio of each indicator to US and State overall averages</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold1</code></td>
<td>
<p>percentile like 80 or 90 or 95 to compare percentiles to
"alone" for groups like white alone (whether or not hispanic),
"both" may try to include both,
or possibly "original" or "default" might be added as options</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of tables of results.
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#doaggregate">doaggregate()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token comment"># All in one step, using functions not shiny app:</span>
 out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100_dt<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> quadtree<span class="token operator">=</span>localtree<span class="token punctuation">)</span>

 <span class="token comment"># Do not specify sitepoints and it will prompt you for a file,</span>
 <span class="token comment"># if in RStudio in interactive mode!</span>
 out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 
  <span class="token comment"># Specify facilities or sites as points for test data, </span>
  <span class="token comment"># use 1000 test facility points from the R package </span>
  testsites <span class="token operator">&lt;-</span> testpoints_1000_dt
  <span class="token comment"># use facility points in an excel or csv file</span>
  testsites <span class="token operator">&lt;-</span> latlon_from_anything<span class="token punctuation">(</span>
   <span class="token string">"./inst/testdata/testpoints_207_sites_with_signif_violations_NAICS_326_ECHO.csv"</span><span class="token punctuation">)</span>
  <span class="token comment"># use facility points from a random sample of EPA-regulated facilities</span>
  testsites <span class="token operator">&lt;-</span> testpoints_n<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">)</span>  
  
  <span class="token comment"># Specify max distance from sites to look at (residents within X miles of site point)</span>
  radius <span class="token operator">&lt;-</span> <span class="token number">3.1</span> <span class="token comment"># miles</span>
  
  <span class="token comment"># Get summaries of all indicators near a set of points </span>
  out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> radius<span class="token punctuation">)</span>  
  <span class="token comment"># out &lt;- ejamit("myfile.xlsx", 3.1)  </span>
  
  <span class="token comment"># out2 &lt;- ejscreenit(testpoints_05)</span>
  
  <span class="token comment"># View results overall</span>
  round<span class="token punctuation">(</span>t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_overall<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">)</span>
  
  <span class="token comment"># View plots</span>
  <span class="token comment"># plot_distance_avg_by_group(out)  </span>
  <span class="token comment"># plot_distance_cdf_by_group(out)</span>
  
  <span class="token comment"># View maps</span>
  mapfast<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3.1</span><span class="token punctuation">)</span>
  
  <span class="token comment"># view results at a single site</span>
  t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
  t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">[</span>out<span class="token operator">$</span>results_bysite<span class="token operator">$</span>siteid <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
  
  
  <span class="token comment"># if doing just 1st step of ejamit() </span>
  <span class="token comment">#  get distance between each site and every nearby Census block</span>
  s2b <span class="token operator">&lt;-</span> testdata_sites2blocks
  s2b <span class="token operator">&lt;-</span> getblocksnearby<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> radius <span class="token operator">=</span> radius<span class="token punctuation">)</span>
  s2b <span class="token operator">&lt;-</span> getblocksnearbyviaQuadTree<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> radius <span class="token operator">=</span> radius<span class="token punctuation">)</span>
  getblocks_diagnostics<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span>
  plotblocksnearby<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span>
   
  <span class="token comment"># if doing just 2d step of ejamit()</span>
  <span class="token comment">#  get summaries of all indicators based on table of distances</span>
  out <span class="token operator">&lt;-</span> doaggregate<span class="token punctuation">(</span>s2b<span class="token punctuation">,</span> testsites<span class="token punctuation">)</span> <span class="token comment"># this works now and is simpler</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="ejampackages">

<a href="#ejampackages" class="help-page-title"><h2>ejampackages (DATA) list of names of key EJAM-related R packages</h2></a>

<h3>Description</h3>

<p>ejampackages (DATA) list of names of key EJAM-related R packages
</p>

<hr>
</div>
<div class="container manual-page" id="ejscreenit_for_ejam">

<a href="#ejscreenit_for_ejam" class="help-page-title"><h2>ejscreenit_for_ejam - DRAFT
Wrapper for ejscreenit() from EJAMejscreenapi package, to use in EJAM app - NOT USED CURRENTLY</h2></a>

<h3>Description</h3>

<p>ejscreenit_for_ejam - DRAFT
Wrapper for ejscreenit() from EJAMejscreenapi package, to use in EJAM app - NOT USED CURRENTLY
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ejscreenit_for_ejam<span class="token punctuation">(</span>sitepoints<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>table with lat and lon columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to ejscreenit() but not tested and probably should not use/ not needed</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>list of results from ejscreenit()
i.e., list of these: results_bysite (data.table), map, plot, us.ratios
</p>

<hr>
</div>
<div class="container manual-page" id="fips_counties_from_state_abbrev">

<a href="#fips_counties_from_state_abbrev" class="help-page-title"><h2>fips_counties_from_state_abbrev</h2></a>

<h3>Description</h3>

<p>fips_counties_from_state_abbrev
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_state_abbrev<span class="token punctuation">(</span>ST<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations like c("NY","GA")</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 5-digit character string county FIPS of all unique counties in those states
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_state_abbrev<span class="token punctuation">(</span><span class="token string">"DE"</span><span class="token punctuation">)</span>
  fips_counties_from_state_abbrev<span class="token punctuation">(</span><span class="token string">"RI"</span><span class="token punctuation">,</span> <span class="token string">"RI"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fips_counties_from_statefips">

<a href="#fips_counties_from_statefips" class="help-page-title"><h2>fips_counties_from_statefips</h2></a>

<h3>Description</h3>

<p>fips_counties_from_statefips
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_statefips<span class="token punctuation">(</span>statefips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>statefips</code></td>
<td>
<p>vector of 2-digit state FIPS codes like c("10", "44", "44") or c(10,44)</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 5-digit character string county FIPS of all unique counties in those states
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_statefips<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fips_counties_from_statefips<span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fips_counties_from_statename">

<a href="#fips_counties_from_statename" class="help-page-title"><h2>fips_counties_from_statename</h2></a>

<h3>Description</h3>

<p>fips_counties_from_statename
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_statename<span class="token punctuation">(</span>statename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>statename</code></td>
<td>
<p>vector of state names like c("New York","Georgia")</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 5-digit character string county FIPS of all unique counties in those states
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_counties_from_statename<span class="token punctuation">(</span><span class="token string">"Delaware"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fips_from_table">

<a href="#fips_from_table" class="help-page-title"><h2>fips_from_table
Just read the codes in one column of a table obtained from something like read.csv, or excel, etc.</h2></a>

<h3>Description</h3>

<p>fips_from_table
Just read the codes in one column of a table obtained from something like read.csv, or excel, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_from_table<span class="token punctuation">(</span>fips_table<span class="token punctuation">,</span> addleadzeroes <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> inshiny <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips_table</code></td>
<td>
<p>data.frame or data.table of FIPS codes for counties, states, or tracts,
for example, in a column whose name can be interpreted as FIPS
(is one of the aliases like fips, countyfips, etc.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addleadzeroes</code></td>
<td>
<p>whether to add leading zeroes where needed as for a State whose FIPS starts with "01"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inshiny</code></td>
<td>
<p>used by server during shiny app</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a vector of fips codes
</p>


<h3>See Also</h3>

<p><code><a href="#fipsbg_from_anyfips">fipsbg_from_anyfips()</a></code> <code><a href="#fips_lead_zero">fips_lead_zero()</a></code> <code><a href="#getblocksnearby_from_fips">getblocksnearby_from_fips()</a></code> <code><a href="#fips_from_table">fips_from_table()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="fips_lead_zero">

<a href="#fips_lead_zero" class="help-page-title"><h2>fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.</h2></a>

<h3>Description</h3>

<p>fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_lead_zero<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of numeric or character US FIPS codes</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of same length
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_lead_zero<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"01"</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">,</span><span class="token string">"1234"</span><span class="token punctuation">,</span><span class="token string">"12345"</span><span class="token punctuation">,</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fips_state_from_state_abbrev">

<a href="#fips_state_from_state_abbrev" class="help-page-title"><h2>fips_state_from_state_abbrev</h2></a>

<h3>Description</h3>

<p>fips_state_from_state_abbrev
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_state_from_state_abbrev<span class="token punctuation">(</span>ST<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations like c("NY","GA")</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 2-digit state FIPS codes like c("10", "44", "44"),
same length as input, so including any duplicates
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_state_from_state_abbrev<span class="token punctuation">(</span><span class="token string">"DE"</span><span class="token punctuation">,</span> <span class="token string">"DE"</span><span class="token punctuation">,</span> <span class="token string">"RI"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fips_state_from_statename">

<a href="#fips_state_from_statename" class="help-page-title"><h2>fips_state_from_statename</h2></a>

<h3>Description</h3>

<p>fips_state_from_statename
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_state_from_statename<span class="token punctuation">(</span>statename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>statename</code></td>
<td>
<p>vector of state names like c("New York","Georgia")</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 2-digit state FIPS codes like c("10", "44", "44"),
same length as input, so including any duplicates
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_state_from_statename<span class="token punctuation">(</span><span class="token string">"Delaware"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fipsbg_from_anyfips">

<a href="#fipsbg_from_anyfips" class="help-page-title"><h2>fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS</h2></a>

<h3>Description</h3>

<p>fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fipsbg_from_anyfips<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of US FIPS codes, as character or numeric,
with or without their leading zeroes, each with as many characters</p>
</td>
</tr></table>
<h3>Details</h3>

<p>This is a way to get a list of blockgroups, specified by state/county/tract or even block.
</p>
<p>Takes a vector of one or more FIPS that could be State (2-digit), County (5-digit),
Tract (11-digit), or blockgroup (12 digit), or even block (15-digit fips).
</p>
<p>Returns unique vector of FIPS of all US blockgroups (including DC and Puerto Rico)
that contain any specified blocks, are equal to any specified blockgroup fips,
or are contained within any provided tract/county/state FIPS.
</p>


<h3>Value</h3>

<p>vector of blockgroup FIPS (or NA values) that may be much longer than the
vector of fips passed to this function.
</p>


<h3>See Also</h3>

<p><code><a href="#fips_lead_zero">fips_lead_zero()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># all blockgroups in one state</span>
  blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>.N<span class="token punctuation">,</span>by<span class="token operator">=</span>substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  length<span class="token punctuation">(</span>fipsbg_from_anyfips<span class="token punctuation">(</span><span class="token string">"72"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># all blockgroups in this one county</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span><span class="token number">30001</span><span class="token punctuation">)</span>
  <span class="token comment"># all blockgroups that contain any of these 6 blocks (just one bg)</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span> blockid2fips<span class="token operator">$</span>blockfips<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment"># 2 counties</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">36009</span><span class="token punctuation">,</span><span class="token number">36011</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="format_gt_table">

<a href="#format_gt_table" class="help-page-title"><h2>format_gt_table</h2></a>

<h3>Description</h3>

<p>format_gt_table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">format_gt_table<span class="token punctuation">(</span>
  df<span class="token punctuation">,</span>
  type<span class="token punctuation">,</span>
  my_cell_color <span class="token operator">=</span> <span class="token string">"#dce6f0"</span><span class="token punctuation">,</span>
  my_border_color <span class="token operator">=</span> <span class="token string">"#0070c0"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df, </code></td>
<td>
<p>a data frame with 6 columns (var_names, value, state_avg, state_pctile, usa_avg, usa_pctile), and one row per indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type, </code></td>
<td>
<p>string - one of 'demog', 'envt'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my_cell_color, </code></td>
<td>
<p>color for filling in background of table cells, can be given as string ('blue') or hex code ('#0070c0')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my_border_color, </code></td>
<td>
<p>color for table borders and boundaries, can be given as string ('blue') or hex code ('#0070c0')</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a 'gt'-style table with formatting to closely match EJScreen standard report formatting
</p>

<hr>
</div>
<div class="container manual-page" id="format_results_overall">

<a href="#format_results_overall" class="help-page-title"><h2>format_results_overall
Format the results_overall part of the output of ejamit() or doaggregate()</h2></a>

<h3>Description</h3>

<p>format_results_overall
Format the results_overall part of the output of ejamit() or doaggregate()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">format_results_overall<span class="token punctuation">(</span>results_overall<span class="token punctuation">,</span> longnames<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_overall</code></td>
<td>
<p>data.table of 1 row, from output of ejamit() or doaggregate()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>longnames</code></td>
<td>
<p>vector of names of variables in results_overall,
from output of ejamit() or doaggregate()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.table that is one row per indicator
</p>

<hr>
</div>
<div class="container manual-page" id="frs">

<a href="#frs" class="help-page-title"><h2>frs (DATA) EPA Facility Registry Service table of regulated sites</h2></a>

<h3>Description</h3>

<p>This is a data.table snapshot version of the EPA FRS.
You can look up sites by REGISTRY_ID in <a href="#frs">frs</a>, and get their location, etc.
</p>


<h3>Details</h3>

<p>This dataset can be updated by a package maintainer by using
frs_update_datasets() (which is not an exported function)
</p>
<p>The definitions of active/inactive here are not quite the
same as used in ECHO, as of 5/2023.
</p>
<p>Also, EJScreen has maps of EPA-regulated facilities of a few program types,
as provided here: <a href="https://www.epa.gov/ejscreen/ejscreen-map-descriptions#sites-reporting-to-epa" target="_blank">https://www.epa.gov/ejscreen/ejscreen-map-descriptions#sites-reporting-to-epa</a>
</p>
<pre>

 As of June 2023
 
 Count of    all REGISTRY_ID rows:   7,441,086
 Count of unique REGISTRY_ID values: 4,705,744
 Clearly inactive unique IDs:        1,436,096
 Assumed   active unique IDs:        3,269,648

frs rows total:            3,456,042 
frs clearly inactive IDs:  1,436,096 
frs rows actives:          2,573,338 
frs_by_programid rows:     3,440,036 
frs_by_naics rows:           679,471 
frs_by_sic rows:           1,081,742

  Classes data.table and 'data.frame':	 
  Retained only these columns for this package
  
  $ lat           : num  18.4 18.4 18.5 18.2 18.2 ...
  $ lon           : num  -66.1 -66.1 -66.8 -67.1 -67.2 ...
  $ REGISTRY_ID   : chr  "110000307668" "110000307695" "110000307739" "110000307757" ...
  $ PRIMARY_NAME  : chr  "HB FULLER COMPANY HBF PUERTO RICO" "RAMCO CHEMICALS INCORPORATED" 
  $ NAICS         : chr  "325520" "" "311119" "312120" ...
  $ SIC           : chr  "2842" "2048" "2047, 2048, 2091" ...
  $ PGM_SYS_ACRNMS: chr  "NCDB:I02#19880913A2001 2, RCRAINFO:PRD090122136
   
   </pre>


<h3>See Also</h3>

<p>frs_by_programid  frs_by_naics frs_by_sic
</p>

<hr>
</div>
<div class="container manual-page" id="frs_by_mact">

<a href="#frs_by_mact" class="help-page-title"><h2>frs_by_mact (DATA) MACT NESHAP subpart(s) that each EPA-regulated site is subject to</h2></a>

<h3>Description</h3>

<p>This is a data.table with one row per site  MACT subpart pair,
so it has multiple rows for one site if the site is covered by multiple subparts. It has been joined with frs_by_programid to get latlons for matching facilities.
@details
</p>
<p>There are about 112k rows here but only about 83k unique program IDs in this table,
</p>
<p>which is from the ECHO data download of ICIS Air and AFS.
</p>
<p>The programid column here should be found in the pgm_sys_id column in frs_by_programid,
</p>
<p>but as of 6/14/23 only a little over half of them were found there, so this is work in progress
</p>
<p>to be resolved.
</p>
<p>table(frs_by_mact$programid %in% frs_by_programid$pgm_sys_id)
</p>
<p>FALSE  TRUE
</p>
<p>56497 55411
</p>
<p>Also there are some typos in the downloaded dataset from ECHO/FRS, such as
</p>
<p>"WOOD PERSERVING AREA SOURCES"
</p>


<h3>See Also</h3>

<p><a href="#mact_table">mact_table</a> <a href="#frs_by_programid">frs_by_programid</a>  <a href="#frs">frs</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">mact_table
  mact_table<span class="token punctuation">[</span>order<span class="token punctuation">(</span>mact_table<span class="token operator">$</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  mycodes <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"BBBBBB"</span><span class="token punctuation">,</span> <span class="token string">"OOOO"</span><span class="token punctuation">)</span>
  frs_by_mact<span class="token punctuation">[</span>subpart <span class="token percent-operator operator">%in%</span> mycodes<span class="token punctuation">,</span> <span class="token punctuation">]</span>
  mact_table<span class="token punctuation">[</span>grepl<span class="token punctuation">(</span><span class="token string">"smelt"</span><span class="token punctuation">,</span> mact_table<span class="token operator">$</span>title<span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
  frs_by_mact<span class="token punctuation">[</span>grepl<span class="token punctuation">(</span><span class="token string">"smelt"</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
  <span class="token comment"># a single site can be covered by 19 categories</span>
  frs_by_mact<span class="token punctuation">[</span><span class="token punctuation">,</span> howmany <span class="token operator">:</span><span class="token operator">=</span> .N<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">"programid"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>howmany<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> 
  table<span class="token punctuation">(</span>frs_by_mact<span class="token punctuation">[</span><span class="token punctuation">,</span> howmany <span class="token operator">:</span><span class="token operator">=</span> .N<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">"programid"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>howmany<span class="token punctuation">)</span><span class="token punctuation">,</span> howmany<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_by_naics">

<a href="#frs_by_naics" class="help-page-title"><h2>frs_by_naics (DATA) data.table of NAICS code(s) for each EPA-regulated site in Facility Registry Service</h2></a>

<h3>Description</h3>

<p>This is the format with one row per site-NAICS pair,
so multiple rows for one site if it is in multiple NAICS.
@details
</p>
<p>MOST SITES LACK NAICS INFO IN FRS! NAICS is missing for about 80 percent of these facilities.
</p>
<p>frs here had about 2,571,750 unique REGISTRY_ID values, but
</p>
<p>frs_by_naics had only about 680,000 rows as of 4/1/2023,
</p>
<p>about 562,000 unique REGISTRY_ID values with
</p>
<p>about 2,900 unique NAICS codes.
</p>
<p>length(unique(frs_by_naics$REGISTRY_ID))
</p>
<p><code>length(unique(frs_by_naics[,REGISTRY_ID]))</code>
</p>
<p><code>length(frs_by_naics[, unique(REGISTRY_ID)])</code>
</p>
<p><code>frs_by_naics[,uniqueN(REGISTRY_ID)]</code>
</p>
<div class="sourceCode"><pre> 561,999  as of 3/26/23 but early 2023 had been 564,770


    lat       lon  REGISTRY_ID  NAICS
</pre></div>
<p>1: 34.04722 -81.15136 110000854246 325211
</p>
<p>2: 34.04722 -81.15136 110000854246 325220
</p>
<p>3: 34.04722 -81.15136 110000854246 325222
</p>


<h3>See Also</h3>

<p><a href="#frs">frs</a> <code><a href="#frs_from_naics">frs_from_naics()</a></code> <code><a href="#naics_categories">naics_categories()</a></code> <a href="#frs_by_programid">frs_by_programid</a> and see naics_from_any in EJAM pkg.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># NAICS is missing for about 80 percent of facilities</span>
 `frs<span class="token punctuation">[</span> NAICS <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">,</span> .N<span class="token punctuation">]</span> <span class="token operator">/</span> frs<span class="token punctuation">[</span><span class="token punctuation">,</span>.N<span class="token punctuation">]</span> `
 <span class="token comment"># only about 562k facilities have some NAICS info</span>
 `frs<span class="token punctuation">[</span> NAICS <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">,</span> .N<span class="token punctuation">]</span>`
 `frs_by_naics<span class="token punctuation">[</span><span class="token punctuation">,</span> uniqueN<span class="token punctuation">(</span>REGISTRY_ID<span class="token punctuation">)</span><span class="token punctuation">]</span>` <span class="token comment"># almost exactly matches the above</span>
 
 dim<span class="token punctuation">(</span>frs_by_naics<span class="token punctuation">)</span> 
 <span class="token comment"># about 680k rows here, or pairs of 1 NAICS - 1 registry ID pair,</span>
 <span class="token comment">#  since some IDs have 2 or more NAICS so appear as 2 or more rows here.</span>
 
 <span class="token comment"># About 2,900 different NAICS codes appear here:</span>
 `frs_by_naics<span class="token punctuation">[</span><span class="token punctuation">,</span>  uniqueN<span class="token punctuation">(</span>NAICS<span class="token punctuation">)</span><span class="token punctuation">]</span>`
 `frs_by_naics<span class="token punctuation">[</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>.N <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> by<span class="token operator">=</span>NAICS<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span>sum<span class="token punctuation">(</span>V1<span class="token punctuation">)</span><span class="token punctuation">]</span>`
   <span class="token comment">#  2,457 NAICS codes are used to describe more than one Registry ID</span>
  `frs_by_naics<span class="token punctuation">[</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>.N <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> by<span class="token operator">=</span>NAICS<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span>sum<span class="token punctuation">(</span>V1<span class="token punctuation">)</span><span class="token punctuation">]</span>`
   <span class="token comment"># [1] 425 NAICS codes appear only once, i.e., apply to only a single facility!</span>
   
 <span class="token comment"># Which 2-digit NAICS are found here most often?</span>
 `frs_by_naics<span class="token punctuation">[</span> <span class="token punctuation">,</span> .N<span class="token punctuation">,</span> keyby<span class="token operator">=</span>substr<span class="token punctuation">(</span>NAICS<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>`
 `frs_by_naics<span class="token punctuation">[</span> <span class="token punctuation">,</span> .N<span class="token punctuation">,</span>   by<span class="token operator">=</span>substr<span class="token punctuation">(</span>NAICS<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>` <span class="token comment"># Most common is 33</span>
 <span class="token comment"># Top 10 most common 3-digit NAICS here:</span>
 `x <span class="token operator">=</span> tail<span class="token punctuation">(</span>frs_by_naics<span class="token punctuation">[</span> <span class="token punctuation">,</span> .N<span class="token punctuation">,</span>   by<span class="token operator">=</span>.<span class="token punctuation">(</span>n3 <span class="token operator">=</span> substr<span class="token punctuation">(</span>NAICS<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>`
 `cbind<span class="token punctuation">(</span>x<span class="token punctuation">,</span> industry <span class="token operator">=</span> rownames<span class="token punctuation">(</span>naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>match<span class="token punctuation">(</span>x<span class="token operator">$</span>n3<span class="token punctuation">,</span> naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>`</code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_by_programid">

<a href="#frs_by_programid" class="help-page-title"><h2>frs_by_programid (DATA) data.table of Program System ID code(s) for each EPA-regulated site in
the Facility Registry Service</h2></a>

<h3>Description</h3>

<pre>
   This is the format with one row per site-programid pair, 
   so multiple rows for one site if it is in multiple programs.

 &gt; dim(frs_by_programid)
 [1] 3440451       5   as of 1/3/2023

nn=sample(1:nrow(frs_by_programid), 1); frs_by_programid[REGISTRY_ID == frs_by_programid$REGISTRY_ID[nn],]

             lat       lon  REGISTRY_ID  program         pgm_sys_id
     1: 40.21262 -100.6464 110040499724 AIRS/AFS         3114500040
     2: 40.21262 -100.6464 110040499724     NDEQ              87933
     3: 40.21262 -100.6464 110040499724      AIR NE0000003114500040
     
nn=sample(1:nrow(frs_by_programid), 1); frs_by_programid[REGISTRY_ID == frs_by_programid$REGISTRY_ID[nn],]

             lat       lon  REGISTRY_ID program   pgm_sys_id
     1: 47.00071 -120.5649 110037546493 WA-FSIS      1796553
     2: 47.00071 -120.5649 110037546493    ICIS   1800041945
     3: 47.00071 -120.5649 110037546493 WA-FSIS      7886103
  </pre>


<h3>See Also</h3>

<p>frs() frs_by_naics() Created by frs_make_programid_lookup()
</p>

<hr>
</div>
<div class="container manual-page" id="frs_by_sic">

<a href="#frs_by_sic" class="help-page-title"><h2>frs_by_sic (DATA) data.table of SIC code(s) for each EPA-regulated site in Facility Registry Service</h2></a>

<h3>Description</h3>

<p>This is the format with one row per site-SIC pair,
so multiple rows for one site if it is in multiple SIC.
</p>

<hr>
</div>
<div class="container manual-page" id="frs_clean">

<a href="#frs_clean" class="help-page-title"><h2>frs_clean - utility to clean Facility Registry Service dataset when updating it
This is just a helper function used to create the dataset saved as data for use in EJAM</h2></a>

<h3>Description</h3>

<p>frs_clean - utility to clean Facility Registry Service dataset when updating it
This is just a helper function used to create the dataset saved as data for use in EJAM
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_clean<span class="token punctuation">(</span>
  frs<span class="token punctuation">,</span>
  usefulcolumns <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"LATITUDE83"</span><span class="token punctuation">,</span> <span class="token string">"LONGITUDE83"</span><span class="token punctuation">,</span> <span class="token string">"REGISTRY_ID"</span><span class="token punctuation">,</span> <span class="token string">"PRIMARY_NAME"</span><span class="token punctuation">,</span>
    <span class="token string">"NAICS_CODES"</span><span class="token punctuation">,</span> <span class="token string">"SIC_CODES"</span><span class="token punctuation">,</span> <span class="token string">"PGM_SYS_ACRNMS"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frs</code></td>
<td>
<p>data.table that is the output of frs_read()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usefulcolumns</code></td>
<td>
<p>optional, drops all columns except those in this vector of character colnames</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Used by frs_get()
This renames some columns (lat, lon, NAICS are new names)
and it drops rows lacking lat/lon location info in the LATITUDE83 or LONGITUDE83 columns
</p>

<hr>
</div>
<div class="container manual-page" id="frs_from_naics">

<a href="#frs_from_naics" class="help-page-title"><h2>frs_from_naics - Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>frs_from_naics - Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_naics<span class="token punctuation">(</span>naics_code_or_name<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>naics_code_or_name</code></td>
<td>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>See Also</h3>

<p><code><a href="#siteid_from_naics">siteid_from_naics()</a></code> <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_naics<span class="token punctuation">(</span><span class="token string">"uranium"</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>frs_from_naics<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"nuclear"</span><span class="token punctuation">)</span><span class="token operator">$</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  naics_from_name<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span><span class="token number">212222</span> <span class="token punctuation">)</span>
  frs_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span>
  siteid_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_program">

<a href="#frs_from_program" class="help-page-title"><h2>frs_from_program - Use EPA Program acronym like TRIS to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Get data.table based on given FRS Program System CATEGORY.
Find all FRS sites in a program like RCRAINFO, TRIS, or others.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_program<span class="token punctuation">(</span>program<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>program</code></td>
<td>
<p>vector of one or more EPA Program names used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>

<hr>
</div>
<div class="container manual-page" id="frs_from_programid">

<a href="#frs_from_programid" class="help-page-title"><h2>frs_from_programid - Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>frs_from_programid - Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_programid<span class="token punctuation">(</span>programid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Program ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x<span class="token operator">=</span>frs_from_programid<span class="token punctuation">(</span>testids_program_sys_id<span class="token punctuation">)</span>
  x
  mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_regid">

<a href="#frs_from_regid" class="help-page-title"><h2>frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_regid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Registry ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>testids_registry_id<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_sic">

<a href="#frs_from_sic" class="help-page-title"><h2>frs_from_sic - Use SIC code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>frs_from_sic - Use SIC code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_sic<span class="token punctuation">(</span>sic_code_or_name<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>naics_code_or_name</code></td>
<td>
</td>
</tr>
</table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "SIC" "PGM_SYS_ACRNMS"
</p>


<h3>See Also</h3>

<p><code><a href="#siteid_from_sic">siteid_from_sic()</a></code> <code><a href="#sic_from_any">sic_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_sic<span class="token punctuation">(</span><span class="token string">"glass"</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>frs_from_sic<span class="token punctuation">(</span>sic_from_any<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span><span class="token operator">$</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
  sic_from_any<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  sic_from_name<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  sic_from_any<span class="token punctuation">(</span><span class="token string">'0780'</span><span class="token punctuation">)</span>
  frs_from_sic<span class="token punctuation">(</span><span class="token string">'0780'</span><span class="token punctuation">)</span>
  siteid_from_sic<span class="token punctuation">(</span><span class="token string">'0780'</span><span class="token punctuation">)</span>
  latlon_from_sic<span class="token punctuation">(</span><span class="token string">'0780'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_siteid">

<a href="#frs_from_siteid" class="help-page-title"><h2>frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>frs_from_siteid - Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Registry ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>testids_registry_id<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_sitename">

<a href="#frs_from_sitename" class="help-page-title"><h2>frs_from_sitename - Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text</h2></a>

<h3>Description</h3>

<p>frs_from_sitename - Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_sitename<span class="token punctuation">(</span>sitenames<span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitenames</code></td>
<td>
<p>one or more strings in a vector, which can be regular expressions or query for exact match using fixed=TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>logical, search is not case sensitive by default (unlike <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code> default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code>, if set to TRUE it looks for only exact matches</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>relevant rows of the data.table called frs, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token comment"># very slow</span>
 x<span class="token operator">=</span>frs_from_sitename
 nrow<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 head<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_is_valid">

<a href="#frs_is_valid" class="help-page-title"><h2>frs_is_valid - Validate FRS Registry ID list uploads</h2></a>

<h3>Description</h3>

<p>Check for proper FRS facility id in uploaded data
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_is_valid<span class="token punctuation">(</span>frs_upload<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>frs_upload</code></td>
<td>
<p>upload frs registry IDs table converted to data frame</p>
</td>
</tr></table>
<h3>Value</h3>

<p>boolean value (valid or not valid)
</p>

<hr>
</div>
<div class="container manual-page" id="frsprogramcodes">

<a href="#frsprogramcodes" class="help-page-title"><h2>frsprogramcodes DATA EPA programs listed in Facility Registry Service</h2></a>

<h3>Description</h3>

<div class="sourceCode"><pre>data.frame

                                                              description     code
                                                              
1    National Pollutant Discharge Elimination System (NPDES) (ICIS-NPDES)    NPDES

2  The Integrated Compliance Information System (ICIS) for Air (ICIS-Air)      AIR

3    The Resource Conservation and Recovery Act (RCRA) Information System RCRAINFO

4                                   Risk Management Plan (RMP) facilities      RMP

5                      The Safe Drinking Water Information System (SDWIS)     SFDW

6                              The Superfund Enterprise Management System     SEMS

7                              Clean Air Markets Division Business System   CAMDBS

8                                        Toxics Release Inventory Program     TRIS

9                                        Greenhouse Gas Reporting Program   E-GGRT

10                                             Emissions Inventory System      EIS

11                                           Toxic Substances Control Act     TSCA
</pre></div>


<h3>See Also</h3>

<p><a href="#frs">frs</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  frs_by_programid<span class="token punctuation">[</span>program <span class="token percent-operator operator">%in%</span> frsprogramcodes<span class="token operator">$</span>code<span class="token punctuation">,</span> .N<span class="token punctuation">,</span> by<span class="token operator">=</span>program<span class="token punctuation">]</span>
  
  setkey<span class="token punctuation">(</span>frs_by_programid<span class="token punctuation">,</span><span class="token string">"program"</span><span class="token punctuation">)</span>
  frs_by_programid<span class="token punctuation">[</span><span class="token string">"TRIS"</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get_blockpoints_in_shape">

<a href="#get_blockpoints_in_shape" class="help-page-title"><h2>get_blockpoints_in_shape - find blocks that are in a polygon, using internal point of block - WORK IN PROGRESS ****</h2></a>

<h3>Description</h3>

<p>This is like getblocksnearby() but for a polygonal buffer area instead of
a circular buffer.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_blockpoints_in_shape<span class="token punctuation">(</span>
  polys<span class="token punctuation">,</span>
  addedbuffermiles <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  blocksnearby <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dissolved <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  safety_margin_ratio <span class="token operator">=</span> <span class="token number">1.1</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>polys</code></td>
<td>
<p>Spatial data as from sf::st_as_sf(), with a column called siteid, like
points as from <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code>,
or a table of points with lat,lon columns that will first be converted here using that function,
or polygons (not yet tested).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addedbuffermiles</code></td>
<td>
<p>width of optional buffering to add to the points (or edges), in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksnearby</code></td>
<td>
<p>optional table of blocks with blockid,siteid (from which lat,lon can be looked up in blockpoints dt)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dissolved</code></td>
<td>
<p>If TRUE, use sf::st_union(polys) to find unique blocks inside any one or more of polys</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>safety_margin_ratio</code></td>
<td>
<p>multiplied by addedbuffermiles, how far to search for
blocks nearby using getblocksnearby(), before using those found to do the intersection via sf::</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This uses getblocksnearby() to get a very fast rough/good estimate of
which US block points are nearby (with a safety margin - see param below),
before then using sf:: to carefully identify which of those candidate blocks are actually
inside each polygon (e.g., circle) according to sf:: methods.
</p>
<p>For circular buffers, just using getblocksnearby() should work and not need this function.
</p>
<p>For noncircular polygons, buffered or not, this function will provide a way to very quickly
filter down to which of the millions of US blocks should be examined by the sf:: join / intersect,
since otherwise it takes forever for sf:: to check all US blocks.
</p>


<h3>Value</h3>

<p>Block points table for those blocks whose internal point is inside the buffer
which is just a circular buffer of specified radius if polys are just points.
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <code><a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">=</span> get_shapefile_from_sitepoints<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># y = get_blockpoints_in_shape(x, 1)  # very very slow</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get_shape_buffered_from_shapefile_points">

<a href="#get_shape_buffered_from_shapefile_points" class="help-page-title"><h2>get_shape_buffered_from_shapefile_points - add buffer around shape (points, here)</h2></a>

<h3>Description</h3>

<p>get_shape_buffered_from_shapefile_points - add buffer around shape (points, here)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_shape_buffered_from_shapefile_points<span class="token punctuation">(</span>shapefile_points<span class="token punctuation">,</span> radius.miles<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>shapefile_points</code></td>
<td>
<p>spatial object like areas at high risk or areas with facilities to be analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius.miles</code></td>
<td>
<p>width of buffer to add to shapefile_points
(in case dist is a units object, it should be
convertible to arc_degree if x has geographic coordinates,
and to st_crs(x)$units otherwise)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to st_buffer()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Just a wrapper for <code><a href="https://r-spatial.r-universe.dev/manual/sf.html#geos_unary">sf::st_buffer()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points</a>
</p>

<hr>
</div>
<div class="container manual-page" id="get_shapefile_from_sitepoints">

<a href="#get_shapefile_from_sitepoints" class="help-page-title"><h2>get_shapefile_from_sitepoints - convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points</h2></a>

<h3>Description</h3>

<p>get_shapefile_from_sitepoints - convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_shapefile_from_sitepoints<span class="token punctuation">(</span>sitepoints<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>a data.table or data.frame with columns called lat,lon</p>
</td>
</tr></table>
<h3>Value</h3>

<p>A shapefile via <code><a href="https://r-spatial.r-universe.dev/manual/sf.html#st_as_sf">sf::st_as_sf()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <code><a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocks_diagnostics">

<a href="#getblocks_diagnostics" class="help-page-title"><h2>getblocks_diagnostics - Get summary stats on counts of blocks (unique vs doublecounted) near sites</h2></a>

<h3>Description</h3>

<p>getblocks_diagnostics - Get summary stats on counts of blocks (unique vs doublecounted) near sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_diagnostics<span class="token punctuation">(</span>x<span class="token punctuation">,</span> detailed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> see_plot <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like testoutput_getblocksnearby_10pts_1miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detailed</code></td>
<td>
<p>if TRUE, also shows in console a long table of frequencies via <code><a href="#getblocks_summarize_blocks_per_site">getblocks_summarize_blocks_per_site()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>see_plot</code></td>
<td>
<p>set TRUE to draw for each site a boxplot of distances of nearby blocks</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of stats
</p>


<h3>See Also</h3>

<p>This relies on  <code><a href="#getblocks_summarize_blocks_per_site">getblocks_summarize_blocks_per_site()</a></code> and <code><a href="#getblocks_summarize_sites_per_block">getblocks_summarize_sites_per_block()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">getblocks_diagnostics<span class="token punctuation">(</span>testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocks_summarize_blocks_per_site">

<a href="#getblocks_summarize_blocks_per_site" class="help-page-title"><h2>getblocks_summarize_blocks_per_site - Get summary stats on counts of blocks near various sites</h2></a>

<h3>Description</h3>

<p>Tells you # of blocks near avg site,
how many sites have only 1 block nearby, or have &lt;30 nearby, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_summarize_blocks_per_site<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"siteid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of getblocksnearby()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>


<h3>See Also</h3>

<p><code><a href="#getblocks_diagnostics">getblocks_diagnostics()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocks_summarize_sites_per_block">

<a href="#getblocks_summarize_sites_per_block" class="help-page-title"><h2>getblocks_summarize_sites_per_block - Get summary stats on how many sites are near various blocks (residents)</h2></a>

<h3>Description</h3>

<p>getblocks_summarize_sites_per_block - Get summary stats on how many sites are near various blocks (residents)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_summarize_sites_per_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"blockid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like testoutput_getblocksnearby_10pts_1miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>


<h3>See Also</h3>

<p><code><a href="#getblocks_diagnostics">getblocks_diagnostics()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby">

<a href="#getblocksnearby" class="help-page-title"><h2>getblocksnearby - Fast way to find nearby points - finds distance to each Census block centroid nearby</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius,
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified radius distance and finds the distance to
every block within the circle defined by the radius.
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  quadtree<span class="token punctuation">,</span>
  quiet <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  parallel <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles, defining circular buffer around a site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical If TRUE, then where not even 1 BLOCK internal point is within radius of a SITE,
it keeps looking past radius, up to maxradius, to find nearest 1 BLOCK.
What EJScreen does in that case is report NA, right? So,
does EJAM really need to report stats on residents presumed to be within radius,
if no block centroid is within radius?
Best estimate might be to report indicators from nearest block centroid which is
probably almost always the one your site is sitting inside of,
but ideally would adjust total count to be a fraction of blockwt based on
what is area of circular buffer as fraction of area of block it is apparently inside of.
Setting this to TRUE can produce unexpected results, which will not match EJScreen numbers.
</p>
<p>Note that if creating a proximity score, by contrast, you instead want to find nearest 1 SITE if none within radius of this BLOCK.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created using indexblocks() which uses the SearchTree package.
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is attached via the .onAttach() function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Optional. set to TRUE to avoid message about using getblock_diagnostics(),
which is relevant only if a user saved the output of this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <code><a href="#ejamit">ejamit()</a></code> for examples.
</p>
<p>getblocksnearby() is a wrapper redirecting to the right version, like <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
Census block "internal points" (defined by Census Bureau) are actually what it looks for,
and they are like centroids.
The blocks are pre-indexed for the whole USA, via the data object quadtree aka localtree
</p>


<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code>  <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby_from_fips">

<a href="#getblocksnearby_from_fips" class="help-page-title"><h2>getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided</h2></a>

<h3>Description</h3>

<p>getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby_from_fips<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> inshiny <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> need_blockwt <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of FIPS codes identifying blockgroups, tracts, counties, or states.
This is useful if  instead of gettings stats on and comparing circular buffers or polygons 
one will be getting stats on one or more tracts,
or analyzing and comparing blockgroups in a county,
or comparing whole counties to each other, within a State.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inshiny</code></td>
<td>
<p>used by shiny app server code to handle errors via validate() instead of stop()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>need_blockwt</code></td>
<td>
<p>set to FALSE to speed it up if you do not need blockwt</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>same as for <a href="#getblocksnearby">getblocksnearby</a> but one row per FIPS, and the distance column is irrelevant
</p>


<h3>See Also</h3>

<p><code><a href="#fipsbg_from_anyfips">fipsbg_from_anyfips()</a></code> <code><a href="#fips_lead_zero">fips_lead_zero()</a></code> <code><a href="#getblocksnearby_from_fips">getblocksnearby_from_fips()</a></code> <code><a href="#fips_from_table">fips_from_table()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> getblocksnearby_from_fips<span class="token punctuation">(</span>fips_counties_from_state_abbrev<span class="token punctuation">(</span><span class="token string">"DE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  counties_ej <span class="token operator">&lt;-</span> doaggregate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sites2states_or_latlon <span class="token operator">=</span> unique<span class="token punctuation">(</span>x<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>siteid<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>counties_ej<span class="token operator">$</span>results_bysite<span class="token punctuation">)</span>
  y <span class="token operator">=</span>  ejamit<span class="token punctuation">(</span>fips<span class="token operator">=</span>fips_counties_from_statename<span class="token punctuation">(</span><span class="token string">"Delaware"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  <span class="token comment"># x=getblocksnearby_from_fips("482011000011") # one blockgroup only</span>
  <span class="token comment"># y=doaggregate(x)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby_from_fips_OLD">

<a href="#getblocksnearby_from_fips_OLD" class="help-page-title"><h2>getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided</h2></a>

<h3>Description</h3>

<p>getblocksnearby_from_fips
Actually finds all blocks within each of the FIPS codes provided
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby_from_fips_OLD<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> need_blockwt <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of FIPS codes identifying blockgroups, tracts, counties, or states.
This is useful if  instead of gettings stats on and comparing circular buffers or polygons 
one will be getting stats on one or more tracts,
or analyzing and comparing blockgroups in a county,
or comparing whole counties to each other, within a State.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>need_blockwt</code></td>
<td>
<p>set to FALSE to speed it up if you do not need blockwt</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>same as for <a href="#getblocksnearby">getblocksnearby</a> but one row per FIPS, and the distance column is irrelevant
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> getblocksnearby_from_fips<span class="token punctuation">(</span>fips_counties_from_state_abbrev<span class="token punctuation">(</span><span class="token string">"DE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  counties_ej <span class="token operator">&lt;-</span> doaggregate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sites2states_or_latlon <span class="token operator">=</span> unique<span class="token punctuation">(</span>x<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>siteid<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>counties_ej<span class="token operator">$</span>results_bysite<span class="token punctuation">)</span>
  y <span class="token operator">=</span>  ejamit<span class="token punctuation">(</span>fips<span class="token operator">=</span>fips_counties_from_statename<span class="token punctuation">(</span><span class="token string">"Delaware"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  <span class="token comment"># x=getblocksnearby_from_fips("482011000011") # one blockgroup only</span>
  <span class="token comment"># y=doaggregate(x)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby2">

<a href="#getblocksnearby2" class="help-page-title"><h2>getblocksnearby2 - Key buffering function - wrapper redirecting to the right version of getblocksnearby()
DRAFT / WAS WORK IN PROGRESS</h2></a>

<h3>Description</h3>

<p>getblocksnearby2 - Key buffering function - wrapper redirecting to the right version of getblocksnearby()
DRAFT / WAS WORK IN PROGRESS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  quadtree <span class="token operator">=</span> is.null<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>a large quadtree object created from the SearchTree package example:
SearchTrees::createTree( quaddata, treeType = "quad", dataType = "point")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#ejamit">ejamit()</a></code>
</p>
<p>Like getblocksnearby() but tries to handle localtree and quadtree parameter differently
</p>

<ul><li>
<p> not sure how to check if they are in the right environment.
</p>
</li></ul>
<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree">

<a href="#getblocksnearbyviaQuadTree" class="help-page-title"><h2>getblocksnearbyviaQuadTree - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius in miles,
this function quickly finds all the US Census blocks near each point.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quiet <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles, defining circular buffer around a site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical If TRUE, then where not even 1 BLOCK internal point is within radius of a SITE,
it keeps looking past radius, up to maxradius, to find nearest 1 BLOCK.
What EJScreen does in that case is report NA, right? So,
does EJAM really need to report stats on residents presumed to be within radius,
if no block centroid is within radius?
Best estimate might be to report indicators from nearest block centroid which is
probably almost always the one your site is sitting inside of,
but ideally would adjust total count to be a fraction of blockwt based on
what is area of circular buffer as fraction of area of block it is apparently inside of.
Setting this to TRUE can produce unexpected results, which will not match EJScreen numbers.
</p>
<p>Note that if creating a proximity score, by contrast, you instead want to find nearest 1 SITE if none within radius of this BLOCK.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Optional. set to TRUE to avoid message about using getblock_diagnostics(),
which is relevant only if a user saved the output of this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created using indexblocks() which uses the SearchTree package.
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is attached via the .onAttach() function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For each point, it uses the specified search radius and finds the distance to
every block within the circle defined by the radius.
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Results are the sites2blocks table that would be used by doaggregate(),
with distance in miles as one output column of data.table.
Adjusts distance to avg resident in block when it is very small relative to block size,
the same way EJScreen adjusts distances in creating proximity scores.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code> <code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># indexblocks() # if localtree not available yet, quadtree = localtree</span>
  x <span class="token operator">=</span> getblocksnearby<span class="token punctuation">(</span>testpoints_1000<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree_Clustered">

<a href="#getblocksnearbyviaQuadTree_Clustered" class="help-page-title"><h2>getblocksnearbyviaQuadTree_Clustered - find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Uses packages parallel and snow. <a href="https://r-universe.dev/manuals/parallel.html#makeCluster">parallel::makePSOCKcluster</a> is an enhanced version of <a href="https://ltierney.r-universe.dev/manual/snow.html#snow-startstop">snow::makeSOCKcluster</a> in package snow.
It runs Rscript on the specified host(s) to set up a worker process which listens on a socket for expressions to evaluate, and returns the results (as serialized objects).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree_Clustered<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius<span class="token punctuation">,</span>
  maxradius<span class="token punctuation">,</span>
  avoidorphans<span class="token punctuation">,</span>
  CountCPU <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns LAT, LONG</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CountCPU</code></td>
<td>
<p>for parallel processing via makeCluster() and <code><a href="https://beccadaniel.r-universe.dev/manual/doSNOW.html#registerDoSNOW">doSNOW::registerDoSNOW()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>index of all US blocks like localtree</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>
<p>Uses indexgridsize and quaddata  variables that come from global environment (but should pass to this function rather than assume in global env?)
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree2">

<a href="#getblocksnearbyviaQuadTree2" class="help-page-title"><h2>getblocksnearbyviaQuadTree2 - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING - DRAFT / WORK IN PROGRESS</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius in miles,
this function quickly finds all the US Census blocks near each point.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quiet <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles, defining circular buffer around a site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical If TRUE, then where not even 1 BLOCK internal point is within radius of a SITE,
it keeps looking past radius, up to maxradius, to find nearest 1 BLOCK.
What EJScreen does in that case is report NA, right? So,
does EJAM really need to report stats on residents presumed to be within radius,
if no block centroid is within radius?
Best estimate might be to report indicators from nearest block centroid which is
probably almost always the one your site is sitting inside of,
but ideally would adjust total count to be a fraction of blockwt based on
what is area of circular buffer as fraction of area of block it is apparently inside of.
Setting this to TRUE can produce unexpected results, which will not match EJScreen numbers.
</p>
<p>Note that if creating a proximity score, by contrast, you instead want to find nearest 1 SITE if none within radius of this BLOCK.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Optional. set to TRUE to avoid message about using getblock_diagnostics(),
which is relevant only if a user saved the output of this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created using indexblocks() which uses the SearchTree package.
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is attached via the .onAttach() function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This should be almost identical to getblocksnearbyviaQuadTree(), but it uses f2, a copy of sitepoints, and more importantly pulls some code out of the for loop and uses a vectorized approach.
For each point, it uses the specified search radius and finds the distance to
every block within the circle defined by the radius.
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Results are the sites2blocks table that would be used by doaggregate(),
with distance in miles as one output column of data.table.
Adjusts distance to avg resident in block when it is very small relative to block size,
the same way EJScreen adjusts distances in creating proximity scores.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code> <code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># indexblocks() # if localtree not available yet, quadtree = localtree</span>
  x <span class="token operator">=</span> getblocksnearby2<span class="token punctuation">(</span>testpoints_1000<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree3">

<a href="#getblocksnearbyviaQuadTree3" class="help-page-title"><h2>getblocksnearbyviaQuadTree3 - Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING
DRAFT / WAS WORK IN PROGRESS</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius (in miles),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified search radius and finds the distance to
every block within the circle defined by the radius.
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree3<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxradius <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxradius</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within radius,
so if TRUE, it keeps looking past radius to find nearest one within maxradius.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree( quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It is automatically created when the package is attached via the .onAttach() function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code> <code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="high_pctiles_tied_with_min">

<a href="#high_pctiles_tied_with_min" class="help-page-title"><h2>high_pctiles_tied_with_min (DATA) internal data used to handle cases where multiple places are tied for the lowest indicator score</h2></a>

<h3>Description</h3>

<p>high_pctiles_tied_with_min (DATA) internal data used to handle cases where multiple places are tied for the lowest indicator score
</p>

<hr>
</div>
<div class="container manual-page" id="indexblocks">

<a href="#indexblocks" class="help-page-title"><h2>indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment</h2></a>

<h3>Description</h3>

<p>indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">indexblocks<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>


<h3>Details</h3>

<p>Note this is duplicated code in .onAttach() and also in global.R
</p>
<p>.onAttach() can be edited to create this when the package loads,
but then it takes time each time a developer rebuilds/installs the package or others that load EJAM.
</p>
<p>It also has to happen in global.R if it has not already.
</p>


<h3>Value</h3>

<p>Returns TRUE when done. Side effect is it creates the index in memory.
</p>

<hr>
</div>
<div class="container manual-page" id="input_names_listing">

<a href="#input_names_listing" class="help-page-title"><h2>input_names_listing
Utility checking values of input$ that appear in this code
See appsilon pkg shiny.info now</h2></a>

<h3>Description</h3>

<p>input_names_listing
Utility checking values of input$ that appear in this code
See appsilon pkg shiny.info now
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">input_names_listing<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"./R/app_server.R"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>path to source file to search in</p>
</td>
</tr></table>
<h3>Value</h3>

<p>character vector of ids of inputs like x,y,z if it found input$x input$y input$z
</p>

<hr>
</div>
<div class="container manual-page" id="islandareas">

<a href="#islandareas" class="help-page-title"><h2>islandareas (DATA) table, bounds info on lat lon of US Island Areas</h2></a>

<h3>Description</h3>

<p>data.frame of info on approximate lat lon bounding boxes around
American Samoa, Guam, the
Commonwealth of the Northern Mariana Islands (Northern Mariana Islands),
and the United States Virgin Islands.
</p>
<p>See also <a href="#stateinfo">stateinfo</a> and []
</p>
<p>See <a href="http://www.census.gov/geo/reference/gtc/gtc_island.html" target="_blank">http://www.census.gov/geo/reference/gtc/gtc_island.html</a>
</p>
<p>See datacreate_islandareas.R or data-raw/islandareas.xlsx
</p>
<p>Note the US minor outlying islands are not in that list and are widely dispersed.
They include Midway Islands, etc.
</p>

<hr>
</div>
<div class="container manual-page" id="lat_alias">

<a href="#lat_alias" class="help-page-title"><h2>lat_alias, lon_alias (DATA) Synonyms for lat and lon</h2></a>

<h3>Description</h3>

<p>lists of synonyms for "latitude" and "longitude" used when guessing which column is what in user-provided tables of coordinates
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_as.numeric">

<a href="#latlon_as.numeric" class="help-page-title"><h2>latlon_as.numeric - Strip non-numeric characters from a vector</h2></a>

<h3>Description</h3>

<p>Remove all characters other than minus signs, decimal points, and numeric digits
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of something that is supposed to be numbers like latitude or longitude
and may be a character vector because there were some other characters like tab or space or percent sign or dollar sign</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Useful if latitude or longitude vector has spaces, tabs, etc.
CAUTION - Assumes stripping those out and making it numeric will fix whatever problem there was
and end result is a valid set of numbers. Inf etc. are turned into NA values.
Empty zero length string is turned into NA without warning. NA is left as NA.
If anything other than empty or NA could not be interpreted as a number, it
returns NA for those and offers a warning.
</p>


<h3>Value</h3>

<p>numeric vector same length as x
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"-97.179167000000007"</span><span class="token punctuation">,</span> <span class="token string">" -94.0533"</span><span class="token punctuation">,</span> <span class="token string">"-95.152083000000005"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'asdf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'aword'</span><span class="token punctuation">,</span> <span class="token string">'$b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'-10.5%'</span><span class="token punctuation">,</span> <span class="token string">'&lt;5'</span><span class="token punctuation">,</span> <span class="token string">'$100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">Inf</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_df_clean">

<a href="#latlon_df_clean" class="help-page-title"><h2>latlon_df_clean - Find and clean up latitude and longitude columns in a data.frame</h2></a>

<h3>Description</h3>

<p>Utility to identify lat and lon columns, renaming and cleaning them up.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_df_clean<span class="token punctuation">(</span>df<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>data.frame With columns lat and lon or names that can be interpreted as such</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Tries to figure out which columns seem to have lat lon values, renames those in the data.frame.
Cleans up lat and lon values (removes extra characters, makes numeric)
</p>


<h3>Value</h3>

<p>Returns the same data.frame but with relevant colnames changed to lat and lon,
and invalid lat or lon values cleaned up if possible or else replaced with NA
</p>


<h3>See Also</h3>

<p>Used by <code><a href="#latlon_from_anything">latlon_from_anything()</a></code>. Uses <code><a href="#latlon_infer">latlon_infer()</a></code> <code><a href="#latlon_is.valid">latlon_is.valid()</a></code> <code><a href="#latlon_as.numeric">latlon_as.numeric()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#  x &lt;- latlon_df_clean(x)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_anything">

<a href="#latlon_from_anything" class="help-page-title"><h2>latlon_from_anything - Flexibly get lat/lon from file, data.frame, data.table, or lat/lon vectors</h2></a>

<h3>Description</h3>

<p>Try to figure out if user provided latitude / longitude as vectors, data.frame, file, or interactively pick file.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_anything<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>If missing and interactive mode in RStudio, prompts user for file. Otherwise,
this can be a filename (csv or xlsx, with path), or data.frame/ data.table/ matrix,
or vector of longitudes (in which case y must be the latitudes).
Note that even though it is called latlon_etc the
lon is x and comes before the lat among parameters x,y (unlike in most other functions here using lat,lon)
File or data.frame/data.table/matrix must have columns called lat and lon, or names that can
be inferred to be that by latlon_infer()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>If x is a vector of longitudes, y must be the latitudes. Ignored otherwise.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function
</p>
<p>relies on
</p>
<p>read_csv_or_xl()  and
</p>
<p><code><a href="#latlon_df_clean">latlon_df_clean()</a></code> which in turn uses <code><a href="#latlon_infer">latlon_infer()</a></code> <code><a href="#latlon_as.numeric">latlon_as.numeric()</a></code> <code><a href="#latlon_is.valid">latlon_is.valid()</a></code>
</p>
<p>read_and_clean_points() from EJAMejscreenapi
</p>
<p>would be the most general / flexible broadest way to get points, but is still work in progress
</p>
<p>is similar to what is done by latlon_from_anything()
</p>
<p>except it also uses these functions:
</p>
<p><code><a href="#latlon_from_siteid">latlon_from_siteid()</a></code>
</p>
<p><code><a href="#latlon_from_programid">latlon_from_programid()</a></code>   but not  _from_naics() ?
</p>


<h3>Value</h3>

<p>A data.frame that has at least columns lon and lat (and others if they were in x)
</p>


<h3>See Also</h3>

<p>read_csv_or_xl() latlon_df_clean()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token keyword">if</span> <span class="token punctuation">(</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 pts <span class="token operator">&lt;-</span> latlon_from_anything<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 latlon_from_anything<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">,</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>x<span class="token operator">=</span>testpoints_100<span class="token operator">$</span>lon<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>testpoints_100<span class="token operator">$</span>lat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_mactsubpart">

<a href="#latlon_from_mactsubpart" class="help-page-title"><h2>latlon_from_mactsubpart
Get point locations for US EPA-regulated facilities that have
sources subject to Maximum Achievable Control Technology (MACT) standards
under the Clean Air Act.</h2></a>

<h3>Description</h3>

<p>latlon_from_mactsubpart
Get point locations for US EPA-regulated facilities that have
sources subject to Maximum Achievable Control Technology (MACT) standards
under the Clean Air Act.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_mactsubpart<span class="token punctuation">(</span>subpart<span class="token punctuation">,</span> include_if_no_latlon <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>subpart</code></td>
<td>
<p>vector of one or more strings indicating the
Subpart of CFR Title 40 Part 63 that covers the source category
of interest, such as "FFFF" - see for example,
<a href="https://www.ecfr.gov/current/title-40/part-63/subpart-FFFF" target="_blank">https://www.ecfr.gov/current/title-40/part-63/subpart-FFFF</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_if_no_latlon</code></td>
<td>
<p>logical - many in the database lack lat lon values but have a MACT code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <a href="https://www.epa.gov/stationary-sources-air-pollution/national-emission-standards-hazardous-air-pollutants-neshap-8" target="_blank">https://www.epa.gov/stationary-sources-air-pollution/national-emission-standards-hazardous-air-pollutants-neshap-8</a>
</p>


<h3>Value</h3>

<p>a table of lat, lon, subpart, etc. for US EPA FRS sites with that MACT code
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_from_naics">

<a href="#latlon_from_naics" class="help-page-title"><h2>latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</h2></a>

<h3>Description</h3>

<p>latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_naics<span class="token punctuation">(</span>naics<span class="token punctuation">,</span> id_only <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>a vector of naics codes, or
a data.table with column named code, as with output of <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr></table>
<h3>Details</h3>

<p>NOTE: many FRS sites lack NAICS code!
</p>
<p>Also, this function does not find the sites
identified by FRS data as being in a child NAICS (subcategory of your exact query)!
</p>
<p>Relies on  frs_by_naics (a data.table)
</p>
<p>See info about NAICS industry codes at <a href="https://www.naics.com/search" target="_blank">https://www.naics.com/search</a>
</p>


<h3>Value</h3>

<p>A data.table (not just data.frame) with columns called
lat, lon, REGISTRY_ID, NAICS (but see the id_only parameter)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">siteid_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  head<span class="token punctuation">(</span>latlon_from_naics<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3366</span><span class="token punctuation">,</span> <span class="token number">33661</span><span class="token punctuation">,</span> <span class="token number">336611</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id_only<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># mapfast(frs_from_naics(336611)) # simple map</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_program">

<a href="#latlon_from_program" class="help-page-title"><h2>latlon_from_program - Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others</h2></a>

<h3>Description</h3>

<p>latlon_from_program - Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_program<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>program</code></td>
<td>
<p>like "RMP", "RCRAINFO", "TRIS", "RMP", or others.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For info on FRS program codes in general, see <a href="https://www.epa.gov/frs/frs-program-crosswalks" target="_blank">https://www.epa.gov/frs/frs-program-crosswalks</a>
</p>
<p>Also see information at <a href="https://echo.epa.gov/tools/data-downloads/frs-download-summary" target="_blank">https://echo.epa.gov/tools/data-downloads/frs-download-summary</a>
about the file FRS_PROGRAM_LINKS.csv
</p>
<p>For info on program codes ECHO uses, see <a href="https://echo.epa.gov/resources/echo-data/about-the-data" target="_blank">https://echo.epa.gov/resources/echo-data/about-the-data</a>
</p>
<p>including <a href="https://www.epa.gov/frs/frs-environmental-interest-types" target="_blank">https://www.epa.gov/frs/frs-environmental-interest-types</a>
</p>
<p>For a list of program acronyms, <a href="https://www.epa.gov/frs/frs-rest-services#appendixa" target="_blank">https://www.epa.gov/frs/frs-rest-services#appendixa</a>
</p>
<p>The acronym is the abbreviated name that represents the name of an
information management system for an environmental program.
The Federal ones with at least 100k facilities each are
</p>
<p>RCRAINFO (over 500k sites), NPDES, ICIS, AIR, FIS, EIS, and AIRS/AFS.
</p>


<h3>Value</h3>

<p>data.table with lat  lon  REGISTRY_ID  program  but not pgm_sys_id
since there could be duplicates where same REGISTRY_ID has 2 different pgm_sys_id values
in the same program, so results were sometimes longer than if using <code><a href="#frs_from_program">frs_from_program()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 x <span class="token operator">=</span> latlon_from_program<span class="token punctuation">(</span><span class="token string">"CAMDBS"</span><span class="token punctuation">)</span>
 EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 program <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"EIS"</span><span class="token punctuation">,</span> <span class="token string">"UST"</span><span class="token punctuation">)</span>
 x <span class="token operator">=</span> latlon_from_program<span class="token punctuation">(</span>program<span class="token punctuation">)</span>
 <span class="token comment"># to get the facility name as well:</span>
 x <span class="token operator">=</span> frs<span class="token punctuation">[</span>grepl<span class="token punctuation">(</span><span class="token string">"RCRAINFO"</span><span class="token punctuation">,</span> PGM_SYS_ACRNMS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token comment"># fast</span>
 <span class="token comment">## x = latlon_from_siteid(latlon_from_program(program)[,REGISTRY_ID])  # slower!</span>
 EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">[</span>sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_programid">

<a href="#latlon_from_programid" class="help-page-title"><h2>latlon_from_programid - Get lat lon, Registry ID, and NAICS, for given FRS Program System ID</h2></a>

<h3>Description</h3>

<p>latlon_from_programid - Get lat lon, Registry ID, and NAICS, for given FRS Program System ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_programid<span class="token punctuation">(</span>programid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>programid</code></td>
<td>
<p>like "XJW000012435"</p>
</td>
</tr></table>
<h3>Details</h3>

<p>The ID is the identification number, such as the permit number,
assigned by an information management system that represents a
facility site, waste site, operable unit, or other feature tracked by that
Environmental Information System.
</p>
<p>Also note the FRS API:
<a href="https://www.epa.gov/frs/facility-registry-service-frs-api" target="_blank">https://www.epa.gov/frs/facility-registry-service-frs-api</a>
<a href="https://www.epa.gov/frs/frs-rest-services" target="_blank">https://www.epa.gov/frs/frs-rest-services</a>
</p>


<h3>Value</h3>

<p>data.table with lat  lon  REGISTRY_ID  program   pgm_sys_id
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_programid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"XJW000012435"</span><span class="token punctuation">,</span> <span class="token string">"00768SRTRSROAD1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 pids <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"7-0540-00003"</span><span class="token punctuation">,</span> <span class="token string">"354362"</span><span class="token punctuation">,</span> <span class="token string">"1513529"</span><span class="token punctuation">,</span> <span class="token string">"485659"</span><span class="token punctuation">,</span> <span class="token string">"LAG750956"</span><span class="token punctuation">,</span> 
   <span class="token string">"CAC002995519"</span><span class="token punctuation">,</span> <span class="token string">"3601252181"</span><span class="token punctuation">,</span> <span class="token string">"3601439158"</span><span class="token punctuation">)</span>
 latlon_from_siteid<span class="token punctuation">(</span>latlon_from_programid<span class="token punctuation">(</span>pids<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>REGISTRY_ID<span class="token punctuation">]</span><span class="token punctuation">)</span>
 latlon_from_programid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"XJW000012435"</span><span class="token punctuation">,</span> <span class="token string">"00768SRTRSROAD1"</span><span class="token punctuation">,</span> <span class="token string">"asdfsdf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>lat<span class="token punctuation">,</span>lon<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_regid">

<a href="#latlon_from_regid" class="help-page-title"><h2>latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID</h2></a>

<h3>Description</h3>

<p>latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_regid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>Facility Registry Service ID like 110010052520</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns
lat,lon,REGISTRY_ID,PRIMARY_NAME,NAICS,PGM_SYS_ACRNMS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span><span class="token number">110070874073</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> latlon_from_siteid<span class="token punctuation">(</span>
    c<span class="token punctuation">(</span><span class="token number">110071293460</span><span class="token punctuation">,</span> <span class="token number">110070874073</span><span class="token punctuation">,</span> <span class="token number">110070538057</span><span class="token punctuation">,</span> <span class="token number">110044340807</span><span class="token punctuation">,</span>
       <span class="token number">110030509215</span><span class="token punctuation">,</span> <span class="token number">110019033810</span><span class="token punctuation">,</span> <span class="token number">110056111559</span><span class="token punctuation">,</span> <span class="token number">110056982323</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_sic">

<a href="#latlon_from_sic" class="help-page-title"><h2>latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)</h2></a>

<h3>Description</h3>

<p>latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_sic<span class="token punctuation">(</span>sic<span class="token punctuation">,</span> id_only <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sic</code></td>
<td>
<p>a vector of SIC codes, or
a data.table with column named code, as with output of <code><a href="#sic_from_any">sic_from_any()</a></code></p>
</td>
</tr></table>
<h3>Details</h3>

<p>NOTE: many FRS sites lack SIC code!
</p>
<p>Also, this function does not find the sites
identified by FRS data as being in a child SIC (subcategory of your exact query)!
</p>
<p>Relies on  frs_by_sic (a data.table)
</p>
<p>See info about SIC industry codes at <a href="https://www.naics.com/search" target="_blank">https://www.naics.com/search</a>
</p>


<h3>Value</h3>

<p>A data.table (not just data.frame) with columns called
lat, lon, REGISTRY_ID, SIC (but see the id_only parameter)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">siteid_from_sic<span class="token punctuation">(</span><span class="token string">'7300'</span><span class="token punctuation">)</span>
  latlon_from_sic<span class="token punctuation">(</span><span class="token string">'7300'</span><span class="token punctuation">)</span>
  latlon_from_sic<span class="token punctuation">(</span>sic_from_any<span class="token punctuation">(</span><span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  head<span class="token punctuation">(</span>latlon_from_sic<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'6150'</span><span class="token punctuation">,</span> <span class="token string">'6300'</span><span class="token punctuation">,</span> <span class="token string">'5995'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id_only<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># mapfast(frs_from_sic('6150')) # simple map</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_siteid">

<a href="#latlon_from_siteid" class="help-page-title"><h2>latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID</h2></a>

<h3>Description</h3>

<p>latlon_from_siteid - Get lat lon (and NAICS) via Facility Registry ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>Facility Registry Service ID like 110010052520</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns
lat,lon,REGISTRY_ID,PRIMARY_NAME,NAICS,PGM_SYS_ACRNMS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span><span class="token number">110070874073</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> latlon_from_siteid<span class="token punctuation">(</span>
    c<span class="token punctuation">(</span><span class="token number">110071293460</span><span class="token punctuation">,</span> <span class="token number">110070874073</span><span class="token punctuation">,</span> <span class="token number">110070538057</span><span class="token punctuation">,</span> <span class="token number">110044340807</span><span class="token punctuation">,</span>
       <span class="token number">110030509215</span><span class="token punctuation">,</span> <span class="token number">110019033810</span><span class="token punctuation">,</span> <span class="token number">110056111559</span><span class="token punctuation">,</span> <span class="token number">110056982323</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_infer">

<a href="#latlon_infer" class="help-page-title"><h2>latlon_infer - guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</h2></a>

<h3>Description</h3>

<p>latlon_infer - guess which columns have lat and lon based on aliases like latitude, FacLat, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>mycolnames<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycolnames</code></td>
<td>
<p>e.g., colnames(x) where x is a data.frame from read.csv</p>
</td>
</tr></table>
<h3>Value</h3>

<p>returns all of mycolnames except replacing the best candidates with lat and lon
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'trilat'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># warns if no alias found, </span>
    <span class="token comment">#  but doesnt warn of dupes in other terms, just preferred term.</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'Longitude'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">,</span> <span class="token string">'Long'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'longing'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'LAT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of preferred are </span>
      <span class="token comment"># left alone only if lowercase one is found</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'long'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of a single alias are </span>
      <span class="token comment"># converted to preferred word (if pref not found), creating dupes!  warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes of an alias are renamed and still are dupes! warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'Lon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes left as dupes but warn!</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_is.available">

<a href="#latlon_is.available" class="help-page-title"><h2>latlon_is.available
check if not NA using !is.na()</h2></a>

<h3>Description</h3>

<p>latlon_is.available
check if not NA using !is.na()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.available<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p><code><a href="#latlon_is.usa">latlon_is.usa()</a></code> <code><a href="#latlon_is.islandareas">latlon_is.islandareas()</a></code> <code><a href="#latlon_is.available">latlon_is.available()</a></code> <code><a href="#latlon_is.possible">latlon_is.possible()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_is.islandareas">

<a href="#latlon_is.islandareas" class="help-page-title"><h2>latlon_is.islandareas
Check lat lon coordinates to see if each is approx. in general area of US Island Areas Guam, USVI, Amer Samoa or N Marianas
See <a href="#islandareas">islandareas</a>
</h2></a>

<h3>Description</h3>

<p>latlon_is.islandareas
Check lat lon coordinates to see if each is approx. in general area of US Island Areas Guam, USVI, Amer Samoa or N Marianas
See <a href="#islandareas">islandareas</a>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.islandareas<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of TRUE / FALSE values indicating a given lat lon pair
is approximately in one of the rough bounding boxes that includes the 4 Island Areas.
</p>


<h3>See Also</h3>

<p><code><a href="#latlon_is.usa">latlon_is.usa()</a></code> <code><a href="#latlon_is.islandareas">latlon_is.islandareas()</a></code> <code><a href="#latlon_is.available">latlon_is.available()</a></code> <code><a href="#latlon_is.possible">latlon_is.possible()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment"># this would require the testpoints_1000 data from the EJAM package:</span>
  isles <span class="token operator">&lt;-</span> which<span class="token punctuation">(</span>latlon_is.islandareas<span class="token punctuation">(</span>lat <span class="token operator">=</span> testpoints_1000<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span> testpoints_1000<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>testpoints_1000<span class="token punctuation">[</span>isles<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># c(213,785) </span>
  which<span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>latlon_is.usa<span class="token punctuation">(</span>lat <span class="token operator">=</span> testpoints_1000<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span> testpoints_1000<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_is.possible">

<a href="#latlon_is.possible" class="help-page-title"><h2>latlon_is.possible
check if between -180 and +180</h2></a>

<h3>Description</h3>

<p>latlon_is.possible
check if between -180 and +180
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.possible<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p><code><a href="#latlon_is.usa">latlon_is.usa()</a></code> <code><a href="#latlon_is.islandareas">latlon_is.islandareas()</a></code> <code><a href="#latlon_is.available">latlon_is.available()</a></code> <code><a href="#latlon_is.possible">latlon_is.possible()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_is.usa">

<a href="#latlon_is.usa" class="help-page-title"><h2>latlon_is.usa
Check lat lon coordinates to see if each is approx. in general area of USA excluding Island Areas</h2></a>

<h3>Description</h3>

<p>latlon_is.usa
Check lat lon coordinates to see if each is approx. in general area of USA excluding Island Areas
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.usa<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
Indicates the point is approximately in one of the
rough bounding boxes that includes the USA without
the Island Areas Guam, American Samoa, USVI, N Marianas Islands.
</p>


<h3>See Also</h3>

<p><code><a href="#latlon_is.usa">latlon_is.usa()</a></code> <code><a href="#latlon_is.islandareas">latlon_is.islandareas()</a></code> <code><a href="#latlon_is.available">latlon_is.available()</a></code> <code><a href="#latlon_is.possible">latlon_is.possible()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_is.valid">

<a href="#latlon_is.valid" class="help-page-title"><h2>latlon_is.valid - Validate latitudes and longitudes</h2></a>

<h3>Description</h3>

<p>Check each latitude and longitude value to see if they are valid.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.valid<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> quiet <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>optional logical, if TRUE, show list of bad values in console</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>NA or outside expected numeric ranges
</p>
<p>(based on approx ranges of lat lon seen among block internal points dataset)
</p>
<p>But note Guam, American Samoa, Northern Mariana Islands, and U.S. Virgin Islands are outside these ranges!
EJScreen 2.2 does not provide demographic data in those locations anyway, but can map sites there.
</p>
<p>lat must be between 17.5 and 71.5, and
</p>
<p>lon must be ( between -180 and -64) OR (between 172 and 180)
</p>


<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p><code><a href="#latlon_is.usa">latlon_is.usa()</a></code> <code><a href="#latlon_is.islandareas">latlon_is.islandareas()</a></code> <code><a href="#latlon_is.available">latlon_is.available()</a></code> <code><a href="#latlon_is.possible">latlon_is.possible()</a></code>
<code><a href="#latlon_df_clean">latlon_df_clean()</a></code> <code><a href="#latlon_infer">latlon_infer()</a></code> <code><a href="#latlon_is.valid">latlon_is.valid()</a></code> <code><a href="#latlon_as.numeric">latlon_as.numeric()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token comment"># this would only work using the EJAM package datasets frs and blockpoints:</span>
 table<span class="token punctuation">(</span>latlon_is.valid<span class="token punctuation">(</span>lat <span class="token operator">=</span>  frs<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span>  frs<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># blockpoints may need to be downloaded using dataload_from_aws()</span>
 table<span class="token punctuation">(</span>latlon_is.valid<span class="token punctuation">(</span>lat <span class="token operator">=</span>  blockpoints<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span>  blockpoints<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_join_on_blockid">

<a href="#latlon_join_on_blockid" class="help-page-title"><h2>latlon_join_on_blockid - get lat,lon of each block internal point via blockid
get expanded version of sites2blocks data.table, with new lat,lon columns</h2></a>

<h3>Description</h3>

<p>latlon_join_on_blockid - get lat,lon of each block internal point via blockid
get expanded version of sites2blocks data.table, with new lat,lon columns
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_join_on_blockid<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>s2b</code></td>
<td>
<p>like <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a>, output of <code><a href="#getblocksnearby">getblocksnearby()</a></code></p>
</td>
</tr></table>
<h3>Value</h3>

<p>returns the input data.table but with lat,lon columns added as block coordinates
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">s2b <span class="token operator">=</span> copy<span class="token punctuation">(</span>testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">)</span>
 latlon_join_on_blockid<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span> <span class="token comment"># done by trilaterate also</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="lookup_pctile">

<a href="#lookup_pctile" class="help-page-title"><h2>lookup_pctile (synonym for pctile_from_raw_lookup)</h2></a>

<h3>Description</h3>

<p>This is used with a lookup table to
convert a raw indicator vector to percentiles in US or States.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">lookup_pctile<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Details</h3>

<p>This could be recoded to be more efficient - could use data.table.
</p>
<p>The data.frame lookup table must have a field called "PCTILE" that has quantiles/percentiles
and other column(s) with values that fall at those percentiles.
<a href="#usastats">usastats</a> and <a href="#statestats">statestats</a> are such lookup tables.
This function accepts lookup table (or uses one called us if that is in memory), and
finds the number in the PCTILE column that corresponds to where a specified value
(in myvector) appears in the column called varname.in.lookup.table.
The function just looks for where the specified value fits between values in the lookup table
and returns the approximate percentile as found in the PCTILE column.
If the value is between the cutpoints listed as
percentiles 89 and 90, it returns 89, for example.
If the value is exactly equal to the cutpoint listed as percentile 90,
it returns percentile 90.
If the value is exactly the same as the minimum in the lookup table and multiple percentiles
in that lookup are listed as tied for having the same threshold value defining the percentile
(i.e., a large percent of places have the same score and it is the minimum score),
then the percentile gets reported as 0,
not the percent of places tied for that minimum score. Note this is true whether they are
tied at a value of 0 or are tied at some other minimum value than 0.
If the value is less than the cutpoint listed as percentile 0,
which should be the minimum value in the dataset,
it still returns 0 as the percentile, but with a warning that
the value checked was less than the minimum in the dataset.
</p>
<p>It also handles other odd cases, like where a large percent of all raw scores are tied at
the minimum value, in which case it reports 0 as percentile, not that large percent.
</p>


<h3>Value</h3>

<p>By default, returns numeric vector length of myvector.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  <span class="token comment"># compare ejscreen API output percentiles to those from this function:</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>vname <span class="token keyword">in</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     print<span class="token punctuation">(</span>pctile_from_raw_lookup<span class="token punctuation">(</span>testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>vname<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> vname<span class="token punctuation">,</span> 
       lookup <span class="token operator">=</span> usastats<span class="token punctuation">)</span> 
       <span class="token operator">-</span> testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>paste0<span class="token punctuation">(</span><span class="token string">"pctile."</span><span class="token punctuation">,</span>vname<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>vname <span class="token keyword">in</span> c<span class="token punctuation">(</span>names_e <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     print<span class="token punctuation">(</span>pctile_from_raw_lookup<span class="token punctuation">(</span>testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>vname<span class="token punctuation">]</span><span class="token punctuation">,</span> vname<span class="token punctuation">,</span> 
       lookup <span class="token operator">=</span> usastats<span class="token punctuation">)</span>
         <span class="token operator">-</span> testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>paste0<span class="token punctuation">(</span><span class="token string">"pctile."</span><span class="token punctuation">,</span>vname<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="mact_table">

<a href="#mact_table" class="help-page-title"><h2>mact_table (DATA) MACT NESHAP subparts (the code and the description)</h2></a>

<h3>Description</h3>

<p>This is a data.table with one row per MACT subpart such as BBBBBB or ZZZZZZ
and the title of each category. From the ECHO download of ICIS Air
@seealso <a href="#frs_by_mact">frs_by_mact</a>
</p>

<hr>
</div>
<div class="container manual-page" id="map_facilities">

<a href="#map_facilities" class="help-page-title"><h2>map_facilities</h2></a>

<h3>Description</h3>

<p>make a leaflet map of uploaded points
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">map_facilities<span class="token punctuation">(</span>mypoints<span class="token punctuation">,</span> rad <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> highlight <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> clustered<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mypoints, </code></td>
<td>
<p>data frame of uploaded points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rad, </code></td>
<td>
<p>a size for drawing each circle (buffer search radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highlight, </code></td>
<td>
<p>a logicial for whether to highlight overlapping points (defaults to FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clustered, </code></td>
<td>
<p>a vector of T/F values for each point, indicating if they overlap with another</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a leaflet map with circles, circleMarkers, and basic popup
</p>

<hr>
</div>
<div class="container manual-page" id="map_facilities_proxy">

<a href="#map_facilities_proxy" class="help-page-title"><h2>map_facilities_proxy</h2></a>

<h3>Description</h3>

<p>update a leaflet map within the EJAM shiny app with uploaded points.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">map_facilities_proxy<span class="token punctuation">(</span>
  mymap<span class="token punctuation">,</span>
  rad <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  highlight <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  clustered <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  popup_vec <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  use_marker_clusters <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mymap, </code></td>
<td>
<p>leafletProxy map object to be added to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rad, </code></td>
<td>
<p>a size for drawing each circle (buffer search radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highlight, </code></td>
<td>
<p>a logicial for whether to highlight overlapping points (defaults to FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clustered, </code></td>
<td>
<p>a vector of T/F values for each point, indicating if they overlap with another</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popup_vec, </code></td>
<td>
<p>a vector of popup values to display when points are clicked. Length should match number of rows in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_marker_clusters, </code></td>
<td>
<p>boolean for whether to group points into markerClusters. Uses logic from shiny app to only implement when n &gt; 1000.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a leaflet map with circles, circleMarkers, and basic popup
</p>

<hr>
</div>
<div class="container manual-page" id="metadata_add">

<a href="#metadata_add" class="help-page-title"><h2>helper function for package to set attributes of a dataset</h2></a>

<h3>Description</h3>

<p>This can be used annually to update some datasets in a package.
It just makes it easier to set a few metadata attributes similarly
for a number of data elements, for example,
to add new or update existing attributes.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>dataset (or any object) whose metadata you want to update or create</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata</code></td>
<td>
<p>must be a named list, so that the function can do this for each i:
<code>attr(x, which=names(metadata)[i]) &lt;- metadata[[i]]</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>returns x but with new or altered attributes
</p>


<h3>See Also</h3>

<p>metadata_check()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">1001</span><span class="token operator">:</span><span class="token number">1010</span><span class="token punctuation">)</span>
  metadata <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>
  ejscreen_version <span class="token operator">=</span>  <span class="token string">'2.2'</span><span class="token punctuation">,</span>
  acs_version <span class="token operator">=</span>          <span class="token string">'2017-2021'</span><span class="token punctuation">,</span>
  census_version <span class="token operator">=</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  ejscreen_releasedate <span class="token operator">=</span> <span class="token string">'2023-06-23'</span><span class="token punctuation">,</span>
  acs_releasedate <span class="token operator">=</span>      <span class="token string">'2022-12-08'</span><span class="token punctuation">,</span>
  ejscreen_pkg_data <span class="token operator">=</span> <span class="token keyword">NA</span>
  <span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
  attributes<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> list<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'final'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  attr<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'status'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="metadata_check">

<a href="#metadata_check" class="help-page-title"><h2>helper function in updating the package metadata</h2></a>

<h3>Description</h3>

<p>Quick and dirty helper during development, to check all the
attributes of all the data files in relevant packages.
It loads unloaded packages as needed, which you might not want it to do,
but it is not coded to be able to check attributes without doing that.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_check<span class="token punctuation">(</span>
  packages <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">,</span>
  which <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"census_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ACS"</span><span class="token punctuation">,</span>
    <span class="token string">"ejscreen_version"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_pkg_data"</span><span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token string">"released"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  loadifnotloaded <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>packages</code></td>
<td>
<p>Optional. e.g. 'EJAMejscreendata', or can be a vector of character strings,
and if not specified, default is to report on all packages with EJ as part of their name,
like EJAMejscreenapi</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>Optional vector (not list) of strings, the attributes.
Default is some typical ones used in EJAM-related packages currently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loadifnotloaded</code></td>
<td>
<p>Optional to control if func should temporarily attach packages not already loaded.</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="NAICS">

<a href="#NAICS" class="help-page-title"><h2>NAICS (DATA) named list of all NAICS code numbers and industry name for each</h2></a>

<h3>Description</h3>

<p>NAICS (DATA) named list of all NAICS code numbers and industry name for each
</p>


<h3>Details</h3>

<p>see <a href="https://naics.com" target="_blank">https://naics.com</a>
</p>


<h3>See Also</h3>

<p><a href="#naicstable">naicstable</a> <code><a href="#naics_from_any">naics_from_any()</a></code> <code><a href="#naics_categories">naics_categories()</a></code> <a href="#NAICS">NAICS</a>
</p>

<hr>
</div>
<div class="container manual-page" id="naics_categories">

<a href="#naics_categories" class="help-page-title"><h2>naics_categories - See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</h2></a>

<h3>Description</h3>

<p>naics_categories - See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span>digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> dataset <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>default is 2, for 2-digits NAICS, the top level, but could be up to 6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Should default to the dataset called NAICS, installed with this package.
see <a href="#NAICS">NAICS</a>  Check attr(NAICS, 'year')</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Also see <a href="https://www.naics.com/search/" target="_blank">https://www.naics.com/search/</a>
</p>
<p>There are this many NAICS codes roughly by number of digits in the code:
</p>
<p>table(nchar(NAICS))
</p>
<p>2    3    4    5    6
</p>
<p>17   99  311  709 1057
</p>
<p>See <a href="https://www.census.gov/naics/" target="_blank">https://www.census.gov/naics/</a>
</p>


<h3>See Also</h3>

<p><a href="#naics_from_any">naics_from_any</a>  <a href="#NAICS">NAICS</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_download">

<a href="#naics_download" class="help-page-title"><h2>naics_download - script to download NAICS file with code and name of sector</h2></a>

<h3>Description</h3>

<p>See source code. Mostly just a short script to get the 2017 or 2022 codes and names.
See &lt;'https://www.census.gov/naics/?48967'&gt;
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_download<span class="token punctuation">(</span>
  year <span class="token operator">=</span> <span class="token number">2017</span><span class="token punctuation">,</span>
  urlpattern <span class="token operator">=</span> <span class="token string">"https://www.census.gov/naics/YYYYNAICS/2-6%20digit_YYYY_Codes.xlsx"</span><span class="token punctuation">,</span>
  destfile <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">"~/Downloads/"</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> <span class="token string">"NAICS.xlsx"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>which vintage of NAICS codes to use, 2012, 2017, or 2022</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urlpattern</code></td>
<td>
<p>full url of xlsx file to use, but with YYYY instead of year</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>destfile</code></td>
<td>
<p>full path and name of file to save as locally</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>names list with year as an attribute
</p>

<hr>
</div>
<div class="container manual-page" id="naics_findwebscrape">

<a href="#naics_findwebscrape" class="help-page-title"><h2>naics_findwebscrape - for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_from_any">naics_from_any()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</h2></a>

<h3>Description</h3>

<p>naics_findwebscrape - for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_from_any">naics_from_any()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_findwebscrape<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>text like "gasoline" or "copper smelting"</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.frame of info on what was found, naics and title
</p>


<h3>See Also</h3>

<p><code><a href="#naics_from_any">naics_from_any()</a></code>  <code><a href="#url_naics.com">url_naics.com()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># naics_from_any("copper smelting")</span>
 <span class="token comment"># naics_from_any("copper smelting", website_scrape=TRUE)</span>
 <span class="token comment"># browseURL(naics_from_any("copper smelting", website_url=TRUE) )</span>
 
  url_naics.com<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  <span class="token comment">## Not run: </span>
  naics_findwebscrape<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>url_naics.com<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>naics_url_of_code<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_from_any">

<a href="#naics_from_any" class="help-page-title"><h2>naics_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</h2></a>

<h3>Description</h3>

<p>naics_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_any<span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_scrape <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_url <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>query string(s) and/or number(s), vector of NAICS codes or industry names or any regular expression or partial words</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_scrape</code></td>
<td>
<p>whether to scrape info from the NAICS website to return a table of codes and names that match (web query uses synonyms so gets more hits)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_url</code></td>
<td>
<p>whether to return the URL of the webpage with info on the NAICS (web query uses synonyms so gets more hits)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># Also see vignette for examples</span>
  naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span>naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">]</span> 
  naics_from_any<span class="token punctuation">(</span>naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">]</span> 
  naics_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naicstable<span class="token punctuation">[</span>code<span class="token operator">==</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  naics_subcodes_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naics_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span>  children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naicstable<span class="token punctuation">[</span>n3<span class="token operator">==</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span>
  
 naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics and rubber"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>
 naics_from_any<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">)</span>
 naics_from_any<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span>
 naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics"</span><span class="token punctuation">,</span> children<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>unique<span class="token punctuation">(</span>n3<span class="token punctuation">)</span><span class="token punctuation">]</span> 
 naics_from_any<span class="token punctuation">(</span><span class="token string">"pig"</span><span class="token punctuation">)</span>
 naics_from_any<span class="token punctuation">(</span><span class="token string">"pig "</span><span class="token punctuation">)</span> <span class="token comment"># space after g</span>
 
 <span class="token comment"># naics_from_any("copper smelting")</span>
 <span class="token comment"># naics_from_any("copper smelting", website_scrape=TRUE)</span>
 <span class="token comment"># browseURL(naics_from_any("copper smelting", website_url=TRUE) )</span>
 
 a <span class="token operator">=</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics"</span><span class="token punctuation">)</span>
 b <span class="token operator">=</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"rubber"</span><span class="token punctuation">)</span> 
 fintersect<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#  a AND b</span>
 funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token comment">#  a OR  b</span>
 naics_subcodes_from_code<span class="token punctuation">(</span>funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>   <span class="token comment">#  plus children</span>
 naics_from_any<span class="token punctuation">(</span>funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span><span class="token punctuation">,</span> children<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#  same</span>
 
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token number">325</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 1</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token number">325</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 54</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 20</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">104</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_from_code">

<a href="#naics_from_code" class="help-page-title"><h2>naics_from_code - search for industry names by NAICS code(s), 2-6 digits long each
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this</h2></a>

<h3>Description</h3>

<p>naics_from_code - search for industry names by NAICS code(s), 2-6 digits long each
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>vector of numeric NAICS codes. see <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="naics_from_federalregister">

<a href="#naics_from_federalregister" class="help-page-title"><h2>naics_from_federalregister - DRAFT WORK IN PROGRESS</h2></a>

<h3>Description</h3>

<p>naics_from_federalregister - DRAFT WORK IN PROGRESS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_federalregister<span class="token punctuation">(</span>naics_text_copy_from_fr<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics_text_copy_from_fr</code></td>
<td>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="naics_from_name">

<a href="#naics_from_name" class="help-page-title"><h2>naics_from_name - search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this</h2></a>

<h3>Description</h3>

<p>naics_from_name - search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_name<span class="token punctuation">(</span>mynames<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mynames</code></td>
<td>
<p>query string, vector of NAICS industry names or any regular expression or partial words. See <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>search_on_naics_website</code></td>
<td>
<p>whether to query on naics website for more hits than just search for text in industry title</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">data.table<span class="token operator">::</span>fintersect<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span> <span class="token string">"manufac"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_subcodes_from_code">

<a href="#naics_subcodes_from_code" class="help-page-title"><h2>naics_subcodes_from_code - find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.</h2></a>

<h3>Description</h3>

<p>naics_subcodes_from_code - find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_subcodes_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>NAICS codes vector, of 2 to 6 digits each. See <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr></table>
<h3>Details</h3>

<p>similar idea was naics2children() but this is more robust
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_url_of_code">

<a href="#naics_url_of_code" class="help-page-title"><h2>naics_url_of_code - Get URL for page with info about industry sector(s) by NAICS
See (https://naics.com) for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>naics_url_of_code - Get URL for page with info about industry sector(s) by NAICS
See (https://naics.com) for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_url_of_code<span class="token punctuation">(</span>naics<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>vector of one or more NAICS codes, like 11,"31-33",325</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of URLs as strings like https://www.naics.com/six-digit-naics/?v=2017&amp;code=22
</p>

<hr>
</div>
<div class="container manual-page" id="naics_validation">

<a href="#naics_validation" class="help-page-title"><h2>naics_validation - Validate NAIC uploads</h2></a>

<h3>Description</h3>

<p>Validates and prepares echo uploads
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_validation<span class="token punctuation">(</span>NAICS_enter<span class="token punctuation">,</span> NAIC_select<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>NAICS</code></td>
<td>
<p>upload validate missing and/or improper inputs</p>
</td>
</tr></table>
<h3>Value</h3>

<p>boolean value (valid or not valid)
</p>

<hr>
</div>
<div class="container manual-page" id="naics2children">

<a href="#naics2children" class="help-page-title"><h2>naics2children - See NAICS codes queried plus all children of any of those
Used by naics_find()</h2></a>

<h3>Description</h3>

<p>naics2children - See NAICS codes queried plus all children of any of those
Used by naics_find()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span>codes<span class="token punctuation">,</span> allcodes <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>codes</code></td>
<td>
<p>vector of numerical or character</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allcodes</code></td>
<td>
<p>Optional (already loaded with package) - dataset with all the codes</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>start with shortest (highest level) codes. since tied for nchar, these branches have zero overlap, so do each.
for each of those, get its children = all rows where parentcode == substr(allcodes, 1, nchar(parentcode))
put together list of all codes we want to include so far.
now for the next longest set of codes in original list of codes,
do same thing.
etc. until did it for 5 digit ones to get 6digit children.
take the unique(allthat)
table(nchar(as.character(NAICS)))
2    3    4    5    6
17   99  311  709 1057
</p>


<h3>Value</h3>

<p>vector of codes and their names
</p>


<h3>See Also</h3>

<p>naics_find() NAICS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naicstable">

<a href="#naicstable" class="help-page-title"><h2>naicstable (DATA) data.table of NAICS code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3,4,5,and 6-digit NAICS that this code falls under, where relevant for given length</h2></a>

<h3>Description</h3>

<p>This is similar to the data file EJAM::NAICS but in a more useful format and newer functions work with it.
</p>


<h3>Details</h3>

<p>see <a href="https://naics.com" target="_blank">https://naics.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#naics_from_any">naics_from_any()</a></code> <a href="#NAICS">NAICS</a>  <code><a href="#naics_categories">naics_categories()</a></code>  <code><a href="#naics_findwebscrape">naics_findwebscrape()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="names_d">

<a href="#names_d" class="help-page-title"><h2>list of demographic indicator names</h2></a>

<h3>Description</h3>

<p>list of demographic indicator names
</p>


<h3>See Also</h3>

<p>map_headernames (in EJAMejscreenapi package) <a href="#names_d">names_d</a> <a href="#names_e">names_e</a> <a href="#namez">namez</a>
</p>

<hr>
</div>
<div class="container manual-page" id="names_e">

<a href="#names_e" class="help-page-title"><h2>list of environmental indicator names</h2></a>

<h3>Description</h3>

<p>list of environmental indicator names
</p>


<h3>See Also</h3>

<p>EJAMejscreenapi dataset called map_headernames <a href="#names_d">names_d</a> <a href="#names_e">names_e</a> <a href="#namez">namez</a>
</p>

<hr>
</div>
<div class="container manual-page" id="names_whichlist">

<a href="#names_whichlist" class="help-page-title"><h2>names_whichlist
See which of the lists of names a single term appears in</h2></a>

<h3>Description</h3>

<p>names_whichlist
See which of the lists of names a single term appears in
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">names_whichlist<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  exact <span class="token operator">=</span> T<span class="token punctuation">,</span>
  grepmatching <span class="token operator">=</span> T<span class="token punctuation">,</span>
  ignore.case.exact <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  ignore.case.grep <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  keylists <span class="token operator">=</span> F<span class="token punctuation">,</span>
  exactonly <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>term, like part or all of a variable name, such as state.avg</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact</code></td>
<td>
<p>whether to look for exact matches</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grepmatching</code></td>
<td>
<p>whether to look for matches via grep (partial match)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case.exact</code></td>
<td>
<p>whether to ignore capitalization in exact matches</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case.grep</code></td>
<td>
<p>passed to grep as ignore.case param</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keylists</code></td>
<td>
<p>if true, only report for the key lists not friendly, all, these, need types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exactonly</code></td>
<td>
<p>to limit output to rows with exact matches</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>EJAM::namez has a list of lists of names used for indicators or variables, such as
namez$d_friendly which is a vector of terms like
"Demog.Ind.", "Suppl Demog Index",  "% Low-inc.", etc.
</p>


<h3>Value</h3>

<p>a data.frame of whichlist, exactmatch, grepmatch, and grephits (examples)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> names_whichlist<span class="token punctuation">(</span><span class="token string">"rsei"</span><span class="token punctuation">,</span> ignore.case.exact <span class="token operator">=</span> T<span class="token punctuation">,</span> ignore.case.grep <span class="token operator">=</span> T<span class="token punctuation">)</span>
   subset<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">!</span>grepl<span class="token punctuation">(</span><span class="token string">"friendly"</span><span class="token punctuation">,</span> x<span class="token operator">$</span>whichlist<span class="token punctuation">)</span><span class="token punctuation">)</span>
   
   subset<span class="token punctuation">(</span>x<span class="token punctuation">,</span>  grepl<span class="token punctuation">(</span><span class="token string">"friendly"</span><span class="token punctuation">,</span> x<span class="token operator">$</span>whichlist<span class="token punctuation">)</span><span class="token punctuation">)</span>
   subset<span class="token punctuation">(</span>namez<span class="token punctuation">,</span> names<span class="token punctuation">(</span>namez<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"all_r"</span> <span class="token operator">&amp;</span> names<span class="token punctuation">(</span>namez<span class="token punctuation">)</span> <span class="token percent-operator operator">%in%</span>
      subset<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token operator">$</span>grepmatch <span class="token operator">==</span> <span class="token string">"yes"</span> <span class="token operator">&amp;</span> <span class="token operator">!</span>grepl<span class="token punctuation">(</span><span class="token string">"friendly"</span><span class="token punctuation">,</span> x<span class="token operator">$</span>whichlist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">$</span>whichlist  <span class="token punctuation">)</span>
   grep<span class="token punctuation">(</span><span class="token string">"\\.eo$"</span><span class="token punctuation">,</span> namez<span class="token operator">$</span>ej<span class="token punctuation">,</span> value <span class="token operator">=</span> T<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="names_whichlist_multi">

<a href="#names_whichlist_multi" class="help-page-title"><h2>names_whichlist_multi
See which lists of names the given indicator names are in</h2></a>

<h3>Description</h3>

<p>names_whichlist_multi
See which lists of names the given indicator names are in
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">names_whichlist_multi<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of names (query terms)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to names_whichlist()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list of sets of names
</p>

<hr>
</div>
<div class="container manual-page" id="names_whichlist_multi_key">

<a href="#names_whichlist_multi_key" class="help-page-title"><h2>names_whichlist_multi_key
See which key lists of names the given indicator names are in</h2></a>

<h3>Description</h3>

<p>names_whichlist_multi_key
See which key lists of names the given indicator names are in
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">names_whichlist_multi_key<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to names_whichlist_multi()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector maybe
</p>

<hr>
</div>
<div class="container manual-page" id="namez">

<a href="#namez" class="help-page-title"><h2>list of lists of indicator names</h2></a>

<h3>Description</h3>

<p>list of lists of indicator names
</p>


<h3>See Also</h3>

<p>EJAMejscreenapi dataset called map_headernames <a href="#names_d">names_d</a> <a href="#names_e">names_e</a>
</p>

<hr>
</div>
<div class="container manual-page" id="pctile_from_raw_lookup">

<a href="#pctile_from_raw_lookup" class="help-page-title"><h2>pctile_from_raw_lookup - Find approx wtd percentiles in lookup table that is in memory</h2></a>

<h3>Description</h3>

<p>This is used with a lookup table to
convert a raw indicator vector to percentiles in US or States.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pctile_from_raw_lookup<span class="token punctuation">(</span>
  myvector<span class="token punctuation">,</span>
  varname.<span class="token keyword">in</span>.lookup.table<span class="token punctuation">,</span>
  lookup <span class="token operator">=</span> usastats<span class="token punctuation">,</span>
  zone <span class="token operator">=</span> <span class="token string">"USA"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myvector</code></td>
<td>
<p>Numeric vector, required. Values to look for in the lookup table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname.in.lookup.table</code></td>
<td>
<p>Character element, required.
Name of column in lookup table to look in
to find interval where a given element of myvector values is.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lookup</code></td>
<td>
<p>Either lookup must be provided, not quoted,
or a lookup table called <a href="#usastats">usastats</a> must already be in memory. This is the lookup table
data.frame with a PCTILE column, REGION column, and column whose name is the value of varname.in.lookup.table
To use state lookups set lookup=statestats</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Character element (or vector as long as myvector), optional.
If specified, must appear in a column called REGION within the lookup table,
or NA returned for each item looked up and warning given.
For example, it could be "NY" for New York State, "USA" for national percentiles.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This could be recoded to be more efficient - could use data.table.
</p>
<p>The data.frame lookup table must have a field called "PCTILE" that has quantiles/percentiles
and other column(s) with values that fall at those percentiles.
<a href="#usastats">usastats</a> and <a href="#statestats">statestats</a> are such lookup tables.
This function accepts lookup table (or uses one called us if that is in memory), and
finds the number in the PCTILE column that corresponds to where a specified value
(in myvector) appears in the column called varname.in.lookup.table.
The function just looks for where the specified value fits between values in the lookup table
and returns the approximate percentile as found in the PCTILE column.
If the value is between the cutpoints listed as
percentiles 89 and 90, it returns 89, for example.
If the value is exactly equal to the cutpoint listed as percentile 90,
it returns percentile 90.
If the value is exactly the same as the minimum in the lookup table and multiple percentiles
in that lookup are listed as tied for having the same threshold value defining the percentile
(i.e., a large percent of places have the same score and it is the minimum score),
then the percentile gets reported as 0,
not the percent of places tied for that minimum score. Note this is true whether they are
tied at a value of 0 or are tied at some other minimum value than 0.
If the value is less than the cutpoint listed as percentile 0,
which should be the minimum value in the dataset,
it still returns 0 as the percentile, but with a warning that
the value checked was less than the minimum in the dataset.
</p>
<p>It also handles other odd cases, like where a large percent of all raw scores are tied at
the minimum value, in which case it reports 0 as percentile, not that large percent.
</p>


<h3>Value</h3>

<p>By default, returns numeric vector length of myvector.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  <span class="token comment"># compare ejscreen API output percentiles to those from this function:</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>vname <span class="token keyword">in</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     print<span class="token punctuation">(</span>pctile_from_raw_lookup<span class="token punctuation">(</span>testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>vname<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> vname<span class="token punctuation">,</span> 
       lookup <span class="token operator">=</span> usastats<span class="token punctuation">)</span> 
       <span class="token operator">-</span> testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>paste0<span class="token punctuation">(</span><span class="token string">"pctile."</span><span class="token punctuation">,</span>vname<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>vname <span class="token keyword">in</span> c<span class="token punctuation">(</span>names_e <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     print<span class="token punctuation">(</span>pctile_from_raw_lookup<span class="token punctuation">(</span>testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>vname<span class="token punctuation">]</span><span class="token punctuation">,</span> vname<span class="token punctuation">,</span> 
       lookup <span class="token operator">=</span> usastats<span class="token punctuation">)</span>
         <span class="token operator">-</span> testoutput_ejscreenapi_plus_100<span class="token punctuation">[</span><span class="token punctuation">,</span>paste0<span class="token punctuation">(</span><span class="token string">"pctile."</span><span class="token punctuation">,</span>vname<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="pctiles_lookup_create">

<a href="#pctiles_lookup_create" class="help-page-title"><h2>pctiles_lookup_create - create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</h2></a>

<h3>Description</h3>

<p>pctiles_lookup_create - create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pctiles_lookup_create<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  zone.vector <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zoneOverallName <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
  wts <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate
mean,   and percentiles, for each zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone.vector</code></td>
<td>
<p>optional names of states or regions, for example. same length as wts, or rows in mydf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zoneOverallName</code></td>
<td>
<p>optional. Default is USA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>not used in EJScreen percentiles anymore</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>EJScreen assigns each indicator in each block group a percentile value via python script, using
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.percentileofscore.html" target="_blank">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.percentileofscore.html</a>
</p>
<p>The way the python function is used as of 2023 is that percentileofscore is 80% if
</p>
<p>80% of all indicator values (statewide or nationwide, depending on the type being calculated)
</p>
<p>are less than (NOT equal to) the indicator value
</p>
<p>in the specified block group (since kind="strict").
</p>
<p>The percentile recorded in the EJScreen dataset is the floor of that,
</p>
<p>meaning if the 81.9% of values are less than x, the percentile is reported as 81.
</p>
<p>The EJScreen python script used to create percentile lookup tables is in a file
</p>
<p>called cal_statepctile_0222.py and the key lines of code and functions it uses are
</p>
<p>pctile = math.floor(stats.percentileofscore(barray, indicatorscore, kind="strict"))
</p>
<p>binvalue = getBinvalue(pctile)
</p>
<p>and
</p>
<p>def getBinvalue(pct):
</p>
<p>if pct is None:
return 0
else:
if pct &gt;= 95:
return 11
elif pct &gt;= 90 and pct &lt; 95:
return 10
elif pct &gt;= 80 and pct &lt; 90:
return 9
elif pct &gt;= 70 and pct &lt; 80:
return 8
elif pct &gt;= 60 and pct &lt; 70:
return 7
elif pct &gt;= 50 and pct &lt; 60:
return 6
elif pct &gt;= 40 and pct &lt; 50:
return 5
elif pct &gt;= 30 and pct &lt; 40:
return 4
elif pct &gt;= 20 and pct &lt; 30:
return 3
elif pct &gt;= 10 and pct &lt; 20:
return 2
else:
return 1
</p>

<hr>
</div>
<div class="container manual-page" id="plot_barplot_ratios">

<a href="#plot_barplot_ratios" class="help-page-title"><h2>plot_barplot_ratios
Make barplot of ratios of demographic score to its average</h2></a>

<h3>Description</h3>

<p>plot_barplot_ratios
Make barplot of ratios of demographic score to its average
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_barplot_ratios<span class="token punctuation">(</span>
  ratio.to.us.d.overall<span class="token punctuation">,</span>
  names2plot_friendly <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  mycolorsavailable <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ratio.to.us.d.overall</code></td>
<td>
<p>named list of a few ratios to plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names2plot_friendly</code></td>
<td>
<p>names to use for plot - should be same length as named list ratio.to.us.d.overall</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mycolorsavailable</code></td>
<td>
<p>leave as default</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For plots in general, see:
</p>

<ul>
<li> <p><a href="https://echarts4r.john-coene.com/articles/themes.html" target="_blank">https://echarts4r.john-coene.com/articles/themes.html</a>
</p>
</li>
<li> <p><a href="https://exts.ggplot2.tidyverse.org/gallery" target="_blank">https://exts.ggplot2.tidyverse.org/gallery</a>
</p>
</li>
</ul>
<p>For BARPLOTS, see/ merge/consolidate:
</p>

<ul>
<li>
<p> output$view1_summary_plot &lt;- renderPlot(v1_summary_plot()) and v1_summary_plot &lt;- reactive( )
in EJAM server for Short Report if  bar type
</p>
</li>
<li>
<p> output$summ_display_bar &lt;- renderPlot(  ) contains its own plot code not a reactive
in EJAM server for tab showing barplots in Detailed Results
</p>
</li>
<li>
<p> plot_barplot_ratios() drafted function in EJAM
</p>
</li>
</ul>
<p>For BOXPLOTS, see:
</p>

<ul>
<li>
<p> v1_summary_plot &lt;- reactive( )     and output$view1_summary_plot &lt;- renderPlot(v1_summary_plot())
</p>
<p>in EJAM server for SHORT report if box type, and
</p>
<p>in EJAM server for LONG report passed as a parameter
</p>
</li>
<li>
<p> boxplots_ratios()   in EJAMejscreenapi
</p>
<p>(NOT in EJAM server for Detailed Results interactive views)
</p>
</li>
<li>
<p> ejscreenapi_script() code also relevant? in EJAMejscreenapi
</p>
</li>
<li>
<p> box/scatter examples in ggplot, <a href="https://r-graph-gallery.com/89-box-and-scatter-plot-with-ggplot2.html" target="_blank">https://r-graph-gallery.com/89-box-and-scatter-plot-with-ggplot2.html</a>
</p>
</li>
<li>
<p> boxplots in base R, <a href="https://www.r-bloggers.com/2023/09/how-to-reorder-boxplots-in-r-a-comprehensive-guide" target="_blank">https://www.r-bloggers.com/2023/09/how-to-reorder-boxplots-in-r-a-comprehensive-guide</a>
</p>
</li>
</ul>
<p>For HISTOGRAMS, see:
</p>

<ul>
<li>
<p> output$summ_display_hist &lt;- renderPlot   in EJAM server for interactive views
</p>
</li>
<li>
<p> the histograms code and discussion in EJAMbatch.summarizer package
</p>
</li>
</ul>
<h3>Value</h3>

<p>ggplot should be returned
</p>


<h3>See Also</h3>

<p><code><a href="#xls_formatting2">xls_formatting2()</a></code> <a href="#plot_barplot_ratios">plot_barplot_ratios</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">plot_barplot_ratios<span class="token punctuation">(</span>unlist<span class="token punctuation">(</span>testoutput_ejamit_1000pts_1miles<span class="token operator">$</span>results_overall<span class="token punctuation">[</span> <span class="token punctuation">,</span> c<span class="token punctuation">(</span>..names_d_ratio_to_avg <span class="token punctuation">,</span> ..names_d_subgroups_ratio_to_avg<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="plot_demogshare_by_distance">

<a href="#plot_demogshare_by_distance" class="help-page-title"><h2>plot_demogshare_by_distance - work in progress</h2></a>

<h3>Description</h3>

<p>plot_demogshare_by_distance - work in progress
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_demogshare_by_distance<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> names_d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  siteids <span class="token operator">=</span> unique<span class="token punctuation">(</span>results_bybg_people<span class="token operator">$</span>siteid<span class="token punctuation">)</span><span class="token punctuation">,</span>
  show.lowess <span class="token operator">=</span> F<span class="token punctuation">,</span>
  show.lm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  show.line <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>siteids</code></td>
<td>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.lowess</code></td>
<td>
<p>F</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.lm</code></td>
<td>
<p>linefit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.line</code></td>
<td>
<p>linefit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to plot</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Could also consider plotting something like boxplot(demogvar ~ round(distance, 1))
</p>
<p>See notes on plots at <code><a href="#plot_barplot_ratios">plot_barplot_ratios()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="plot_distance_cdf_by_group">

<a href="#plot_distance_cdf_by_group" class="help-page-title"><h2>plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances</h2></a>

<h3>Description</h3>

<p>plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_distance_cdf_by_group<span class="token punctuation">(</span>
  results_bybg_people <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  radius_miles <span class="token operator">=</span>
    round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>results_bybg_people<span class="token operator">$</span>distance_min_avgperson<span class="token punctuation">[</span><span class="token operator">!</span>is.infinite<span class="token punctuation">(</span>results_bybg_people<span class="token operator">$</span>distance_min_avgperson<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    na.rm <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  subgroups_type <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  colorlist <span class="token operator">=</span> colorspace<span class="token operator">::</span>diverging_hcl<span class="token punctuation">(</span>length<span class="token punctuation">(</span>demogvarname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  coloroverall <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span>
  returnwhat <span class="token operator">=</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_miles</code></td>
<td>
<p>miles radius that was max distance analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subgroups_type</code></td>
<td>
<p>optional, can be set to "nh" or "alone".
Specifies types of race ethnicity subgroups to use for demogvarname
but only if demogvarname is not specified as a parameter.
If neither is specified it tries to use default_subgroups_type
if that is a variable set by global.R, since it cannot check the reactive variable input$subgroups_type
outside the context of the web app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>optional way to specify names of columns to use from results_bybg_people,
e.g., c("pctlowinc", "pctmin"), or  namez$d, or
could be a vector of subgroups such as namez$d_subgroups_nh that includes "pctnhba" etc.
or namez$d_subgroups_alone that includes "pctba" etc.,
but if demogvarname is not specified here as a parameter,
this info could also be specified by the subgroups_type parameter here.
If neither is specified, the function will try to use a default
(which may not reflect any changes being made during development of EJAM if default_subgroups_type is in flux)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>friendly text names for labelling graphic, like "Low income residents"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorlist</code></td>
<td>
<p>colors like "red" etc. for the demographic groups of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coloroverall</code></td>
<td>
<p>color like "gray" for everyone as a whole</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnwhat</code></td>
<td>
<p>If returnwhat is "table", invisibly returns a
full table of sorted distances of blockgroups,
cumulative count of demog groups at that block group's distance.
If returnwhat is "plotfilename" then it returns the full path including filename of a .png in a tempdir
If returnwhat is "plot" then it returns the plot object as needed for xls_formatting2()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>see returnwhat parameter
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code> <code><a href="#ejamit">ejamit()</a></code> for examples
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="plot_distance_mean_by_group">

<a href="#plot_distance_mean_by_group" class="help-page-title"><h2>plot_distance_mean_by_group
Barplot of Average Proximity to sites, by Demographic Group (vs everyone else)</h2></a>

<h3>Description</h3>

<p>Note ratio shown is ratio of distance among others to distance in group,
so values below 1 mean the given demographic group lives closer to facilities.
A value of 0.85 would mean the group is only 85% as far from a site as
@details Note it is in miles assuming input was in miles, and the distance for each resident is
actually the average distance of all residents within their Census block (not block group),
and when a site is very close to the block internal point (like a centroid)
relative to the size of the block, the distance to the average resident in the block is
estimated as 90 percent of the effective radius, which is what the radius of the block
would be if it were the same area in square meters or miles but circular in shape.
This is the approach used in EJScreen to estimate average proximity of a block resident in
cases where the block is extremely close to the site or the site may actually be inside the block,
or exactly on top of the internal point of the block, in which case zero would not be an
appropriate estimate of the distance, hence this adjustment is made in EJAM getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_distance_mean_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  graph <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  returnwhat <span class="token operator">=</span> <span class="token string">"table"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>vector of column names like "pctlowinc" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>vector of labels like "Low Income Residents" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnwhat</code></td>
<td>
<p>If returnwhat is "table", invisibly returns a
data.frame with group, ratio, avg_distance_for_group, avg_distance_for_nongroup.
If returnwhat is "plotfilename" then it returns the full path including filename of a .png in a tempdir
If returnwhat is "plot" then it returns the plot object as needed for xls_formatting2() ?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>see parameter returnwhat
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code>
</p>
<p><code><a href="#distance_by_group_plot">distance_by_group_plot()</a></code>  <code><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">y <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 plot_distance_mean_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment"># or distance_mean_by_group() synonym</span>
 print<span class="token punctuation">(</span>distance_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 distance_by_group_plot<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">,</span> 
   demogvarname <span class="token operator">=</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> demoglabel <span class="token operator">=</span> <span class="token string">'Low Income'</span><span class="token punctuation">)</span>
 xyz <span class="token operator">=</span> plot_distance_cdf_by_group<span class="token punctuation">(</span>y<span class="token operator">$</span>results_bybg_people<span class="token punctuation">)</span> <span class="token comment">#  </span>
 tail<span class="token punctuation">(</span>round<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctwa <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> White Alone is <span class="token number">2.15</span> miles<span class="token punctuation">,</span> but <span class="token operator">&gt;</span><span class="token number">60</span>% of Black Alone have a site that close.
 tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>pctba <span class="token operator">&lt;=</span> <span class="token number">0.501</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#  Median distance to nearest site here </span>
   <span class="token keyword">for</span> Black Alone is <span class="token number">1.85</span> miles
 round<span class="token punctuation">(</span>tail<span class="token punctuation">(</span>xyz<span class="token punctuation">[</span>xyz<span class="token operator">$</span>dist <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#  11% of White have a site within 1 mile, </span>
   compared to <span class="token number">18.7</span>% of Asian who do.</code></pre>

<hr>
</div>
<div class="container manual-page" id="plotblocksnearby">

<a href="#plotblocksnearby" class="help-page-title"><h2>plotblocksnearby - Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby</h2></a>

<h3>Description</h3>

<p>plotblocksnearby - Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plotblocksnearby<span class="token punctuation">(</span>sitepoints<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> sites2blocks<span class="token punctuation">,</span> usemapfast <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>table of points with lat, lon in decimal degrees (data.frame or data.table),
but also could just be the output of getblocksnearby() if that has already been done.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>If provided, used as sites2blocks like <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a>
If neither sites2blocks nor sitepoints is provided it cannot plot and returns error.
If sites2blocks and sitepoints are both provided, it uses them both to plot blocks and sites (centers of circles).
If sites2blocks not provided, but sitepoints alone is provided, checks if sitepoints is actually sites2blocks, and uses as such.
If sites2blocks not provided, but sitepoints alone is provided, and sitepoints is really sitepoints, it runs getblocksnearby() to create sites2blocks.
If sites2blocks is provided, but sitepoints is not, it could only do a bad approximation of sitepoints so it will not draw the circle or site at center of the circle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usemapfast</code></td>
<td>
<p>optional. simpler plot if FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to mapfast() or plot() depending on usemapfast</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Uses <code><a href="#getblocksnearby">getblocksnearby()</a></code> if lat,lon points provided as sitepoints,
but skips it if looks like user passed output of getblocksnearby(),
and then displays a map of those blocks near the specified point.
</p>


<h3>Value</h3>

<p>invisibly returns sites2blocks like getblocksnearby() does
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#  see all Census Blocks within 1 mile of 1 site, if already had run getblocksnearby()</span>
   z <span class="token operator">=</span>  plotblocksnearby<span class="token punctuation">(</span>sitepoints <span class="token operator">=</span> testpoints_10<span class="token punctuation">,</span> 
   sites2blocks <span class="token operator">=</span> testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">[</span>siteid <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">1</span>  <span class="token punctuation">)</span>
   <span class="token comment"># see two sites if already had run getblocksnearby()</span>
   z <span class="token operator">=</span>  plotblocksnearby<span class="token punctuation">(</span>sitepoints <span class="token operator">=</span> testpoints_10<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
   sites2blocks <span class="token operator">=</span> testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">[</span>siteid <span class="token percent-operator operator">%in%</span> c<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">1</span>  <span class="token punctuation">)</span>
  <span class="token comment">## Not run: </span>
  <span class="token comment"># See one randomly selected regulated facility from FRS and all Census Blocks within 2 miles:</span>
    plotblocksnearby<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> 
  <span class="token comment"># See two sites and all Census Blocks within 5 kilometers</span>
    plotblocksnearby<span class="token punctuation">(</span>testpoints_2<span class="token punctuation">,</span> radius <span class="token operator">=</span> convert_units<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> from <span class="token operator">=</span> <span class="token string">"km"</span><span class="token punctuation">,</span> towhat <span class="token operator">=</span> <span class="token string">"miles"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># See 100 sites and all blocks within 1 mile of each - </span>
  <span class="token comment"># Note you have to specify radius here or it uses default that may not match intent </span>
  <span class="token comment"># - and this is a bit slow</span>
  plotblocksnearby<span class="token punctuation">(</span>testdata_ejamit_output_100pts_1miles<span class="token operator">$</span>results_bysite<span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>siteid<span class="token punctuation">,</span> lat<span class="token punctuation">,</span>lon<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> 
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popshare_at_top_n">

<a href="#popshare_at_top_n" class="help-page-title"><h2>popshare_at_top_n
What fraction of total population is accounted for by the top n places?</h2></a>

<h3>Description</h3>

<p>popshare_at_top_n
What fraction of total population is accounted for by the top n places?
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popshare_at_top_n<span class="token punctuation">(</span>pop<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> astext <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>vector of population totals across places,
like out$results_bysite$pop where out is the output of ejamit()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of places to consider</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>astext</code></td>
<td>
<p>if TRUE, return text of description of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>rounding digits for text output</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A fraction of 1
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> testdata_ejamit_output_100pts_1miles<span class="token operator">$</span>results_bysite
 popshare_p_lives_at_what_pct<span class="token punctuation">(</span>x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0.50</span><span class="token punctuation">,</span> astext<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 popshare_p_lives_at_what_n<span class="token punctuation">(</span>  x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">0.67</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_x_pct<span class="token punctuation">(</span>       x<span class="token operator">$</span>pop<span class="token punctuation">,</span> x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">.90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_n<span class="token punctuation">(</span>           x<span class="token operator">$</span>pop<span class="token punctuation">,</span> n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popshare_at_top_x_pct">

<a href="#popshare_at_top_x_pct" class="help-page-title"><h2>popshare_at_top_x_pct
What fraction of total population is accounted for by the top X percent of places?</h2></a>

<h3>Description</h3>

<p>popshare_at_top_x_pct
What fraction of total population is accounted for by the top X percent of places?
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popshare_at_top_x_pct<span class="token punctuation">(</span>pop<span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span> astext <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>vector of population totals across places,
like out$results_bysite$pop where out is the output of ejamit()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a fraction of 1, the share of all places (or a vector of values)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>astext</code></td>
<td>
<p>if TRUE, return text of description of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>rounding digits for text output</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A fraction of 1 (or a vector of results) or text
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> testdata_ejamit_output_100pts_1miles<span class="token operator">$</span>results_bysite
 popshare_p_lives_at_what_pct<span class="token punctuation">(</span>x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0.50</span><span class="token punctuation">,</span> astext<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 popshare_p_lives_at_what_n<span class="token punctuation">(</span>  x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">0.67</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_x_pct<span class="token punctuation">(</span>       x<span class="token operator">$</span>pop<span class="token punctuation">,</span> x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">.90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_n<span class="token punctuation">(</span>           x<span class="token operator">$</span>pop<span class="token punctuation">,</span> n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popshare_p_lives_at_what_n">

<a href="#popshare_p_lives_at_what_n" class="help-page-title"><h2>popshare_p_lives_at_what_n</h2></a>

<h3>Description</h3>

<p>popshare_p_lives_at_what_n
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popshare_p_lives_at_what_n<span class="token punctuation">(</span>pop<span class="token punctuation">,</span> p<span class="token punctuation">,</span> astext <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>vector of population totals across places,
like out$results_bysite$pop where out is the output of ejamit()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>share of population (0-1, fraction), vector of one or more</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>astext</code></td>
<td>
<p>if TRUE, return text of description of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>rounding digits for text output</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of numbers of sites, or text about that
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> testdata_ejamit_output_100pts_1miles<span class="token operator">$</span>results_bysite
 popshare_p_lives_at_what_pct<span class="token punctuation">(</span>x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0.50</span><span class="token punctuation">,</span> astext<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 popshare_p_lives_at_what_n<span class="token punctuation">(</span>  x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">0.67</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_x_pct<span class="token punctuation">(</span>       x<span class="token operator">$</span>pop<span class="token punctuation">,</span> x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">.90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_n<span class="token punctuation">(</span>           x<span class="token operator">$</span>pop<span class="token punctuation">,</span> n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popshare_p_lives_at_what_pct">

<a href="#popshare_p_lives_at_what_pct" class="help-page-title"><h2>popshare_p_lives_at_what_pct</h2></a>

<h3>Description</h3>

<p>popshare_p_lives_at_what_pct
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popshare_p_lives_at_what_pct<span class="token punctuation">(</span>pop<span class="token punctuation">,</span> p<span class="token punctuation">,</span> astext <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>vector of population totals across places,
like out$results_bysite$pop where out is the output of ejamit()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>share of population (0-1, fraction), vector of one or more</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>astext</code></td>
<td>
<p>if TRUE, return text of description of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>rounding digits for text output</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of fractions 0-1 of all sites, or text about that
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> testdata_ejamit_output_100pts_1miles<span class="token operator">$</span>results_bysite
 popshare_p_lives_at_what_pct<span class="token punctuation">(</span>x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0.50</span><span class="token punctuation">,</span> astext<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 popshare_p_lives_at_what_n<span class="token punctuation">(</span>  x<span class="token operator">$</span>pop<span class="token punctuation">,</span> p <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">0.67</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_x_pct<span class="token punctuation">(</span>       x<span class="token operator">$</span>pop<span class="token punctuation">,</span> x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.50</span><span class="token punctuation">,</span> <span class="token number">.90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 popshare_at_top_n<span class="token punctuation">(</span>           x<span class="token operator">$</span>pop<span class="token punctuation">,</span> n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popup_from_any">

<a href="#popup_from_any" class="help-page-title"><h2>popup_from_any - Simple map popup from a data.table or data.frame, one point per row
Creates popup vector that leaflet::addCircles or leaflet::addPopups can use.
Works similarly to EJAMejscreenapi::popup_from_df, but now extends to data.table</h2></a>

<h3>Description</h3>

<p>popup_from_any - Simple map popup from a data.table or data.frame, one point per row
Creates popup vector that leaflet::addCircles or leaflet::addPopups can use.
Works similarly to EJAMejscreenapi::popup_from_df, but now extends to data.table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popup_from_any<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  column_names <span class="token operator">=</span> names<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  labels <span class="token operator">=</span> column_names<span class="token punctuation">,</span>
  n <span class="token operator">=</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x, </code></td>
<td>
<p>a data table or data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>column_names</code></td>
<td>
<p>default is all, or a vector of column names from x to use.
If some of column_names requested are not found in names(x),
a warning is given and NA values returned for those names not in x.
If some of names(x) not requested by column_names, they are left out.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>default is column_names - vector used to label
the elements in the popup. Must be same length as column_names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Show the first n columns of mypoints, in popup. "all" means all of them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>can set to TRUE while testing function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each popup is made from one row of the data.frame.
Each popup has one row of text per column of the data.frame
</p>


<h3>Value</h3>

<p>A vector of strings, one per row or map point,
with a line break separating column elements
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">dat <span class="token operator">&lt;-</span> data.table<span class="token punctuation">(</span>
   RegistryId <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"110071102551"</span><span class="token punctuation">,</span> <span class="token string">"110015787683"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   FacilityName <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"USDOI FWS AK MARITIME NWR etc"</span><span class="token punctuation">,</span> <span class="token string">"ADAK POWER PLANT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   LocationAddress <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"65 MI W. OF ADAK NAVAL FACILITY"</span><span class="token punctuation">,</span> <span class="token string">"100 HILLSIDE BLVD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   CityName <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"ADAK"</span><span class="token punctuation">,</span> <span class="token string">"ADAK"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   CountyName <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"ALEUTIAN ISLANDS"</span><span class="token punctuation">,</span> <span class="token string">"ALEUTIANS WEST"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   StateAbbr <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"AK"</span><span class="token punctuation">,</span> <span class="token string">"AK"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   ZipCode <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"99546"</span><span class="token punctuation">,</span> <span class="token string">"99546"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   FIPSCode <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"02010"</span><span class="token punctuation">,</span> <span class="token string">"02016"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   lat <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">51.671389</span><span class="token punctuation">,</span><span class="token number">51.8703</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lon <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">178.051111</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">176.659</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   SupplementalLocation <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token keyword">NA_character_</span><span class="token punctuation">,</span><span class="token keyword">NA_character_</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 <span class="token comment">## add popups only</span>
 leaflet<span class="token operator">::</span>leaflet<span class="token punctuation">(</span>dat<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addTiles<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addPopups<span class="token punctuation">(</span>popup <span class="token operator">=</span> popup_from_any<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 <span class="token comment">## add circles with clickable popups</span>
 leaflet<span class="token operator">::</span>leaflet<span class="token punctuation">(</span>dat<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addTiles<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addCircles<span class="token punctuation">(</span>popup <span class="token operator">=</span> popup_from_any<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 <span class="token comment">## convert to data frame, works the same way </span>
 dat_df <span class="token operator">&lt;-</span> as.data.frame<span class="token punctuation">(</span>dat_df<span class="token punctuation">)</span>
 leaflet<span class="token operator">::</span>leaflet<span class="token punctuation">(</span>dat<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addTiles<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">&gt;</span> leaflet<span class="token operator">::</span>addCircles<span class="token punctuation">(</span>popup <span class="token operator">=</span> popup_from_any<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="proximity.score.in.miles">

<a href="#proximity.score.in.miles" class="help-page-title"><h2>proximity.score.in.miles - convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used</h2></a>

<h3>Description</h3>

<p>proximity.score.in.miles - convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proximity.score.<span class="token keyword">in</span>.miles<span class="token punctuation">(</span>scoresdf <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>scoresdf</code></td>
<td>
<p>data.frame of simple proximity scores like for tsdf, rmp, npl
but not traffic.score or npdes one since those are weighted and not just count per km</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="proxistat2">

<a href="#proxistat2" class="help-page-title"><h2>proxistat2 - Calculate a proximity score for every blockgroup - WORK IN PROGRESS
Indicator of proximity of each blockgroups to some set of facilities or sites.</h2></a>

<h3>Description</h3>

<p>proxistat2 - Calculate a proximity score for every blockgroup - WORK IN PROGRESS
Indicator of proximity of each blockgroups to some set of facilities or sites.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat2<span class="token punctuation">(</span>pts<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">8.04672</span><span class="token punctuation">,</span> quadtree<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pts</code></td>
<td>
<p>data.table of lat lon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>distance max, in miles, default is 5km (8.04672 miles)
which is the EJScreen max search range for proximity scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>must be called localtree, an index of block locations,
built during use of EJAM package. see <a href="#quaddata">quaddata</a></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Proximity score is sum of (1/d) where each d is distance of a given site in km,
summed over all sites within 5km, as in EJScreen.
</p>
<p>doaggregate() has a bit of code in it to do this same thing that this function does.
</p>
<p>*** Still need area of each block to fix this function -
the block area should get put into one of these:
<a href="#EJAM">blockpoints</a> or <a href="#EJAM">blockwts</a>
</p>


<h3>Value</h3>

<p>data.table with proximityscore, bgfips, lat, lon, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># pts &lt;- testpoints_100</span>
 <span class="token comment"># x &lt;- proxistat2(pts = pts[1:1000,], quadtree = localtree) </span>
 <span class="token comment">#</span>
 <span class="token comment"># summary(x$proximityscore)</span>
 <span class="token comment"># # analyze.stuff   pctiles(x$proximityscore)</span>
 <span class="token comment"># plot(x = x$lon, y = x$lat)</span>
 <span class="token comment"># tops = x$proximityscore &gt; 500 &amp; !is.infinite(x$proximityscore) &amp; !is.na(x$proximityscore)</span>
 <span class="token comment"># points(x = x$lon[tops], y = x$lat[tops], col="red")</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="quaddata">

<a href="#quaddata" class="help-page-title"><h2>data.table used to create index of all US block point locations</h2></a>

<h3>Description</h3>

<p>data.table used to create index of all US block point locations
</p>


<h3>Details</h3>

<p>8,174,955 rows when non-populated blocks are kept.
5,806,512 rows have Census 2020 population (and blockwt) &gt; 0.
This is the largest file used by the package, and is 168 MB as a file, for 2020 Census.
- blockid
- BLOCK_X, BLOCK_Y, BLOCK_Z  (not lat, lon)
</p>
<div class="sourceCode"><pre>localtree is the index made from quaddata  
(QuadTree class, via SearchTrees pkg), not a data.table
</pre></div>


<h3>See Also</h3>

<p><code><a href="#indexblocks">indexblocks()</a></code> <a href="#EJAM">EJAM</a>
</p>

<hr>
</div>
<div class="container manual-page" id="regionstats">

<a href="#regionstats" class="help-page-title"><h2>regionstats (DATA) (obsolete) data.table of 100 percentiles and means for each EPA Region.</h2></a>

<h3>Description</h3>

<p>data.table of 100 percentiles and means for each EPA Region (&gt; 1,000 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen.
</p>

<hr>
</div>
<div class="container manual-page" id="rmost">

<a href="#rmost" class="help-page-title"><h2>rmost - utility to rm(list=ls()) but not remove key datasets EJAM uses</h2></a>

<h3>Description</h3>

<p>rmost - utility to rm(list=ls()) but not remove key datasets EJAM uses
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rmost<span class="token punctuation">(</span>
  notremove <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"rmost"</span><span class="token punctuation">,</span> <span class="token string">"localtree"</span><span class="token punctuation">,</span> <span class="token string">"blockgroupstats"</span><span class="token punctuation">,</span> <span class="token string">"usastats"</span><span class="token punctuation">,</span> <span class="token string">"statestats"</span><span class="token punctuation">,</span>
    <span class="token string">"bgid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockid2fips"</span><span class="token punctuation">,</span> <span class="token string">"blockpoints"</span><span class="token punctuation">,</span> <span class="token string">"blockwts"</span><span class="token punctuation">,</span> <span class="token string">"quaddata"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="rrtable">

<a href="#rrtable" class="help-page-title"><h2>rrtable
Calculate risk ratios of avg E in group D / in everyone not in group D</h2></a>

<h3>Description</h3>

<p>rrtable
Calculate risk ratios of avg E in group D / in everyone not in group D
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rrtable<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>blockgroupstats</p>
</td>
</tr></table>
<h3>Value</h3>

<p>table of ratios and max per row and max per col
</p>

<hr>
</div>
<div class="container manual-page" id="run_app">

<a href="#run_app" class="help-page-title"><h2>run_app - Launch the Shiny Application in RStudio</h2></a>

<h3>Description</h3>

<p>launch Shiny web app from RStudio
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">run_app<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token string">"server"</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>onStart</code></td>
<td>
<p>A function that will be called before the app is actually run.
This is only needed for <code>shinyAppObj</code>, since in the <code>shinyAppDir</code>
case, a <code>global.R</code> file can be used for this purpose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Named options that should be passed to the <code>runApp</code> call
(these can be any of the following: "port", "launch.browser", "host", "quiet",
"display.mode" and "test.mode"). You can also specify <code>width</code> and
<code>height</code> parameters which provide a hint to the embedding environment
about the ideal height/width for the app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enableBookmarking</code></td>
<td>
<p>Can be one of <code>"url"</code>, <code>"server"</code>, or
<code>"disable"</code>. The default value, <code>NULL</code>, will respect the setting from
any previous calls to  <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>. See <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>
for more information on bookmarking your app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiPattern</code></td>
<td>
<p>A regular expression that will be applied to each <code>GET</code>
request to determine whether the <code>ui</code> should be used to handle the
request. Note that the entire request path must match the regular
expression in order for the match to be considered successful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to golem_opts. Maybe could be something like sitepoints="latlondata.xlsx" or sitepoints=<a href="#testpoints_100">testpoints_100</a>
See <code>?golem::get_golem_options</code> for more details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>app_run_EJAM()                 is like <code><a href="#app_run_EJAM">run_app()</a></code> from the EJAM package
</p>

<hr>
</div>
<div class="container manual-page" id="setdiff_yx">

<a href="#setdiff_yx" class="help-page-title"><h2>setdiff_yx
utility just like setdiff except for y,x instead of x,y</h2></a>

<h3>Description</h3>

<p>setdiff_yx
utility just like setdiff except for y,x instead of x,y
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">setdiff_yx<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="setdiff2">

<a href="#setdiff2" class="help-page-title"><h2>setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y</h2></a>

<h3>Description</h3>

<p>setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">setdiff2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="SIC">

<a href="#SIC" class="help-page-title"><h2>SIC (DATA) named list of all SIC code numbers and category name for each</h2></a>

<h3>Description</h3>

<p>SIC (DATA) named list of all SIC code numbers and category name for each
</p>


<h3>Details</h3>

<p>see <a href="https://siccode.com" target="_blank">https://siccode.com</a>
</p>


<h3>See Also</h3>

<p><a href="#SIC">SIC</a> <a href="#sictable">sictable</a> <code><a href="#sic_categories">sic_categories()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="sic_categories">

<a href="#sic_categories" class="help-page-title"><h2>sic_categories - See the names of SIC industrial categories and their codes
Easy way to view, in RStudio console, the SIC categories.
SIC all are 4-digit codes, like 7218 - Industrial launderers</h2></a>

<h3>Description</h3>

<p>sic_categories - See the names of SIC industrial categories and their codes
Easy way to view, in RStudio console, the SIC categories.
SIC all are 4-digit codes, like 7218 - Industrial launderers
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sic_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>


<h3>See Also</h3>

<p><a href="#SIC">SIC</a> <a href="#naics_categories">naics_categories</a>
</p>

<hr>
</div>
<div class="container manual-page" id="sic_from_any">

<a href="#sic_from_any" class="help-page-title"><h2>sic_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</h2></a>

<h3>Description</h3>

<p>sic_from_any - General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sic_from_any<span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_scrape <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_url <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>query string(s) and/or number(s), vector of NAICS codes or industry names or any regular expression or partial words</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_scrape</code></td>
<td>
<p>whether to scrape info from the NAICS website to return a table of codes and names that match (web query uses synonyms so gets more hits)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_url</code></td>
<td>
<p>whether to return the URL of the webpage with info on the NAICS (web query uses synonyms so gets more hits)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#sictable">sictable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#sic_subcodes_from_code">sic_subcodes_from_code()</a></code> <code><a href="#sic_from_code">sic_from_code()</a></code>  <code><a href="#sic_from_name">sic_from_name()</a></code>  <code><a href="#sic_from_any">sic_from_any()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="sic_from_code">

<a href="#sic_from_code" class="help-page-title"><h2>sic_from_code - search for industry names by SIC code(s), 4 digits each</h2></a>

<h3>Description</h3>

<p>sic_from_code - search for industry names by SIC code(s), 4 digits each
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sic_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>vector of character SIC codes. see <a href="https://siccode.com" target="_blank">https://siccode.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where SIC starts with the same digits</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#sictable">sictable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#sic_subcodes_from_code">sic_subcodes_from_code()</a></code> <code><a href="#sic_from_code">sic_from_code()</a></code>  <code><a href="#sic_from_name">sic_from_name()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="sic_from_name">

<a href="#sic_from_name" class="help-page-title"><h2>sic_from_name - search for industry names and SIC codes by query string
query by parts of words, etc. in the industry name.</h2></a>

<h3>Description</h3>

<p>sic_from_name - search for industry names and SIC codes by query string
query by parts of words, etc. in the industry name.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sic_from_name<span class="token punctuation">(</span>mynames<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mynames</code></td>
<td>
<p>query string, vector of SIC industry names or any regular expression or partial words. See <a href="https://siccode.com" target="_blank">https://siccode.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where SIC starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#sictable">sictable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#sic_subcodes_from_code">sic_subcodes_from_code()</a></code> <code><a href="#sic_from_code">sic_from_code()</a></code>  <code><a href="#sic_from_name">sic_from_name()</a></code>  <code><a href="#sic_from_any">sic_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">data.table<span class="token operator">::</span>fintersect<span class="token punctuation">(</span>sic_from_any<span class="token punctuation">(</span> <span class="token string">"glass"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sic_from_any<span class="token punctuation">(</span><span class="token string">"paint"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="sic_subcodes_from_code">

<a href="#sic_subcodes_from_code" class="help-page-title"><h2>sic_subcodes_from_code - find subcategories of the given overall SIC industry code(s)
Given 3-digit SIC code, for example, get all SIC that start with those digits.</h2></a>

<h3>Description</h3>

<p>sic_subcodes_from_code - find subcategories of the given overall SIC industry code(s)
Given 3-digit SIC code, for example, get all SIC that start with those digits.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sic_subcodes_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>SIC codes vector, of 2 to 4 digits each. See <a href="https://siccode.com" target="_blank">https://siccode.com</a></p>
</td>
</tr></table>
<h3>Details</h3>

<p>similar idea was naics2children() but this is more robust
See <code><a href="#sic_from_any">sic_from_any()</a></code> which uses this
</p>


<h3>Value</h3>

<p>a subset of the <a href="#sictable">sictable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#sic_subcodes_from_code">sic_subcodes_from_code()</a></code> <code><a href="#sic_from_code">sic_from_code()</a></code>  <code><a href="#sic_from_name">sic_from_name()</a></code>  <code><a href="#sic_from_any">sic_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># codes starting with '07'</span>
  sic_subcodes_from_code<span class="token punctuation">(</span><span class="token string">'07'</span><span class="token punctuation">)</span>
  <span class="token comment"># codes starting with '078'</span>
  sic_subcodes_from_code<span class="token punctuation">(</span><span class="token string">'078'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="sictable">

<a href="#sictable" class="help-page-title"><h2>sictable (DATA) data.table of SIC code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3, and 4-digit SIC that this code falls under, where relevant for given length</h2></a>

<h3>Description</h3>

<p>This is similar to the data file EJAM::SIC but in a more useful format and newer functions work with it.
</p>


<h3>Details</h3>

<p>see <a href="https://siccode.com" target="_blank">https://siccode.com</a>
</p>


<h3>See Also</h3>

<p><a href="#SIC">SIC</a> <a href="#sictable">sictable</a> <code><a href="#sic_categories">sic_categories()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="siteid_from_naics">

<a href="#siteid_from_naics" class="help-page-title"><h2>latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</h2></a>

<h3>Description</h3>

<p>latlon_from_naics - Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">siteid_from_naics<span class="token punctuation">(</span>naics<span class="token punctuation">,</span> id_only <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>a vector of naics codes, or
a data.table with column named code, as with output of <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr></table>
<h3>Details</h3>

<p>NOTE: many FRS sites lack NAICS code!
</p>
<p>Also, this function does not find the sites
identified by FRS data as being in a child NAICS (subcategory of your exact query)!
</p>
<p>Relies on  frs_by_naics (a data.table)
</p>
<p>See info about NAICS industry codes at <a href="https://www.naics.com/search" target="_blank">https://www.naics.com/search</a>
</p>


<h3>Value</h3>

<p>A data.table (not just data.frame) with columns called
lat, lon, REGISTRY_ID, NAICS (but see the id_only parameter)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">siteid_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  head<span class="token punctuation">(</span>latlon_from_naics<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3366</span><span class="token punctuation">,</span> <span class="token number">33661</span><span class="token punctuation">,</span> <span class="token number">336611</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id_only<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># mapfast(frs_from_naics(336611)) # simple map</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="siteid_from_sic">

<a href="#siteid_from_sic" class="help-page-title"><h2>latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)</h2></a>

<h3>Description</h3>

<p>latlon_from_sic - Find EPA-regulated facilities in FRS by SIC code (industrial category)
Get lat lon, Registry ID, given SIC industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact SIC code (not subcategories)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">siteid_from_sic<span class="token punctuation">(</span>sic<span class="token punctuation">,</span> id_only <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sic</code></td>
<td>
<p>a vector of SIC codes, or
a data.table with column named code, as with output of <code><a href="#sic_from_any">sic_from_any()</a></code></p>
</td>
</tr></table>
<h3>Details</h3>

<p>NOTE: many FRS sites lack SIC code!
</p>
<p>Also, this function does not find the sites
identified by FRS data as being in a child SIC (subcategory of your exact query)!
</p>
<p>Relies on  frs_by_sic (a data.table)
</p>
<p>See info about SIC industry codes at <a href="https://www.naics.com/search" target="_blank">https://www.naics.com/search</a>
</p>


<h3>Value</h3>

<p>A data.table (not just data.frame) with columns called
lat, lon, REGISTRY_ID, SIC (but see the id_only parameter)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">siteid_from_sic<span class="token punctuation">(</span><span class="token string">'7300'</span><span class="token punctuation">)</span>
  latlon_from_sic<span class="token punctuation">(</span><span class="token string">'7300'</span><span class="token punctuation">)</span>
  latlon_from_sic<span class="token punctuation">(</span>sic_from_any<span class="token punctuation">(</span><span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  head<span class="token punctuation">(</span>latlon_from_sic<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'6150'</span><span class="token punctuation">,</span> <span class="token string">'6300'</span><span class="token punctuation">,</span> <span class="token string">'5995'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id_only<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># mapfast(frs_from_sic('6150')) # simple map</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="sites2blocks_example1000pts_1miles">

<a href="#sites2blocks_example1000pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_1000, radius = 1)
This is the same as  <a href="#testoutput_getblocksnearby_1000pts_1miles">testoutput_getblocksnearby_1000pts_1miles</a>
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_1000">testpoints_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="sites2blocks_example100pts_1miles">

<a href="#sites2blocks_example100pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_100, radius = 1)
This is the same as  <a href="#testoutput_getblocksnearby_100pts_1miles">testoutput_getblocksnearby_100pts_1miles</a>
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_100">testpoints_100</a>
</p>

<hr>
</div>
<div class="container manual-page" id="sites2blocks_example10pts_1miles">

<a href="#sites2blocks_example10pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_10, radius = 1)
This is the same as  <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a>
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_10">testpoints_10</a>
</p>

<hr>
</div>
<div class="container manual-page" id="speedtable_expand">

<a href="#speedtable_expand" class="help-page-title"><h2>speedtable_expand
Utility used by speedtest() and speedtable_summarize()</h2></a>

<h3>Description</h3>

<p>speedtable_expand
Utility used by speedtest() and speedtable_summarize()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtable_expand<span class="token punctuation">(</span>speedtable<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>speedtable</code></td>
<td>
<p>must have columns called  points, miles, and perhr</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="speedtable_summarize">

<a href="#speedtable_summarize" class="help-page-title"><h2>speedtable_summarize
utility used by speedtest()</h2></a>

<h3>Description</h3>

<p>speedtable_summarize
utility used by speedtest()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtable_summarize<span class="token punctuation">(</span>speedtable<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>speedtable</code></td>
<td>
<p>from speedtest(), with columns named points and perhr</p>
</td>
</tr></table>
<h3>See Also</h3>

<p><code><a href="#speedtest">speedtest()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="speedtest">

<a href="#speedtest" class="help-page-title"><h2>speedtest
Run EJAM analysis for several radii and numbers of sitepoints,
recording how long each step takes</h2></a>

<h3>Description</h3>

<p>speedtest
Run EJAM analysis for several radii and numbers of sitepoints,
recording how long each step takes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtest<span class="token punctuation">(</span>
  n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  sitepoints <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  weighting <span class="token operator">=</span> <span class="token string">"frs"</span><span class="token punctuation">,</span>
  radii <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31.06856</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  test_ejamit <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  test_getblocksnearby <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  test_doaggregate <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  test_batch.summarize <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  logging <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  logfolder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  logfilename <span class="token operator">=</span> <span class="token string">"log_n_datetime.txt"</span><span class="token punctuation">,</span>
  honk_when_ready <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  saveoutput <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  getblocks_diagnostics_shown <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>optional, vector of 1 or more counts of how many random points to test, or
set to 0 to interactively pick file of points in RStudio (n is ignored if sitepoints provided)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>optional,  (use if you do not want random points) data.frame of points or
path/file with points, where columns are lat and lon in decimal degrees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>optional, if using random points, how to weight them,
such as facilities, people, or blockgroups. see <code><a href="#testpoints_n">testpoints_n()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radii</code></td>
<td>
<p>optional, one or more radius values in miles
to use in creating circular buffers when findings residents nearby each of sitepoints.
The default list includes one that is 5km (approx 3.1 miles)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearby">getblocksnearby()</a></code> or <code><a href="#ejamit">ejamit()</a></code> regarding this param</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_ejamit</code></td>
<td>
<p>whether to test only ejamit()
instead of its subcomponents like getblocksnearby(), doaggregate(), etc</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_getblocksnearby</code></td>
<td>
<p>whether to include this function in timing - not used because always done</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_doaggregate</code></td>
<td>
<p>whether to include this function in timing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_batch.summarize</code></td>
<td>
<p>whether to include this function in timing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logging</code></td>
<td>
<p>logical optional, whether to save log file with timings of steps.
NOTE this slows it down though.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfolder</code></td>
<td>
<p>optional, name of folder for log file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfilename</code></td>
<td>
<p>optional, name of log file to go in folder</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>honk_when_ready</code></td>
<td>
<p>optional, self-explanatory</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveoutput</code></td>
<td>
<p>but this slows it down if set to TRUE to save each run as .rda file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>whether to create plot of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>getblocks_diagnostics_shown</code></td>
<td>
<p>set TRUE to see more details on block counts etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to plotting function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is essentially a test script that times each step of EJAM for a large dataset
</p>

<ul>
<li>
<p> pick a sample size (n) (or enter sitepoints, or set n=0 to interactively pick file of points in RStudio)
</p>
</li>
<li>
<p> pick n random points
</p>
</li>
<li>
<p> pick a few different radii for circular buffering
</p>
</li>
<li>
<p> analyze indicators in circular buffers and overall (find blocks nearby and then calc indicators)
</p>
</li>
<li>
<p> get stats that summarize those indicators
</p>
</li>
<li>
<p> compare times between steps and radii and other approaches or tools
</p>
</li>
</ul>
<h3>Value</h3>

<p>EJAM results similar to as from the web app or <code><a href="#ejamit">ejamit()</a></code> and also creates a plot
</p>


<h3>See Also</h3>

<p><code><a href="#speedtest_plot">speedtest_plot()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run:  </span>
  speedseen_few <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logging<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
  
  speedseen_nearer_to1k <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1e2</span><span class="token punctuation">,</span><span class="token number">1e3</span><span class="token punctuation">,</span><span class="token number">1e4</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
    logging<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
  save<span class="token punctuation">(</span> speedseen_nearer_to1k<span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"~/../Downloads/speedseen_nearer_to1k.rda"</span><span class="token punctuation">)</span>
  rstudioapi<span class="token operator">::</span>savePlotAsImage<span class="token punctuation">(</span>        <span class="token string">"~/../Downloads/speedseen_nearer_to1k.png"</span><span class="token punctuation">)</span>
  
  speedseen_all <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>
    n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1e2</span><span class="token punctuation">,</span><span class="token number">1e3</span><span class="token punctuation">,</span><span class="token number">1e4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31.06856</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    logging<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">TRUE</span>
  <span class="token punctuation">)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="speedtest_plot">

<a href="#speedtest_plot" class="help-page-title"><h2>speedtest_plot
utility to plot output of speedtest(), rate of points analyzed per hour</h2></a>

<h3>Description</h3>

<p>speedtest_plot
utility to plot output of speedtest(), rate of points analyzed per hour
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtest_plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ltype <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">,</span> plotfile <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> secondsperthousand <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>table from speedtest()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ltype</code></td>
<td>
<p>optional type of line for plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotfile</code></td>
<td>
<p>optional path and filename of .png image file to save</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>side effect is a plot. returns x but with seconds column added to it
</p>


<h3>See Also</h3>

<p><code><a href="#speedtest">speedtest()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="ST_by_site_from_sites2blocks">

<a href="#ST_by_site_from_sites2blocks" class="help-page-title"><h2>ST_by_site_from_sites2blocks - Get State that each site is in, from a table of siteid, blockid, distance</h2></a>

<h3>Description</h3>

<p>Find the 2-character State abbreviation for each site. This is for when you need to know
the state each site is in, to be able to report state percentiles, but you do not have
the original list of siteid lat/lon or State info. This can infer the State
each site is located in, based on the state of the nearest block (and its parent blockgroup).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ST_by_site_from_sites2blocks<span class="token punctuation">(</span>sites2blocks<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>data.table or data.frame, like <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a>,
from <code><a href="#getblocksnearby">getblocksnearby()</a></code> that has columns siteid and blockid and distance</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns  siteid, ST
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  fname <span class="token operator">=</span> <span class="token string">'./inst/testdata/testpoints_207_sites_with_signif_violations_NAICS_326_ECHO.csv'</span>
  x <span class="token operator">=</span> ST_by_site_from_sites2blocks<span class="token punctuation">(</span>
    getblocksnearby<span class="token punctuation">(</span> latlon_from_anything<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">,</span> quadtree <span class="token operator">=</span> localtree<span class="token punctuation">)</span><span class="token punctuation">)</span>
  y <span class="token operator">=</span> read_csv_or_xl<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
  x<span class="token operator">$</span>ST <span class="token operator">==</span> y<span class="token operator">$</span>FacState
  
<span class="token comment">## End(Not run)</span>
  ST_by_site_from_sites2blocks<span class="token punctuation">(</span>testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_blockid">

<a href="#state_from_blockid" class="help-page-title"><h2>state_from_blockid
given vector of blockids, get state abbreviation of each</h2></a>

<h3>Description</h3>

<p>state_from_blockid
given vector of blockids, get state abbreviation of each
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_blockid<span class="token punctuation">(</span>blockid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>blockid</code></td>
<td>
<p>vector of blockid values as from EJAM in a table called blockpoints</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of ST info like AK, CA, DE, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">state_from_blockid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">8174952</span><span class="token punctuation">,</span> blockpoints<span class="token operator">$</span>blockid<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_blocktable">

<a href="#state_from_blocktable" class="help-page-title"><h2>state_from_blocktable
given data.table with blockid column, get state abbreviation of each</h2></a>

<h3>Description</h3>

<p>state_from_blocktable
given data.table with blockid column, get state abbreviation of each
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_blocktable<span class="token punctuation">(</span>dt_with_blockid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>dt_with_blockid</code></td>
<td>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of ST info like AK, CA, DE, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">state_from_blocktable<span class="token punctuation">(</span>blockpoints<span class="token punctuation">[</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_fips">

<a href="#state_from_fips" class="help-page-title"><h2>state_from_fips
Get the State abbreviations of all blockgroups within the input FIPS</h2></a>

<h3>Description</h3>

<p>state_from_fips
Get the State abbreviations of all blockgroups within the input FIPS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_fips<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> uniqueonly <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Census FIPS codes vector, numeric or char, 2-digit, 5-digit, etc. OK</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uniqueonly</code></td>
<td>
<p>If set to TRUE, returns only unique results.
This parameter is here mostly to remind user that default is not uniques only.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Returns a vector of 2-letter State abbreviations that is
one per blockgroup that matches the input FIPS,
not necessarily a vector as long as the input vector of FIPS codes!,
and not just a short list of unique states!
</p>


<h3>Value</h3>

<p>vector of 2-character state abbreviations like CA,CA,CA,MD,MD,TX
</p>

<hr>
</div>
<div class="container manual-page" id="state_from_latlon">

<a href="#state_from_latlon" class="help-page-title"><h2>state_from_latlon - find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful</h2></a>

<h3>Description</h3>

<p>state_from_latlon - find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_latlon<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> states_shapefile <span class="token operator">=</span> EJAM<span class="token operator">::</span>states_shapefile<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>latitudes vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>longitudes vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shapefile</code></td>
<td>
<p>shapefile of US States, in package already</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns data.frame: ST, statename, FIPS.ST, REGION, n
as many rows as elements in lat or lon
</p>


<h3>See Also</h3>

<p><a href="#states_shapefile">states_shapefile</a> <code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#states_infer">states_infer()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">myprogram <span class="token operator">&lt;-</span> <span class="token string">"CAMDBS"</span> <span class="token comment"># 739 sites</span>
 pts <span class="token operator">&lt;-</span> frs_from_program<span class="token punctuation">(</span>myprogram<span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> REGISTRY_ID<span class="token punctuation">,</span>  PRIMARY_NAME<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment"># add a column with State abbreviation</span>
 pts<span class="token punctuation">[</span><span class="token punctuation">,</span> ST <span class="token operator">:</span><span class="token operator">=</span> state_from_latlon<span class="token punctuation">(</span>lat<span class="token operator">=</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span> lon<span class="token punctuation">)</span><span class="token operator">$</span>ST<span class="token punctuation">]</span>
 <span class="token comment">#map these points</span>
 mapfast<span class="token punctuation">(</span>pts<span class="token punctuation">[</span>ST <span class="token operator">==</span> <span class="token string">'TX'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 1 miles radius circles</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="stateinfo">

<a href="#stateinfo" class="help-page-title"><h2>stateinfo (DATA) data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</h2></a>

<h3>Description</h3>

<p>52 rows and a few variables: ST is the 2-letter abbreviation,
statename is the State name, etc.
</p>


<h3>Details</h3>

<p>Created for EJAM by datacreate_stateinfo.R script
</p>
<p>Also see <a href="https://www.census.gov/programs-surveys/decennial-census/decade/2020/planning-management/release/2020-island-areas-data-products.html" target="_blank">https://www.census.gov/programs-surveys/decennial-census/decade/2020/planning-management/release/2020-island-areas-data-products.html</a>
</p>
<p>column names: "ST"  "statename"  "ftpname"   "FIPS.ST"   "REGION"
</p>
<p>Some datasets lack PR. (72)
</p>
<p>Many datasets lack these:  AS, GU, MP, VI (codes "60" "66" "69" "78")
</p>
<p>Almost all datasets lack UM. (74)
</p>
<div class="sourceCode"><pre>    72 PR                 Puerto Rico
    
    66 GU                        Guam 
    
    69 MP    Northern Mariana Islands  
    
    78 VI         U.S. Virgin Islands 
    
    74 UM U.S. Minor Outlying Islands  
</pre></div>


<h3>See Also</h3>

<p><a href="#stateinfo2">stateinfo2</a> for more columns
</p>

<hr>
</div>
<div class="container manual-page" id="stateinfo2">

<a href="#stateinfo2" class="help-page-title"><h2>stateinfo2 (DATA) data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</h2></a>

<h3>Description</h3>

<p>52 rows and several variables: ST is the 2-letter abbreviation,
statename is the State name, etc.
</p>


<h3>Details</h3>

<p>Created for EJAM by datacreate_stateinfo2.R script
</p>
<p>Also see <a href="https://www.census.gov/programs-surveys/decennial-census/decade/2020/planning-management/release/2020-island-areas-data-products.html" target="_blank">https://www.census.gov/programs-surveys/decennial-census/decade/2020/planning-management/release/2020-island-areas-data-products.html</a>
</p>
<p>column names:
</p>
<p>c("statename", "FIPS.ST", "ST", "ftpname", "REGION",
</p>
<p>"is.usa.plus.pr", "is.usa", "is.state", "is.contiguous.us", "is.island.areas",
</p>
<p>"area.sqmi", "area.sqkm",
</p>
<p>"landarea.sqmi", "landarea.sqkm",
</p>
<p>"waterarea.sqmi", "waterarea.sqkm",
</p>
<p>"inland.sqmi", "inland.sqkm",
</p>
<p>"coastal.sqmi", coastal.sqkm",
</p>
<p>"greatlakes.sqmi", "greatlakes.sqkm",
</p>
<p>"territorial.sqmi", "territorial.sqkm",
</p>
<p>"lat", "lon")
</p>
<p>Some datasets lack PR. (72)
</p>
<p>Many datasets lack these:  AS, GU, MP, VI (codes "60" "66" "69" "78")
</p>
<p>Almost all datasets lack UM. (74)
</p>
<div class="sourceCode"><pre>    72 PR                 Puerto Rico
    
    66 GU                        Guam 
    
    69 MP    Northern Mariana Islands  
    
    78 VI         U.S. Virgin Islands 
    
    74 UM U.S. Minor Outlying Islands  
</pre></div>


<h3>See Also</h3>

<p><a href="#stateinfo">stateinfo</a>  for fewer columns
</p>

<hr>
</div>
<div class="container manual-page" id="states_infer">

<a href="#states_infer" class="help-page-title"><h2>states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS</h2></a>

<h3>Description</h3>

<p>states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">states_infer<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame or data.table with either ST column or lat and lon columns, or FIPS,
and optionally a column with siteid or column called n</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.frame with unique siteid, ST, etc.
</p>


<h3>See Also</h3>

<p><code><a href="#state_from_latlon">state_from_latlon()</a></code> <code><a href="#state_from_fips">state_from_fips()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="states_shapefile">

<a href="#states_shapefile" class="help-page-title"><h2>states_shapefile (DATA) US States boundaries 2020 shapefile from TIGER</h2></a>

<h3>Description</h3>

<p>This is used to figure out which state contains each point (facility/site).
</p>


<h3>Details</h3>

<p>This is used by <code><a href="#state_from_latlon">state_from_latlon()</a></code> to find which state is associated with each point
that the user wants to analyze. That is needed to report indicators in
the form of State-specific percentiles
(e.g., a score that is at the 80th percentile within Texas).
It is created by the package via a script at EJAM/data-raw/datacreate_states_shapefile.R
which downloads the data from Census Bureau.
</p>


<h3>See Also</h3>

<p><code><a href="#state_from_latlon">state_from_latlon()</a></code> <code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="statestats">

<a href="#statestats" class="help-page-title"><h2>statestats (DATA) data.frame of 100 percentiles and means for each US State and PR and DC.</h2></a>

<h3>Description</h3>

<p>data.frame of 100 percentiles and means
for each US State and PR and DC (approx 5,300 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen,
except it also has data for the demographic race/ethnicity subgroups.
For details on how the table was made, see /EJAM/data-raw/usastats_subgroups.R
</p>

<hr>
</div>
<div class="container manual-page" id="statestats_query">

<a href="#statestats_query" class="help-page-title"><h2>statestats_query - convenient way to see mean, pctiles of Env or Demog indicators from lookup table</h2></a>

<h3>Description</h3>

<p>statestats_query - convenient way to see mean, pctiles of Env or Demog indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_query<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations, or USA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="statestats_queryd">

<a href="#statestats_queryd" class="help-page-title"><h2>statestats_queryd - convenient way to see mean, pctiles of DEMOG indicators from lookup table</h2></a>

<h3>Description</h3>

<p>statestats_queryd - convenient way to see mean, pctiles of DEMOG indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_queryd<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations, or USA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="statestats_querye">

<a href="#statestats_querye" class="help-page-title"><h2>statestats_querye - convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table</h2></a>

<h3>Description</h3>

<p>statestats_querye - convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_querye<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr></table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="structure.of.output.list">

<a href="#structure.of.output.list" class="help-page-title"><h2>structure.of.output.list - See info about list of results
Utility to print summary info about the output of ejamit or doaggregate</h2></a>

<h3>Description</h3>

<p>structure.of.output.list - See info about list of results
Utility to print summary info about the output of ejamit or doaggregate
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">structure.of.output.list<span class="token punctuation">(</span>x<span class="token punctuation">,</span> maxshown <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the output of ejamit() or of doaggregate(),
a list of objects holding results of analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxshown</code></td>
<td>
<p>shows only first 10 elements of list by default</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame summarizing names of list, whether each element is a
data.table, data.frame, or vector, and rows/cols/length info
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">structure.of.output.list<span class="token punctuation">(</span>testpoints_10<span class="token punctuation">)</span>
  structure.of.output.list<span class="token punctuation">(</span>testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">)</span>
  structure.of.output.list<span class="token punctuation">(</span>testoutput_doaggregate_10pts_1miles<span class="token punctuation">)</span>
  structure.of.output.list<span class="token punctuation">(</span>testoutput_ejamit_10pts_1miles<span class="token punctuation">)</span>
  structure.of.output.list<span class="token punctuation">(</span>testoutput_ejscreenapi_plus_5<span class="token punctuation">)</span>
  structure.of.output.list<span class="token punctuation">(</span>testoutput_ejscreenit_5<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="tablefixed">

<a href="#tablefixed" class="help-page-title"><h2>tablefixed - Table of counts of integer values zero through maxbin</h2></a>

<h3>Description</h3>

<p>Like tabulate or table, sort of, but includes zero unlike tabulate,
and lets you ensure results include every integer 0 through maxbin,
so you can, for example, easily combine tables of counts where some
did not include all integers.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">tablefixed<span class="token punctuation">(</span>x<span class="token punctuation">,</span> maxbin <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of integers, like counts, that can include 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxbin</code></td>
<td>
<p>highest integer among x, or number of bins</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>There is likely a more efficient way to do this in some existing package,
but this is useful and fast enough.
</p>
<p>When using a dataset like EJScreen with 13 indicators of interest,
and counting how many of the 13 are above various cutpoints,
there may be zero rows that have exactly 8 above some cutoff, for example.
</p>
<p>This function makes it easier to combine those tables into a summary
where 0-13 are in each table while table() would only return integers
that came up in a given case (for one cutoff).
</p>


<h3>Value</h3>

<p>summary table
</p>


<h3>See Also</h3>

<p>colcounter_summary()
</p>

<hr>
</div>
<div class="container manual-page" id="test_regid">

<a href="#test_regid" class="help-page-title"><h2>test_regid (DATA) test data, vector of EPA FRS Registry ID numbers</h2></a>

<h3>Description</h3>

<p>test_regid (DATA) test data, vector of EPA FRS Registry ID numbers
</p>


<h3>Details</h3>

<p>For testing, e.g.,
</p>
<p>frs_from_siteid(test_regid)
</p>
<p>mapfast(  frs_from_regid(test_regid)  )
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_doaggregate_1000pts_1miles">

<a href="#testoutput_doaggregate_1000pts_1miles" class="help-page-title"><h2>test output of doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of doaggregate(testoutput_getblocksnearby_1000pts_1miles, sites2states_or_latlon = testpoints_1000, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_getblocksnearby_1000pts_1miles">testoutput_getblocksnearby_1000pts_1miles</a> <a href="#testpoints_1000">testpoints_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_doaggregate_100pts_1miles">

<a href="#testoutput_doaggregate_100pts_1miles" class="help-page-title"><h2>test output of doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of doaggregate(testoutput_getblocksnearby_100pts_1miles, sites2states_or_latlon = testpoints_100, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_getblocksnearby_100pts_1miles">testoutput_getblocksnearby_100pts_1miles</a> <a href="#testpoints_100">testpoints_100</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_doaggregate_10pts_1miles">

<a href="#testoutput_doaggregate_10pts_1miles" class="help-page-title"><h2>test output of doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of doaggregate(testoutput_getblocksnearby_10pts_1miles, sites2states_or_latlon = testpoints_10, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a> <a href="#testpoints_10">testpoints_10</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_ejamit_1000pts_1miles">

<a href="#testoutput_ejamit_1000pts_1miles" class="help-page-title"><h2>test output of ejamit()</h2></a>

<h3>Description</h3>

<p>test output of ejamit()
</p>


<h3>Details</h3>

<p>This is the output of ejamit(testpoints_1000, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_doaggregate_1000pts_1miles">testoutput_doaggregate_1000pts_1miles</a> <a href="#testpoints_1000">testpoints_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_ejamit_100pts_1miles">

<a href="#testoutput_ejamit_100pts_1miles" class="help-page-title"><h2>test output of ejamit()</h2></a>

<h3>Description</h3>

<p>test output of ejamit()
</p>


<h3>Details</h3>

<p>This is the output of ejamit( testpoints_100, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_doaggregate_100pts_1miles">testoutput_doaggregate_100pts_1miles</a> <a href="#testpoints_100">testpoints_100</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_ejamit_10pts_1miles">

<a href="#testoutput_ejamit_10pts_1miles" class="help-page-title"><h2>test output of ejamit()</h2></a>

<h3>Description</h3>

<p>test output of ejamit()
</p>


<h3>Details</h3>

<p>This is the output of ejamit( testpoints_10, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#doaggregate">doaggregate()</a></code> <code><a href="#ejamit">ejamit()</a></code> <a href="#testoutput_doaggregate_10pts_1miles">testoutput_doaggregate_10pts_1miles</a> <a href="#testpoints_10">testpoints_10</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_getblocksnearby_1000pts_1miles">

<a href="#testoutput_getblocksnearby_1000pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_1000, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_1000">testpoints_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_getblocksnearby_100pts_1miles">

<a href="#testoutput_getblocksnearby_100pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_100, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_100">testpoints_100</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testoutput_getblocksnearby_10pts_1miles">

<a href="#testoutput_getblocksnearby_10pts_1miles" class="help-page-title"><h2>test output of getblocksnearby(), and is an input to doaggregate()</h2></a>

<h3>Description</h3>

<p>test output of getblocksnearby(), and is an input to doaggregate()
</p>


<h3>Details</h3>

<p>This is the output of getblocksnearby(testpoints_10, radius = 1)
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>  <code><a href="#doaggregate">doaggregate()</a></code>  <a href="#testpoints_10">testpoints_10</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_10">

<a href="#testpoints_10" class="help-page-title"><h2>test points data.frame with columns siteid, lat, lon</h2></a>

<h3>Description</h3>

<p>test points data.frame with columns siteid, lat, lon
</p>
<p>test points data.frame with columns siteid, lat, lon
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_100">

<a href="#testpoints_100" class="help-page-title"><h2>test points data.frame with columns siteid, lat, lon</h2></a>

<h3>Description</h3>

<p>test points data.frame with columns siteid, lat, lon
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_1000">

<a href="#testpoints_1000" class="help-page-title"><h2>test points data.frame with columns siteid, lat, lon</h2></a>

<h3>Description</h3>

<p>test points data.frame with columns siteid, lat, lon
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_10000">

<a href="#testpoints_10000" class="help-page-title"><h2>test points data.frame with columns siteid, lat, lon</h2></a>

<h3>Description</h3>

<p>test points data.frame with columns siteid, lat, lon
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_n">

<a href="#testpoints_n" class="help-page-title"><h2>testpoints_n - Random points in USA - average resident, facility, BG, block, or square mile
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.</h2></a>

<h3>Description</h3>

<p>testpoints_n - Random points in USA - average resident, facility, BG, block, or square mile
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_n<span class="token punctuation">(</span>
  n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  weighting <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"frs"</span><span class="token punctuation">,</span> <span class="token string">"pop"</span><span class="token punctuation">,</span> <span class="token string">"area"</span><span class="token punctuation">,</span> <span class="token string">"bg"</span><span class="token punctuation">,</span> <span class="token string">"block"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  dt <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  ST_of_blockgroup <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of points needed (sample size)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>word indicating how to weight the random points (some synonyms are allowed, in addition to those shown here):
</p>
<p>Note the default is frs, but you may want to use pop even though it is slower.
</p>

<ul>
<li>
<p> pop or people = Average Person: random person among all US residents (block point of residence per 2020 Census)
</p>
</li>
<li>
<p> frs or facility = Average Facility: random EPA-regulated facility from actives in Facility Registry Service (FRS)
</p>
</li>
<li>
<p> bg = Average Blockgroup: random US Census block group (internal point like a centroid)
</p>
</li>
<li>
<p> block = Average Block: random US Census block (internal point like a centroid)
</p>
</li>
<li>
<p> area or place = Average Place: random point on a map (internal point of avg blockgroup weighted by its square meters size)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt</code></td>
<td>
<p>logical, whether to return a data.table (DEFAULT) instead of normal data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ST_of_blockgroup</code></td>
<td>
<p>optional, can be a character vector of 2 letter State abbreviations to pick from only some States.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame or data.table with columns lat, lon in decimal degrees, and
any other columns that are in the table used (based on weighting)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
mapfast<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> ST_of_blockgroup <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'LA'</span><span class="token punctuation">,</span><span class="token string">'MS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
n<span class="token operator">=</span><span class="token number">2</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>d <span class="token keyword">in</span> c<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>w <span class="token keyword">in</span> c<span class="token punctuation">(</span><span class="token string">'frs'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'area'</span><span class="token punctuation">,</span> <span class="token string">'bg'</span><span class="token punctuation">,</span> <span class="token string">'block'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span><span class="token string">"n="</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span><span class="token string">"  weighting="</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span> <span class="token string">"  dt="</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>x <span class="token operator">&lt;-</span> testpoints_n<span class="token punctuation">(</span>n<span class="token punctuation">,</span>w<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> print<span class="token punctuation">(</span>class<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cat<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="trilaterate_sites2blocks">

<a href="#trilaterate_sites2blocks" class="help-page-title"><h2>trilaterate_sites2blocks - Estimate lat,lon of each siteid, from outputs of getblocksnearby()
get data.table with siteid, lat,lon of each site (eg for when you did not save sitepoints info)</h2></a>

<h3>Description</h3>

<p>trilaterate_sites2blocks - Estimate lat,lon of each siteid, from outputs of getblocksnearby()
get data.table with siteid, lat,lon of each site (eg for when you did not save sitepoints info)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">trilaterate_sites2blocks<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>s2b</code></td>
<td>
<p>like <a href="#testoutput_getblocksnearby_10pts_1miles">testoutput_getblocksnearby_10pts_1miles</a></p>
</td>
</tr></table>
<h3>Value</h3>

<p>a data.table with one row per unique siteid from input dt,
plus lat,lon columns
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">s2b <span class="token operator">=</span> copy<span class="token punctuation">(</span>testoutput_getblocksnearby_10pts_1miles<span class="token punctuation">)</span>
s2b_located <span class="token operator">=</span> latlon_join_on_blockid<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span> <span class="token comment"># done by trilaterate also</span>
inferred_sites <span class="token operator">=</span> trilaterate_sites2blocks<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span>
inferred_sites
plotblocksnearby<span class="token punctuation">(</span>s2b_located<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="unshared">

<a href="#unshared" class="help-page-title"><h2>setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y</h2></a>

<h3>Description</h3>

<p>setdiff2 aka unshared
utility just like setdiff except for y,x and also x,y
Just shows which elements are in one and only one of the sets x and y
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">unshared<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_4table">

<a href="#url_4table" class="help-page-title"><h2>url_4table - Create URLs in columns</h2></a>

<h3>Description</h3>

<p>url_4table - Create URLs in columns
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_4table<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> regid <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> as_html <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>vector of longitudes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>vector of values for radius in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regid</code></td>
<td>
<p>vector of FRS registry IDs if available to use to create links to detailed ECHO facility reports</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_html</code></td>
<td>
<p>logical</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>list of data.frames to append to the list of data.frames created by ejamit() or doaggregate(),
list(results_bysite = results_bysite, results_overall = results_overall, newcolnames=newcolnames)
</p>


<h3>See Also</h3>

<p>url_ejscreen_report() url_ejscreenmap() url_echo_facility_webpage() from EJAMejscreenapi package
</p>

<hr>
</div>
<div class="container manual-page" id="url_bookmark_save">

<a href="#url_bookmark_save" class="help-page-title"><h2>url_bookmark_save
save bookmarked EJScreen session (map location and indicator)</h2></a>

<h3>Description</h3>

<p>url_bookmark_save
save bookmarked EJScreen session (map location and indicator)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_bookmark_save<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"ejscreenbookmark.json"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#url_bookmark_text">url_bookmark_text()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>path and name of .json file you want to save locally</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WORK IN PROGRESS - NOT USED AS OF EARLY 2023.
You can use this function to create and save a json file that is a bookmark
for a specific place/ map view/ data layer in EJScreen.
You can later pull up that exact map in EJScreen by launching EJScreen,
clicking Tools, Save Session, Load from File.
</p>
<p>***Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100
</p>
<p>Note:
(1) The number of sessions that can be saved depends on the browser cache size.
(2) Session files, if saved, are available from the default Downloads folder on your computer.
(3) Users should exercise caution when saving sessions that may contain sensitive or confidential data.
</p>


<h3>Value</h3>

<p>URL for 1 bookmarked EJScreen map location and variable displayed on map
</p>

<hr>
</div>
<div class="container manual-page" id="url_bookmark_text">

<a href="#url_bookmark_text" class="help-page-title"><h2>url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)</h2></a>

<h3>Description</h3>

<p>url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_bookmark_text<span class="token punctuation">(</span>
  x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">13232599.1784247</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">13085305.0249191</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  y <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3970069.24597194</span><span class="token punctuation">,</span> <span class="token number">4067373.582979</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name <span class="token operator">=</span> <span class="token string">"BookmarkedEJScreenMap"</span><span class="token punctuation">,</span>
  title <span class="token operator">=</span> <span class="token string">"Socioeconomic Indicators"</span><span class="token punctuation">,</span>
  renderField <span class="token operator">=</span> <span class="token string">"B_UNEMPPCT"</span><span class="token punctuation">,</span>
  pctlevel <span class="token operator">=</span> <span class="token string">"nation"</span><span class="token punctuation">,</span>
  xmin <span class="token operator">=</span> <span class="token number">1.1</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  xmax <span class="token operator">=</span> <span class="token number">0.9</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  ymin <span class="token operator">=</span> <span class="token number">0.9</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
  ymax <span class="token operator">=</span> <span class="token number">1.1</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
  urlrest <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">"https://geopub.epa.gov/arcgis/rest/services"</span><span class="token punctuation">,</span>
    <span class="token string">"/ejscreen/ejscreen_v2022_with_AS_CNMI_GU_VI/MapServer"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of approx topleft, bottomright longitudes in some units EJScreen uses?
Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>vector of approx topleft, bottomright latitudes in some units EJScreen uses?
Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>Your name for the map bookmark</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>Your name for the map like Socioeconomic Indicators  or  Pollution and Sources</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>renderField</code></td>
<td>
<p>name of variable shown on map, like B_UNEMPPCT for map color bins of percent unemployed
or B_PTRAF for traffic indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pctlevel</code></td>
<td>
<p>nation or state</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmin</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmax</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ymin</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ymax</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urlrest</code></td>
<td>
<p>Just use the default but it changes each year</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WORK IN PROGRESS - NOT USED AS OF EARLY 2023.
You can use this function to create and save a json file that is a bookmark
for a specific place/ map view/ data layer in EJScreen.
You can later pull up that exact map in EJScreen by launching EJScreen,
clicking Tools, Save Session, Load from File.
</p>
<p>Note:
(1) The number of sessions that can be saved depends on the browser cache size.
(2) Session files, if saved, are available from the default Downloads folder on your computer.
(3) Users should exercise caution when saving sessions that may contain sensitive or confidential data.
</p>


<h3>Value</h3>

<p>URL for 1 bookmarked EJScreen map location and variable displayed on map
</p>


<h3>See Also</h3>

<p><code><a href="#url_bookmark_save">url_bookmark_save()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  url_bookmark_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
  url_bookmark_save<span class="token punctuation">(</span>
    x<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10173158.179197036</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10128824.702791695</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    y<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">3548990.034736070</span><span class="token punctuation">,</span><span class="token number">3579297.316451102</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    file<span class="token operator">=</span><span class="token string">"./mysavedejscreensession1.json"</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_get_eparest_chunked_by_id">

<a href="#url_get_eparest_chunked_by_id" class="help-page-title"><h2>url_get_eparest_chunked_by_id - experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</h2></a>

<h3>Description</h3>

<p>url_get_eparest_chunked_by_id - experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_get_eparest_chunked_by_id<span class="token punctuation">(</span>objectIds<span class="token punctuation">,</span> chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a table
</p>

<hr>
</div>
<div class="container manual-page" id="url_get_via_url">

<a href="#url_get_via_url" class="help-page-title"><h2>url_get_via_url - helper function work in progress: GET json via url of ejscreen ejquery map services</h2></a>

<h3>Description</h3>

<p>url_get_via_url - helper function work in progress: GET json via url of ejscreen ejquery map services
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_get_via_url<span class="token punctuation">(</span>url<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>the url for an EJScreen ejquery request</p>
</td>
</tr></table>
<h3>Value</h3>

<p>json
</p>

<hr>
</div>
<div class="container manual-page" id="url_getacs_epaquery">

<a href="#url_getacs_epaquery" class="help-page-title"><h2>url_getacs_epaquery - experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</h2></a>

<h3>Description</h3>

<p>uses ACS2019 rest services ejscreen ejquery MapServer 7
</p>
<p>Documentation of format and examples of input parameters:
</p>
<p><a href="https://geopub.epa.gov/arcgis/sdk/rest/index.html#/Query_Map_Service_Layer/02ss0000000r000000/" target="_blank">https://geopub.epa.gov/arcgis/sdk/rest/index.html#/Query_Map_Service_Layer/02ss0000000r000000/</a>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API. eg "STCNTRBG","TOTALPOP","PCT_HISP",</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>if TRUE, returns url instead of default making API request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery_chunked()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery<span class="token punctuation">(</span>justurl<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_getacs_epaquery_chunked">

<a href="#url_getacs_epaquery_chunked" class="help-page-title"><h2>url_getacs_epaquery_chunked - experimental/ work in progress: in chunks, get ACS data via EPA API</h2></a>

<h3>Description</h3>

<p>url_getacs_epaquery_chunked - experimental/ work in progress: in chunks, get ACS data via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery_chunked<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>eg 200 for chunks of 200 each request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token comment"># x &lt;- list() # chunked chunks. best not to ask for all these:</span>
 <span class="token comment"># x[[1]] &lt;- url_getacs_epaquery_chunked(   1:1000, chunksize = 100)</span>
 <span class="token comment"># x[[2]] &lt;- url_getacs_epaquery_chunked(1001:5000, chunksize = 100)</span>
 <span class="token comment"># xall &lt;- do.call(rbind, x)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_naics.com">

<a href="#url_naics.com" class="help-page-title"><h2>url_naics.com - Get URL for page with info about industry sectors by text query term
See (https://naics.com) for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>url_naics.com - Get URL for page with info about industry sectors by text query term
See (https://naics.com) for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_naics.com<span class="token punctuation">(</span>query<span class="token punctuation">,</span> as_html <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> linktext<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>string query term like "gasoline" or "copper smelting"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_html</code></td>
<td>
<p>Whether to return as just the urls or as html hyperlinks to use in a DT::datatable() for example</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linktext</code></td>
<td>
<p>used as text for hyperlinks, if supplied and as_html=TRUE</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>URL as string
</p>

<hr>
</div>
<div class="container manual-page" id="usastats">

<a href="#usastats" class="help-page-title"><h2>usastats (DATA) data.frame of 100 percentiles and means</h2></a>

<h3>Description</h3>

<p>data.frame of 100 percentiles and means (about 100 rows)
in the USA overall, across all locations (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen,
except it also has data for the demographic race/ethnicity subgroups.
For details on how the table was made, see /EJAM/data-raw/usastats_subgroups.R
</p>

<hr>
</div>
<div class="container manual-page" id="usastats_means">

<a href="#usastats_means" class="help-page-title"><h2>usastats_means - convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table</h2></a>

<h3>Description</h3>

<p>usastats_means - convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_means<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code><a href="#usastats_query">usastats_query</a></code>
</p>

<dl>
<dt><code>varnames</code></dt>
<dd>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</dd>
<dt><code>PCTILES</code></dt>
<dd>
<p>vector of percentiles 0-100 and/or "mean"</p>
</dd>
<dt><code>dig</code></dt>
<dd>
<p>how many digits to round to</p>
</dd>
</dl>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="usastats_query">

<a href="#usastats_query" class="help-page-title"><h2>usastats_query - convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table</h2></a>

<h3>Description</h3>

<p>usastats_query - convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_query<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="usastats_queryd">

<a href="#usastats_queryd" class="help-page-title"><h2>usastats_queryd - convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table</h2></a>

<h3>Description</h3>

<p>usastats_queryd - convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_queryd<span class="token punctuation">(</span>varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span> PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="usastats_querye">

<a href="#usastats_querye" class="help-page-title"><h2>usastats_querye - convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table</h2></a>

<h3>Description</h3>

<p>usastats_querye - convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_querye<span class="token punctuation">(</span>varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#  ustotals2 is from EJAMbatch.summarizer package</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="varname2color_ejam">

<a href="#varname2color_ejam" class="help-page-title"><h2>varname2color_ejam - helper function - for color coding excel sheet columns
Convert R variable name of indicator to appropriate color for header row in Excel</h2></a>

<h3>Description</h3>

<p>varname2color_ejam - helper function - for color coding excel sheet columns
Convert R variable name of indicator to appropriate color for header row in Excel
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">varname2color_ejam<span class="token punctuation">(</span>varname<span class="token punctuation">,</span> varnameinfo<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>things like us.avg.pctlowinc</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of colors
</p>


<h3>See Also</h3>

<p><code><a href="#varname2vartype_ejam">varname2vartype_ejam()</a></code> <code><a href="#varname2varcategory_ejam">varname2varcategory_ejam()</a></code> <code><a href="#vartype_cat2color_ejam">vartype_cat2color_ejam()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="varname2varcategory_ejam">

<a href="#varname2varcategory_ejam" class="help-page-title"><h2>varname2varcategory_ejam - helper function - given indicator names, look up what category each is</h2></a>

<h3>Description</h3>

<p>varname2varcategory_ejam - helper function - given indicator names, look up what category each is
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">varname2varcategory_ejam<span class="token punctuation">(</span>varname<span class="token punctuation">,</span> varnameinfo<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>vector of 1 or more names like "pctlowinc" as in unique(map_headernames$rname)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnameinfo</code></td>
<td>
<p>data.frame with info on type of each variable</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>tells if variable is "Demographic" "Environmental" "EJ Index" or "other"
as from dput(unique(map_headernames$varcategory))
</p>


<h3>Value</h3>

<p>vector same size as varname
</p>


<h3>See Also</h3>

<p><code><a href="#vartype_cat2color_ejam">vartype_cat2color_ejam()</a></code> <code><a href="#varname2color_ejam">varname2color_ejam()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="varname2vartype_ejam">

<a href="#varname2vartype_ejam" class="help-page-title"><h2>varname2vartype_ejam - helper function - given indicator names, look up what type each is</h2></a>

<h3>Description</h3>

<p>varname2vartype_ejam - helper function - given indicator names, look up what type each is
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">varname2vartype_ejam<span class="token punctuation">(</span>varname<span class="token punctuation">,</span> varnameinfo<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>vector of 1 or more names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnameinfo</code></td>
<td>
<p>data.frame with info on type of each variable</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The types are things like raw data count for indicator, average, percentile, etc.
</p>


<h3>Value</h3>

<p>vector same size as varname
</p>


<h3>See Also</h3>

<p><code><a href="#vartype_cat2color_ejam">vartype_cat2color_ejam()</a></code> <code><a href="#varname2color_ejam">varname2color_ejam()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="vartype_cat2color_ejam">

<a href="#vartype_cat2color_ejam" class="help-page-title"><h2>vartype_cat2color_ejam - helper function - assign fill color to shade excel cells by indicator type and category
Use color shading to make spreadsheet easier to use, grouping the indicators</h2></a>

<h3>Description</h3>

<p>vartype_cat2color_ejam - helper function - assign fill color to shade excel cells by indicator type and category
Use color shading to make spreadsheet easier to use, grouping the indicators
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">vartype_cat2color_ejam<span class="token punctuation">(</span>vartype <span class="token operator">=</span> raw<span class="token punctuation">,</span> varcategory <span class="token operator">=</span> <span class="token string">"other"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>vartype</code></td>
<td>
<p>must be one found in dput(unique(map_headernames$vartype))
like "usratio", "stateratio", "usraw", "stateraw",
"uspctile", "statepctile", "usavg", "stateavg", etc.
NA if not found.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varcategory</code></td>
<td>
<p>must be one of "Demographic"   "Environmental" "EJ Index" "other"
as from dput(unique(map_headernames$varcategory))</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of colors like c('lightblue', 'gray') matching length of vartype
</p>


<h3>See Also</h3>

<p><code><a href="#varname2vartype_ejam">varname2vartype_ejam()</a></code>  <code><a href="#varname2varcategory_ejam">varname2varcategory_ejam()</a></code> <code><a href="#varname2color_ejam">varname2color_ejam()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="xls_formatting2">

<a href="#xls_formatting2" class="help-page-title"><h2>xls_formatting2 - Format EJAM tabular outputs for saving as Excel spreadsheet</h2></a>

<h3>Description</h3>

<p>xls_formatting2 - Format EJAM tabular outputs for saving as Excel spreadsheet
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">xls_formatting2<span class="token punctuation">(</span>
  overall<span class="token punctuation">,</span>
  eachsite<span class="token punctuation">,</span>
  longnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  formatted <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  bybg <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  plot_distance_by_group <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  summary_plot <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  plotlatest <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  plotfilename <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  mapadd <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  ok2plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  analysis_title <span class="token operator">=</span> <span class="token string">"EJAM analysis"</span><span class="token punctuation">,</span>
  buffer_desc <span class="token operator">=</span> <span class="token string">"Selected Locations"</span><span class="token punctuation">,</span>
  radius_or_buffer_in_miles <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  radius_or_buffer_description <span class="token operator">=</span>
    <span class="token string">"Miles radius of circular buffer (or distance used if buffering around polygons)"</span><span class="token punctuation">,</span>
  notes <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  heatmap_colnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  heatmap_cuts <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  heatmap_colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  heatmap2_colnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  heatmap2_cuts <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1.009</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  heatmap2_colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  hyperlink_colnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"EJScreen Report"</span><span class="token punctuation">,</span> <span class="token string">"EJScreen Map"</span><span class="token punctuation">,</span> <span class="token string">"ECHO report"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  graycolnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  narrowcolnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  graycolor <span class="token operator">=</span> <span class="token string">"gray"</span><span class="token punctuation">,</span>
  narrow6 <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  launchexcel <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  saveas <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>overall</code></td>
<td>
<p>table to save in one tab, from ejamit()$overall, EJAM analysis of indicators overall (one row)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eachsite</code></td>
<td>
<p>table to save in one tab, from ejamit()$overall, EJAM analysis site by site (one row per site)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>longnames</code></td>
<td>
<p>vector of indicator names to display in Excel table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formatted</code></td>
<td>
<p>optional table to save in one tab, from ejamit()$overall, EJAM analysis overall in different format</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bybg</code></td>
<td>
<p>Optional large table of details of each block group that is only needed to analyze distances by group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_distance_by_group</code></td>
<td>
<p>logical, whether to try to add a plot of mean distance by group.
This requires that bybg be provided as a parameter input to this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summary_plot</code></td>
<td>
<p>optional plot object passed from EJAM shiny app to save in 'Plot' sheet of Excel table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotlatest</code></td>
<td>
<p>optional logical. If TRUE, the most recently displayed plot (prior to this function being called) will be inserted into a tab called plot2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotfilename</code></td>
<td>
<p>the full path including name of .png file to insert</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapadd</code></td>
<td>
<p>logical optional - try to include a map of the points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ok2plot</code></td>
<td>
<p>can set to FALSE to prevent plots from being attempted, while debugging</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>analysis_title</code></td>
<td>
<p>optional title passed from Shiny app to 'Notes' sheet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer_desc</code></td>
<td>
<p>optional description of buffer used in analysis, passed to 'Notes' sheet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_or_buffer_description</code></td>
<td>
<p>optional text saying if distance is radius or polygon buffer, passed to 'Notes' sheet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>notes</code></td>
<td>
<p>Text of additional notes to put in the notes tab, optional vector of character elements pasted in as one line each.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_colnames</code></td>
<td>
<p>optional vector of colnames to apply heatmap colors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_cuts</code></td>
<td>
<p>vector of values to separate heatmap colors, between 0-100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_colors</code></td>
<td>
<p>vector of color names for heatmap bins, same length as
heatmap_cuts, where first color is for those &gt;= 1st cutpoint, but &lt;2d,
second color is for those &gt;=2d cutpoint but &lt;3d, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyperlink_colnames</code></td>
<td>
<p>names of which to treat as URLs that should be hyperlinks</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graycolnames</code></td>
<td>
<p>which columns to deemphasize</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>narrowcolnames</code></td>
<td>
<p>which column numbers to make narrow</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graycolor</code></td>
<td>
<p>color used to deemphasize some columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>narrow6</code></td>
<td>
<p>how narrow</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>optional for testing only</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launchexcel</code></td>
<td>
<p>Set to TRUE to have this function launch Excel immediately, showing the final workbook created here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveas</code></td>
<td>
<p>If not NULL, and a valid path with filename.xlsx is provided,
the workbook will be saved locally at that path and name. Warning: it will overwrite an existing file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other params passed along to <code><a href="https://ycphs.r-universe.dev/manual/openxlsx.html#writeData">openxlsx::writeData()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_miles</code></td>
<td>
<p>If provided, miles buffer distance (from polygon or from point if circular buffers)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Already took and put here most or all of code from xls_formatting() or xls_formatting_api()
</p>


<h3>Value</h3>

<p>a workbook, ready to be saved in spreadsheet format, with tabs like "Overall" and "Each Site"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  wb <span class="token operator">&lt;-</span> xls_formatting2<span class="token punctuation">(</span>testoutputs_<span class="token operator">$</span>results_overall<span class="token punctuation">,</span> datasetResults<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">$</span>results_bysite<span class="token punctuation">,</span>
    saveas <span class="token operator">=</span>  <span class="token string">"results.xlsx"</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
</div>
    <footer><p>Rendered with postdoc 1.2.0</p></footer>
  </body>
</html>
