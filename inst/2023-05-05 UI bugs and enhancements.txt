Discussed on 5/4/23:

in xlsx downloaded and interactive version of tables (overall and site by site tables): fix first 4 columns of site by site table in interactive version and excel - State, EPA region and # indicators above x -- seem to have gotten shifted to the right so they show incorrect data - appears that a row number was included as a column by accident and that displaced the state column bumping it to the right into the epa region column, etc. 

in xlsx downloaded and interactive version of tables (overall and site by site tables): hide the ECHO url column for now. or at least fill it with NA values in excel and interactive version. Fill it with links whenever the facility registry id is known.

in xlsx downloaded and interactive version of tables (overall and site by site tables): make the columns and their sort order identical between xlsx download and interactive version of overall and site by site tables.

in xlsx downloaded and interactive version of tables (overall and site by site tables): fix aspect ratio of image of barplot in xlsx tab, and make it bigger so it is more legible.

in xlsx downloaded and interactive version of tables (overall and site by site tables): in xlsx notes tab, put in the name of the analysis as text. also the radius in miles. number of points could be helpful too, and easy to add there.


New issues identified 5/5/23:

bug? in latlon_from_regid(), most of the test examples of registry id values fail to be found in frs, even though at least some are valid and can be found by manually searching in FRS via ECHO like for https://echo.epa.gov/detailed-facility-report?fid=110008989737 that is found but  latlon_from_regid(110008989737) fails to find it; and only a few are found in this example:  latlon_from_regid(read_csv_or_xl("./inst/testdata/FRS_Test_Data/frs_testpoints_10.xlsx")$REGISTRY_ID)  One guess is perhaps the code in   EJAMfrsdata::frs_active_ids() is too aggressively removing supposedly inactive sites or the examples are for some reason mostly inactive sites? 

bug - 
on the site selection tab, MAP panel, on initial map after uploading points, changing the radius via slider should not reset the zoom of the map - it should just show the circle getting bigger or smaller, just like the map does in the EJAMejscreenapi shiny app. This already works if "Highlight overlaps is NOT checked" but when it is checked then slider radius changes reset the zoom which they should not. A second, closely related bug is that clicking the radio button for Highlight overlaps resets the zoom, but it should not do that. 

on the site selection tab, MAP panel, on initial map after uploading points, popups do not work until you zoom in to a certain level of zoom - unless that is an inherent problem in leaflet or whatever is used there, it should show a popup for a single point that you can see regardless of zoom level. For points that are clustered at that zoom, it of course cannot show a popup which is fine, but if you can see a single point then a popup should be available. 

on the site selection tab, MAP panel, the Review selected sites button should be hidden when you first launch the app, but also whenever it is not relevant. For example, when you click the radio button to upload points via lat/lon, the Review sites button cannot be used so it should be invisible. 

on the site selection tab, MAP panel, when you first launch the app, it should not say "Please upload a data set" twice.

on the site selection tab, MAP panel, one of these two lines of text should be removed because you do not need both numbers: - Valid site(s) uploaded: 10   and   - Site(s) with invalid lat/lon values: 0

on the site selection tab, MAP panel, remove the line of text that says, e.g., Current upload method: latlon. This is clear from the radio button at the left, already, and just adds clutter/redundancy. 


on the site selection tab, SLIDER bar, "Radius of circular buffer: 4.25 mi (6.84 km)" should be broken into two lines because the wrapping looks awkward or messy right now. Maybe after the colon should be a line break. And since there is more space available per line that way, "mi" can be spelled out as "miles." 

on the site selection tab, SLIDER bar, "Radius of circular buffer" should be rephrased to more user-friendly/ less technical jargon, to say something like "Distance from each site," but to be more clear about what this means, really the whole label could be rephrased as "Residents within __ miles (x km) of [these/specified/selected?] [places/ locations/ SITES/POINTS/FACILITIES?  (assuming circles around points rather than shapefiles are being analyzed) ... depends on what the points are... is there a generic but plain English terms here? The word "places" is probably the most flexible and simple. ]"

on the site selection tab, SLIDER bar, Once shapefiles can be uploaded, the distance slider bar should say, for a BUFFERED POLYGON something like "Residents within __ miles (x km) of [these/specified/selected?] [places/locations/areas?]", and for a NON-BUFFERED POLYGON it should say something like "Residents within [these/specified?/selected?] [places/ locations/ areas]" The word "places" is probably the most flexible and simple. ).


on the site selection tab, new UI element idea: The user-specified distance, like 3 miles or whatever, has to be much much more prominent, obvious, maybe show the number using a much larger font within a UI element like a big text box of some kind -- it should be very hard to miss if you glance at the page -- need to be very clear to the user what distance they have chosen since that is really the only parameter they are setting on this whole page, other than picking a list of places. 


on the site selection tab, UI for "Specify Locations" -  the UI design around the radio buttons and Browse files box should be much improved somehow -- I am very open to a creative overhaul / full revamp of this part of the UI -- it is important because it is the first thing someone will do, so it needs to be easy or even kind of fun to use this first step.  At a minimum before even designing an overhaul, for example, I would dim/gray the other options once you pick 1 radio button, to reduce visual clutter and make clear what you need to click or enter next. Maybe there is a better way than radio buttons?  Also, the 2 upload options should be next to each other since they are similar. Also the Browse files box should somehow be immediately to the right of or right below to the place where you clicked to upload rather than several lines down - the same idea with Select by Industry - once you pick that, the "select codes from dropdown" and "enter text or code" are really submenu options under that, and the entry box should be very prominently the next thing to focus on.

on the site selection tab, UI for "Specify Locations" -   "Upload Location (latitude/longitude) file" is somewhat redundant with the text below that says, "Upload a list of sites in a spreadsheet (.csv, .xls, or .xlsx with lat & lon as table headers)" -- Someone with UI expertise should suggest how to merge and rephrase those two or use hover info/etc. to clean this up -- The phrase "Upload a list of sites in a spreadsheet with lat & lon as table headers" is pretty clear if you omit the part saying .csv,xls,or.xlsx, or perhaps something like "Upload a spreadsheet with latitude/longitude of each facility (point)." If UI experts or reviewers think that is too long, it could be something shorter but explain that full idea as a tip shown upon hover. 

on the site selection tab, UI for "Specify Locations" -  "Location file upload instructions" down below, is not a good way to communicate this extra information. People with UI experience should figure out a nicer way to help users know what their options are and how exactly to use this option- Having this text appear down below does not work well because you don't even see it unless the browser window happens to be very tall or zoomed out, and it needs to first communicate immediately the very basic idea that you can upload your own spreadsheet to provide a list of points like facility locations, then provide a bit more detail maybe upon hover, and then finally provide the example format and full detail (maybe as a popup/modal, or a new browser tab?) perhaps if they click on a tool tip or something easy/clear. It also could have a link (in the full detailed instructions) that says something like " download an example (or template?) spreadsheet you can try (or fill in?): mypoints.xlsx "  And the same ideas for FRS file upload, etc. 

