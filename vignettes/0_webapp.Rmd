---
title: "0. Using EJAM as a Web App"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{0. Using EJAM as a Web App}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r SETUP_default_eval_or_not, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(eval = FALSE)
# https://r-pkgs.org/vignettes.html
```

```{r libraryEJAM, eval = TRUE, echo= FALSE, include= FALSE}
# rm(list = ls())
# golem::detach_all_attached()
# 
library(EJAM)
# dataload_from_pins('all') # varnames = all  currently means all these:
dataload_from_pins(
  c("blockwts", "blockpoints", "blockid2fips", "quaddata", 
    "bgej", "bgid2fips",
    "frs", "frs_by_programid", "frs_by_naics", "frs_by_sic", "frs_by_mact")
)

##################################### #
if (!exists("blockid2fips")) {
  cat("warning: blockid2fips not available\n")
  # *** temporary workaround if building vignette on 1 particular machine
  here <- "~/../Downloads/EJAMbigfiles"
  varnames <- c('blockwts', 'blockpoints', 'blockid2fips', "quaddata",
                'bgej','bgid2fips', 
                'frs', 'frs_by_programid', 'frs_by_naics', "frs_by_sic", "frs_by_mact")
  fnames <- paste0(varnames, ".arrow")
  localpaths  <- paste0(here, '/', fnames)
  for (i in 1:length(varnames)) {assign(varnames[i], arrow::read_ipc_file(file = localpaths[i]))}
  rm(here, varnames, fnames, localpaths)
}
##################################### #

indexblocks()
```

```{r developernote, echo= FALSE}
#
#  *>>>>>>>>>> Developer note on updating this vignette <<<<<<<<<<<*
#
#  -   *TO UPDATE THIS VIGNETTE:* 
#
#    - *This vignette must be regularly tested/edited*
#
#    -  rmarkdown::render("vignettes/INSERTNAMEHERE.Rmd", encoding = 'UTF-8') 
#     but the render button in RStudio shows more detailed progress during render.
#
#    -  possibly also devtools::build_vignettes() but that fails on dataload_from_pins() or _local() trying to get blockid2fips
#
#  -    See <https://docs.ropensci.org/postdoc/> for quick way to make html help on a pkg. Do this...   postdoc::render_package_manual('EJAM') 
#
#  -   *See <https://r-pkgs.org/vignettes.html>*
#
#  -   *See <https://r-pkgs.org/vignettes.html#sec-vignettes-how-built>*
#
#  -   *Vignette is in EJAM\vignettes\INSERTNAMEHERE.Rmd.html*
```


# EJAM web app

## EJAM as a hosted web app (easiest way to use EJAM)

EPA staff can try a live demo version of EJAM with just a web browser. You must be inside EPA's network (e.g. using VPN) to access the EJAM web app as of 1/2024. EJAM is in active development, not yet launched as of 1/2023. This is work in progress, so not everything is working and changes are being made!

* A full development version of EJAM is being tested on a staging server, accessible only by EPA staff members who have been given individual access (contact us for access) and requires VPN/in-LAN and sign-in https://rstudio-connect.dmap-stage.aws.epa.gov/content/cb2bc9cf-75c3-4db1-ad28-e92940fe4438 

* A basic version of only a few features -- called "ejam lite" -- is on a staging server at [EJAM Lite (Demo/Test on Staging Server)](https://rstudio-connect.dmap-stage.aws.epa.gov/content/725e3761-3dc1-4012-b07c-23126063da97/ "https://rstudio-connect.dmap-stage.aws.epa.gov/content/725e3761-3dc1-4012-b07c-23126063da97/"){.uri target="_blank" rel="noreferrer noopener"}. Note that the demo app takes time to start up and load all the datasets and packages and then build an index. The analysis can be started only after the blue bar lights up to show that the spreadsheet with lat lon values has been uploaded.

## EJAM as a web app running locally (for R users)

If you use R/RStudio, you can run the web app on your own computer. You first need to install the EJAM R package as explained in the vignette on installing EJAM.

Once EJAM is installed, you can launch the local web app from RStudio as follows:
```{r run_app1, eval = FALSE, include= TRUE}
library(EJAM)
run_app()
```
Note this is different than running a simple shiny app that is not also a package via golem. You should use EJAM::run_app() not shiny::runApp().

Note that the web app (e.g., launched locally) handles loading datasets and indexing blocks, so you would not have to download datasets manually or do indexing manually if launching the EJAM app locally. You just need the packages installed that EJAM relies on (see below).

Note that information about how to use the web app will be provided elsewhere, not in this vignette.
