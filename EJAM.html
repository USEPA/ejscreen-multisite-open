<!DOCTYPE html>
<html>
  <head>
    <title>Package 'EJAM' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'EJAM'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">EJAM Environmental Justice Analysis Multisite tool</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">Tools for summarizing environmental and demographic indicators 
    (such as those in EJScreen) for residents living near any one of a number of 
    specific sites. It uses quad tree search/indexing of block locations, data.table, parallel processing 
    to provide very fast identification of nearby blocks, distances, and 
    aggregation of indicators within each distance. It can be uses as a web app, with the user interface provided by the shiny R package.</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>Mark Corrales</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">Mark Corrales &lt;corrales.mark@epa.gov&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">MIT + file LICENSE.md</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">2.1.1</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-04-24 01:25:29 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source"></td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list">
<li class="help-index-item"><a href="#dot-onLoad">Creates index to all US blocks (internal point lat lon) at package load</a></li>
<li class="help-index-item"><a href="#all.equal_functions">helper function for checking possibly different versions of a function with same name in 2 packages</a></li>
<li class="help-index-item"><a href="#app_run_EJAM">Launch the Shiny Application in RStudio</a></li>
<li class="help-index-item"><a href="#app_server">EJAM app server</a></li>
<li class="help-index-item"><a href="#bg_cenpop2020">data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group</a></li>
<li class="help-index-item"><a href="#bg_from_county">Analyze US Counties as if they were sites, to get EJ indicators summary for each county</a></li>
<li class="help-index-item"><a href="#bgpts">lat lon of popwtd center of blockgroup, and count of blocks per block group</a></li>
<li class="help-index-item"><a href="#blockgroupstats">EJScreen demographic and enviromental indicators for Census block groups</a></li>
<li class="help-index-item"><a href="#counties_as_sites">Analyze US Counties as if they were sites, to get EJ indicators summary for each county</a></li>
<li class="help-index-item"><a href="#datapack">See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame</a></li>
<li class="help-index-item"><a href="#distance_by_group">distance_by_group
Get average distance for ONE demographic group versus everyone else</a></li>
<li class="help-index-item"><a href="#distance_cdf_by_group_plot">distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONE demographic group that are within each distance</a></li>
<li class="help-index-item"><a href="#distance_via_surfacedistance">convert surface distance to actual distance</a></li>
<li class="help-index-item"><a href="#doaggregate">Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</a></li>
<li class="help-index-item"><a href="#dupenames">helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</a></li>
<li class="help-index-item"><a href="#ejamit">Get complete EJ analysis numbers (demographic and environmental indicators) near a list of locations</a></li>
<li class="help-index-item"><a href="#ejampackages">list of names of EJAM-related R packages</a></li>
<li class="help-index-item"><a href="#fips_lead_zero">fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.</a></li>
<li class="help-index-item"><a href="#fipsbg_from_anyfips">fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS</a></li>
<li class="help-index-item"><a href="#format_gt_table">format_gt_table</a></li>
<li class="help-index-item"><a href="#frs_from_naics">Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_program">Use EPA Program acronym like TRIS to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_programid">Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_regid">Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_siteid">Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</a></li>
<li class="help-index-item"><a href="#frs_from_sitename">Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text</a></li>
<li class="help-index-item"><a href="#frs_is_valid">Validate FRS Registry ID list uploads</a></li>
<li class="help-index-item"><a href="#get_blockpoints_in_shape">find blocks that are in a polygon, using internal point of block - WORK IN PROGRESS ****</a></li>
<li class="help-index-item"><a href="#get_circles_from_spatialpoints">add buffer around shape (points, here)</a></li>
<li class="help-index-item"><a href="#get_shape_buffered_from_shapefile_points">add buffer around shape (points, here)</a></li>
<li class="help-index-item"><a href="#get_shapefile_from_sitepoints">convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points</a></li>
<li class="help-index-item"><a href="#getblocks_diagnostics">Get summary stats on counts of blocks (unique vs doublecounted) near sites</a></li>
<li class="help-index-item"><a href="#getblocks_summarize_blocks_per_site">helper- Get summary stats on counts of blocks near various sites</a></li>
<li class="help-index-item"><a href="#getblocks_summarize_sites_per_block">helper- Get summary stats on how many sites are near various blocks (residents)</a></li>
<li class="help-index-item"><a href="#getblocksnearby">Fast way to find nearby points - finds distance to each Census block centroid nearby</a></li>
<li class="help-index-item"><a href="#getblocksnearby2">Key buffering function - wrapper redirecting to the right version of getblocksnearby()</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree">Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree_Clustered">find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree2">Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree3">Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#indexblocks">indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment</a></li>
<li class="help-index-item"><a href="#input_names_listing">input_names_listing
Utility checking values of input$ that appear in this code</a></li>
<li class="help-index-item"><a href="#installejamsource">installejamsource
utility for when working on the source code - redoes documentation and reinstalls packages</a></li>
<li class="help-index-item"><a href="#lat_alias-lon_alias">Synonyms for lat and lon</a></li>
<li class="help-index-item"><a href="#latlon_as.numeric">Strip non-numeric characters from a vector</a></li>
<li class="help-index-item"><a href="#latlon_df_clean">Find and clean up latitude and longitude columns in a data.frame</a></li>
<li class="help-index-item"><a href="#latlon_from_anything">Flexibly get lat/lon from file, data.frame, data.table, or lat/lon vectors</a></li>
<li class="help-index-item"><a href="#latlon_from_naics">Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</a></li>
<li class="help-index-item"><a href="#latlon_from_program">Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others</a></li>
<li class="help-index-item"><a href="#latlon_from_programid">Get lat lon, Registry ID, and NAICS, for given FRS Program System ID</a></li>
<li class="help-index-item"><a href="#latlon_from_regid">Get lat lon (and NAICS) via Facility Registry ID</a></li>
<li class="help-index-item"><a href="#latlon_from_siteid">Get lat lon (and NAICS) via Facility Registry ID</a></li>
<li class="help-index-item"><a href="#latlon_infer">guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</a></li>
<li class="help-index-item"><a href="#latlon_is.valid">Validate latitudes and longitudes</a></li>
<li class="help-index-item"><a href="#map_facilities">map_facilities</a></li>
<li class="help-index-item"><a href="#metadata_add">helper function for package to set attributes of a dataset</a></li>
<li class="help-index-item"><a href="#metadata_check">helper function in updating the package metadata</a></li>
<li class="help-index-item"><a href="#NAICS">named list of all NAICS code numbers and industry name for each</a></li>
<li class="help-index-item"><a href="#naics_categories">See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</a></li>
<li class="help-index-item"><a href="#naics_download">script to download NAICS file with code and name of sector</a></li>
<li class="help-index-item"><a href="#naics_findwebscrape">for query term, show list of roughly matching NAICS, scraped from web
This finds more than just naics_from_any() does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</a></li>
<li class="help-index-item"><a href="#naics_from_any">General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</a></li>
<li class="help-index-item"><a href="#naics_from_code">search for industry names by NAICS code(s), 2-6 digits long each
See naics_from_any() which uses this</a></li>
<li class="help-index-item"><a href="#naics_from_name">search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See naics_from_any() which uses this</a></li>
<li class="help-index-item"><a href="#naics_subcodes_from_code">find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.</a></li>
<li class="help-index-item"><a href="#naics_url_of_code">Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#naics_validation">Validate NAIC uploads</a></li>
<li class="help-index-item"><a href="#naics2children">See NAICS codes queried plus all children of any of those
Used by naics_find()</a></li>
<li class="help-index-item"><a href="#naicstable">data.table of NAICS code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3,4,5,and 6-digit NAICS that this code falls under, where relevant for given length</a></li>
<li class="help-index-item"><a href="#pctile_from_raw_lookup">Find approx wtd percentiles in lookup table that is in memory</a></li>
<li class="help-index-item"><a href="#plot_distance_cdf_by_group">plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances</a></li>
<li class="help-index-item"><a href="#plot_distance_mean_by_group">plot_distance_mean_by_group
Barplot of Average Proximity to sites, by Demographic Group (vs everyone else)</a></li>
<li class="help-index-item"><a href="#plotblocksnearby">Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby</a></li>
<li class="help-index-item"><a href="#popweightedsums">Get population weighted sums of indicators -MOSTLY OBSOLETE
The code in doaggregate() does pop wtd means faster using data.tables and collapse::fmean()</a></li>
<li class="help-index-item"><a href="#proximity.score.in.miles">convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used</a></li>
<li class="help-index-item"><a href="#proxistat2">Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.</a></li>
<li class="help-index-item"><a href="#regionstats">data.table of 100 percentiles and means for each EPA Region.</a></li>
<li class="help-index-item"><a href="#run_app">Launch the Shiny Application in RStudio</a></li>
<li class="help-index-item"><a href="#sitepoints_example">data.table of points as example of sitepoints for EJAM</a></li>
<li class="help-index-item"><a href="#sites2blocks_example">data.table of output of getblocknearby(), each row is a unique site-block-distance</a></li>
<li class="help-index-item"><a href="#speedtest">speedtest
Runs EJAM analysis for several radius values for various numbers of sitepoints, recording how long each step took.</a></li>
<li class="help-index-item"><a href="#speedtest_plot">utility to plot output of speedtest(), rate of points analyzed per hour</a></li>
<li class="help-index-item"><a href="#ST_by_site_from_sites2blocks">Get State that each site is in, from a table of siteid, blockid, distance</a></li>
<li class="help-index-item"><a href="#state_from_blockid">state_from_blockid
given vector of blockids, get state abbreviation of each</a></li>
<li class="help-index-item"><a href="#state_from_blocktable">state_from_blocktable
given data.table with blockid column, get state abbreviation of each</a></li>
<li class="help-index-item"><a href="#state_from_fips">state_from_fips</a></li>
<li class="help-index-item"><a href="#state_from_latlon">find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful</a></li>
<li class="help-index-item"><a href="#stateinfo">data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</a></li>
<li class="help-index-item"><a href="#states_infer">states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS</a></li>
<li class="help-index-item"><a href="#states_shapefile">US States boundaries 2020 shapefile from TIGER</a></li>
<li class="help-index-item"><a href="#statestats">data.frame of 100 percentiles and means for each US State and PR and DC.</a></li>
<li class="help-index-item"><a href="#statestats_query">convenient way to see mean, pctiles of Env or Demog indicators from lookup table</a></li>
<li class="help-index-item"><a href="#statestats_queryd">convenient way to see mean, pctiles of DEMOG indicators from lookup table</a></li>
<li class="help-index-item"><a href="#statestats_querye">convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table</a></li>
<li class="help-index-item"><a href="#test_regid">test data, vector of EPA FRS Registry ID numbers</a></li>
<li class="help-index-item"><a href="#testdata_sites2blocks">data.table of output of getblocknearby(), each row is a unique site-block-distance</a></li>
<li class="help-index-item"><a href="#testdata_sites2blocks_1000">data.table of output of getblocknearby(testpoints_1000,cutoff = 3.1), each row is a unique site-block-distance</a></li>
<li class="help-index-item"><a href="#testpoints_100_dt">Random test points data.table with columns lat lon site</a></li>
<li class="help-index-item"><a href="#testpoints_1000_dt">Random test points data.table with columns lat lon site</a></li>
<li class="help-index-item"><a href="#testpoints_n">Random points on the map
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.</a></li>
<li class="help-index-item"><a href="#url_bookmark_save">url_bookmark_save
save bookmarked EJScreen session (map location and indicator)</a></li>
<li class="help-index-item"><a href="#url_bookmark_text">url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)</a></li>
<li class="help-index-item"><a href="#url_get_eparest_chunked_by_id">experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</a></li>
<li class="help-index-item"><a href="#url_get_via_url">helper function work in progress: GET json via url of ejscreen ejquery map services</a></li>
<li class="help-index-item"><a href="#url_getacs_epaquery">experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</a></li>
<li class="help-index-item"><a href="#url_getacs_epaquery_chunked">experimental/ work in progress: in chunks, get ACS data via EPA API</a></li>
<li class="help-index-item"><a href="#url_naics.com">Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#usastats">data.frame of 100 percentiles and means</a></li>
<li class="help-index-item"><a href="#usastats_means">convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_query">convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_queryd">convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table</a></li>
<li class="help-index-item"><a href="#usastats_querye">convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table</a></li>
<li class="help-index-item"><a href="#write_pctiles_lookup">create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</a></li>
<li class="help-index-item"><a href="#xls_formatting">Format batch results for excel
also see other functions related to this!</a></li>
<li class="help-index-item"><a href="#xls_formatting2">xls_formatting2
Format EJAM tabular outputs for saving as Excel spreadsheet</a></li>
</ul>

    <hr>
    <div class="manual-pages-content">
<div class="container manual-page" id="dot-onLoad">

<a href="#dot-onLoad" class="help-page-title"><h2>Creates index to all US blocks (internal point lat lon) at package load</h2></a>

<h3>Description</h3>

<p>Creates index to all US blocks (internal point lat lon) at package load
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">.onLoad<span class="token punctuation">(</span>libname<span class="token punctuation">,</span> pkgname<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>libname</code></td>
<td>
<p>na</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkgname</code></td>
<td>
<p>na</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="all.equal_functions">

<a href="#all.equal_functions" class="help-page-title"><h2>helper function for checking possibly different versions of a function with same name in 2 packages</h2></a>

<h3>Description</h3>

<p>helper function for checking possibly different versions of a function with same name in 2 packages
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## S3 method for class 'equal_functions'</span>
all<span class="token punctuation">(</span>fun <span class="token operator">=</span> <span class="token string">"latlon_infer"</span><span class="token punctuation">,</span> package1 <span class="token operator">=</span> <span class="token string">"EJAM"</span><span class="token punctuation">,</span> package2 <span class="token operator">=</span> <span class="token string">"EJAMejscreenapi"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>quoted name of function, like "latlon_infer"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package1</code></td>
<td>
<p>quoted name of package, like "EJAM"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package2</code></td>
<td>
<p>quoted name of package, like "EJAMejscreenapi"</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>TRUE or FALSE
</p>


<h3>See Also</h3>

<p><code><a href="#dupenames">dupenames()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="app_run_EJAM">

<a href="#app_run_EJAM" class="help-page-title"><h2>Launch the Shiny Application in RStudio</h2></a>

<h3>Description</h3>

<p>launch Shiny web app from RStudio
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">app_run_EJAM<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>onStart</code></td>
<td>
<p>A function that will be called before the app is actually run.
This is only needed for <code>shinyAppObj</code>, since in the <code>shinyAppDir</code>
case, a <code>global.R</code> file can be used for this purpose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Named options that should be passed to the <code>runApp</code> call
(these can be any of the following: "port", "launch.browser", "host", "quiet",
"display.mode" and "test.mode"). You can also specify <code>width</code> and
<code>height</code> parameters which provide a hint to the embedding environment
about the ideal height/width for the app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enableBookmarking</code></td>
<td>
<p>Can be one of <code>"url"</code>, <code>"server"</code>, or
<code>"disable"</code>. The default value, <code>NULL</code>, will respect the setting from
any previous calls to  <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>. See <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>
for more information on bookmarking your app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiPattern</code></td>
<td>
<p>A regular expression that will be applied to each <code>GET</code>
request to determine whether the <code>ui</code> should be used to handle the
request. Note that the entire request path must match the regular
expression in order for the match to be considered successful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to golem_opts.
See <code>?golem::get_golem_options</code> for more details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>app_run_EJAM()                 is like <code><a href="#run_app">run_app()</a></code>
app_run_EJAMejscreenapi()      is like <code><a>EJAMejscreenapi::run_app()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="app_server">

<a href="#app_server" class="help-page-title"><h2>EJAM app server</h2></a>

<h3>Description</h3>

<p>EJAM app server
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">app_server<span class="token punctuation">(</span>input<span class="token punctuation">,</span> output<span class="token punctuation">,</span> session<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>input, output, session</code></td>
<td>
<p>Internal parameters for shiny.
DO NOT REMOVE.</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="bg_cenpop2020">

<a href="#bg_cenpop2020" class="help-page-title"><h2>data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group</h2></a>

<h3>Description</h3>

<p>data.table with all US Census 2020 block groups, Census 2020 population count,
and lat/lon of Census2020-population-weighted centroid of block group
</p>


<h3>Details</h3>

<p>also see attributes(bg_cenpop2020) for source URL and date
</p>


<h3>See Also</h3>

<p><a href="#bgpts">bgpts</a> <a href="#blockgroupstats">blockgroupstats</a>
</p>

<hr>
</div>
<div class="container manual-page" id="bg_from_county">

<a href="#bg_from_county" class="help-page-title"><h2>Analyze US Counties as if they were sites, to get EJ indicators summary for each county</h2></a>

<h3>Description</h3>

<p>Analyze US Counties as if they were sites, to get EJ indicators summary for each county
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>County FIPS vector as character not numeric values</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with all pairs of county fips - bgid, and a unique siteid assigned to each county
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'01001'</span><span class="token punctuation">,</span><span class="token string">'72153'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># Largest US Counties by ACS Population Totals:</span>
 blockgroupstats<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>ST <span class="token operator">=</span> ST<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> countypop <span class="token operator">=</span> sum<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  by<span class="token operator">=</span>.<span class="token punctuation">(</span>FIPS <span class="token operator">=</span> substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span><span class="token operator">-</span>countypop<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>
  CountyPopulation <span class="token operator">=</span> prettyNum<span class="token punctuation">(</span>countypop<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FIPS<span class="token punctuation">,</span> ST<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="bgpts">

<a href="#bgpts" class="help-page-title"><h2>lat lon of popwtd center of blockgroup, and count of blocks per block group</h2></a>

<h3>Description</h3>

<p>This is just a list of US block groups and how many blocks are in each...
It also has the lat and lon roughly of each blockgroup
</p>


<h3>Details</h3>

<p>The point used for each bg is the Census 2020 population weighted mean
of the blocks' internal points. It gives an approximation of where people live
and where each bg is, which is useful for some situations.
</p>
<pre>
  As of 10/2022 it is the EJScreen 2.1 version of data, which uses ACS 2016-2020
  and Census 2020. it has all US States, DC, PR, but not  "AS" "GU" "MP" "VI"
  
  How lat lon were estimated:

# proxistat::bg.pts had a lat/lon internal point for each us block group for Census 2010.
# that had been used to include those lat/lon in ejscreen::bg21, for convenience. 
 &gt; head(proxistat::bg.pts)
           FIPS    aland   awater      lat       lon
           1 010950302024 14969994 15040133 34.42668 -86.2437
            2 010950306002  6751877 16610261 34.31763 -86.34399
            
 # Now, for Census 2020 blocks, create pop wtd centroids lat lon for each block group #### 
 #  using EJAMblockdata::blockwts and EJAMblockdata::blockpoints
 
 bgpts_blocks &lt;- copy(blockpoints) # not essential but ok to make sure we do not change blockpoints itself by reference in data.table operations
 # all.equal(bgpts$blockid , blockwts$blockid)
 bgpts_blocks[ , bgid    := blockwts$bgid]
 bgpts_blocks[ , blockwt := blockwts$blockwt]
 # get pop wtd mean of lat, and same for lon, by bgid
 bgpts &lt;- bgpts_blocks[ , lapply(.SD, FUN = function(x) stats::weighted.mean(x, w = blockwt, na.rm = TRUE)), .SDcols = c('lat', 'lon') , by = 'bgid']
 rm( bgpts_blocks)
 # add the bgfips column, so it has bgfips, bgid, lat, lon
 # all.equal(bgpts$bgid,bgid2fips$bgid)
 bgpts[ , bgfips := bgid2fips$bgfips]
 # setnames(bgpts, 'bgfips', 'FIPS')
 
 # BUT NOTE this census2020 block table has PR but lacks "AS" "GU" "MP" "VI" ####
 # &gt; uniqueN(EJAMblockdata::blockid2fips[,substr(blockfips,1,2)])
 # [1] 52
 # length(unique(EJAMejscreendata::EJSCREEN_Full_with_AS_CNMI_GU_VI$ST_ABBREV))
 # [1] 56
 #   dim(bgejam)
 # [1] 242,940    155
 #   dim(bg22)
 # [1] 242,335    157
 #
 # so how do we get latlon for bg in as/gu/mp/vi ?  ?####
 
 # view those block group points on a map (plot only a subset which is enough)
 sam &lt;- sample(seq_along(bgpts$bgid),5000) 
 plot(bgpts$lon[sam], bgpts$lat[sam], pch = '.')
 
 # view one state, florida, where 12 are the 1st 2 digits of the FIPS:
 # bgpts[bgid2fips[substr(bgfips,1,2) == '12', ], on = 'bgid']
 xx='12'
 mystate &lt;- bgpts[bgid2fips[substr(bgfips, 1, 2) == xx, ], on = 'bgid'][ , .(lon,lat)]
 plot(mystate, pch = '.')
 rm(mystate, xx)
 
    
  How blockcounts were done: 
  
  library(EJAMblockdata)
  library(data.table)
  bg_blockcounts &lt;- blockwts[ , .(blockcount = uniqueN(.SD)), by=bgid]
  sum(bg_blockcounts$blockcount == 1)
    # [1] 1874 blockgroups have only 1 block
  sum(bg_blockcounts$blockcount == 1000)  the max is 1000 blocks in a bg
    # # [1] 22
  round(100*table(bg_blockcounts[blockcount &lt;20, blockcount]) / nrow(bg_blockcounts) ,1)
    # about 1 to 3 
    #   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19 
    # 0.8 1.2 1.3 1.4 1.5 2.1 2.2 2.4 2.6 2.8 2.8 3.0 3.0 2.9 3.0 2.9 2.8 2.7 2.5 
    all.equal(bgpts$bgid, bg_blockcounts$bgid)
  bgpts[ , blockcount := bg_blockcounts$blockcount]
  dim(bgpts)   
      # 242335  x    5
  usethis::use_data(bgpts) # saved for EJAM package
  
  </pre>

<hr>
</div>
<div class="container manual-page" id="blockgroupstats">

<a href="#blockgroupstats" class="help-page-title"><h2>EJScreen demographic and enviromental indicators for Census block groups</h2></a>

<h3>Description</h3>

<p>The EJScreen dataset (demographic, environmental, EJ indicators),
plus more demographic subgroups.
</p>


<h3>Details</h3>

<p>As of 10/2022 it is the EJScreen 2.1 version of data, which uses ACS 2016-2020.
EJScreen 2.1 was released October 2022.
As of  4/2022 it was the EJScreen 2.0 version of data, which used ACS 2015-2019.
EJScreen 2.0 was released 2/18/2022 (raw data download avail 2/22/2022).
</p>
<p>NOTE: It also has the race/ethnic subgroups that add up to minority or people of color.
</p>
<p>Each year this could be created as for the latest version.
See attributes(blockgroupstats)
It is also available in a similar form via the ejscreen package on github,
and EJAMejscreendata::EJSCREEN_Full_with_AS_CNMI_GU_VI
but there are differences in which columns are kept.
</p>
<p>It is a data.table of US Census blockgroups (not blocks). With PR, 242,335 rows, approx 175 columns.
See <a href="https://www.epa.gov/ejscreen" target="_blank">https://www.epa.gov/ejscreen</a>
</p>
<p>column names include bgfips, bgid (for join to blockwt$bgid), pop, pctlowinc, pcthisp, etc.
</p>
<p>see source code and notes in EJAM/inst/notes_datasets/ which has  create_blockgroupstats()
</p>
<p>See maybe the notes on cleaning up and changing the dataset starting from ejscreen::bg22plus
</p>

<hr>
</div>
<div class="container manual-page" id="counties_as_sites">

<a href="#counties_as_sites" class="help-page-title"><h2>Analyze US Counties as if they were sites, to get EJ indicators summary for each county</h2></a>

<h3>Description</h3>

<p>Analyze US Counties as if they were sites, to get EJ indicators summary for each county
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">counties_as_sites<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>County FIPS vector as character not numeric values</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with all pairs of county fips - bgid, and a unique siteid assigned to each county
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg_from_county<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'01001'</span><span class="token punctuation">,</span><span class="token string">'72153'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># Largest US Counties by ACS Population Totals:</span>
 blockgroupstats<span class="token punctuation">[</span> <span class="token punctuation">,</span> .<span class="token punctuation">(</span>ST <span class="token operator">=</span> ST<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> countypop <span class="token operator">=</span> sum<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  by<span class="token operator">=</span>.<span class="token punctuation">(</span>FIPS <span class="token operator">=</span> substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span><span class="token operator">-</span>countypop<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>
  CountyPopulation <span class="token operator">=</span> prettyNum<span class="token punctuation">(</span>countypop<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FIPS<span class="token punctuation">,</span> ST<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="datapack">

<a href="#datapack" class="help-page-title"><h2>See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame</h2></a>

<h3>Description</h3>

<p>See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span>pkg <span class="token operator">=</span> ejampackages<span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>a character vector giving the package(s) to look in for data sets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>len</code></td>
<td>
<p>Only affects what is printed to console - specifies the
number of characters to limit Title to, making it easier to see in the console.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame with Item and Title as columns
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span><span class="token string">"datasets"</span><span class="token punctuation">)</span>
 datapack<span class="token punctuation">(</span><span class="token string">"MASS"</span><span class="token punctuation">)</span>
 datapack<span class="token punctuation">(</span>ejampackages<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="distance_by_group">

<a href="#distance_by_group" class="help-page-title"><h2>distance_by_group
Get average distance for ONE demographic group versus everyone else</h2></a>

<h3>Description</h3>

<p>distance_by_group
Get average distance for ONE demographic group versus everyone else
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token string">"Demog.Index"</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> demogvarname
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>e.g., "pctlowinc"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>e.g., "Low Income Residents"</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note on Avg Distance and range of distances in each Demog group, &amp; %D as function of distance:
</p>
<p>We have info on each blockgroup near each site, which means some small % of those bgs are duplicated in this table:
</p>
<div class="sourceCode"><pre>results_bybg_people
</pre></div>
<p>Mostly we want overall (not by site) to know avg and cum distrib of distances in each demog,
</p>
<p>(and also %D as a function of continuous distance),
</p>
<p>and for those stats we would want to take only unique blockgroups from here,
using the shorter distance, so the distribution of distances does not doublecount people.
</p>
<p>But we might also want to see that distribution of distances by D for just 1 site?
</p>
<p>And we might also want to see the %D as a function of continuous distance at just 1 site?
</p>
<p>So to retain flexibility doaggregate() reports all instances of blockgroup-site pairings.
</p>


<h3>Value</h3>

<p>list of 2 numbers: avg_distance_for_group and avg_distance_for_nongroup
</p>


<h3>See Also</h3>

<p><code>distance_by_group_plot()</code> <code>distance_by_groups()</code>
</p>

<hr>
</div>
<div class="container manual-page" id="distance_cdf_by_group_plot">

<a href="#distance_cdf_by_group_plot" class="help-page-title"><h2>distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONE demographic group that are within each distance</h2></a>

<h3>Description</h3>

<p>distance_cdf_by_group_plot - SLOW - needs to be optimized
Plot a graphic showing cumulative shares of ONE demographic group that are within each distance
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_cdf_by_group_plot<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  radius_miles <span class="token operator">=</span> round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>x<span class="token operator">$</span>distance_min_avgperson<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> <span class="token string">"Demog.Index"</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> demogvarname<span class="token punctuation">,</span>
  color1 <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
  color2 <span class="token operator">=</span> <span class="token string">"black"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_miles</code></td>
<td>
<p>miles radius that was max distance analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>name of column in results_bybg_people, e.g., "pctlowinc"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>friendly text name for labelling graphic, like "Low income residents"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color1</code></td>
<td>
<p>color like "red" for demographic group of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color2</code></td>
<td>
<p>color like "gray" for everyone else</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly returns full table of sorted distances of blockgroups, cumulative count of demog group at that block group's distance,
and cumulative count of everyone else in that block group
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> for examples
</p>

<hr>
</div>
<div class="container manual-page" id="distance_via_surfacedistance">

<a href="#distance_via_surfacedistance" class="help-page-title"><h2>convert surface distance to actual distance</h2></a>

<h3>Description</h3>

<div class="sourceCode"><pre>\preformatted{
    Just a simple formula:
   earthRadius_miles &lt;- 3959
   angle_rad &lt;- x/earthRadius_miles
   # Calculate  radius * cord length
   return( earthRadius_miles * 2*sin(angle_rad/2) )
   }
</pre></div>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">distance_via_surfacedistance<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>surface distance in miles</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="doaggregate">

<a href="#doaggregate" class="help-page-title"><h2>Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</h2></a>

<h3>Description</h3>

<p>This updated 2023 code takes a set of facilities and the set of blocks that are near each,
(as identified previously, in other code that has identified which blocks are nearby)
and combines those with indicator scores for block groups.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">doaggregate<span class="token punctuation">(</span>
  sites2blocks<span class="token punctuation">,</span>
  sites2states_or_latlon <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>
  countcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  popmeancols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  calculatedcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  include_ejindexes <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  updateProgress <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  need_proximityscore <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  silentinteractive <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>data.table of distances in miles between all sites (facilities) and
nearby Census block internal points, with columns siteid, blockid, distance,
created by getblocksnearby  function.
See sites2blocks_example dataset in package, as input to this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sites2states_or_latlon</code></td>
<td>
<p>data.table or just data.frame, with columns siteid (each unique one in sites2blocks) and ST (2-character State abbreviation) or lat and lon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countcols</code></td>
<td>
<p>character vector of names of variables  to aggregate within a buffer
using a sum of counts, like, for example, the number of people for whom a
poverty ratio is known, the count of which is the exact denominator needed
to correctly calculate percent low income.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popmeancols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using population weighted mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calculatedcols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using formulas that have to be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>used while testing this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_ejindexes</code></td>
<td>
<p>not yet implemented</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>updateProgress</code></td>
<td>
<p>progress bar function used for shiny app</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>need_proximityscore</code></td>
<td>
<p>whether to calculate proximity scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silentinteractive</code></td>
<td>
<p>Set to FALSE to prevent long output showing in console in RStudio when in interactive mode</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>more to pass to another function? Not used currently.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>
<p>This function aggregates the blockgroup scores to create a summary of each indicator,
as a raw score and US percentile and State percentile,
in each buffer (i.e., near each facility):
</p>

<ul>
<li> <p><strong>SUMS OF COUNTS</strong>: for population count, or number of households or Hispanics, etc.
</p>
</li>
<li> <p><strong>POPULATION-WEIGHTED MEANS</strong>: for  Environmental indicators.
</p>
<p><em><strong>EJ Indexes</strong>:</em> These could be in theory recalculated via formula, but the way EJScreen
does this is apparently finding the pop wtd mean of EJ Index raw scores,
not the EJ Index formula applied to the summarized demographic score and aggregated envt number.
</p>
</li>
<li> <p><strong>CALCULATED BY FORMULA</strong>: Buffer or overall score calculated via formulas using aggregated counts,
such as percent low income = sum of counts low income / sum of counts of denominator,
which in this case is the count of those for whom the poverty ratio is known.
</p>
</li>
<li> <p><strong>LOOKED UP</strong>: Aggregated scores are converted into percentile terms via lookup tables (US or State version).
</p>
</li>
</ul>
<p>This function requires the following as data lazy loaded for example from EJAMblockdata package:
</p>

<ul>
<li>
<p> blockwts: data.table with these columns: blockid , bgid, blockwt
</p>
</li>
<li>
<p> Index built from quaddata, and blockquadtree: data.table and quad tree, for indexes of block points
(and localtree that is created when package is loaded)
</p>
</li>
<li>
<p> EJAM::blockgroupstats - A data.table (such as EJScreen demographic and environmental data by blockgroup?)
</p>
</li>
</ul>
<h3>See Also</h3>

<p><a href="#ejamit">ejamit</a>   <code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="dupenames">

<a href="#dupenames" class="help-page-title"><h2>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</h2></a>

<h3>Description</h3>

<p>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dupenames<span class="token punctuation">(</span>
  pkg <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">,</span>
  sortbypkg <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  compare.functions <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>one or more package names as vector of strings.
If "all" it checks all installed pkgs, but takes very very long potentially.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbypkg</code></td>
<td>
<p>If TRUE, just returns same thing but sorted by package name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare.functions</code></td>
<td>
<p>If TRUE, sends to console inf about whether body and formals
of the functions are identical between functions of same name from different packages.
Only checks the first 2 copies, not any additional ones (where 3+ pkgs use same name)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This can help find duplicates/conflicts within source code
and make sure they are on search path, for when renaming / moving functions/packages
</p>


<h3>Value</h3>

<p>data.frame with columns Package, Object name (or NA if no dupes)
</p>


<h3>See Also</h3>

<p><code><a href="#all.equal_functions">all.equal_functions()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="ejamit">

<a href="#ejamit" class="help-page-title"><h2>Get complete EJ analysis numbers (demographic and environmental indicators) near a list of locations</h2></a>

<h3>Description</h3>

<p>This is the main function in EJAM for users who want to use EJAM from RStudio.
It does essentially what the webapp does to analyze/summarize near a set of points.
See help("EJAM")
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ejamit<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It is automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of tables of results.
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#doaggregate">doaggregate()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># All in one step, using functions not shiny app:</span>
 <span class="token comment">## Not run: </span>
 out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testpoints_100_dt<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> quadtree<span class="token operator">=</span>localtree<span class="token punctuation">)</span>

 <span class="token comment"># Do not specify sitepoints and it will prompt you for a file,</span>
 <span class="token comment"># if in RStudio in interactive mode!</span>
 out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
 
  <span class="token comment"># Specify facilities or sites as points for test data, </span>
  <span class="token comment"># use 1000 test facility points from the R package </span>
  testsites <span class="token operator">&lt;-</span> testpoints_1000_dt
  <span class="token comment"># use facility points in an excel or csv file</span>
  testsites <span class="token operator">&lt;-</span> latlon_from_anything<span class="token punctuation">(</span>
   <span class="token string">"./inst/testdata/testpoints_207_sites_with_signif_violations_NAICS_326_ECHO.csv"</span><span class="token punctuation">)</span>
  <span class="token comment"># use facility points from a random sample of EPA-regulated facilities</span>
  testsites <span class="token operator">&lt;-</span> testpoints_n<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">)</span>  
  
  <span class="token comment"># Specify max distance from sites to look at (residents within X miles of site point)</span>
  radius <span class="token operator">&lt;-</span> <span class="token number">3.1</span> <span class="token comment"># miles</span>
  
  <span class="token comment"># Get summaries of all indicators near a set of points </span>
  out <span class="token operator">&lt;-</span> ejamit<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> radius<span class="token punctuation">)</span>  
  <span class="token comment"># out &lt;- ejamit("myfile.xlsx", 3.1)  </span>
  
  <span class="token comment"># out2 &lt;- EJAMejscreenapi::ejscreenit(testpoints_1000[1:3,])</span>
  
  <span class="token comment"># View results overall</span>
  round<span class="token punctuation">(</span>t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_overall<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">)</span>
  
  <span class="token comment"># View plots</span>
  <span class="token comment"># plot_distance_avg_by_group(out)  </span>
  <span class="token comment"># plot_distance_cdf_by_group(out)</span>
  
  <span class="token comment"># View maps</span>
  mapfast<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">3.1</span><span class="token punctuation">)</span>
  
  <span class="token comment"># view results at a single site</span>
  t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
  t<span class="token punctuation">(</span>out<span class="token operator">$</span>results_bysite<span class="token punctuation">[</span>out<span class="token operator">$</span>results_bysite<span class="token operator">$</span>siteid <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
  
  <span class="token comment"># if doing just 1st step of ejamit() </span>
  <span class="token comment">#  get distance between each site and every nearby Census block</span>
  s2b <span class="token operator">&lt;-</span> testdata_sites2blocks
  s2b <span class="token operator">&lt;-</span> getblocksnearby<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> radius<span class="token punctuation">)</span>
  s2b <span class="token operator">&lt;-</span> getblocksnearbyviaQuadTree<span class="token punctuation">(</span>testsites<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> radius<span class="token punctuation">)</span>
  getblocks_diagnostics<span class="token punctuation">(</span>s2b<span class="token punctuation">)</span>
  
  <span class="token comment"># if doing just 2d step of ejamit()</span>
  <span class="token comment">#  get summaries of all indicators based on table of distances</span>
  out <span class="token operator">&lt;-</span> doaggregate<span class="token punctuation">(</span>s2b<span class="token punctuation">,</span> testsites<span class="token punctuation">)</span> <span class="token comment"># this works now and is simpler</span>
  

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="ejampackages">

<a href="#ejampackages" class="help-page-title"><h2>list of names of EJAM-related R packages</h2></a>

<h3>Description</h3>

<p>list of names of EJAM-related R packages
</p>

<hr>
</div>
<div class="container manual-page" id="fips_lead_zero">

<a href="#fips_lead_zero" class="help-page-title"><h2>fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.</h2></a>

<h3>Description</h3>

<p>fips_lead_zero
Add leading zeroes to fips codes if missing, replace with NA if length invalid
Note it does NOT VALIDATE FIPS -
It does NOT check if FIPS is valid other than checking its length seems OK,
i.e., it might be a state, county, tract, blockgroup, or block FIPS code.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fips_lead_zero<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of numeric or character US FIPS codes</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of same length
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">fips_lead_zero<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"01"</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">,</span><span class="token string">"1234"</span><span class="token punctuation">,</span><span class="token string">"12345"</span><span class="token punctuation">,</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="fipsbg_from_anyfips">

<a href="#fipsbg_from_anyfips" class="help-page-title"><h2>fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS</h2></a>

<h3>Description</h3>

<p>fipsbg_from_anyfips
convert any FIPS codes to the FIPS of all the blockgroups that are
among or within or containing those FIPS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">fipsbg_from_anyfips<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of US FIPS codes, as character or numeric,
with or without their leading zeroes, each with as many characters</p>
</td>
</tr></table>
<h3>Details</h3>

<p>This is a way to get a list of blockgroups, specified by state/county/tract or even block.
</p>
<p>Takes a vector of one or more FIPS that could be State (2-digit), County (5-digit),
Tract (11-digit), or blockgroup (12 digit), or even block (15-digit fips).
</p>
<p>Returns unique vector of FIPS of all US blockgroups (including DC and Puerto Rico)
that contain any specified blocks, are equal to any specified blockgroup fips,
or are contained within any provided tract/county/state FIPS.
</p>
<p>stateinfo$STmatch( unique(substr(blockgroupstats$bgfips,1,2)), stateinfo$FIPS.ST)
</p>


<h3>Value</h3>

<p>vector of blockgroup FIPS (or NA values) that may be much longer than the
vector of fips passed to this function.
</p>


<h3>See Also</h3>

<p><code><a href="#fips_lead_zero">fips_lead_zero()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># all blockgroups in one state</span>
  blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>.N<span class="token punctuation">,</span>by<span class="token operator">=</span>substr<span class="token punctuation">(</span>bgfips<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  length<span class="token punctuation">(</span>fipsbg_from_anyfips<span class="token punctuation">(</span><span class="token string">"72"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># all blockgroups in this one county</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span><span class="token number">30001</span><span class="token punctuation">)</span>
  <span class="token comment"># all blockgroups that contain any of these 6 blocks (just one bg)</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span> blockid2fips<span class="token operator">$</span>blockfips<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment"># 2 counties</span>
  fipsbg_from_anyfips<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">36009</span><span class="token punctuation">,</span><span class="token number">36011</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="format_gt_table">

<a href="#format_gt_table" class="help-page-title"><h2>format_gt_table</h2></a>

<h3>Description</h3>

<p>format_gt_table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">format_gt_table<span class="token punctuation">(</span>
  df<span class="token punctuation">,</span>
  type<span class="token punctuation">,</span>
  my_cell_color <span class="token operator">=</span> <span class="token string">"#dce6f0"</span><span class="token punctuation">,</span>
  my_border_color <span class="token operator">=</span> <span class="token string">"#0070c0"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df, </code></td>
<td>
<p>a data frame with 6 columns (var_names, value, state_avg, state_pctile, usa_avg, usa_pctile), and one row per indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type, </code></td>
<td>
<p>string - one of 'demog', 'envt'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my_cell_color, </code></td>
<td>
<p>color for filling in background of table cells, can be given as string ('blue') or hex code ('#0070c0')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my_border_color, </code></td>
<td>
<p>color for table borders and boundaries, can be given as string ('blue') or hex code ('#0070c0')</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a 'gt'-style table with formatting to closely match EJScreen standard report formatting
</p>

<hr>
</div>
<div class="container manual-page" id="frs_from_naics">

<a href="#frs_from_naics" class="help-page-title"><h2>Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Use NAICS code or industry title text search to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_naics<span class="token punctuation">(</span>naics_code_or_name<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>naics_code_or_name</code></td>
<td>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>See Also</h3>

<p><code>siteid_from_naics()</code> <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_naics<span class="token punctuation">(</span><span class="token string">"uranium"</span><span class="token punctuation">)</span>
  mapfast<span class="token punctuation">(</span>frs_from_naics<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"nuclear"</span><span class="token punctuation">)</span><span class="token operator">$</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  naics_from_name<span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span><span class="token number">212222</span> <span class="token punctuation">)</span>
  frs_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span>
  siteid_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span><span class="token number">21222</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_program">

<a href="#frs_from_program" class="help-page-title"><h2>Use EPA Program acronym like TRIS to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Get data.table based on given FRS Program System CATEGORY.
Find all FRS sites in a program like RCRAINFO, TRIS, or others.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_program<span class="token punctuation">(</span>program<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>program</code></td>
<td>
<p>vector of one or more EPA Program names used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">mapfast<span class="token punctuation">(</span>latlon_from_program<span class="token punctuation">(</span><span class="token string">"CAMDBS"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#p1="TRIS"; p2="EIS"; </span>
    <span class="token comment">#analyze.stuff::overlaps(</span>
    <span class="token comment">#  latlon_from_program(p1)$REGISTRY_ID, </span>
    <span class="token comment">#  latlon_from_program(p2)$REGISTRY_ID, </span>
    <span class="token comment">#  ab_names = c(p1,p2)</span>
    <span class="token comment">#)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_programid">

<a href="#frs_from_programid" class="help-page-title"><h2>Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Use EPA Program ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_programid<span class="token punctuation">(</span>programid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Program ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x<span class="token operator">=</span>frs_from_programid<span class="token punctuation">(</span>testids_program_sys_id<span class="token punctuation">)</span>
  x
  mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_regid">

<a href="#frs_from_regid" class="help-page-title"><h2>Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_regid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Registry ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>testids_registry_id<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_siteid">

<a href="#frs_from_siteid" class="help-page-title"><h2>Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites</h2></a>

<h3>Description</h3>

<p>Use registry ID to see FRS Facility Registry Service data on those EPA-regulated sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>vector of one or more EPA Registry ID codes used by FRS</p>
</td>
</tr></table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">frs_from_siteid<span class="token punctuation">(</span>testids_registry_id<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_from_sitename">

<a href="#frs_from_sitename" class="help-page-title"><h2>Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text</h2></a>

<h3>Description</h3>

<p>Use site name text search to see FRS Facility Registry Service data on those EPA-regulated sites
VERY SLOW search within PRIMARY_NAME of facilities for matching text
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_from_sitename<span class="token punctuation">(</span>sitenames<span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitenames</code></td>
<td>
<p>one or more strings in a vector, which can be regular expressions or query for exact match using fixed=TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>logical, search is not case sensitive by default (unlike <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code> default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code>, if set to TRUE it looks for only exact matches</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>relevant rows of the data.table called <a>frs</a>, which has column names that are
"lat" "lon" "REGISTRY_ID" "PRIMARY_NAME" "NAICS" "PGM_SYS_ACRNMS"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token comment"># very slow</span>
 x<span class="token operator">=</span>frs_from_sitename
 nrow<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 head<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="frs_is_valid">

<a href="#frs_is_valid" class="help-page-title"><h2>Validate FRS Registry ID list uploads</h2></a>

<h3>Description</h3>

<p>Check for proper FRS facility id in uploaded data
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">frs_is_valid<span class="token punctuation">(</span>frs_upload<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>frs_upload</code></td>
<td>
<p>upload frs registry IDs table converted to data frame</p>
</td>
</tr></table>
<h3>Value</h3>

<p>boolean value (valid or not valid)
</p>

<hr>
</div>
<div class="container manual-page" id="get_blockpoints_in_shape">

<a href="#get_blockpoints_in_shape" class="help-page-title"><h2>find blocks that are in a polygon, using internal point of block - WORK IN PROGRESS ****</h2></a>

<h3>Description</h3>

<p>This is like getblocksnearby() but for a polygonal buffer area instead of
a circular buffer.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_blockpoints_in_shape<span class="token punctuation">(</span>
  polys<span class="token punctuation">,</span>
  addedbuffermiles <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  blocksnearby <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dissolved <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  safety_margin_ratio <span class="token operator">=</span> <span class="token number">1.1</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>polys</code></td>
<td>
<p>Spatial data as from sf::st_as_sf(), with a column called siteid, like
points as from <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code>,
or a table of points with lat,lon columns that will first be converted here using that function,
or polygons (not yet tested).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addedbuffermiles</code></td>
<td>
<p>width of optional buffering to add to the points (or edges), in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksnearby</code></td>
<td>
<p>optional table of blocks with blockid,siteid (from which lat,lon can be looked up in blockpoints dt)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dissolved</code></td>
<td>
<p>If TRUE, use sf::st_union(polys) to find unique blocks inside any one or more of polys</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>safety_margin_ratio</code></td>
<td>
<p>multiplied by addedbuffermiles, how far to search for
blocks nearby using getblocksnearby(), before using those found to do the intersection via sf::</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This uses getblocksnearby() to get a very fast rough/good estimate of
which US block points are nearby (with a safety margin - see param below),
before then using sf:: to carefully identify which of those candidate blocks are actually
inside each polygon (e.g., circle) according to sf:: methods.
For circular buffers, just using getblocksnearby() should work and not need this function.
For noncircular polygons, buffered or not, this function will provide a way to very quickly
filter down to which of the millions of US blocks should be examined by the sf:: join / intersect,
since otherwise it takes forever for sf:: to check all US blocks.
</p>


<h3>Value</h3>

<p>Block points table for those blocks whose internal point is inside the buffer
which is just a circular buffer of specified radius if polys are just points.
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <code><a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">=</span> get_shapefile_from_sitepoints<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># y = get_blockpoints_in_shape(x, 1)  # very very slow</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get_circles_from_spatialpoints">

<a href="#get_circles_from_spatialpoints" class="help-page-title"><h2>add buffer around shape (points, here)</h2></a>

<h3>Description</h3>

<p>add buffer around shape (points, here)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_circles_from_spatialpoints<span class="token punctuation">(</span>shapefile_points<span class="token punctuation">,</span> radius.miles<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>shapefile_points</code></td>
<td>
<p>spatial object like areas at high risk or areas with facilities to be analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius.miles</code></td>
<td>
<p>width of buffer to add to shapefile_points
(in case dist is a units object, it should be
convertible to arc_degree if x has geographic coordinates,
and to st_crs(x)$units otherwise)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to st_buffer()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Just a wrapper for <code><a href="https://r-spatial.r-universe.dev/manual/sf.html#geos_unary">sf::st_buffer()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points</a>
</p>

<hr>
</div>
<div class="container manual-page" id="get_shape_buffered_from_shapefile_points">

<a href="#get_shape_buffered_from_shapefile_points" class="help-page-title"><h2>add buffer around shape (points, here)</h2></a>

<h3>Description</h3>

<p>add buffer around shape (points, here)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_shape_buffered_from_shapefile_points<span class="token punctuation">(</span>shapefile_points<span class="token punctuation">,</span> radius.miles<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>shapefile_points</code></td>
<td>
<p>spatial object like areas at high risk or areas with facilities to be analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius.miles</code></td>
<td>
<p>width of buffer to add to shapefile_points
(in case dist is a units object, it should be
convertible to arc_degree if x has geographic coordinates,
and to st_crs(x)$units otherwise)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to st_buffer()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Just a wrapper for <code><a href="https://r-spatial.r-universe.dev/manual/sf.html#geos_unary">sf::st_buffer()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points</a>
</p>

<hr>
</div>
<div class="container manual-page" id="get_shapefile_from_sitepoints">

<a href="#get_shapefile_from_sitepoints" class="help-page-title"><h2>convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points</h2></a>

<h3>Description</h3>

<p>convert table of lat,lon points/sites into sf:: shapefile
Creates a simple feature (sf) dataframe from points
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_shapefile_from_sitepoints<span class="token punctuation">(</span>sitepoints<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>a data.table or data.frame with columns called lat,lon</p>
</td>
</tr></table>
<h3>Value</h3>

<p>A shapefile via <code><a href="https://r-spatial.r-universe.dev/manual/sf.html#st_as_sf">sf::st_as_sf()</a></code>
</p>


<h3>See Also</h3>

<p><code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#get_shapefile_from_sitepoints">get_shapefile_from_sitepoints()</a></code> <code><a href="#get_shape_buffered_from_shapefile_points">get_shape_buffered_from_shapefile_points()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocks_diagnostics">

<a href="#getblocks_diagnostics" class="help-page-title"><h2>Get summary stats on counts of blocks (unique vs doublecounted) near sites</h2></a>

<h3>Description</h3>

<p>Get summary stats on counts of blocks (unique vs doublecounted) near sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_diagnostics<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like sites2blocks_example</p>
</td>
</tr></table>
<h3>Value</h3>

<p>A list of stats
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">getblocks_diagnostics<span class="token punctuation">(</span>sites2blocks_example<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocks_summarize_blocks_per_site">

<a href="#getblocks_summarize_blocks_per_site" class="help-page-title"><h2>helper- Get summary stats on counts of blocks near various sites</h2></a>

<h3>Description</h3>

<p>Tells you # of blocks near avg site,
how many sites have only 1 block nearby, or have &lt;30 nearby, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_summarize_blocks_per_site<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"siteid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of getblocksnearby()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>


<h3>See Also</h3>

<p><code><a href="#getblocks_diagnostics">getblocks_diagnostics()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocks_summarize_sites_per_block">

<a href="#getblocks_summarize_sites_per_block" class="help-page-title"><h2>helper- Get summary stats on how many sites are near various blocks (residents)</h2></a>

<h3>Description</h3>

<p>helper- Get summary stats on how many sites are near various blocks (residents)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocks_summarize_sites_per_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"blockid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like sites2blocks_example</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>


<h3>See Also</h3>

<p><code><a href="#getblocks_diagnostics">getblocks_diagnostics()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby">

<a href="#getblocksnearby" class="help-page-title"><h2>Fast way to find nearby points - finds distance to each Census block centroid nearby</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree<span class="token punctuation">,</span>
  parallel <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It is automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <code><a href="#ejamit">ejamit()</a></code> for examples.
</p>
<p>getblocksnearby() is a wrapper redirecting to the right version, like <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
Census block "internal points" (defined by Census Bureau) are actually what it looks for,
and they are like centroids.
The blocks are pre-indexed for the whole USA, via the data object quadtree aka localtree
</p>


<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code>  <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby2">

<a href="#getblocksnearby2" class="help-page-title"><h2>Key buffering function - wrapper redirecting to the right version of getblocksnearby()</h2></a>

<h3>Description</h3>

<p>Key buffering function - wrapper redirecting to the right version of getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree <span class="token operator">=</span> is.null<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>a large quadtree object created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#ejamit">ejamit()</a></code>
</p>
<p>Like getblocksnearby() but tries to handle localtree and quadtree parameter differently
</p>

<ul><li>
<p> not sure how to check if they are in the right environment.
</p>
</li></ul>
<h3>See Also</h3>

<p><code>getblocksnearby_and_doaggregate()</code> <code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree">

<a href="#getblocksnearbyviaQuadTree" class="help-page-title"><h2>Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It is automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code> <code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree_Clustered">

<a href="#getblocksnearbyviaQuadTree_Clustered" class="help-page-title"><h2>find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Uses packages <a href="https://deepayan.r-universe.dev/manual/lattice.html#splom">parallel</a> and snow. parallel::makePSOCKcluster is an enhanced version of snow::makeSOCKcluster in package snow.
It runs Rscript on the specified host(s) to set up a worker process which listens on a socket for expressions to evaluate, and returns the results (as serialized objects).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree_Clustered<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff<span class="token punctuation">,</span>
  maxcutoff<span class="token punctuation">,</span>
  avoidorphans<span class="token punctuation">,</span>
  CountCPU <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns LAT, LONG</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles distance (check what this actually does)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (check what this actually does)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CountCPU</code></td>
<td>
<p>for parallel processing via makeCluster() and doSNOW::registerDoSNOW()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>index of all US blocks like localtree</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all examples, see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>
<p>Uses indexgridsize and quaddata  variables that come from global environment (but should pass to this function rather than assume in global env?)
</p>


<h3>See Also</h3>

<p><code>getblocksnearby_and_doaggregate()</code> <code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree2">

<a href="#getblocksnearbyviaQuadTree2" class="help-page-title"><h2>Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>This should be almost identical to getblocksnearbyviaQuadTree(),
but it uses f2, a copy of sitepoints, and more importantly it
pulls some code out of the for loop and uses a vectorized approach.
Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code>  <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">localtree_example <span class="token operator">=</span> SearchTrees<span class="token operator">::</span>createTree<span class="token punctuation">(</span>EJAMblockdata<span class="token operator">::</span>quaddata<span class="token punctuation">,</span> treeType <span class="token operator">=</span> <span class="token string">"quad"</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">"point"</span><span class="token punctuation">)</span>
  x <span class="token operator">=</span> getblocksnearby2<span class="token punctuation">(</span>testpoints_1000_dt<span class="token punctuation">,</span> quadtree <span class="token operator">=</span> localtree_example<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree3">

<a href="#getblocksnearbyviaQuadTree3" class="help-page-title"><h2>Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree3<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It is automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#ejamit">ejamit()</a></code> <code><a href="#getblocksnearby">getblocksnearby()</a></code> <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="indexblocks">

<a href="#indexblocks" class="help-page-title"><h2>indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment</h2></a>

<h3>Description</h3>

<p>indexblocks
Create localtree (a quadtree index of all US block centroids) in global environment
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">indexblocks<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>


<h3>Details</h3>

<p>.onLoad() can be edited to create this when the package loads,
but then it takes time each time a developer rebuilds/installs the package or others that load EJAM.
</p>


<h3>Value</h3>

<p>Side effect is it creates the index in memory
</p>

<hr>
</div>
<div class="container manual-page" id="input_names_listing">

<a href="#input_names_listing" class="help-page-title"><h2>input_names_listing
Utility checking values of input$ that appear in this code</h2></a>

<h3>Description</h3>

<p>input_names_listing
Utility checking values of input$ that appear in this code
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">input_names_listing<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"./R/app_server.R"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>path to source file to search in</p>
</td>
</tr></table>
<h3>Value</h3>

<p>character vector of ids of inputs like x,y,z if it found input$x input$y input$z
</p>

<hr>
</div>
<div class="container manual-page" id="installejamsource">

<a href="#installejamsource" class="help-page-title"><h2>installejamsource
utility for when working on the source code - redoes documentation and reinstalls packages</h2></a>

<h3>Description</h3>

<p>installejamsource
utility for when working on the source code - redoes documentation and reinstalls packages
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">installejamsource<span class="token punctuation">(</span>pkg <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>vector of names of folders with source packages,
but not the full path - just the package name.
Assumes that R_USER points to the folder that has all those source package folders in it.</p>
</td>
</tr></table>
<h3>Value</h3>

<p>nothing. side effect is it does document() and INSTALL
</p>

<hr>
</div>
<div class="container manual-page" id="lat_alias-lon_alias">

<a href="#lat_alias-lon_alias" class="help-page-title"><h2>Synonyms for lat and lon</h2></a>

<h3>Description</h3>

<p>lists of synonyms for "latitude" and "longitude" used when guessing which column is what in user-provided tables of coordinates
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_as.numeric">

<a href="#latlon_as.numeric" class="help-page-title"><h2>Strip non-numeric characters from a vector</h2></a>

<h3>Description</h3>

<p>Remove all characters other than minus signs, decimal points, and numeric digits
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of something that is supposed to be numbers like latitude or longitude
and may be a character vector because there were some other characters like tab or space or percent sign or dollar sign</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Useful if latitude or longitude vector has spaces, tabs, etc.
CAUTION - Assumes stripping those out and making it numeric will fix whatever problem there was
and end result is a valid set of numbers. Inf etc. are turned into NA values.
Empty zero length string is turned into NA without warning. NA is left as NA.
If anything other than empty or NA could not be interpreted as a number, it
returns NA for those and offers a warning.
</p>


<h3>Value</h3>

<p>numeric vector same length as x
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"-97.179167000000007"</span><span class="token punctuation">,</span> <span class="token string">" -94.0533"</span><span class="token punctuation">,</span> <span class="token string">"-95.152083000000005"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'asdf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'aword'</span><span class="token punctuation">,</span> <span class="token string">'$b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'-10.5%'</span><span class="token punctuation">,</span> <span class="token string">'&lt;5'</span><span class="token punctuation">,</span> <span class="token string">'$100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">Inf</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_df_clean">

<a href="#latlon_df_clean" class="help-page-title"><h2>Find and clean up latitude and longitude columns in a data.frame</h2></a>

<h3>Description</h3>

<p>Utility to identify lat and lon columns, renaming and cleaning them up.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_df_clean<span class="token punctuation">(</span>df<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>data.frame With columns lat and lon or names that can be interpreted as such</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Tries to figure out which columns seem to have lat lon values, renames those in the data.frame.
Cleans up lat and lon values (removes extra characters, makes numeric)
</p>


<h3>Value</h3>

<p>Returns the same data.frame but with relevant colnames changed to lat and lon,
and invalid lat or lon values cleaned up if possible or else replaced with NA
</p>


<h3>See Also</h3>

<p>Used by <code><a href="#latlon_from_anything">latlon_from_anything()</a></code>. Uses <code><a href="#latlon_infer">latlon_infer()</a></code> <code><a href="#latlon_is.valid">latlon_is.valid()</a></code> <code><a href="#latlon_as.numeric">latlon_as.numeric()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#  x &lt;- latlon_df_clean(x)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_anything">

<a href="#latlon_from_anything" class="help-page-title"><h2>Flexibly get lat/lon from file, data.frame, data.table, or lat/lon vectors</h2></a>

<h3>Description</h3>

<p>Try to figure out if user provided latitude / longitude as vectors, data.frame, file, or interactively pick file.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_anything<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>If missing and interactive mode in RStudio, prompts user for file. Otherwise,
this can be a filename (csv or xlsx, with path), or data.frame/ data.table/ matrix,
or vector of longitudes (in which case y must be the latitudes).
Note that even though it is called latlon_etc the lon is x and comes before the lat among parameters x,y
File or data.frame/data.table/matrix must have columns called lon and lat, or something that can
be inferred to be that by latlon_infer()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>If x is a vector of longitudes, y must be the latitudes. Ignored otherwise.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function, <code><a href="#latlon_from_anything">latlon_from_anything()</a></code>
</p>
<p>relies on
</p>
<p><code><a>EJAMbatch.summarizer::read_csv_or_xl()</a></code> = <code><a>EJAMejscreenapi::read_csv_or_xl()</a></code> and
</p>
<p><code><a href="#latlon_df_clean">latlon_df_clean()</a></code> which in turn uses <code><a href="#latlon_infer">latlon_infer()</a></code> <code><a href="#latlon_as.numeric">latlon_as.numeric()</a></code> <code><a href="#latlon_is.valid">latlon_is.valid()</a></code>
</p>
<p><code><a>EJAMejscreenapi::read_and_clean_points()</a></code>
</p>
<p>would be the most general / flexible broadest way to get points, but is still work in progress
</p>
<p>is similar to what is done by <code><a href="#latlon_from_anything">latlon_from_anything()</a></code>
</p>
<p>except it also uses these functions:
</p>
<p><code><a href="#latlon_from_siteid">latlon_from_siteid()</a></code>
</p>
<p><code><a href="#latlon_from_programid">latlon_from_programid()</a></code>   but not  _from_naics() ?
</p>


<h3>Value</h3>

<p>A data.frame that has at least columns lon and lat (and others if they were in x)
</p>


<h3>See Also</h3>

<p><code><a>EJAMbatch.summarizer::read_csv_or_xl()</a></code> <code><a href="#latlon_df_clean">latlon_df_clean()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token keyword">if</span> <span class="token punctuation">(</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 pts <span class="token operator">&lt;-</span> latlon_from_anything<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 latlon_from_anything<span class="token punctuation">(</span>system.file<span class="token punctuation">(</span><span class="token string">"testdata/Sample12.xlsx"</span><span class="token punctuation">,</span> 
   package<span class="token operator">=</span><span class="token string">"EJAMejscreenapi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>system.file<span class="token punctuation">(</span><span class="token string">"testdata/testpoints_05.csv"</span><span class="token punctuation">,</span> 
   package<span class="token operator">=</span><span class="token string">"EJAMejscreenapi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>testpoints_50<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>testpoints_50<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">,</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
 latlon_from_anything<span class="token punctuation">(</span>x<span class="token operator">=</span>testpoints_50<span class="token operator">$</span>lon<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>testpoints_50<span class="token operator">$</span>lat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_naics">

<a href="#latlon_from_naics" class="help-page-title"><h2>Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)</h2></a>

<h3>Description</h3>

<p>Find EPA-regulated facilities in FRS by NAICS code (industrial category)
Get lat lon, Registry ID, given NAICS industry code(s)
Find all EPA Facility Registry Service (FRS) sites with this exact NAICS code (not subcategories)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_naics<span class="token punctuation">(</span>naics<span class="token punctuation">,</span> id_only <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>a vector of naics codes, or
a data.table with column named code, as with output of <code><a href="#naics_from_any">naics_from_any()</a></code></p>
</td>
</tr></table>
<h3>Details</h3>

<p>NOTE: many FRS sites lack NAICS code!
</p>
<p>Also, this function does not find the sites
identified by FRS data as being in a child NAICS (subcategory of your exact query)!
</p>
<p>Relies on EJAMfrsdata::frs_by_naics (a data.table)
</p>
<p>See info about NAICS industry codes at <a href="https://www.naics.com/search" target="_blank">https://www.naics.com/search</a>
</p>


<h3>Value</h3>

<p>A data.table (not just data.frame) with columns called
lat, lon, REGISTRY_ID, NAICS (but see the id_only parameter)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">siteid_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span><span class="token number">321114</span><span class="token punctuation">)</span>
  latlon_from_naics<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  head<span class="token punctuation">(</span>latlon_from_naics<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3366</span><span class="token punctuation">,</span> <span class="token number">33661</span><span class="token punctuation">,</span> <span class="token number">336611</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id_only<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># mapfast(frs_from_naics(336611)) # simple map</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_program">

<a href="#latlon_from_program" class="help-page-title"><h2>Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others</h2></a>

<h3>Description</h3>

<p>Get lat lon, Registry ID, and NAICS, for given FRS Program System CATEGORY
Find all FRS sites in a program like RCRAINFO, TRIS, or others
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_program<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>program</code></td>
<td>
<p>like "RMP", "RCRAINFO", "TRIS", "RMP", or others.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For info on FRS program codes in general, see <a href="https://www.epa.gov/frs/frs-program-crosswalks" target="_blank">https://www.epa.gov/frs/frs-program-crosswalks</a>
</p>
<p>Also see information at <a href="https://echo.epa.gov/tools/data-downloads/frs-download-summary" target="_blank">https://echo.epa.gov/tools/data-downloads/frs-download-summary</a>
about the file FRS_PROGRAM_LINKS.csv
</p>
<p>For info on program codes ECHO uses, see <a href="https://echo.epa.gov/resources/echo-data/about-the-data" target="_blank">https://echo.epa.gov/resources/echo-data/about-the-data</a>
</p>
<p>including <a href="https://www.epa.gov/frs/frs-environmental-interest-types" target="_blank">https://www.epa.gov/frs/frs-environmental-interest-types</a>
</p>
<p>For a list of program acronyms, <a href="https://www.epa.gov/frs/frs-rest-services#appendixa" target="_blank">https://www.epa.gov/frs/frs-rest-services#appendixa</a>
</p>
<p>The acronym is the abbreviated name that represents the name of an
information management system for an environmental program.
The Federal ones with at least 100k facilities each are
</p>
<p>RCRAINFO (over 500k sites), NPDES, ICIS, AIR, FIS, EIS, and AIRS/AFS.
</p>


<h3>Value</h3>

<p>data.table with lat  lon  REGISTRY_ID  program  but not pgm_sys_id
since there could be duplicates where same REGISTRY_ID has 2 different pgm_sys_id values
in the same program, so results were sometimes longer than if using <code><a href="#frs_from_program">frs_from_program()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 x <span class="token operator">=</span> latlon_from_program<span class="token punctuation">(</span><span class="token string">"CAMDBS"</span><span class="token punctuation">)</span>
 EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 program <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"EIS"</span><span class="token punctuation">,</span> <span class="token string">"UST"</span><span class="token punctuation">)</span>
 x <span class="token operator">=</span> latlon_from_program<span class="token punctuation">(</span>program<span class="token punctuation">)</span>
 <span class="token comment"># to get the facility name as well:</span>
 x <span class="token operator">=</span> frs<span class="token punctuation">[</span>grepl<span class="token punctuation">(</span><span class="token string">"RCRAINFO"</span><span class="token punctuation">,</span> PGM_SYS_ACRNMS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token comment"># fast</span>
 <span class="token comment">## x = latlon_from_siteid(latlon_from_program(program)[,REGISTRY_ID])  # slower!</span>
 EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">[</span>sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_programid">

<a href="#latlon_from_programid" class="help-page-title"><h2>Get lat lon, Registry ID, and NAICS, for given FRS Program System ID</h2></a>

<h3>Description</h3>

<p>Get lat lon, Registry ID, and NAICS, for given FRS Program System ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_programid<span class="token punctuation">(</span>programid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>programid</code></td>
<td>
<p>like "XJW000012435"</p>
</td>
</tr></table>
<h3>Details</h3>

<p>The ID is the identification number, such as the permit number,
assigned by an information management system that represents a
facility site, waste site, operable unit, or other feature tracked by that
Environmental Information System.
</p>
<p>Also note the FRS API:
<a href="https://www.epa.gov/frs/facility-registry-service-frs-api" target="_blank">https://www.epa.gov/frs/facility-registry-service-frs-api</a>
<a href="https://www.epa.gov/frs/frs-rest-services" target="_blank">https://www.epa.gov/frs/frs-rest-services</a>
</p>


<h3>Value</h3>

<p>data.table with lat  lon  REGISTRY_ID  program   pgm_sys_id
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_programid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"XJW000012435"</span><span class="token punctuation">,</span> <span class="token string">"00768SRTRSROAD1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 pids <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"7-0540-00003"</span><span class="token punctuation">,</span> <span class="token string">"354362"</span><span class="token punctuation">,</span> <span class="token string">"1513529"</span><span class="token punctuation">,</span> <span class="token string">"485659"</span><span class="token punctuation">,</span> <span class="token string">"LAG750956"</span><span class="token punctuation">,</span> 
   <span class="token string">"CAC002995519"</span><span class="token punctuation">,</span> <span class="token string">"3601252181"</span><span class="token punctuation">,</span> <span class="token string">"3601439158"</span><span class="token punctuation">)</span>
 latlon_from_siteid<span class="token punctuation">(</span>latlon_from_programid<span class="token punctuation">(</span>pids<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>REGISTRY_ID<span class="token punctuation">]</span><span class="token punctuation">)</span>
 latlon_from_programid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"XJW000012435"</span><span class="token punctuation">,</span> <span class="token string">"00768SRTRSROAD1"</span><span class="token punctuation">,</span> <span class="token string">"asdfsdf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>lat<span class="token punctuation">,</span>lon<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_regid">

<a href="#latlon_from_regid" class="help-page-title"><h2>Get lat lon (and NAICS) via Facility Registry ID</h2></a>

<h3>Description</h3>

<p>Get lat lon (and NAICS) via Facility Registry ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_regid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>Facility Registry Service ID like 110010052520</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns
lat,lon,REGISTRY_ID,PRIMARY_NAME,NAICS,PGM_SYS_ACRNMS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span><span class="token number">110070874073</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> latlon_from_siteid<span class="token punctuation">(</span>
    c<span class="token punctuation">(</span><span class="token number">110071293460</span><span class="token punctuation">,</span> <span class="token number">110070874073</span><span class="token punctuation">,</span> <span class="token number">110070538057</span><span class="token punctuation">,</span> <span class="token number">110044340807</span><span class="token punctuation">,</span>
       <span class="token number">110030509215</span><span class="token punctuation">,</span> <span class="token number">110019033810</span><span class="token punctuation">,</span> <span class="token number">110056111559</span><span class="token punctuation">,</span> <span class="token number">110056982323</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_from_siteid">

<a href="#latlon_from_siteid" class="help-page-title"><h2>Get lat lon (and NAICS) via Facility Registry ID</h2></a>

<h3>Description</h3>

<p>Get lat lon (and NAICS) via Facility Registry ID
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span>siteid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>siteid</code></td>
<td>
<p>Facility Registry Service ID like 110010052520</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns
lat,lon,REGISTRY_ID,PRIMARY_NAME,NAICS,PGM_SYS_ACRNMS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_from_siteid<span class="token punctuation">(</span><span class="token number">110070874073</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> latlon_from_siteid<span class="token punctuation">(</span>
    c<span class="token punctuation">(</span><span class="token number">110071293460</span><span class="token punctuation">,</span> <span class="token number">110070874073</span><span class="token punctuation">,</span> <span class="token number">110070538057</span><span class="token punctuation">,</span> <span class="token number">110044340807</span><span class="token punctuation">,</span>
       <span class="token number">110030509215</span><span class="token punctuation">,</span> <span class="token number">110019033810</span><span class="token punctuation">,</span> <span class="token number">110056111559</span><span class="token punctuation">,</span> <span class="token number">110056982323</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_infer">

<a href="#latlon_infer" class="help-page-title"><h2>guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</h2></a>

<h3>Description</h3>

<p>guess which columns have lat and lon based on aliases like latitude, FacLat, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>mycolnames<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycolnames</code></td>
<td>
<p>e.g., colnames(x) where x is a data.frame from read.csv</p>
</td>
</tr></table>
<h3>Value</h3>

<p>returns all of mycolnames except replacing the best candidates with lat and lon
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'trilat'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># warns if no alias found, </span>
    <span class="token comment">#  but doesnt warn of dupes in other terms, just preferred term.</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'Longitude'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">,</span> <span class="token string">'Long'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'longing'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'LAT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of preferred are </span>
      <span class="token comment"># left alone only if lowercase one is found</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'long'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of a single alias are </span>
      <span class="token comment"># converted to preferred word (if pref not found), creating dupes!  warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes of an alias are renamed and still are dupes! warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'Lon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes left as dupes but warn!</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_is.valid">

<a href="#latlon_is.valid" class="help-page-title"><h2>Validate latitudes and longitudes</h2></a>

<h3>Description</h3>

<p>Check each latitude and longitude value to see if they are
NA or outside expected numeric ranges
(based on approx ranges of lat lon seen among block internal points dataset)
lat must be between 17.5 and 71.5, and
lon must be ( between -180 and -65) OR (between 172 and 180)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.valid<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes in decimal degrees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>numeric vector of longitudes in decimal degrees, same length</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 table<span class="token punctuation">(</span>latlon_is.valid<span class="token punctuation">(</span>lat <span class="token operator">=</span> EJAMblockdata<span class="token operator">::</span>blockpoints<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span> EJAMblockdata<span class="token operator">::</span>blockpoints<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">##      TRUE </span>
  <span class="token comment">## 8,174,955</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="map_facilities">

<a href="#map_facilities" class="help-page-title"><h2>map_facilities</h2></a>

<h3>Description</h3>

<p>make a leaflet map of uploaded points
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">map_facilities<span class="token punctuation">(</span>mypoints<span class="token punctuation">,</span> rad <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> highlight <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> clustered<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mypoints, </code></td>
<td>
<p>data frame of uploaded points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rad, </code></td>
<td>
<p>a size for drawing each circle (buffer search radius)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highlight, </code></td>
<td>
<p>a logicial for whether to highlight overlapping points (defaults to FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clustered, </code></td>
<td>
<p>a vector of T/F values for each point, indicating if they overlap with another</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a leaflet map with circles, circleMarkers, and basic popup
</p>

<hr>
</div>
<div class="container manual-page" id="metadata_add">

<a href="#metadata_add" class="help-page-title"><h2>helper function for package to set attributes of a dataset</h2></a>

<h3>Description</h3>

<p>This can be used annually to update some datasets in a package.
It just makes it easier to set a few metadata attributes similarly
for a number of data elements, for example,
to add new or update existing attributes.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>dataset (or any object) whose metadata you want to update or create</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata</code></td>
<td>
<p>must be a named list, so that the function can do this for each i:
attr(x, which=names(metadata)i) &lt;- metadata[i]</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>returns x but with new or altered attributes
</p>


<h3>See Also</h3>

<p>metadata_check()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">1001</span><span class="token operator">:</span><span class="token number">1010</span><span class="token punctuation">)</span>
  metadata <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>
  census_version <span class="token operator">=</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  acs_version <span class="token operator">=</span> <span class="token string">'2016-2020'</span><span class="token punctuation">,</span>
  acs_releasedate <span class="token operator">=</span> <span class="token string">'3/17/2022'</span><span class="token punctuation">,</span>
  ejscreen_version <span class="token operator">=</span> <span class="token string">'2.1'</span><span class="token punctuation">,</span>
  ejscreen_releasedate <span class="token operator">=</span> <span class="token string">'October 2022'</span><span class="token punctuation">,</span>
  ejscreen_pkg_data <span class="token operator">=</span> <span class="token string">'bg22'</span>
  <span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
  attributes<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> list<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'final'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  attr<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'status'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="metadata_check">

<a href="#metadata_check" class="help-page-title"><h2>helper function in updating the package metadata</h2></a>

<h3>Description</h3>

<p>Quick and dirty helper during development, to check all the
attributes of all the data files in relevant packages.
It loads unloaded packages as needed, which you might not want it to do,
but it is not coded to be able to check attributes without doing that.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_check<span class="token punctuation">(</span>
  packages <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">,</span>
  which <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"census_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ACS"</span><span class="token punctuation">,</span>
    <span class="token string">"ejscreen_version"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_pkg_data"</span><span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token string">"released"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  loadifnotloaded <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>packages</code></td>
<td>
<p>Optional. e.g. 'EJAMejscreendata', or can be a vector of character strings,
and if not specified, default is to report on all packages with EJ as part of their name,
like EJAMblockdata or ejscreenapi</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>Optional vector (not list) of strings, the attributes.
Default is some typical ones used in EJAM-related packages currently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loadifnotloaded</code></td>
<td>
<p>Optional to control if func should temporarily attach packages not already loaded.</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="NAICS">

<a href="#NAICS" class="help-page-title"><h2>named list of all NAICS code numbers and industry name for each</h2></a>

<h3>Description</h3>

<p>named list of all NAICS code numbers and industry name for each
</p>


<h3>Details</h3>

<p>see <a href="https://naics.com" target="_blank">https://naics.com</a>
</p>


<h3>See Also</h3>

<p><a href="#naicstable">naicstable</a> <code><a href="#naics_from_any">naics_from_any()</a></code> <code><a href="#naics_categories">naics_categories()</a></code> <a href="#NAICS">NAICS</a>
</p>

<hr>
</div>
<div class="container manual-page" id="naics_categories">

<a href="#naics_categories" class="help-page-title"><h2>See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</h2></a>

<h3>Description</h3>

<p>See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span>digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> dataset <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>default is 2, for 2-digits NAICS, the top level, but could be up to 6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Should default to the dataset called NAICS, installed with this package.
see <a href="#NAICS">NAICS</a>  Check attr(NAICS, 'year')</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Also see <a href="https://www.naics.com/search/" target="_blank">https://www.naics.com/search/</a>
</p>
<p>There are this many NAICS codes roughly by number of digits in the code:
</p>
<p>table(nchar(NAICS))
</p>
<p>2    3    4    5    6
</p>
<p>17   99  311  709 1057
</p>
<p>See <a href="https://www.census.gov/naics/" target="_blank">https://www.census.gov/naics/</a>
</p>


<h3>See Also</h3>

<p>naics_find  <a href="#NAICS">NAICS</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_download">

<a href="#naics_download" class="help-page-title"><h2>script to download NAICS file with code and name of sector</h2></a>

<h3>Description</h3>

<p>See source code. Mostly just a short script to get the 2017 or 2022 codes and names.
See &lt;'https://www.census.gov/naics/?48967'&gt;
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_download<span class="token punctuation">(</span>
  year <span class="token operator">=</span> <span class="token number">2017</span><span class="token punctuation">,</span>
  urlpattern <span class="token operator">=</span> <span class="token string">"https://www.census.gov/naics/YYYYNAICS/2-6%20digit_YYYY_Codes.xlsx"</span><span class="token punctuation">,</span>
  destfile <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">"~/Downloads/"</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> <span class="token string">"NAICS.xlsx"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>which vintage of NAICS codes to use, 2012, 2017, or 2022</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urlpattern</code></td>
<td>
<p>full url of xlsx file to use, but with YYYY instead of year</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>destfile</code></td>
<td>
<p>full path and name of file to save as locally</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>names list with year as an attribute
</p>

<hr>
</div>
<div class="container manual-page" id="naics_findwebscrape">

<a href="#naics_findwebscrape" class="help-page-title"><h2>for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_from_any">naics_from_any()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</h2></a>

<h3>Description</h3>

<p>for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_from_any">naics_from_any()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_findwebscrape<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>text like "gasoline" or "copper smelting"</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.frame of info on what was found, naics and title
</p>


<h3>See Also</h3>

<p><code><a href="#naics_from_any">naics_from_any()</a></code>  <code><a href="#url_naics.com">url_naics.com()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># naics_from_any("copper smelting")</span>
 <span class="token comment"># naics_from_any("copper smelting", website_scrape=TRUE)</span>
 <span class="token comment"># browseURL(naics_from_any("copper smelting", website_url=TRUE) )</span>
 
  url_naics.com<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  <span class="token comment">## Not run: </span>
  naics_findwebscrape<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>url_naics.com<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>naics_url_of_code<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_from_any">

<a href="#naics_from_any" class="help-page-title"><h2>General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text</h2></a>

<h3>Description</h3>

<p>General way to search for industry names and NAICS codes
Find industry names and codes by searching for queried code(s) or text
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_any<span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_scrape <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  website_url <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>query string(s) and/or number(s), vector of NAICS codes or industry names or any regular expression or partial words</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_scrape</code></td>
<td>
<p>whether to scrape info from the NAICS website to return a table of codes and names that match (web query uses synonyms so gets more hits)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>website_url</code></td>
<td>
<p>whether to return the URL of the webpage with info on the NAICS (web query uses synonyms so gets more hits)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># Also see vignette for examples</span>
  naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span>
  naics_from_any<span class="token punctuation">(</span>naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">]</span> 
  naics_from_any<span class="token punctuation">(</span>naics_categories<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">]</span> 
  naics_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naicstable<span class="token punctuation">[</span>code<span class="token operator">==</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  naics_subcodes_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naics_from_code<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span>  children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naicstable<span class="token punctuation">[</span>n3<span class="token operator">==</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span>
  
 naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics and rubber"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>
 naics_from_any<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">)</span>
 naics_from_any<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span>
 naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics"</span><span class="token punctuation">,</span> children<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>unique<span class="token punctuation">(</span>n3<span class="token punctuation">)</span><span class="token punctuation">]</span> 
 naics_from_any<span class="token punctuation">(</span><span class="token string">"pig"</span><span class="token punctuation">)</span>
 naics_from_any<span class="token punctuation">(</span><span class="token string">"pig "</span><span class="token punctuation">)</span> <span class="token comment"># space after g</span>
 
 <span class="token comment"># naics_from_any("copper smelting")</span>
 <span class="token comment"># naics_from_any("copper smelting", website_scrape=TRUE)</span>
 <span class="token comment"># browseURL(naics_from_any("copper smelting", website_url=TRUE) )</span>
 
 a <span class="token operator">=</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"plastics"</span><span class="token punctuation">)</span>
 b <span class="token operator">=</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"rubber"</span><span class="token punctuation">)</span> 
 fintersect<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#  a AND b</span>
 funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token comment">#  a OR  b</span>
 naics_subcodes_from_code<span class="token punctuation">(</span>funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span>   <span class="token comment">#  plus children</span>
 naics_from_any<span class="token punctuation">(</span>funion<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>code<span class="token punctuation">]</span><span class="token punctuation">,</span> children<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>.<span class="token punctuation">(</span>name<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#  same</span>
 
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token number">325</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 1</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token number">325</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 54</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#[1] 20</span>
 NROW<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">,</span> children <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">104</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_from_code">

<a href="#naics_from_code" class="help-page-title"><h2>search for industry names by NAICS code(s), 2-6 digits long each
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this</h2></a>

<h3>Description</h3>

<p>search for industry names by NAICS code(s), 2-6 digits long each
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>vector of numeric NAICS codes. see <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="naics_from_name">

<a href="#naics_from_name" class="help-page-title"><h2>search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this</h2></a>

<h3>Description</h3>

<p>search for industry names and NAICS codes by query string
query by parts of words, etc. in the industry name.
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_from_name<span class="token punctuation">(</span>mynames<span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fixed <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mynames</code></td>
<td>
<p>query string, vector of NAICS industry names or any regular expression or partial words. See <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>children</code></td>
<td>
<p>logical, if TRUE, also return all the subcategories - where NAICS starts with the same digits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>should it be an exact match? see <code><a href="https://r-universe.dev/manuals/base.html#grep">grepl()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>search_on_naics_website</code></td>
<td>
<p>whether to query on naics website for more hits than just search for text in industry title</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">data.table<span class="token operator">::</span>fintersect<span class="token punctuation">(</span>naics_from_any<span class="token punctuation">(</span> <span class="token string">"manufac"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> naics_from_any<span class="token punctuation">(</span><span class="token string">"chem"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_subcodes_from_code">

<a href="#naics_subcodes_from_code" class="help-page-title"><h2>find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.</h2></a>

<h3>Description</h3>

<p>find subcategories of the given overall NAICS industry code(s)
Given 3-digit NAICS code, for example, get all NAICS that start with those digits.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_subcodes_from_code<span class="token punctuation">(</span>mycodes<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycodes</code></td>
<td>
<p>NAICS codes vector, of 2 to 6 digits each. See <a href="https://naics.com" target="_blank">https://naics.com</a></p>
</td>
</tr></table>
<h3>Details</h3>

<p>similar idea was naics2children() but this is more robust
See <code><a href="#naics_from_any">naics_from_any()</a></code> which uses this
</p>


<h3>Value</h3>

<p>a subset of the <a href="#naicstable">naicstable</a> data.table (not just the codes column)
</p>


<h3>See Also</h3>

<p><code><a href="#naics_subcodes_from_code">naics_subcodes_from_code()</a></code> <code><a href="#naics_from_code">naics_from_code()</a></code>  <code><a href="#naics_from_name">naics_from_name()</a></code>  <code><a href="#naics_from_any">naics_from_any()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_url_of_code">

<a href="#naics_url_of_code" class="help-page-title"><h2>Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_url_of_code<span class="token punctuation">(</span>naics<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>vector of one or more NAICS codes, like 11,"31-33",325</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of URLs as strings like https://www.naics.com/six-digit-naics/?v=2017&amp;code=22
</p>

<hr>
</div>
<div class="container manual-page" id="naics_validation">

<a href="#naics_validation" class="help-page-title"><h2>Validate NAIC uploads</h2></a>

<h3>Description</h3>

<p>Validates and prepares echo uploads
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_validation<span class="token punctuation">(</span>NAICS_enter<span class="token punctuation">,</span> NAIC_select<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>NAICS</code></td>
<td>
<p>upload validate missing and/or improper inputs</p>
</td>
</tr></table>
<h3>Value</h3>

<p>boolean value (valid or not valid)
</p>

<hr>
</div>
<div class="container manual-page" id="naics2children">

<a href="#naics2children" class="help-page-title"><h2>See NAICS codes queried plus all children of any of those
Used by naics_find()</h2></a>

<h3>Description</h3>

<p>See NAICS codes queried plus all children of any of those
Used by naics_find()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span>codes<span class="token punctuation">,</span> allcodes <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>codes</code></td>
<td>
<p>vector of numerical or character</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allcodes</code></td>
<td>
<p>Optional (already loaded with package) - dataset with all the codes</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>start with shortest (highest level) codes. since tied for nchar, these branches have zero overlap, so do each.
for each of those, get its children = all rows where parentcode == substr(allcodes, 1, nchar(parentcode))
put together list of all codes we want to include so far.
now for the next longest set of codes in original list of codes,
do same thing.
etc. until did it for 5 digit ones to get 6digit children.
take the unique(allthat)
table(nchar(as.character(NAICS)))
2    3    4    5    6
17   99  311  709 1057
</p>


<h3>Value</h3>

<p>vector of codes and their names
</p>


<h3>See Also</h3>

<p>naics_find() NAICS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naicstable">

<a href="#naicstable" class="help-page-title"><h2>data.table of NAICS code(s) and industry names for each EPA-regulated site in Facility Registry Service
Also has the 2,3,4,5,and 6-digit NAICS that this code falls under, where relevant for given length</h2></a>

<h3>Description</h3>

<p>This is similar to the data file EJAM::NAICS but in a more useful format and newer functions work with it.
</p>


<h3>Details</h3>

<p>see <a href="https://naics.com" target="_blank">https://naics.com</a>
</p>


<h3>See Also</h3>

<p><code><a href="#naics_from_any">naics_from_any()</a></code> <a href="#NAICS">NAICS</a>  <code><a href="#naics_categories">naics_categories()</a></code>  <code><a href="#naics_findwebscrape">naics_findwebscrape()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="pctile_from_raw_lookup">

<a href="#pctile_from_raw_lookup" class="help-page-title"><h2>Find approx wtd percentiles in lookup table that is in memory</h2></a>

<h3>Description</h3>

<p>This is used with a data.frame that is a lookup table used to
convert a raw indicator value to a percentile - US, Region, or State percentile.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pctile_from_raw_lookup<span class="token punctuation">(</span>
  myvector<span class="token punctuation">,</span>
  varname.<span class="token keyword">in</span>.lookup.table<span class="token punctuation">,</span>
  lookup <span class="token operator">=</span> usastats<span class="token punctuation">,</span>
  zone
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myvector</code></td>
<td>
<p>Numeric vector, required. Values to look for in the lookup table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname.in.lookup.table</code></td>
<td>
<p>Character element, required.
Name of column in lookup table to look in
to find interval where a given element of myvector values is.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lookup</code></td>
<td>
<p>Either lookup must be specified,
or a lookup table called us must already be in memory. This is the lookup table
data.frame with a PCTILE column and column whose name is the value of varname.in.lookup.table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Character element (or vector as long as myvector), optional.
If specified, must appear in a column called REGION within the lookup table.
For example, it could be 'NY' for New York State.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This could be recoded to be more efficient - could use data.table
The data.frame lookup table must have a field called "PCTILE" that has quantiles/percentiles
and other column(s) with values that fall at those percentiles.
EJAM::usastats, EJAM::statstats, EJAM::regionstats are such lookup tables.
This function accepts lookup table (or uses one called us if that is in memory), and
finds the number in the PCTILE column that corresponds to where a specified value
(in myvector) appears in the column called varname.in.lookup.table.
The function just looks for where the specified value fits between values in the lookup table
and returns the approximate percentile as found in the PCTILE column.
If the value is between the cutpoints listed as
percentiles 89 and 90, it returns 89, for example.
If the value is exactly equal to the cutpoint listed as percentile 90,
it returns percentile 90.
If the value is less than the cutpoint listed as percentile 0,
which should be the minimum value in the dataset,
it still returns 0 as the percentile, but with a warning that
the value checked was less than the minimum in the dataset.
</p>


<h3>Value</h3>

<p>By default, returns numeric vector length of myvector.
</p>

<hr>
</div>
<div class="container manual-page" id="plot_distance_cdf_by_group">

<a href="#plot_distance_cdf_by_group" class="help-page-title"><h2>plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances</h2></a>

<h3>Description</h3>

<p>plot_distance_cdf_by_group  - SLOW - needs to be optimized
CDF Line Plots of cumulative share of each demographic group, within each distance
Each groups distribution of distances
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_distance_cdf_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  radius_miles <span class="token operator">=</span> round<span class="token punctuation">(</span>max<span class="token punctuation">(</span>x<span class="token operator">$</span>distance_min_avgperson<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> c<span class="token punctuation">(</span>namez<span class="token operator">$</span>d<span class="token punctuation">,</span> namez<span class="token operator">$</span>d_subgroups<span class="token punctuation">)</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  colorlist <span class="token operator">=</span> colors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>demogvarname<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  coloroverall <span class="token operator">=</span> <span class="token string">"gray"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_miles</code></td>
<td>
<p>miles radius that was max distance analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>names of columns in results_bybg_people, e.g., "pctlowinc"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>friendly text names for labelling graphic, like "Low income residents"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorlist</code></td>
<td>
<p>colors like "red" etc. for the demographic groups of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coloroverall</code></td>
<td>
<p>color like "gray" for everyone as a whole</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly returns full table of sorted distances of blockgroups, cumulative count of demog groups at that block group's distance
</p>


<h3>See Also</h3>

<p><code>distance_by_groups()</code> <code><a href="#ejamit">ejamit()</a></code> for examples
</p>

<hr>
</div>
<div class="container manual-page" id="plot_distance_mean_by_group">

<a href="#plot_distance_mean_by_group" class="help-page-title"><h2>plot_distance_mean_by_group
Barplot of Average Proximity to sites, by Demographic Group (vs everyone else)</h2></a>

<h3>Description</h3>

<p>Note ratio shown is ratio of distance among others to distance in group,
so values below 1 mean the given demographic group lives closer to facilities.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_distance_mean_by_group<span class="token punctuation">(</span>
  results_bybg_people<span class="token punctuation">,</span>
  demogvarname <span class="token operator">=</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d_subgroups<span class="token punctuation">)</span><span class="token punctuation">,</span>
  demoglabel <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  graph <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>results_bybg_people</code></td>
<td>
<p>data.table from doaggregate()$results_bybg_people</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demogvarname</code></td>
<td>
<p>vector of column names like "pctlowinc" etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demoglabel</code></td>
<td>
<p>vector of labels like "Low Income Residents" etc.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame with group, ratio, avg_distance_for_group, avg_distance_for_nongroup
</p>


<h3>See Also</h3>

<p><code><a href="#distance_by_group">distance_by_group()</a></code>
</p>
<p><code>distance_by_group_plot()</code>
</p>

<hr>
</div>
<div class="container manual-page" id="plotblocksnearby">

<a href="#plotblocksnearby" class="help-page-title"><h2>Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby</h2></a>

<h3>Description</h3>

<p>Map view of Census blocks (their centroids) near one or more sites
Utility to quickly view one or more facility points on map with the blocks found nearby
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plotblocksnearby<span class="token punctuation">(</span>sitepoints<span class="token punctuation">,</span> radius <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> usemapfast <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>table of points with lat, lon in decimal degrees (data.frame or data.table)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>in miles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usemapfast</code></td>
<td>
<p>optional. simpler plot if FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to mapfast() or plot() depending on usemapfast</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly returns sites2blocks like getblocksnearby() does
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">plotblocksnearby<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popweightedsums">

<a href="#popweightedsums" class="help-page-title"><h2>Get population weighted sums of indicators -MOSTLY OBSOLETE
The code in doaggregate() does pop wtd means faster using data.tables and <code><a href="https://sebkrantz.r-universe.dev/manual/collapse.html#fmean">collapse::fmean()</a></code>
</h2></a>

<h3>Description</h3>

<p>Get population weighted sums of indicators -MOSTLY OBSOLETE
The code in doaggregate() does pop wtd means faster using data.tables and <code><a href="https://sebkrantz.r-universe.dev/manual/collapse.html#fmean">collapse::fmean()</a></code>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popweightedsums<span class="token punctuation">(</span>data<span class="token punctuation">,</span> fieldnames<span class="token punctuation">,</span> fieldnames_out<span class="token punctuation">,</span> scaling<span class="token punctuation">,</span> popname <span class="token operator">=</span> <span class="token string">"POP100"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.table with demographic and/or environmental data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fieldnames</code></td>
<td>
<p>vector of terms like pctmin, traffic.score, pm, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fieldnames_out</code></td>
<td>
<p>optional, should be same length as fieldnames</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaling</code></td>
<td>
<p>number to multiply raw values by to put in right units like percent 0-100 vs 0.0-1.0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popname</code></td>
<td>
<p>name of column with population counts to use for weighting</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="proximity.score.in.miles">

<a href="#proximity.score.in.miles" class="help-page-title"><h2>convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used</h2></a>

<h3>Description</h3>

<p>convert EJScreen proximity scores to miles per site instead of sites per kilometer
Shows US percentiles if no arguments used
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proximity.score.<span class="token keyword">in</span>.miles<span class="token punctuation">(</span>scoresdf <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>scoresdf</code></td>
<td>
<p>data.frame of simple proximity scores like for tsdf, rmp, npl
but not traffic.score or npdes one since those are weighted and not just count per km</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="proxistat2">

<a href="#proxistat2" class="help-page-title"><h2>Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.</h2></a>

<h3>Description</h3>

<p>Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat2<span class="token punctuation">(</span>pts<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> <span class="token number">8.04672</span><span class="token punctuation">,</span> quadtree<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pts</code></td>
<td>
<p>data.table of lat lon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>distance max, in miles, default is 5km (8.04672 miles)
which is the EJScreen max search range for proximity scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>must be localtree from EJAM::</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Proximity score is sum of (1/d) where each d is distance of a given site in km,
summed over all sites within 5km, as in EJScreen.
</p>
<p>doaggregate() has a bit of code in it to do this same thing that proxistat2() does.
</p>
<p>*** Still need area of each block to fix this func proxistat2()
</p>


<h3>Value</h3>

<p>data.table with proximityscore, bgfips, lat, lon, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># pts &lt;- testpoints_50</span>
 <span class="token comment"># x &lt;- proxistat2(pts = pts[1:1000,], quadtree = localtree) </span>
 <span class="token comment">#</span>
 <span class="token comment"># summary(x$proximityscore)</span>
 <span class="token comment"># # analyze.stuff::pctiles(x$proximityscore)</span>
 <span class="token comment"># plot(x$lon, x$lat)</span>
 <span class="token comment"># tops = x$proximityscore &gt; 500 &amp; !is.infinite(x$proximityscore) &amp; !is.na(x$proximityscore)</span>
 <span class="token comment"># points(x$lon[tops], x$lat[tops], col="red")</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="regionstats">

<a href="#regionstats" class="help-page-title"><h2>data.table of 100 percentiles and means for each EPA Region.</h2></a>

<h3>Description</h3>

<p>data.table of 100 percentiles and means for each EPA Region (&gt; 1,000 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen.
</p>

<hr>
</div>
<div class="container manual-page" id="run_app">

<a href="#run_app" class="help-page-title"><h2>Launch the Shiny Application in RStudio</h2></a>

<h3>Description</h3>

<p>launch Shiny web app from RStudio
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">run_app<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token string">"server"</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>onStart</code></td>
<td>
<p>A function that will be called before the app is actually run.
This is only needed for <code>shinyAppObj</code>, since in the <code>shinyAppDir</code>
case, a <code>global.R</code> file can be used for this purpose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Named options that should be passed to the <code>runApp</code> call
(these can be any of the following: "port", "launch.browser", "host", "quiet",
"display.mode" and "test.mode"). You can also specify <code>width</code> and
<code>height</code> parameters which provide a hint to the embedding environment
about the ideal height/width for the app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enableBookmarking</code></td>
<td>
<p>Can be one of <code>"url"</code>, <code>"server"</code>, or
<code>"disable"</code>. The default value, <code>NULL</code>, will respect the setting from
any previous calls to  <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>. See <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>
for more information on bookmarking your app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiPattern</code></td>
<td>
<p>A regular expression that will be applied to each <code>GET</code>
request to determine whether the <code>ui</code> should be used to handle the
request. Note that the entire request path must match the regular
expression in order for the match to be considered successful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to golem_opts.
Can be sitepoints="latlondata.xlsx" or sitepoints=testpoints_50
See <code>?golem::get_golem_options</code> for more details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>app_run_EJAM()                 is like EJAM::run_app()
app_run_EJAMejscreenapi()      is like EJAMejscreenapi::run_app()
app_run_EJAMbatch.summarizer() is like EJAMbatch.summarizer::run_app()
</p>

<hr>
</div>
<div class="container manual-page" id="sitepoints_example">

<a href="#sitepoints_example" class="help-page-title"><h2>data.table of points as example of sitepoints for EJAM</h2></a>

<h3>Description</h3>

<p>data.table of points as example of sitepoints for EJAM
</p>

<hr>
</div>
<div class="container manual-page" id="sites2blocks_example">

<a href="#sites2blocks_example" class="help-page-title"><h2>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance</h2></a>

<h3>Description</h3>

<p>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance
</p>


<h3>See Also</h3>

<p><a href="#sites2blocks_example">testdata_sites2blocks</a> <a href="#testdata_sites2blocks_1000">testdata_sites2blocks_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="speedtest">

<a href="#speedtest" class="help-page-title"><h2>speedtest
Runs EJAM analysis for several radius values for various numbers of sitepoints, recording how long each step took.</h2></a>

<h3>Description</h3>

<p>speedtest
Runs EJAM analysis for several radius values for various numbers of sitepoints, recording how long each step took.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtest<span class="token punctuation">(</span>
  n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  sitepoints <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  weighting <span class="token operator">=</span> <span class="token string">"frs"</span><span class="token punctuation">,</span>
  radii <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31.06856</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  test_getblocksnearby <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  test_doaggregate <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  test_batch.summarize <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  logging <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  logfolder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  logfilename <span class="token operator">=</span> <span class="token string">"log_n_datetime.txt"</span><span class="token punctuation">,</span>
  honk_when_ready <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  saveoutput <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>optional, vector of 1 or more counts of how many random points to test, or set to 0 to interactively pick file of points in RStudio (n is ignored if sitepoints provided)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>optional,  (use if you do not want random points) data.frame of points or path/file with points, where columns are lat and lon in decimal degrees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>optional, if using random points, how to weight them, such as facilities, people, or blockgroups. see <code><a href="#testpoints_n">testpoints_n()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radii</code></td>
<td>
<p>optional, one or more radius values in miles
to use in creating circular buffers when findings residents nearby each of sitepoints.
The default list includes one that is 5km (approx 3.1 miles)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_getblocksnearby</code></td>
<td>
<p>whether to include this function in timing - not used because always done</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_doaggregate</code></td>
<td>
<p>whether to include this function in timing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_batch.summarize</code></td>
<td>
<p>whether to include this function in timing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logging</code></td>
<td>
<p>logical optional, whether to save log file with timings of steps. NOTE this slows it down though.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfolder</code></td>
<td>
<p>optional, name of folder for log file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logfilename</code></td>
<td>
<p>optional, name of log file to go in folder</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>honk_when_ready</code></td>
<td>
<p>optional, self-explanatory</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveoutput</code></td>
<td>
<p>but this slows it down if set to TRUE to save each run as .rda file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>whether to create plot of results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to plotting function</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>EJAM results similar to as from the web app  <code><a href="#ejamit">ejamit()</a></code> and also creates a plot
</p>


<h3>See Also</h3>

<p><code><a href="#speedtest_plot">speedtest_plot()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run:  </span>
  speedseen_few <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logging<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
  
  speedseen_nearer_to1k <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1e2</span><span class="token punctuation">,</span><span class="token number">1e3</span><span class="token punctuation">,</span><span class="token number">1e4</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> logging<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
  save<span class="token punctuation">(</span> speedseen_nearer_to1k<span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"~/../Downloads/speedseen_nearer_to1k.rda"</span><span class="token punctuation">)</span>
  rstudioapi<span class="token operator">::</span>savePlotAsImage<span class="token punctuation">(</span>        <span class="token string">"~/../Downloads/speedseen_nearer_to1k.png"</span><span class="token punctuation">)</span>
  
  speedseen_all <span class="token operator">&lt;-</span> speedtest<span class="token punctuation">(</span>
    n <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1e2</span><span class="token punctuation">,</span><span class="token number">1e3</span><span class="token punctuation">,</span><span class="token number">1e4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    radii<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.106856</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31.06856</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    logging<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> honk<span class="token operator">=</span><span class="token boolean">TRUE</span>
  <span class="token punctuation">)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="speedtest_plot">

<a href="#speedtest_plot" class="help-page-title"><h2>utility to plot output of speedtest(), rate of points analyzed per hour</h2></a>

<h3>Description</h3>

<p>utility to plot output of speedtest(), rate of points analyzed per hour
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">speedtest_plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ltype <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">,</span> plotfile <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> secondsperthousand <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>table from speedtest()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ltype</code></td>
<td>
<p>optional type of line for plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotfile</code></td>
<td>
<p>optional path and filename of .png image file to save</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>side effect is a plot. returns x but with seconds column added to it
</p>


<h3>See Also</h3>

<p><code><a href="#speedtest">speedtest()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="ST_by_site_from_sites2blocks">

<a href="#ST_by_site_from_sites2blocks" class="help-page-title"><h2>Get State that each site is in, from a table of siteid, blockid, distance</h2></a>

<h3>Description</h3>

<p>Find the 2-character State abbreviation for each site. This is for when you need to know
the state each site is in, to be able to report state percentiles, but you do not have
the original list of siteid lat/lon or State info. This can infer the State
each site is located in, based on the state of the nearest block (and its parent blockgroup).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ST_by_site_from_sites2blocks<span class="token punctuation">(</span>sites2blocks<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>data.table or data.frame, like <a href="#sites2blocks_example">sites2blocks_example</a>,
from <code><a href="#getblocksnearby">getblocksnearby()</a></code> that has columns siteid and blockid and distance</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.table with columns  siteid, ST
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">ST_by_site_from_sites2blocks<span class="token punctuation">(</span>sites2blocks_example<span class="token punctuation">)</span> 
  <span class="token comment">## Not run: </span>
  fname <span class="token operator">=</span> <span class="token string">'./inst/testdata/testpoints_207_sites_with_signif_violations_NAICS_326_ECHO.csv'</span>
  x <span class="token operator">=</span> ST_by_site_from_sites2blocks<span class="token punctuation">(</span>
    getblocksnearby<span class="token punctuation">(</span> latlon_from_anything<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">,</span> quadtree <span class="token operator">=</span> localtree<span class="token punctuation">)</span><span class="token punctuation">)</span>
  y <span class="token operator">=</span> read_csv_or_xl<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
  x<span class="token operator">$</span>ST <span class="token operator">==</span> y<span class="token operator">$</span>FacState
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_blockid">

<a href="#state_from_blockid" class="help-page-title"><h2>state_from_blockid
given vector of blockids, get state abbreviation of each</h2></a>

<h3>Description</h3>

<p>state_from_blockid
given vector of blockids, get state abbreviation of each
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_blockid<span class="token punctuation">(</span>blockid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>blockid</code></td>
<td>
<p>vector of blockid values as from EJAM::blockpoints</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of ST info like AK, CA, DE, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">state_from_blockid<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">8174952</span><span class="token punctuation">,</span> blockpoints<span class="token operator">$</span>blockid<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_blocktable">

<a href="#state_from_blocktable" class="help-page-title"><h2>state_from_blocktable
given data.table with blockid column, get state abbreviation of each</h2></a>

<h3>Description</h3>

<p>state_from_blocktable
given data.table with blockid column, get state abbreviation of each
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_blocktable<span class="token punctuation">(</span>dt_with_blockid<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>dt_with_blockid</code></td>
<td>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of ST info like AK, CA, DE, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">state_from_blocktable<span class="token punctuation">(</span>blockpoints<span class="token punctuation">[</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state_from_fips">

<a href="#state_from_fips" class="help-page-title"><h2>state_from_fips</h2></a>

<h3>Description</h3>

<p>state_from_fips
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_fips<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Census FIPS codes vector, numeric or char, 2-digit, 5-digit, etc. OK</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of 2-character state abbreviations like CA,MD,TX,OH
</p>

<hr>
</div>
<div class="container manual-page" id="state_from_latlon">

<a href="#state_from_latlon" class="help-page-title"><h2>find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful</h2></a>

<h3>Description</h3>

<p>find what state is where each point is located
Takes 3 seconds to find state for 1k points, so a faster alternative would be useful
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state_from_latlon<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> states_shapefile <span class="token operator">=</span> EJAM<span class="token operator">::</span>states_shapefile<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>latitudes vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>longitudes vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shapefile</code></td>
<td>
<p>shapefile of US States, in package already</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns data.frame: ST, statename, FIPS.ST, REGION, n
as many rows as elements in lat or lon
</p>


<h3>See Also</h3>

<p><a href="#states_shapefile">states_shapefile</a> <code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code> <code><a href="#states_infer">states_infer()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="stateinfo">

<a href="#stateinfo" class="help-page-title"><h2>data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</h2></a>

<h3>Description</h3>

<p>52 rows and 5 variables: ST is the 2-letter abbreviation,
statename is the State name (and ftpname is the name as used on Census FTP site).
</p>


<h3>Details</h3>

<p>column names: "ST"        "statename" "ftpname"   "FIPS.ST"   "REGION"
</p>
<p>Some datasets lack PR. (72)
Many datasets lack these:  AS, GU, MP, VI (codes "60" "66" "69" "78")
Almost all datasets lack UM. (74)
</p>
<div class="sourceCode"><pre>    72 PR                 Puerto Rico
    66 GU                        Guam 
    69 MP    Northern Mariana Islands  
    78 VI         U.S. Virgin Islands 
    74 UM U.S. Minor Outlying Islands  
</pre></div>
<p>stateinfo &lt;- structure(list(
ST = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT",
"DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY",
"LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV",
"NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI",
"SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY",
# "AS", "GU", "MP","VI"
# "UM", #### U.S. Minor Outlying Islands
# "US",
"PR"),
</p>
<p>statename = c("Alabama", "Alaska", "Arizona", "Arkansas",
"California", "Colorado", "Connecticut", "Delaware", "District of Columbia",
"Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana",
"Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
"Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri",
"Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey",
"New Mexico", "New York", "North Carolina", "North Dakota", "Ohio",
"Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina",
"South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia",
"Washington", "West Virginia", "Wisconsin", "Wyoming",
# "American Samoa", "Guam", "Northern Mariana Islands", "U.S. Virgin Islands",
# "U.S. Minor Outlying Islands",
# "United States",
"Puerto Rico"),
</p>
<p>ftpname = c("Alabama", "Alaska", "Arizona", "Arkansas", "California",
"Colorado", "Connecticut", "Delaware", "DistrictOfColumbia",
"Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana",
"Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
"Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri",
"Montana", "Nebraska", "Nevada", "NewHampshire", "NewJersey",
"NewMexico", "NewYork", "NorthCarolina", "NorthDakota", "Ohio",
"Oklahoma", "Oregon", "Pennsylvania", "RhodeIsland", "SouthCarolina",
"SouthDakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia",
"Washington", "WestVirginia", "Wisconsin", "Wyoming",
# NA, NA, NA, NA,
# NA,                 ####  U.S. Minor Outlying Islands
# "UnitedStates",
"PuertoRico"),
</p>
<p>FIPS.ST = c("01", "02", "04", "05", "06", "08", "09", "10",
"11", "12", "13", "15", "16", "17", "18", "19", "20", "21", "22",
"23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33",
"34", "35", "36", "37", "38", "39", "40", "41", "42", "44", "45",
"46", "47", "48", "49", "50", "51", "53", "54", "55", "56",
# "60", "66", "69", "78",
# "74",       ####  U.S. Minor Outlying Islands
# NA,         #### US
"72"),
REGION = c(4, 10, 9, 6, 9, 8, 1, 3, 3, 4, 4, 9, 10, 5, 5,
7, 7, 4, 6, 1, 3, 1, 5, 5, 4, 7, 8, 7, 9, 1, 2, 6, 2, 4, 8, 5,
6, 10, 3, 1, 4, 8, 4, 6, 8, 1, 3, 10, 3, 5, 8,
# NA, NA, NA, NA,
# NA,                ##### U.S. Minor Outlying Islands
# NA,                # US
2)
), row.names = c(NA, -52L), class = "data.frame")
</p>

<hr>
</div>
<div class="container manual-page" id="states_infer">

<a href="#states_infer" class="help-page-title"><h2>states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS</h2></a>

<h3>Description</h3>

<p>states_infer
Get cleaned table of US State etc. by siteid, from lat/lon, or from FIPS
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">states_infer<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame or data.table with either ST column or lat and lon columns, or FIPS,
and optionally a column with siteid or column called n</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.frame with unique siteid, ST, etc.
</p>


<h3>See Also</h3>

<p><code><a href="#state_from_latlon">state_from_latlon()</a></code> <code><a href="#state_from_fips">state_from_fips()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="states_shapefile">

<a href="#states_shapefile" class="help-page-title"><h2>US States boundaries 2020 shapefile from TIGER</h2></a>

<h3>Description</h3>

<p>This is used to figure out which state contains each point (facility/site).
</p>


<h3>Details</h3>

<p>This is used by <code><a href="#state_from_latlon">state_from_latlon()</a></code> to find which state is associated with each point
that the user wants to analyze. That is needed to report indicators in
the form of State-specific percentiles
(e.g., a score that is at the 80th percentile within Texas).
It is created by the package via EJAM/data-raw/make_states_shapefile.R
Created roughly as follows:
</p>
<p>setwd("~/../../R/mysource/EJAM/data-raw")
download.file("https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2020&amp;layergroup=States+%28and+equivalent%29", destfile = "tl_2020_us_state.zip" )
dir.create("./shp")
unzip("tl_2020_us_state.zip", exdir = "./shp")
states_shapefile &lt;- sf::st_read("./shp", quiet = FALSE)
class(states_shapefile)
</p>


<h3>See Also</h3>

<p><code><a href="#state_from_latlon">state_from_latlon()</a></code> <code><a href="#get_blockpoints_in_shape">get_blockpoints_in_shape()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="statestats">

<a href="#statestats" class="help-page-title"><h2>data.frame of 100 percentiles and means for each US State and PR and DC.</h2></a>

<h3>Description</h3>

<p>data.frame of 100 percentiles and means
for each US State and PR and DC (approx 5,300 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen,
except it also has data for the demographic race/ethnicity subgroups.
For details on how the table was made, see /EJAM/data-raw/usastats_subgroups.R
</p>

<hr>
</div>
<div class="container manual-page" id="statestats_query">

<a href="#statestats_query" class="help-page-title"><h2>convenient way to see mean, pctiles of Env or Demog indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see mean, pctiles of Env or Demog indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_query<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations, or USA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="statestats_queryd">

<a href="#statestats_queryd" class="help-page-title"><h2>convenient way to see mean, pctiles of DEMOG indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see mean, pctiles of DEMOG indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_queryd<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>vector of state abbreviations, or USA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dig</code></td>
<td>
<p>digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="statestats_querye">

<a href="#statestats_querye" class="help-page-title"><h2>convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see mean, pctiles of ENVIRONMENTAL indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">statestats_querye<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>statestats<span class="token operator">$</span>REGION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="test_regid">

<a href="#test_regid" class="help-page-title"><h2>test data, vector of EPA FRS Registry ID numbers</h2></a>

<h3>Description</h3>

<p>test data, vector of EPA FRS Registry ID numbers
</p>


<h3>Details</h3>

<p>For testing, e.g.,
</p>
<p>frs_from_siteid(test_regid)
</p>
<p>mapfast(  frs_from_regid(test_regid)  )
</p>

<hr>
</div>
<div class="container manual-page" id="testdata_sites2blocks">

<a href="#testdata_sites2blocks" class="help-page-title"><h2>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance</h2></a>

<h3>Description</h3>

<p>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance
</p>


<h3>See Also</h3>

<p><a href="#sites2blocks_example">testdata_sites2blocks</a> <a href="#testdata_sites2blocks_1000">testdata_sites2blocks_1000</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testdata_sites2blocks_1000">

<a href="#testdata_sites2blocks_1000" class="help-page-title"><h2>data.table of output of getblocknearby(testpoints_1000,cutoff = 3.1), each row is a unique site-block-distance</h2></a>

<h3>Description</h3>

<p>data.table of output of getblocknearby(testpoints_1000,cutoff = 3.1), each row is a unique site-block-distance
</p>


<h3>See Also</h3>

<p><a href="#sites2blocks_example">testdata_sites2blocks</a>
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_100_dt">

<a href="#testpoints_100_dt" class="help-page-title"><h2>Random test points data.table with columns lat lon site</h2></a>

<h3>Description</h3>

<p>Random test points data.table with columns lat lon site
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_1000_dt">

<a href="#testpoints_1000_dt" class="help-page-title"><h2>Random test points data.table with columns lat lon site</h2></a>

<h3>Description</h3>

<p>Random test points data.table with columns lat lon site
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_n">

<a href="#testpoints_n" class="help-page-title"><h2>Random points on the map
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.</h2></a>

<h3>Description</h3>

<p>Random points on the map
Get data.table of Random Points (lat lon) for Testing/ Benchmarking/ Demos, weighted in various ways.
The weighting can be specified so that each point reflects the average EPA-regulated
facility, blockgroup, block, place on the map, or US resident.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_n<span class="token punctuation">(</span>
  n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  weighting <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"frs"</span><span class="token punctuation">,</span> <span class="token string">"pop"</span><span class="token punctuation">,</span> <span class="token string">"area"</span><span class="token punctuation">,</span> <span class="token string">"bg"</span><span class="token punctuation">,</span> <span class="token string">"block"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  dt <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  ST_of_blockgroup <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of points needed (sample size)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>word indicating how to weight the random points (some synonyms are allowed, in addition to those shown here):
</p>
<p>Note the default is frs, but you may want to use pop even though it is slower.
</p>

<ul>
<li>
<p> pop or people = Average Person: random person among all US residents (block point of residence per 2020 Census)
</p>
</li>
<li>
<p> frs or facility = Average Facility: random EPA-regulated facility from actives in Facility Registry Service (FRS)
</p>
</li>
<li>
<p> bg = Average Blockgroup: random US Census block group (internal point like a centroid)
</p>
</li>
<li>
<p> block = Average Block: random US Census block (internal point like a centroid)
</p>
</li>
<li>
<p> area or place = Average Place: random point on a map (internal point of avg blockgroup weighted by its square meters size)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt</code></td>
<td>
<p>logical, whether to return a data.table (DEFAULT) instead of normal data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ST_of_blockgroup</code></td>
<td>
<p>optional, can be a character vector of 2 letter State abbreviations to pick from only some States.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame or data.table with columns lat, lon in decimal degrees, and
any other columns that are in the table used (based on weighting)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
mapfast<span class="token punctuation">(</span>testpoints_n<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> ST_of_blockgroup <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'LA'</span><span class="token punctuation">,</span><span class="token string">'MS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
n<span class="token operator">=</span><span class="token number">2</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>d <span class="token keyword">in</span> c<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>w <span class="token keyword">in</span> c<span class="token punctuation">(</span><span class="token string">'frs'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'area'</span><span class="token punctuation">,</span> <span class="token string">'bg'</span><span class="token punctuation">,</span> <span class="token string">'block'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span><span class="token string">"n="</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span><span class="token string">"  weighting="</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span> <span class="token string">"  dt="</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>x <span class="token operator">&lt;-</span> testpoints_n<span class="token punctuation">(</span>n<span class="token punctuation">,</span>w<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> print<span class="token punctuation">(</span>class<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cat<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_bookmark_save">

<a href="#url_bookmark_save" class="help-page-title"><h2>url_bookmark_save
save bookmarked EJScreen session (map location and indicator)</h2></a>

<h3>Description</h3>

<p>url_bookmark_save
save bookmarked EJScreen session (map location and indicator)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_bookmark_save<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"ejscreenbookmark.json"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code><a href="#url_bookmark_text">url_bookmark_text()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>path and name of .json file you want to save locally</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WORK IN PROGRESS - NOT USED AS OF EARLY 2023.
You can use this function to create and save a json file that is a bookmark
for a specific place/ map view/ data layer in EJScreen.
You can later pull up that exact map in EJScreen by launching EJScreen,
clicking Tools, Save Session, Load from File.
</p>
<p>***Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100
</p>
<p>Note:
(1) The number of sessions that can be saved depends on the browser cache size.
(2) Session files, if saved, are available from the default Downloads folder on your computer.
(3) Users should exercise caution when saving sessions that may contain sensitive or confidential data.
</p>


<h3>Value</h3>

<p>URL for 1 bookmarked EJScreen map location and variable displayed on map
</p>

<hr>
</div>
<div class="container manual-page" id="url_bookmark_text">

<a href="#url_bookmark_text" class="help-page-title"><h2>url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)</h2></a>

<h3>Description</h3>

<p>url_bookmark_text
URL for 1 bookmarked EJScreen session (map location and indicator)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_bookmark_text<span class="token punctuation">(</span>
  x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">13232599.1784247</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">13085305.0249191</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  y <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3970069.24597194</span><span class="token punctuation">,</span> <span class="token number">4067373.582979</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name <span class="token operator">=</span> <span class="token string">"BookmarkedEJScreenMap"</span><span class="token punctuation">,</span>
  title <span class="token operator">=</span> <span class="token string">"Socioeconomic Indicators"</span><span class="token punctuation">,</span>
  renderField <span class="token operator">=</span> <span class="token string">"B_UNEMPPCT"</span><span class="token punctuation">,</span>
  pctlevel <span class="token operator">=</span> <span class="token string">"nation"</span><span class="token punctuation">,</span>
  xmin <span class="token operator">=</span> <span class="token number">1.1</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  xmax <span class="token operator">=</span> <span class="token number">0.9</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  ymin <span class="token operator">=</span> <span class="token number">0.9</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
  ymax <span class="token operator">=</span> <span class="token number">1.1</span> <span class="token operator">*</span> min<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
  urlrest <span class="token operator">=</span>
    <span class="token string">"https://geopub.epa.gov/arcgis/rest/services/ejscreen/ejscreen_v2022_with_AS_CNMI_GU_VI/MapServer"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of approx topleft, bottomright longitudes in some units EJScreen uses?
Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>vector of approx topleft, bottomright latitudes in some units EJScreen uses?
Units are not lat lon: "spatialReference":"latestWkid":3857,"wkid":102100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>Your name for the map bookmark</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>Your name for the map like Socioeconomic Indicators  or  Pollution and Sources</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>renderField</code></td>
<td>
<p>name of variable shown on map, like B_UNEMPPCT for map color bins of percent unemployed
or B_PTRAF for traffic indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pctlevel</code></td>
<td>
<p>nation or state</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmin</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmax</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ymin</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ymax</code></td>
<td>
<p>calculated bounding box for map view</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urlrest</code></td>
<td>
<p>Just use the default but it changes each year</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WORK IN PROGRESS - NOT USED AS OF EARLY 2023.
You can use this function to create and save a json file that is a bookmark
for a specific place/ map view/ data layer in EJScreen.
You can later pull up that exact map in EJScreen by launching EJScreen,
clicking Tools, Save Session, Load from File.
</p>
<p>Note:
(1) The number of sessions that can be saved depends on the browser cache size.
(2) Session files, if saved, are available from the default Downloads folder on your computer.
(3) Users should exercise caution when saving sessions that may contain sensitive or confidential data.
</p>


<h3>Value</h3>

<p>URL for 1 bookmarked EJScreen map location and variable displayed on map
</p>


<h3>See Also</h3>

<p><code><a href="#url_bookmark_save">url_bookmark_save()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  url_bookmark_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
  url_bookmark_save<span class="token punctuation">(</span>
    x<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10173158.179197036</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10128824.702791695</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    y<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">3548990.034736070</span><span class="token punctuation">,</span><span class="token number">3579297.316451102</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    file<span class="token operator">=</span><span class="token string">"./mysavedejscreensession1.json"</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_get_eparest_chunked_by_id">

<a href="#url_get_eparest_chunked_by_id" class="help-page-title"><h2>experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</h2></a>

<h3>Description</h3>

<p>experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_get_eparest_chunked_by_id<span class="token punctuation">(</span>objectIds<span class="token punctuation">,</span> chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a table
</p>

<hr>
</div>
<div class="container manual-page" id="url_get_via_url">

<a href="#url_get_via_url" class="help-page-title"><h2>helper function work in progress: GET json via url of ejscreen ejquery map services</h2></a>

<h3>Description</h3>

<p>helper function work in progress: GET json via url of ejscreen ejquery map services
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_get_via_url<span class="token punctuation">(</span>url<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>the url for an EJScreen ejquery request</p>
</td>
</tr></table>
<h3>Value</h3>

<p>json
</p>

<hr>
</div>
<div class="container manual-page" id="url_getacs_epaquery">

<a href="#url_getacs_epaquery" class="help-page-title"><h2>experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</h2></a>

<h3>Description</h3>

<p>uses ACS2019 rest services ejscreen ejquery MapServer 7
</p>
<p>Documentation of format and examples of input parameters:
</p>
<p><a href="https://geopub.epa.gov/arcgis/sdk/rest/index.html#/Query_Map_Service_Layer/02ss0000000r000000/" target="_blank">https://geopub.epa.gov/arcgis/sdk/rest/index.html#/Query_Map_Service_Layer/02ss0000000r000000/</a>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API. eg "STCNTRBG","TOTALPOP","PCT_HISP",</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>if TRUE, returns url instead of default making API request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery_chunked()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery<span class="token punctuation">(</span>justurl<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_getacs_epaquery_chunked">

<a href="#url_getacs_epaquery_chunked" class="help-page-title"><h2>experimental/ work in progress: in chunks, get ACS data via EPA API</h2></a>

<h3>Description</h3>

<p>experimental/ work in progress: in chunks, get ACS data via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_getacs_epaquery_chunked<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>eg 200 for chunks of 200 each request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to url_getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
 <span class="token comment">#\dontrun {</span>
 <span class="token comment"># x &lt;- list() # chunked chunks. best not to ask for all these:</span>
 <span class="token comment"># x[[1]] &lt;- url_getacs_epaquery_chunked(   1:1000, chunksize = 100)</span>
 <span class="token comment"># x[[2]] &lt;- url_getacs_epaquery_chunked(1001:5000, chunksize = 100)</span>
 <span class="token comment"># xall &lt;- do.call(rbind, x)</span>
 <span class="token comment">#}</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url_naics.com">

<a href="#url_naics.com" class="help-page-title"><h2>Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url_naics.com<span class="token punctuation">(</span>query<span class="token punctuation">,</span> as_html <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> linktext<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>string query term like "gasoline" or "copper smelting"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_html</code></td>
<td>
<p>Whether to return as just the urls or as html hyperlinks to use in a DT::datatable() for example</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linktext</code></td>
<td>
<p>used as text for hyperlinks, if supplied and as_html=TRUE</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>URL as string
</p>


<h3>See Also</h3>

<p><code><a>url_linkify()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="usastats">

<a href="#usastats" class="help-page-title"><h2>data.frame of 100 percentiles and means</h2></a>

<h3>Description</h3>

<p>data.frame of 100 percentiles and means (about 100 rows)
in the USA overall, across all locations (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen,
except it also has data for the demographic race/ethnicity subgroups.
For details on how the table was made, see /EJAM/data-raw/usastats_subgroups.R
</p>

<hr>
</div>
<div class="container manual-page" id="usastats_means">

<a href="#usastats_means" class="help-page-title"><h2>convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see USA MEANS of ENVIRONMENTAL and DEMOGRAPHIC indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_means<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code><a href="#usastats_query">usastats_query</a></code>
</p>

<dl>
<dt><code>varnames</code></dt>
<dd>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</dd>
<dt><code>PCTILES</code></dt>
<dd>
<p>vector of percentiles 0-100 and/or "mean"</p>
</dd>
</dl>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="usastats_query">

<a href="#usastats_query" class="help-page-title"><h2>convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see USA mean, pctiles of Env and Demog indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_query<span class="token punctuation">(</span>
  varnames <span class="token operator">=</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  dig <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>@dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="usastats_queryd">

<a href="#usastats_queryd" class="help-page-title"><h2>convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see USA mean, pctiles of DEMOGRAPHIC indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_queryd<span class="token punctuation">(</span>varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span> PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>@dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="usastats_querye">

<a href="#usastats_querye" class="help-page-title"><h2>convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table</h2></a>

<h3>Description</h3>

<p>convenient way to see USA mean, pctiles of ENVIRONMENTAL indicators from lookup table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">usastats_querye<span class="token punctuation">(</span>varnames <span class="token operator">=</span> EJAM<span class="token operator">::</span>names_e<span class="token punctuation">,</span> PCTILES <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> dig <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>names of columns in lookup table, like "proximity.rmp"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCTILES</code></td>
<td>
<p>vector of percentiles 0-100 and/or "mean"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>@dig</code></td>
<td>
<p>how many digits to round to</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment">## in USA overall, see mean and key percentiles for all demog and envt indicators</span>
usastats_query<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or statestats_query('us') # can say us or US or USA or usa etc.</span>
usastats_query<span class="token punctuation">(</span>PCTILES <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
usastats_means<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># same but nicer looking format in console</span>
usastats_means<span class="token punctuation">(</span>dig<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span>
usastats<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>usastats<span class="token operator">$</span>PCTILE <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"PCTILE"</span><span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## in 1 state, see mean and key percentiles for all demog and envt indicators</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## in 1 state, see mean and key percentiles for just demog indicators</span>
statestats_queryd<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">)</span>
<span class="token comment">## 1 indicator in 1 state, see a few key percentiles and mean</span>
statestats_query<span class="token punctuation">(</span><span class="token string">'MD'</span><span class="token punctuation">,</span><span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## mean of 1 indicator for each state</span>
statestats_query<span class="token punctuation">(</span>varnames <span class="token operator">=</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">)</span>
<span class="token comment">## using full blockgroup dataset, not lookup tables of percentiles, </span>
blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_d<span class="token punctuation">,</span> names_e<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">##   see all total counts (not just US means), </span>
<span class="token comment">##   demographics including subgroups, </span>
<span class="token comment">##   but not environmental indicators.</span>
t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>EJAMbatch.summarizer<span class="token operator">::</span>ustotals2<span class="token punctuation">(</span>bg <span class="token operator">=</span> EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">[</span><span class="token punctuation">,</span>   lapply<span class="token punctuation">(</span>.SD<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm<span class="token operator">=</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  .SDcols<span class="token operator">=</span> c<span class="token punctuation">(</span>names_e<span class="token punctuation">,</span> names_d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="write_pctiles_lookup">

<a href="#write_pctiles_lookup" class="help-page-title"><h2>create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</h2></a>

<h3>Description</h3>

<p>create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write_pctiles_lookup<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  zone.vector <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zoneOverallName <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
  wts <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate
mean, sd, and percentiles, for each zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone.vector</code></td>
<td>
<p>optional names of states or regions, for example. same length as wts, or rows in mydf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zoneOverallName</code></td>
<td>
<p>optional. Default is USA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>not used in EJScreen percentiles anymore</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="xls_formatting">

<a href="#xls_formatting" class="help-page-title"><h2>Format batch results for excel
also see other functions related to this!</h2></a>

<h3>Description</h3>

<p>Format batch results for excel
also see other functions related to this!
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">xls_formatting<span class="token punctuation">(</span>
  df<span class="token punctuation">,</span>
  hyperlink_cols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  heatmap_colnames <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  heatmap_cuts <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  heatmap_colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>data.frame, table of batch buffer results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyperlink_cols</code></td>
<td>
<p>vector of names of columns in df to get treated as hyperlinks in excel</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_colnames</code></td>
<td>
<p>vector of names of columns in df to apply conditional formatting to,
by coloring like a heatmap.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_cuts</code></td>
<td>
<p>vector of color names for heatmap bins, same length as
heatmap_cuts, where first color is for those &gt;= 1st cutpoint, but &lt;2d,
second color is for those &gt;=2d cutpoint but &lt;3d, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatmap_colors</code></td>
<td>
<p>vector of colors corresponding to cuts</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A workbook via openxlsx::writeData() ready to be saved via openxlsx::saveWorkbook()
</p>

<hr>
</div>
<div class="container manual-page" id="xls_formatting2">

<a href="#xls_formatting2" class="help-page-title"><h2>xls_formatting2
Format EJAM tabular outputs for saving as Excel spreadsheet</h2></a>

<h3>Description</h3>

<p>xls_formatting2
Format EJAM tabular outputs for saving as Excel spreadsheet
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">xls_formatting2<span class="token punctuation">(</span>
  overall<span class="token punctuation">,</span>
  eachsite<span class="token punctuation">,</span>
  graycolnums <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  narrowcolnums <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  graycolor <span class="token operator">=</span> <span class="token string">"gray"</span><span class="token punctuation">,</span>
  narrow6 <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>overall</code></td>
<td>
<p>table to save in one tab, from EJAM analysis of indicators overall (one row)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eachsite</code></td>
<td>
<p>table to save in another tab, from EJAM analysis site by site (one row per site)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graycolnums</code></td>
<td>
<p>which columns to deemphasize</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>narrowcolnums</code></td>
<td>
<p>which columns to make narrow</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graycolor</code></td>
<td>
<p>color used to deemphasize some columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>narrow6</code></td>
<td>
<p>how narrow</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other params passed along to <code><a href="https://ycphs.r-universe.dev/manual/openxlsx.html#writeData">openxlsx::writeData()</a></code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>NEED TO MERGE THIS WITH EJAMejscreenapi::xls_formatting_api()
</p>


<h3>Value</h3>

<p>a workbook, ready to be saved in spreadsheet format, with tabs like "Overall" and "Each Site"
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  wb <span class="token operator">&lt;-</span> xls_formatting2<span class="token punctuation">(</span>datasetResults<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">$</span>results_overall<span class="token punctuation">,</span> datasetResults<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">$</span>results_bysite<span class="token punctuation">)</span>
  openxlsx<span class="token operator">::</span>saveWorkbook<span class="token punctuation">(</span>wb<span class="token punctuation">,</span> <span class="token string">"results.xlsx"</span><span class="token punctuation">,</span> overwrite <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
</div>
    <footer><p>Rendered with postdoc 1.2.0</p></footer>
  </body>
</html>
