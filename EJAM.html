<!DOCTYPE html>
<html>
  <head>
    <title>Package 'EJAM' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'EJAM'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">EJAM Environmental Justice Analysis Multisite tool</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">Tools for summarizing environmental and demographic indicators 
    (such as those in EJSCREEN) for residents living near any one of a number of 
    specific sites. It uses quad tree search/indexing of block locations, data.table, parallel processing 
    to provide very fast identification of nearby blocks, distances, and 
    aggregation of indicators within each distance. It can be uses as a web app, with the user interface provided by the shiny R package.</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>Mark Corrales</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">Mark Corrales &lt;corrales.mark@epa.gov&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">MIT + file LICENSE.md</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">2.1.1</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-02-07 16:39:12 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source"></td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list">
<li class="help-index-item"><a href="#dot-onLoad">Creates index to all US blocks (internal point lat lon) at package load</a></li>
<li class="help-index-item"><a href="#all.equal_functions">helper function for checking possibly different versions of a function with same name in 2 packages</a></li>
<li class="help-index-item"><a href="#app_run_EJAM">Run the Shiny Application
app_run_EJAM()                 is like EJAM::run_app()
app_run_EJAMejscreenapi()      is like EJAMejscreenapi::run_app()
app_run_EJAMbatch.summarizer() is like EJAMbatch.summarizer::run_app()</a></li>
<li class="help-index-item"><a href="#bgpts">lat lon of popwtd center of blockgroup, and count of blocks per block group</a></li>
<li class="help-index-item"><a href="#blockgroupstats">EJScreen demographic and enviromental indicators for Census block groups</a></li>
<li class="help-index-item"><a href="#computeActualDistancefromSurfacedistance">convert surface distance to actual distance</a></li>
<li class="help-index-item"><a href="#datapack">See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame</a></li>
<li class="help-index-item"><a href="#doaggregate">Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</a></li>
<li class="help-index-item"><a href="#dupenames">helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</a></li>
<li class="help-index-item"><a href="#ejampackages">list of names of EJAM-related R packages</a></li>
<li class="help-index-item"><a href="#get_any_rest_chunked_by_id">experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</a></li>
<li class="help-index-item"><a href="#get_via_url">helper function work in progress: GET json via url of ejscreen ejquery map services</a></li>
<li class="help-index-item"><a href="#getacs_epaquery">experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</a></li>
<li class="help-index-item"><a href="#getacs_epaquery_chunked">experimental/ work in progress: in chunks, get ACS data via EPA API</a></li>
<li class="help-index-item"><a href="#getblocksnearby">Key buffering function - wrapper redirecting to the right version of getblocksnearby()</a></li>
<li class="help-index-item"><a href="#getblocksnearby_and_doaggregate">Wrapper for getblocksnearby() plus doaggregate()</a></li>
<li class="help-index-item"><a href="#getblocksnearby2">Key buffering function - wrapper redirecting to the right version of getblocksnearby()</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree">Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree_Clustered">find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#getblocksnearbyviaQuadTree2">Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</a></li>
<li class="help-index-item"><a href="#hasfield">helper function</a></li>
<li class="help-index-item"><a href="#latlon_as.numeric">Strip non-numeric characters from a vector</a></li>
<li class="help-index-item"><a href="#latlon_df_clean">Find and clean up latitude and longitude columns in a data.frame</a></li>
<li class="help-index-item"><a href="#latlon_infer">guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</a></li>
<li class="help-index-item"><a href="#latlon_is.valid">Validate latitudes and longitudes</a></li>
<li class="help-index-item"><a href="#latlon_readclean">read csv or xlsx and then clean it
This function just wraps EJAMbatch.summarizer::read_csv_or_xl()
and latlon_df_clean()</a></li>
<li class="help-index-item"><a href="#lookup_pctile">Find approx wtd percentiles in lookup table that is in memory</a></li>
<li class="help-index-item"><a href="#merge_state_shapefiles">OBSOLETE Spatial overlay of facilities points and US States shapefiles to add STATE as column in facility table</a></li>
<li class="help-index-item"><a href="#metadata_add">helper function for package to set attributes of a dataset</a></li>
<li class="help-index-item"><a href="#metadata_check">helper function in updating the package metadata</a></li>
<li class="help-index-item"><a href="#NAICS">NAICS (industry classification system codes)</a></li>
<li class="help-index-item"><a href="#naics_categories">See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</a></li>
<li class="help-index-item"><a href="#naics_download">script to download NAICS file with code and name of sector</a></li>
<li class="help-index-item"><a href="#naics_find">Search for an industrial sector in the list of NAICS codes, see subsectors</a></li>
<li class="help-index-item"><a href="#naics_findwebscrape">for query term, show list of roughly matching NAICS, scraped from web
This finds more than just naics_find() does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</a></li>
<li class="help-index-item"><a href="#naics_url_of_code">Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#naics_url_of_query">Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes</a></li>
<li class="help-index-item"><a href="#naics2children">See NAICS codes queried plus all children of any of those
Used by naics_find()</a></li>
<li class="help-index-item"><a href="#popweightedsums">Get population weighted sums of indicators</a></li>
<li class="help-index-item"><a href="#proxistat2">Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.
Proximity score is sum of (1/d) where each d is distance of a given site in km,
summed over all sites within 5km, as in EJScreen.
*** Still need area of each block to fix this func proxistat2()</a></li>
<li class="help-index-item"><a href="#regionstats">data.table of 100 percentiles and means for each EPA Region.</a></li>
<li class="help-index-item"><a href="#run_app">Run the Shiny Application</a></li>
<li class="help-index-item"><a href="#sitepoints_example">data.table of points as example of sitepoints for EJAM</a></li>
<li class="help-index-item"><a href="#sites2blocks_example">data.table of output of getblocknearby(), each row is a unique site-block-distance</a></li>
<li class="help-index-item"><a href="#stateinfo">data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</a></li>
<li class="help-index-item"><a href="#statestats">data.table of 100 percentiles and means for each US State and PR and DC.</a></li>
<li class="help-index-item"><a href="#summarize_blockcount">Get summary stats on counts of blocks (unique vs doublecounted) near sites</a></li>
<li class="help-index-item"><a href="#summarize_blocks_per_site">Get summary stats on counts of blocks near various sites</a></li>
<li class="help-index-item"><a href="#summarize_sites_per_block">Get summary stats on how many sites are near various blocks (residents)</a></li>
<li class="help-index-item"><a href="#testpoints_100_dt">Random test points data.table with columns lat lon site</a></li>
<li class="help-index-item"><a href="#testpoints_1000_dt">Random test points data.table with columns lat lon site</a></li>
<li class="help-index-item"><a href="#testpoints_blockpoints">Get some random US locations as points to try out/ for testing</a></li>
<li class="help-index-item"><a href="#usastats">data.table of 100 percentiles and means</a></li>
<li class="help-index-item"><a href="#write_pctiles_lookup">create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</a></li>
</ul>

    <hr>
    <div class="manual-pages-content">
<div class="container manual-page" id="dot-onLoad">

<a href="#dot-onLoad" class="help-page-title"><h2>Creates index to all US blocks (internal point lat lon) at package load</h2></a>

<h3>Description</h3>

<p>Creates index to all US blocks (internal point lat lon) at package load
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">.onLoad<span class="token punctuation">(</span>libname<span class="token punctuation">,</span> pkgname<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>libname</code></td>
<td>
<p>na</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkgname</code></td>
<td>
<p>na</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="all.equal_functions">

<a href="#all.equal_functions" class="help-page-title"><h2>helper function for checking possibly different versions of a function with same name in 2 packages</h2></a>

<h3>Description</h3>

<p>helper function for checking possibly different versions of a function with same name in 2 packages
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## S3 method for class 'equal_functions'</span>
all<span class="token punctuation">(</span>fun <span class="token operator">=</span> <span class="token string">"latlon_infer"</span><span class="token punctuation">,</span> package1 <span class="token operator">=</span> <span class="token string">"EJAM"</span><span class="token punctuation">,</span> package2 <span class="token operator">=</span> <span class="token string">"EJAMejscreenapi"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>quoted name of function, like "latlon_infer"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package1</code></td>
<td>
<p>quoted name of package, like "EJAM"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package2</code></td>
<td>
<p>quoted name of package, like "EJAMejscreenapi"</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>TRUE or FALSE
</p>


<h3>See Also</h3>

<p><code><a href="#dupenames">dupenames()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="app_run_EJAM">

<a href="#app_run_EJAM" class="help-page-title"><h2>Run the Shiny Application
app_run_EJAM()                 is like EJAM::run_app()
app_run_EJAMejscreenapi()      is like EJAMejscreenapi::run_app()
app_run_EJAMbatch.summarizer() is like EJAMbatch.summarizer::run_app()</h2></a>

<h3>Description</h3>

<p>Run the Shiny Application
app_run_EJAM()                 is like EJAM::run_app()
app_run_EJAMejscreenapi()      is like EJAMejscreenapi::run_app()
app_run_EJAMbatch.summarizer() is like EJAMbatch.summarizer::run_app()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">app_run_EJAM<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>onStart</code></td>
<td>
<p>A function that will be called before the app is actually run.
This is only needed for <code>shinyAppObj</code>, since in the <code>shinyAppDir</code>
case, a <code>global.R</code> file can be used for this purpose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Named options that should be passed to the <code>runApp</code> call
(these can be any of the following: "port", "launch.browser", "host", "quiet",
"display.mode" and "test.mode"). You can also specify <code>width</code> and
<code>height</code> parameters which provide a hint to the embedding environment
about the ideal height/width for the app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enableBookmarking</code></td>
<td>
<p>Can be one of <code>"url"</code>, <code>"server"</code>, or
<code>"disable"</code>. The default value, <code>NULL</code>, will respect the setting from
any previous calls to  <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>. See <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>
for more information on bookmarking your app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiPattern</code></td>
<td>
<p>A regular expression that will be applied to each <code>GET</code>
request to determine whether the <code>ui</code> should be used to handle the
request. Note that the entire request path must match the regular
expression in order for the match to be considered successful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to golem_opts.
See <code>?golem::get_golem_options</code> for more details.</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="bgpts">

<a href="#bgpts" class="help-page-title"><h2>lat lon of popwtd center of blockgroup, and count of blocks per block group</h2></a>

<h3>Description</h3>

<p>This is just a list of US block groups and how many blocks are in each...
It also has the lat and lon roughly of each blockgroup
</p>


<h3>Details</h3>

<p>The point used for each bg is the Census 2020 population weighted mean
of the blocks' internal points. It gives an approximation of where people live
and where each bg is, which is useful for some situations.
</p>
<pre>
  As of 10/2022 it is the EJScreen 2.1 version of data, which uses ACS 2016-2020
  and Census 2020. it has all US States, DC, PR, but not  "AS" "GU" "MP" "VI"
  
  How lat lon were estimated:

# proxistat::bg.pts had a lat/lon internal point for each us block group for Census 2010.
# that had been used to include those lat/lon in ejscreen::bg21, for convenience. 
 &gt; head(proxistat::bg.pts)
           FIPS    aland   awater      lat       lon
           1 010950302024 14969994 15040133 34.42668 -86.2437
            2 010950306002  6751877 16610261 34.31763 -86.34399
            
 # Now, for Census 2020 blocks, create pop wtd centroids lat lon for each block group #### 
 #  using EJAMblockdata::blockwts and EJAMblockdata::blockpoints
 
 bgpts_blocks &lt;- copy(blockpoints) # not essential but ok to make sure we do not change blockpoints itself by reference in data.table operations
 # all.equal(bgpts$blockid , blockwts$blockid)
 bgpts_blocks[ , bgid    := blockwts$bgid]
 bgpts_blocks[ , blockwt := blockwts$blockwt]
 # get pop wtd mean of lat, and same for lon, by bgid
 bgpts &lt;- bgpts_blocks[ , lapply(.SD, FUN = function(x) stats::weighted.mean(x, w = blockwt, na.rm = TRUE)), .SDcols = c('lat', 'lon') , by = 'bgid']
 rm( bgpts_blocks)
 # add the bgfips column, so it has bgfips, bgid, lat, lon
 # all.equal(bgpts$bgid,bgid2fips$bgid)
 bgpts[ , bgfips := bgid2fips$bgfips]
 # setnames(bgpts, 'bgfips', 'FIPS')
 
 # BUT NOTE this census2020 block table has PR but lacks "AS" "GU" "MP" "VI" ####
 # &gt; uniqueN(EJAMblockdata::blockid2fips[,substr(blockfips,1,2)])
 # [1] 52
 # length(unique(EJAMejscreendata::EJSCREEN_Full_with_AS_CNMI_GU_VI$ST_ABBREV))
 # [1] 56
 #   dim(bgejam)
 # [1] 242,940    155
 #   dim(bg22)
 # [1] 242,335    157
 #
 # so how do we get latlon for bg in as/gu/mp/vi ?  ?####
 
 # view those block group points on a map (plot only a subset which is enough)
 sam &lt;- sample(seq_along(bgpts$bgid),5000) 
 plot(bgpts$lon[sam], bgpts$lat[sam], pch = '.')
 
 # view one state, florida, where 12 are the 1st 2 digits of the FIPS:
 # bgpts[bgid2fips[substr(bgfips,1,2) == '12', ], on = 'bgid']
 xx='12'
 mystate &lt;- bgpts[bgid2fips[substr(bgfips, 1, 2) == xx, ], on = 'bgid'][ , .(lon,lat)]
 plot(mystate, pch = '.')
 rm(mystate, xx)
 
    
  How blockcounts were done: 
  
  library(EJAMblockdata)
  library(data.table)
  bg_blockcounts &lt;- blockwts[ , .(blockcount = uniqueN(.SD)), by=bgid]
  sum(bg_blockcounts$blockcount == 1)
    # [1] 1874 blockgroups have only 1 block
  sum(bg_blockcounts$blockcount == 1000)  the max is 1000 blocks in a bg
    # # [1] 22
  round(100*table(bg_blockcounts[blockcount &lt;20, blockcount]) / nrow(bg_blockcounts) ,1)
    # about 1 to 3 
    #   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19 
    # 0.8 1.2 1.3 1.4 1.5 2.1 2.2 2.4 2.6 2.8 2.8 3.0 3.0 2.9 3.0 2.9 2.8 2.7 2.5 
    all.equal(bgpts$bgid, bg_blockcounts$bgid)
  bgpts[ , blockcount := bg_blockcounts$blockcount]
  dim(bgpts)   
      # 242335  x    5
  usethis::use_data(bgpts) # saved for EJAM package
  
  </pre>

<hr>
</div>
<div class="container manual-page" id="blockgroupstats">

<a href="#blockgroupstats" class="help-page-title"><h2>EJScreen demographic and enviromental indicators for Census block groups</h2></a>

<h3>Description</h3>

<p>The EJScreen dataset (demographic, environmental, EJ indicators),
plus more demographic subgroups.
</p>


<h3>Details</h3>

<p>As of 10/2022 it is the EJScreen 2.1 version of data, which uses ACS 2016-2020.
EJScreen 2.1 was released October 2022.
As of  4/2022 it was the EJScreen 2.0 version of data, which used ACS 2015-2019.
EJScreen 2.0 was released 2/18/2022 (raw data download avail 2/22/2022).
</p>
<p>NOTE: It also has the race/ethnic subgroups that add up to minority or people of color.
</p>
<p>Each year this could be created as for the latest version.
See attributes(blockgroupstats)
It is also available in a similar form via the ejscreen package on github,
and EJAMejscreendata::EJSCREEN_Full_with_AS_CNMI_GU_VI
but there are differences in which columns are kept.
</p>
<p>It is a data.table of US Census blockgroups (not blocks). With PR, 242,335 rows, approx 175 columns.
See <a href="https://www.epa.gov/ejscreen" target="_blank">https://www.epa.gov/ejscreen</a>
</p>
<p>column names include bgfips, bgid (for join to blockwt$bgid), pop, pctlowinc, pcthisp, etc.
</p>
<p>see source code and notes in EJAM/inst/notes_datasets/ which has  create_blockgroupstats()
</p>
<p>See maybe the notes on cleaning up and changing the dataset starting from ejscreen::bg22plus
</p>

<hr>
</div>
<div class="container manual-page" id="computeActualDistancefromSurfacedistance">

<a href="#computeActualDistancefromSurfacedistance" class="help-page-title"><h2>convert surface distance to actual distance</h2></a>

<h3>Description</h3>

<div class="sourceCode"><pre>\preformatted{
    Just a simple formula:
   earthRadius_miles &lt;- 3959
   angle_rad &lt;- x/earthRadius_miles
   # Calculate  radius * cord length
   return( earthRadius_miles * 2*sin(angle_rad/2) )
   }
</pre></div>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">computeActualDistancefromSurfacedistance<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>surface distance in miles</p>
</td>
</tr></table>
<hr>
</div>
<div class="container manual-page" id="datapack">

<a href="#datapack" class="help-page-title"><h2>See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame</h2></a>

<h3>Description</h3>

<p>See info about the data sets in one or more packages
Wrapper for data() - just shows info in console and silently returns a data.frame
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span>pkg <span class="token operator">=</span> ejampackages<span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>a character vector giving the package(s) to look in for data sets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>len</code></td>
<td>
<p>Only affects what is printed to console - specifies the
number of characters to limit Title to, making it easier to see in the console.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame with Item and Title as columns
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">datapack<span class="token punctuation">(</span><span class="token string">"datasets"</span><span class="token punctuation">)</span>
 datapack<span class="token punctuation">(</span><span class="token string">"MASS"</span><span class="token punctuation">)</span>
 datapack<span class="token punctuation">(</span>ejampackages<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="doaggregate">

<a href="#doaggregate" class="help-page-title"><h2>Summarize indicators in each buffer (given the blocks in each buffer and indicators for each block)</h2></a>

<h3>Description</h3>

<p>This updated 2022 code takes a set of facilities and the set of blocks that are near each,
(as identified previously, in other code that has identified which blocks are nearby)
and combines those with indicator scores for block groups.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">doaggregate<span class="token punctuation">(</span>
  sites2blocks<span class="token punctuation">,</span>
  countcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  popmeancols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  calculatedcols <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sites2blocks</code></td>
<td>
<p>data.table of distances in miles between all sites (facilities) and
nearby Census block internal points, with columns siteid, blockid, distance,
created by getblocksnearby  function.
See sites2blocks_example dataset in package, as input to this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countcols</code></td>
<td>
<p>character vector of names of variables  to aggregate within a buffer
using a sum of counts, like, for example, the number of people for whom a
poverty ratio is known, the count of which is the exact denominator needed
to correctly calculate percent low income.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popmeancols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using population weighted mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calculatedcols</code></td>
<td>
<p>character vector of names of variables to aggregate within a buffer
using formulas that have to be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>used while testing this function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>more to pass to another function? Not used currently.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function aggregates the blockgroup scores to create a summary of each indicator,
as a raw score and US percentile and State percentile,
in each buffer (i.e., near each facility):
</p>

<ul>
<li> <p><strong>SUMS OF COUNTS</strong>: for population count, or number of households or Hispanics, etc.
</p>
</li>
<li> <p><strong>POPULATION-WEIGHTED MEANS</strong>: for  Environmental indicators.
</p>
<p><em><strong>EJ Indexes</strong>:</em> These could be in theory recalculated via formula, but the way EJScreen
does this is apparently finding the pop wtd mean of EJ Index raw scores,
not the EJ Index formula applied to the summarized demographic score and aggregated envt number.
</p>
</li>
<li> <p><strong>CALCULATED BY FORMULA</strong>: Buffer or overall score calculated via formulas using aggregated counts,
such as percent low income = sum of counts low income / sum of counts of denominator,
which in this case is the count of those for whom the poverty ratio is known.
</p>
</li>
<li> <p><strong>LOOKED UP</strong>: Aggregated scores are converted into percentile terms via lookup tables (US or State version).
</p>
</li>
</ul>
<p>This function requires the following as data lazy loaded for example from EJAMblockdata package:
</p>

<ul>
<li>
<p> blockwts: data.table with these columns: blockid , bgid, blockwt
</p>
</li>
<li>
<p> quaddata, and blockquadtree: data.table and quad tree, for indexes of block points
(and localtree that is created when package is loaded)
</p>
</li>
<li>
<p> EJAM::blockgroupstats - A data.table (such as EJSCREEN demographic and environmental data by blockgroup?)
</p>
</li>
</ul>
<hr>
</div>
<div class="container manual-page" id="dupenames">

<a href="#dupenames" class="help-page-title"><h2>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package</h2></a>

<h3>Description</h3>

<p>helper function to look at several packages to spot conflicting exported names
See what objects (functions or data) are exported by a given (installed) package
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">dupenames<span class="token punctuation">(</span>
  pkg <span class="token operator">=</span> EJAM<span class="token operator">::</span>ejampackages<span class="token punctuation">,</span>
  sortbypkg <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  compare.functions <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkg</code></td>
<td>
<p>one or more package names as vector of strings.
If "all" it checks all installed pkgs, but takes very very long potentially.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbypkg</code></td>
<td>
<p>If TRUE, just returns same thing but sorted by package name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare.functions</code></td>
<td>
<p>If TRUE, sends to console inf about whether body and formals
of the functions are identical between functions of same name from different packages.
Only checks the first 2 copies, not any additional ones (where 3+ pkgs use same name)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This can help find duplicates/conflicts within source code
and make sure they are on search path, for when renaming / moving functions/packages
</p>


<h3>Value</h3>

<p>data.frame with columns Package, Object name (or NA if no dupes)
</p>


<h3>See Also</h3>

<p><code><a href="#all.equal_functions">all.equal_functions()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="ejampackages">

<a href="#ejampackages" class="help-page-title"><h2>list of names of EJAM-related R packages</h2></a>

<h3>Description</h3>

<p>list of names of EJAM-related R packages
</p>

<hr>
</div>
<div class="container manual-page" id="get_any_rest_chunked_by_id">

<a href="#get_any_rest_chunked_by_id" class="help-page-title"><h2>experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API</h2></a>

<h3>Description</h3>

<p>experimental/ work in progress: in chunks, get ACS data or Block weights nearby via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_any_rest_chunked_by_id<span class="token punctuation">(</span>objectIds<span class="token punctuation">,</span> chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a table
</p>

<hr>
</div>
<div class="container manual-page" id="get_via_url">

<a href="#get_via_url" class="help-page-title"><h2>helper function work in progress: GET json via url of ejscreen ejquery map services</h2></a>

<h3>Description</h3>

<p>helper function work in progress: GET json via url of ejscreen ejquery map services
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get_via_url<span class="token punctuation">(</span>url<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>the url for an EJScreen ejquery request</p>
</td>
</tr></table>
<h3>Value</h3>

<p>json
</p>

<hr>
</div>
<div class="container manual-page" id="getacs_epaquery">

<a href="#getacs_epaquery" class="help-page-title"><h2>experimental/ work in progress: get ACS data via EPA API (for &lt;200 places)</h2></a>

<h3>Description</h3>

<p>uses ACS2019 rest services ejscreen ejquery MapServer 7
</p>
<p>Documentation of format and examples of input parameters:
https://geopub.epa.gov/arcgis/sdk/rest/index.html#/Query_Map_Service_Layer/02ss0000000r000000/
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getacs_epaquery<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API. eg "STCNTRBG","TOTALPOP","PCT_HISP",</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>if TRUE, returns url instead of default making API request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to getacs_epaquery_chunked()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">getacs_epaquery<span class="token punctuation">(</span>justurl<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getacs_epaquery_chunked">

<a href="#getacs_epaquery_chunked" class="help-page-title"><h2>experimental/ work in progress: in chunks, get ACS data via EPA API</h2></a>

<h3>Description</h3>

<p>experimental/ work in progress: in chunks, get ACS data via EPA API
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getacs_epaquery_chunked<span class="token punctuation">(</span>
  objectIds <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  servicenumber <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
  outFields <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  returnGeometry <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  justurl <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  chunksize <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>objectIds</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>servicenumber</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outFields</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnGeometry</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>justurl</code></td>
<td>
<p>see API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunksize</code></td>
<td>
<p>eg 200 for chunks of 200 each request</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to getacs_epaquery()</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>table
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
 <span class="token comment">#\dontrun {</span>
 <span class="token comment"># x &lt;- list() # chunked chunks. best not to ask for all these:</span>
 <span class="token comment"># x[[1]] &lt;- getacs_epaquery_chunked(   1:1000, chunksize = 100)</span>
 <span class="token comment"># x[[2]] &lt;- getacs_epaquery_chunked(1001:5000, chunksize = 100)</span>
 <span class="token comment"># xall &lt;- do.call(rbind, x)</span>
 <span class="token comment">#}</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby">

<a href="#getblocksnearby" class="help-page-title"><h2>Key buffering function - wrapper redirecting to the right version of getblocksnearby()</h2></a>

<h3>Description</h3>

<p>Key buffering function - wrapper redirecting to the right version of getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>a large quadtree object created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#getblocksnearby2">getblocksnearby2()</a></code> that was work in progress
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearby_and_doaggregate">

<a href="#getblocksnearby_and_doaggregate" class="help-page-title"><h2>Wrapper for getblocksnearby() plus doaggregate()</h2></a>

<h3>Description</h3>

<p>Wrapper for getblocksnearby() plus doaggregate()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby_and_doaggregate<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>a large quadtree object created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> or other such functions</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="getblocksnearby2">

<a href="#getblocksnearby2" class="help-page-title"><h2>Key buffering function - wrapper redirecting to the right version of getblocksnearby()</h2></a>

<h3>Description</h3>

<p>Key buffering function - wrapper redirecting to the right version of getblocksnearby()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearby2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  quadtree <span class="token operator">=</span> is.null<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code> or other such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>a large quadtree object created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>see <code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> or other such functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Like getblocksnearby() but tries to handle localtree and quadtree parameter differently
</p>

<ul><li>
<p> not sure how to check if they are in the right environment.
</p>
</li></ul>
<h3>See Also</h3>

<p><code><a href="#getblocksnearby">getblocksnearby()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree">

<a href="#getblocksnearbyviaQuadTree" class="help-page-title"><h2>Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code> <code><a href="#getblocksnearbyviaQuadTree2">getblocksnearbyviaQuadTree2()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">localtree_example <span class="token operator">=</span> SearchTrees<span class="token operator">::</span>createTree<span class="token punctuation">(</span>EJAMblockdata<span class="token operator">::</span>quaddata<span class="token punctuation">,</span> treeType <span class="token operator">=</span> <span class="token string">"quad"</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">"point"</span><span class="token punctuation">)</span>
  x <span class="token operator">=</span> getblocksnearby<span class="token punctuation">(</span>testpoints_1000_dt<span class="token punctuation">,</span> quadtree <span class="token operator">=</span> localtree_example<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree_Clustered">

<a href="#getblocksnearbyviaQuadTree_Clustered" class="help-page-title"><h2>find nearby blocks using Quad Tree data structure for speed, CLUSTERED FOR PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>Uses packages <a href="https://deepayan.r-universe.dev/manual/lattice.html#splom">parallel</a> and snow. parallel::makePSOCKcluster is an enhanced version of snow::makeSOCKcluster in package snow.
It runs Rscript on the specified host(s) to set up a worker process which listens on a socket for expressions to evaluate, and returns the results (as serialized objects).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree_Clustered<span class="token punctuation">(</span>
  facilities<span class="token punctuation">,</span>
  cutoff<span class="token punctuation">,</span>
  maxcutoff<span class="token punctuation">,</span>
  avoidorphans<span class="token punctuation">,</span>
  CountCPU <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>facilities</code></td>
<td>
<p>data.table with columns LAT, LONG</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles distance (check what this actually does)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (check what this actually does)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CountCPU</code></td>
<td>
<p>for parallel processing via makeCluster() and doSNOW::registerDoSNOW()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Uses indexgridsize and quaddata  variables that come from global environment (but should pass to this function rather than assume in global env?)
</p>


<h3>See Also</h3>

<p><code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>  <code><a href="#computeActualDistancefromSurfacedistance">computeActualDistancefromSurfacedistance()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="getblocksnearbyviaQuadTree2">

<a href="#getblocksnearbyviaQuadTree2" class="help-page-title"><h2>Find nearby blocks using Quad Tree data structure for speed, NO PARALLEL PROCESSING</h2></a>

<h3>Description</h3>

<p>This should be almost identical to getblocksnearbyviaQuadTree(),
but it uses f2, a copy of sitepoints, and more importantly it
pulls some code out of the for loop and uses a vectorized approach.
Given a set of points and a specified radius (cutoff),
this function quickly finds all the US Census blocks near each point.
For each point, it uses the specified cutoff distance and finds the distance to
every block within the circle defined by the radius (cutoff).
Each block is defined by its Census-provided internal point, by latitude and longitude.
</p>
<p>Each point can be the location of a regulated facility or other type of site, and
the blocks are a high-resolution source of information about where
residents live.
</p>
<p>Finding which blocks have their internal points in a circle provides
a way to quickly estimate what fraction of a block group is
inside the circular buffer more accurately and more quickly than
areal apportionment of block groups would provide.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">getblocksnearbyviaQuadTree2<span class="token punctuation">(</span>
  sitepoints<span class="token punctuation">,</span>
  cutoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  maxcutoff <span class="token operator">=</span> <span class="token number">31.07</span><span class="token punctuation">,</span>
  avoidorphans <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  report_progress_every_n <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  quadtree
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sitepoints</code></td>
<td>
<p>data.table with columns siteid, lat, lon giving point locations of sites or facilities around which are circular buffers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>miles radius, defining circular buffer around site point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcutoff</code></td>
<td>
<p>miles distance (max distance to check if not even 1 block point is within cutoff)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoidorphans</code></td>
<td>
<p>logical Whether to avoid case where no block points are within cutoff,
so if TRUE, it keeps looking past cutoff to find nearest one within maxcutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report_progress_every_n</code></td>
<td>
<p>Reports progress to console after every n points,
mostly for testing, but a progress bar feature might be useful unless this is super fast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>(a pointer to the large quadtree object)
created from the SearchTree package example:
SearchTrees::createTree(EJAMblockdata::quaddata, treeType = "quad", dataType = "point")
Takes about 2-5 seconds to create this each time it is needed.
It can be automatically created when the package is loaded via the <code><a href="#dot-onLoad">.onLoad()</a></code> function</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#getblocksnearbyviaQuadTree_Clustered">getblocksnearbyviaQuadTree_Clustered()</a></code>  <code><a href="#getblocksnearbyviaQuadTree">getblocksnearbyviaQuadTree()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">localtree_example <span class="token operator">=</span> SearchTrees<span class="token operator">::</span>createTree<span class="token punctuation">(</span>EJAMblockdata<span class="token operator">::</span>quaddata<span class="token punctuation">,</span> treeType <span class="token operator">=</span> <span class="token string">"quad"</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">"point"</span><span class="token punctuation">)</span>
  x <span class="token operator">=</span> getblocksnearby2<span class="token punctuation">(</span>testpoints_1000_dt<span class="token punctuation">,</span> quadtree <span class="token operator">=</span> localtree_example<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="hasfield">

<a href="#hasfield" class="help-page-title"><h2>helper function</h2></a>

<h3>Description</h3>

<p>helper function
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">hasfield<span class="token punctuation">(</span>data<span class="token punctuation">,</span> fieldname<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fieldname</code></td>
<td>
<p>colname to check</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical
</p>

<hr>
</div>
<div class="container manual-page" id="latlon_as.numeric">

<a href="#latlon_as.numeric" class="help-page-title"><h2>Strip non-numeric characters from a vector</h2></a>

<h3>Description</h3>

<p>Remove all characters other than minus signs, decimal points, and numeric digits
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of something that is supposed to be numbers like latitude or longitude
and may be a character vector because there were some other characters like tab or space or percent sign or dollar sign</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Useful if latitude or longitude vector has spaces, tabs, etc.
CAUTION - Assumes stripping those out and making it numeric will fix whatever problem there was
and end result is a valid set of numbers. Inf etc. are turned into NA values.
Empty zero length string is turned into NA without warning. NA is left as NA.
If anything other than empty or NA could not be interpreted as a number, it
returns NA for those and offers a warning.
</p>


<h3>Value</h3>

<p>numeric vector same length as x
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"-97.179167000000007"</span><span class="token punctuation">,</span> <span class="token string">" -94.0533"</span><span class="token punctuation">,</span> <span class="token string">"-95.152083000000005"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'asdf'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'aword'</span><span class="token punctuation">,</span> <span class="token string">'$b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'-10.5%'</span><span class="token punctuation">,</span> <span class="token string">'&lt;5'</span><span class="token punctuation">,</span> <span class="token string">'$100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  latlon_as.numeric<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">Inf</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_df_clean">

<a href="#latlon_df_clean" class="help-page-title"><h2>Find and clean up latitude and longitude columns in a data.frame</h2></a>

<h3>Description</h3>

<p>Utility to identify lat and lon columns, renaming and cleaning them up.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_df_clean<span class="token punctuation">(</span>df<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>data.frame With columns lat and lon or names that can be interpreted as such - see latlon_infer()</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Tries to figure out which columns seem to have lat lon values, renames those in the data.frame.
Cleans up lat and lon values (removes extra characters, makes numeric)
</p>


<h3>Value</h3>

<p>Returns the same data.frame but with relevant colnames changed to lat and lon,
and invalid lat or lon values cleaned up if possible or else replaced with NA
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#  x &lt;- latlon_df_clean(x)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_infer">

<a href="#latlon_infer" class="help-page-title"><h2>guess which columns have lat and lon based on aliases like latitude, FacLat, etc.</h2></a>

<h3>Description</h3>

<p>guess which columns have lat and lon based on aliases like latitude, FacLat, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>mycolnames<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>mycolnames</code></td>
<td>
<p>e.g., colnames(x) where x is a data.frame from read.csv</p>
</td>
</tr></table>
<h3>Value</h3>

<p>returns all of mycolnames except replacing the best candidates with lat and lon
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'trilat'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">,</span> <span class="token string">'belong'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># warns if no alias found. Does not warn of dupes in other terms, just preferred term.</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'Longitude'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'LONGITUDE'</span><span class="token punctuation">,</span> <span class="token string">'Long'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># only the best alias is converted/used</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'longing'</span><span class="token punctuation">,</span> <span class="token string">'Lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'LAT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of preferred are left alone only if lowercase one is found</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'long'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># case variants of a single alias are converted to preferred word (if pref not found), creating dupes!  warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'LONG'</span><span class="token punctuation">,</span> <span class="token string">'LONG'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes of an alias are renamed and still are dupes! warn!</span>
  latlon_infer<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">,</span> <span class="token string">'Lon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># dupes left as dupes but warn!</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_is.valid">

<a href="#latlon_is.valid" class="help-page-title"><h2>Validate latitudes and longitudes</h2></a>

<h3>Description</h3>

<p>Check each latitude and longitude value to see if they are
NA or outside expected numeric ranges
(based on approx ranges of lat lon seen among block internal points dataset)
lat must be between 17.5 and 71.5, and
lon must be ( between -180 and -65) OR (between 172 and 180)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_is.valid<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>vector of latitudes in decimal degrees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>numeric vector of longitudes in decimal degrees, same length</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>logical vector, one element per lat lon pair (location)
</p>


<h3>See Also</h3>

<p>latlon_df_clean() latlon_infer() latlon_is.valid() latlon_as.numeric()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 table<span class="token punctuation">(</span>latlon_is.valid<span class="token punctuation">(</span>lat <span class="token operator">=</span> EJAMblockdata<span class="token operator">::</span>blockpoints<span class="token operator">$</span>lat<span class="token punctuation">,</span> lon <span class="token operator">=</span> EJAMblockdata<span class="token operator">::</span>blockpoints<span class="token operator">$</span>lon<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">##      TRUE </span>
  <span class="token comment">## 8,174,955</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="latlon_readclean">

<a href="#latlon_readclean" class="help-page-title"><h2>read csv or xlsx and then clean it
This function just wraps <code><a>EJAMbatch.summarizer::read_csv_or_xl()</a></code>
and <code><a href="#latlon_df_clean">latlon_df_clean()</a></code>
</h2></a>

<h3>Description</h3>

<p>read csv or xlsx and then clean it
This function just wraps <code><a>EJAMbatch.summarizer::read_csv_or_xl()</a></code>
and <code><a href="#latlon_df_clean">latlon_df_clean()</a></code>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">latlon_readclean<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>character string, full path to a .csv or .xlsx file</p>
</td>
</tr></table>
<h3>Value</h3>

<p>see <code><a href="#latlon_df_clean">latlon_df_clean()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="lookup_pctile">

<a href="#lookup_pctile" class="help-page-title"><h2>Find approx wtd percentiles in lookup table that is in memory</h2></a>

<h3>Description</h3>

<p>This is used with a data.frame that is a lookup table used to
convert a raw indicator value to a percentile - US, Region, or State percentile.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">lookup_pctile<span class="token punctuation">(</span>myvector<span class="token punctuation">,</span> varname.<span class="token keyword">in</span>.lookup.table<span class="token punctuation">,</span> lookup <span class="token operator">=</span> usastats<span class="token punctuation">,</span> zone<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myvector</code></td>
<td>
<p>Numeric vector, required. Values to look for in the lookup table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname.in.lookup.table</code></td>
<td>
<p>Character element, required.
Name of column in lookup table to look in
to find interval where a given element of myvector values is.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lookup</code></td>
<td>
<p>Either lookup must be specified,
or a lookup table called us must already be in memory. This is the lookup table
data.frame with a PCTILE column and column whose name is the value of varname.in.lookup.table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Character element (or vector as long as myvector), optional.
If specified, must appear in a column called REGION within the lookup table.
For example, it could be 'NY' for New York State.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This could be recoded to be more efficient.
The data.frame lookup table must have a field called "PCTILE" that has quantiles/percentiles
and other column(s) with values that fall at those percentiles.
EJAM::usastats, EJAM::statstats, EJAM::regionstats are such lookup tables.
This function accepts lookup table (or uses one called us if that is in memory), and
finds the number in the PCTILE column that corresponds to where a specified value
(in myvector) appears in the column called varname.in.lookup.table.
The function just looks for where the specified value fits between values in the lookup table
and returns the approximate percentile as found in the PCTILE column.
If the value is between the cutpoints listed as
percentiles 89 and 90, it returns 89, for example.
If the value is exactly equal to the cutpoint listed as percentile 90,
it returns percentile 90.
If the value is less than the cutpoint listed as percentile 0,
which should be the minimum value in the dataset,
it still returns 0 as the percentile, but with a warning that
the value checked was less than the minimum in the dataset.
</p>


<h3>Value</h3>

<p>By default, returns numeric vector length of myvector.
</p>

<hr>
</div>
<div class="container manual-page" id="merge_state_shapefiles">

<a href="#merge_state_shapefiles" class="help-page-title"><h2>OBSOLETE Spatial overlay of facilities points and US States shapefiles to add STATE as column in facility table</h2></a>

<h3>Description</h3>

<p>OBSOLETE Spatial overlay of facilities points and US States shapefiles to add STATE as column in facility table
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">merge_state_shapefiles<span class="token punctuation">(</span>facs<span class="token punctuation">,</span> shapefile<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>facs</code></td>
<td>
<p>facilities LONG LAT table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shapefile</code></td>
<td>
<p>shapefile of States</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns the facs that was passed to this function, but with a new column, STATE, that has the name of the State each point is inside of
</p>

<hr>
</div>
<div class="container manual-page" id="metadata_add">

<a href="#metadata_add" class="help-page-title"><h2>helper function for package to set attributes of a dataset</h2></a>

<h3>Description</h3>

<p>This can be used annually to update some datasets in a package.
It just makes it easier to set a few metadata attributes similarly
for a number of data elements, for example,
to add new or update existing attributes.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>dataset (or any object) whose metadata you want to update or create</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata</code></td>
<td>
<p>must be a named list, so that the function can do this for each i:
attr(x, which=names(metadata)i) &lt;- metadata[i]</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>returns x but with new or altered attributes
</p>


<h3>See Also</h3>

<p>metadata_check()
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">1001</span><span class="token operator">:</span><span class="token number">1010</span><span class="token punctuation">)</span>
  metadata <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>
  census_version <span class="token operator">=</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  acs_version <span class="token operator">=</span> <span class="token string">'2016-2020'</span><span class="token punctuation">,</span>
  acs_releasedate <span class="token operator">=</span> <span class="token string">'3/17/2022'</span><span class="token punctuation">,</span>
  ejscreen_version <span class="token operator">=</span> <span class="token string">'2.1'</span><span class="token punctuation">,</span>
  ejscreen_releasedate <span class="token operator">=</span> <span class="token string">'October 2022'</span><span class="token punctuation">,</span>
  ejscreen_pkg_data <span class="token operator">=</span> <span class="token string">'bg22'</span>
  <span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
  attributes<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  x <span class="token operator">&lt;-</span> metadata_add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> list<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'final'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  attr<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'status'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="metadata_check">

<a href="#metadata_check" class="help-page-title"><h2>helper function in updating the package metadata</h2></a>

<h3>Description</h3>

<p>Quick and dirty helper during development, to check all the
attributes of all the data files in relevant packages.
It loads unloaded packages as needed, which you might not want it to do,
but it is not coded to be able to check attributes without doing that.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">metadata_check<span class="token punctuation">(</span>
  packages <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  which <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"census_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_version"</span><span class="token punctuation">,</span> <span class="token string">"acs_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ACS"</span><span class="token punctuation">,</span>
    <span class="token string">"ejscreen_version"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_releasedate"</span><span class="token punctuation">,</span> <span class="token string">"ejscreen_pkg_data"</span><span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token string">"released"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  loadifnotloaded <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>packages</code></td>
<td>
<p>Optional. e.g. 'EJAMejscreendata', or can be a vector of character strings,
and if not specified, default is to report on all packages with EJ as part of their name,
like EJAMblockdata or ejscreenapi</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>Optional vector (not list) of strings, the attributes.
Default is some typical ones used in EJAM-related packages currently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loadifnotloaded</code></td>
<td>
<p>Optional to control if func should temporarily attach packages not already loaded.</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="NAICS">

<a href="#NAICS" class="help-page-title"><h2>NAICS (industry classification system codes)</h2></a>

<h3>Description</h3>

<p>NAICS (industry classification system codes)
</p>


<h3>Details</h3>

<p>These industry names and codes get updated every 5 years
(2017 version replaced by 2022 version in January 2022).
See <a href="https://www.census.gov/naics/" target="_blank">https://www.census.gov/naics/</a>
</p>
<pre>
 This is a list (but may change to data.frame) of NAICS codes.
  The codes are numeric, where names are the code followed by the title of the industrial sector.
  To check the vintage of the dataset, check
   attr(NAICS, 'year')
  The format is like this, and for 2017 version it had 2193 entries:
  but placeholders added in 2023 for 31,32,33, 44,45, 48,49
 #  x &lt;- list(
 #   `11 - Agriculture, Forestry, Fishing and Hunting` = 11,
 #   `111 - Crop Production` = 111,
 #   `1111 - Oilseed and Grain Farming` = 1111,
 #   `11111 - Soybean Farming` = 11111,
 #   `111110 - Soybean Farming` = 111110
 #   )
 About NAICS codes:
 
 The North American Industry Classification System (NAICS)
 is a system for classifying establishments (individual business locations) 
 by type of economic activity.
 https://www.census.gov/naics/ 
 
 The North American Industry Classification System (NAICS) is
 the standard used by Federal statistical agencies in
 classifying business establishments for the purpose of 
 collecting, analyzing, and publishing statistical data 
 related to the U.S. business economy.
 
 The codes were updated 2007, 2012, 2017, and for 2022 (announced Dec. 2021).
 Finalized changes: https://www.census.gov/naics/federal_register_notices/notices/fr21dc21.pdf
 Effective Date for 2022 NAICS
 United States codes and Statistical
 Policy Directives: Federal statistical
 establishment data published for
 reference years beginning on or after
 January 1, 2022, should be published
 using the 2022 NAICS United States
 codes. Publication of NAICS United
 States, 2022 Manual is planned for
 January 2022 on the NAICS website at
 www.census.gov/naics. The updated
 Statistical Policy Directive No. 8, North
 American Industry Classification
 System: Classification of
 Establishments, will be effective
 immediately and will be posted on the
 OMB Statistical Programs and Standards
 website at www.whitehouse.gov/omb/
   information-regulatory-affairs/
   statistical-programs-standards/.
 </pre>
<pre>
  ## see   https://www.census.gov/naics/

  # to get 2017 version into this format, see [naics_download()] 
  NAICS &lt;- naics_download()
  # specify metadata here on vintage of data, etc.
  usethis::use_data(NAICS, overwrite=TRUE)
  # save(NAICS, file = 'yourpath/EJAM/data/NAICS.rda')
  </pre>


<h3>See Also</h3>

<p><code><a href="#naics_find">naics_find()</a></code>  <code><a href="#naics_categories">naics_categories()</a></code>   <code><a href="#naics_download">naics_download()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="naics_categories">

<a href="#naics_categories" class="help-page-title"><h2>See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level</h2></a>

<h3>Description</h3>

<p>See the names of industrial categories and their NAICS code
Easy way to list the 2-digit NAICS (17 categories), or other level
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span>digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> dataset <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>default is 2, for 2-digits NAICS, the top level, but could be up to 6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Should default to the dataset called NAICS, installed with this package.
see <a href="#NAICS">NAICS</a>  Check attr(NAICS, 'year')</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Also see https://www.naics.com/search/
There are this many NAICS codes roughly by number of digits in the code:
table(nchar(NAICS))
2    3    4    5    6
17   99  311  709 1057
See https://www.census.gov/naics/
</p>


<h3>See Also</h3>

<p><a href="#naics_find">naics_find</a>  <a href="#NAICS">NAICS</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_categories<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_download">

<a href="#naics_download" class="help-page-title"><h2>script to download NAICS file with code and name of sector</h2></a>

<h3>Description</h3>

<p>See source code. Mostly just a short script to get the 2017 or 2022 codes and names.
See &lt;'https://www.census.gov/naics/?48967'&gt;
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_download<span class="token punctuation">(</span>
  year <span class="token operator">=</span> <span class="token number">2017</span><span class="token punctuation">,</span>
  urlpattern <span class="token operator">=</span> <span class="token string">"https://www.census.gov/naics/YYYYNAICS/2-6%20digit_YYYY_Codes.xlsx"</span><span class="token punctuation">,</span>
  destfile <span class="token operator">=</span> paste0<span class="token punctuation">(</span><span class="token string">"~/Downloads/"</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> <span class="token string">"NAICS.xlsx"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>which vintage of NAICS codes to use, 2012, 2017, or 2022</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urlpattern</code></td>
<td>
<p>full url of xlsx file to use, but with YYYY instead of year</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>destfile</code></td>
<td>
<p>full path and name of file to save as locally</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>names list with year as an attribute
</p>

<hr>
</div>
<div class="container manual-page" id="naics_find">

<a href="#naics_find" class="help-page-title"><h2>Search for an industrial sector in the list of NAICS codes, see subsectors</h2></a>

<h3>Description</h3>

<p>Just a utility, quick way to view NAICS industrial sectors that contain queried word or phrase,
but can also see all the subcategories within the matching one.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_find<span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  add_children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  naics_dataset <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  ignore.case <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  exactnumber <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  search_on_naics_website <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>a single word or phrase such as "chemical manufacturing" or "cement"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_children</code></td>
<td>
<p>default is FALSE, so it does NOT chidren (subcategories) of those that match the query.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>naics_dataset</code></td>
<td>
<p>Should default to the dataset NAICS, installed with this package. see <a href="#NAICS">NAICS</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.case</code></td>
<td>
<p>default TRUE, ignoring whether query is upper or lower case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exactnumber</code></td>
<td>
<p>if TRUE, only return the exact match to (each) queried number (NAICS code)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>search_on_naics_website</code></td>
<td>
<p>if TRUE (not default),
returns URL of webpage at naics.com with info on the sector</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <a href="https://www.census.gov/naics/" target="_blank">https://www.census.gov/naics/</a>
NOTE: By default, this shows NAICS that match the text query,
and also can include all the children NAICS even if they do not match based on text query.
So it first finds NAICS that match the text (or code) query via grep(),
and then can also include all subcategories within those categories.
</p>
<p>So naics_find('soap', add_children=TRUE) shows "325612 - Polish and Other Sanitation Good Manufacturing",
and others, not just "3256 - Soap, Cleaning Compound, and Toilet Preparation Manufacturing",
because 3256 matches 'soap' and 325612 is a subcategory of 3256.
</p>
<p>The format of NAICS, the naics_dataset, in this package is
dput(NAICS1:4)
c(<code style="white-space: pre;">11 - Agriculture, Forestry, Fishing and Hunting</code> = 11, <code style="white-space: pre;">111 - Crop Production</code> = 111,
<code style="white-space: pre;">1111 - Oilseed and Grain Farming</code> = 1111, <code style="white-space: pre;">11111 - Soybean Farming</code> = 11111
)
</p>


<h3>See Also</h3>

<p><a href="#naics_categories">naics_categories</a> <a href="#NAICS">NAICS</a> <code><a href="#naics_findwebscrape">naics_findwebscrape()</a></code> get_facility_info_via_ECHO function <code><a href="#naics_url_of_code">naics_url_of_code()</a></code> <code><a href="#naics_url_of_query">naics_url_of_query()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_find<span class="token punctuation">(</span><span class="token number">8111</span><span class="token punctuation">,</span> exactnumber <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token number">8111</span><span class="token punctuation">,</span> exactnumber <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token number">8111</span><span class="token punctuation">,</span> exactnumber <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 
 naics_find<span class="token punctuation">(</span><span class="token string">"paper"</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"cement | concrete"</span><span class="token punctuation">)</span>
 cbind<span class="token punctuation">(</span>naics_find<span class="token punctuation">(</span><span class="token string">"pig"</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"pulp"</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"pulp"</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"asdfasdf"</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>  
 naics_find<span class="token punctuation">(</span><span class="token string">"asdfasdf"</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">,</span> search_on_naics_website<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">,</span> search_on_naics_website<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
 <span class="token comment"># browseURL(naics_find("copper smelting", search_on_naics_website=TRUE))</span>
 
 EJAMfrsdata<span class="token operator">::</span>frs<span class="token punctuation">[</span>EJAMfrsdata<span class="token operator">::</span>frs<span class="token operator">$</span>REGISTRY_ID <span class="token percent-operator operator">%in%</span> unlist<span class="token punctuation">(</span>
   EJAMfrsdata<span class="token operator">::</span>get_siteid_from_naics<span class="token punctuation">(</span>
     EJAM<span class="token operator">::</span>naics_find<span class="token punctuation">(</span><span class="token string">"pulp"</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">"REGISTRY_ID"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">]</span>
   
 EJAMejscreenapi<span class="token operator">::</span>mapfast<span class="token punctuation">(</span>EJAMfrsdata<span class="token operator">::</span>frs<span class="token punctuation">[</span>EJAMfrsdata<span class="token operator">::</span>frs<span class="token operator">$</span>REGISTRY_ID <span class="token percent-operator operator">%in%</span> unlist<span class="token punctuation">(</span>
   EJAMfrsdata<span class="token operator">::</span>get_siteid_from_naics<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>naics_find<span class="token punctuation">(</span><span class="token string">"pulp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">"REGISTRY_ID"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token punctuation">]</span><span class="token punctuation">)</span>
   
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics2children<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_findwebscrape">

<a href="#naics_findwebscrape" class="help-page-title"><h2>for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_find">naics_find()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.</h2></a>

<h3>Description</h3>

<p>for query term, show list of roughly matching NAICS, scraped from web
This finds more than just <code><a href="#naics_find">naics_find()</a></code> does, since that needs an exact match
but this looks at naics.com website which lists various aliases for a sector.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_findwebscrape<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>text like "gasoline" or "copper smelting"</p>
</td>
</tr></table>
<h3>Value</h3>

<p>data.frame of info on what was found, naics and title
</p>


<h3>See Also</h3>

<p><code><a href="#naics_find">naics_find()</a></code> <code><a href="#naics_url_of_query">naics_url_of_query()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics_find<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">,</span> search_on_naics_website<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
 naics_find<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">,</span> search_on_naics_website<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics_url_of_query<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  <span class="token comment">## Not run: </span>
  naics_findwebscrape<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>naics_url_of_query<span class="token punctuation">(</span><span class="token string">"copper smelting"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  browseURL<span class="token punctuation">(</span>naics_url_of_code<span class="token punctuation">(</span><span class="token number">326</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="naics_url_of_code">

<a href="#naics_url_of_code" class="help-page-title"><h2>Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>Get URL for page with info about industry sector(s) by NAICS
See naics.com for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_url_of_code<span class="token punctuation">(</span>naics<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>naics</code></td>
<td>
<p>vector of one or more NAICS codes, like 11,"31-33",325</p>
</td>
</tr></table>
<h3>Value</h3>

<p>vector of URLs as strings like https://www.naics.com/six-digit-naics/?v=2017&amp;code=22
</p>

<hr>
</div>
<div class="container manual-page" id="naics_url_of_query">

<a href="#naics_url_of_query" class="help-page-title"><h2>Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes</h2></a>

<h3>Description</h3>

<p>Get URL for page with info about industry sectors by text query term
See naics.com for more information on NAICS codes
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics_url_of_query<span class="token punctuation">(</span>query<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>string query term like "gasoline" or "copper smelting"</p>
</td>
</tr></table>
<h3>Value</h3>

<p>URL as string
</p>

<hr>
</div>
<div class="container manual-page" id="naics2children">

<a href="#naics2children" class="help-page-title"><h2>See NAICS codes queried plus all children of any of those
Used by naics_find()</h2></a>

<h3>Description</h3>

<p>See NAICS codes queried plus all children of any of those
Used by naics_find()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span>codes<span class="token punctuation">,</span> allcodes <span class="token operator">=</span> EJAM<span class="token operator">::</span>NAICS<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>codes</code></td>
<td>
<p>vector of numerical or character</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allcodes</code></td>
<td>
<p>Optional (already loaded with package) - dataset with all the codes</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>start with shortest (highest level) codes. since tied for nchar, these branches have zero overlap, so do each.
for each of those, get its children = all rows where parentcode == substr(allcodes, 1, nchar(parentcode))
put together list of all codes we want to include so far.
now for the next longest set of codes in original list of codes,
do same thing.
etc. until did it for 5 digit ones to get 6digit children.
take the unique(allthat)
table(nchar(as.character(NAICS)))
2    3    4    5    6
17   99  311  709 1057
</p>


<h3>Value</h3>

<p>vector of codes and their names
</p>


<h3>See Also</h3>

<p>naics_find() NAICS
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">naics2children<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  naics_find<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">,</span> exactnumber<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> add_children <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  NAICS<span class="token punctuation">[</span><span class="token number">211</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># wrong</span>
  NAICS<span class="token punctuation">[</span>NAICS <span class="token operator">==</span> <span class="token number">211</span><span class="token punctuation">]</span>
  NAICS<span class="token punctuation">[</span><span class="token string">"211 - Oil and Gas Extraction"</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="popweightedsums">

<a href="#popweightedsums" class="help-page-title"><h2>Get population weighted sums of indicators</h2></a>

<h3>Description</h3>

<p>Get population weighted sums of indicators
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">popweightedsums<span class="token punctuation">(</span>data<span class="token punctuation">,</span> fieldnames<span class="token punctuation">,</span> fieldnames_out<span class="token punctuation">,</span> scaling<span class="token punctuation">,</span> popname <span class="token operator">=</span> <span class="token string">"POP100"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.table with demographic and/or environmental data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fieldnames</code></td>
<td>
<p>vector of terms like pctmin, traffic.score, pm, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fieldnames_out</code></td>
<td>
<p>optional, should be same length as fieldnames</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaling</code></td>
<td>
<p>number to multiply raw values by to put in right units like percent 0-100 vs 0.0-1.0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popname</code></td>
<td>
<p>name of column with population counts to use for weighting</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="proxistat2">

<a href="#proxistat2" class="help-page-title"><h2>Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.
Proximity score is sum of (1/d) where each d is distance of a given site in km,
summed over all sites within 5km, as in EJScreen.
*** Still need area of each block to fix this func proxistat2()</h2></a>

<h3>Description</h3>

<p>Calculate a proximity score for every blockgroup
Indicator of proximity of each blockgroups to some set of facilities or sites.
Proximity score is sum of (1/d) where each d is distance of a given site in km,
summed over all sites within 5km, as in EJScreen.
</p>
<p>*** Still need area of each block to fix this func proxistat2()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">proxistat2<span class="token punctuation">(</span>pts<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> <span class="token number">8.04672</span><span class="token punctuation">,</span> quadtree<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pts</code></td>
<td>
<p>data.table of lat lon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>distance max, in miles, default is 5km (8.04672 miles)
which is the EJScreen max search range for proximity scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadtree</code></td>
<td>
<p>must be localtree from EJAM::</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.table with proximityscore, bgfips, lat, lon, etc.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># pts &lt;- testpoints_50</span>
 <span class="token comment"># x &lt;- proxistat2(pts = pts[1:1000,], quadtree = localtree) </span>
 <span class="token comment">#</span>
 <span class="token comment"># summary(x$proximityscore)</span>
 <span class="token comment"># # analyze.stuff::pctiles(x$proximityscore)</span>
 <span class="token comment"># plot(x$lon, x$lat)</span>
 <span class="token comment"># tops = x$proximityscore &gt; 500 &amp; !is.infinite(x$proximityscore) &amp; !is.na(x$proximityscore)</span>
 <span class="token comment"># points(x$lon[tops], x$lat[tops], col="red")</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="regionstats">

<a href="#regionstats" class="help-page-title"><h2>data.table of 100 percentiles and means for each EPA Region.</h2></a>

<h3>Description</h3>

<p>data.table of 100 percentiles and means for each EPA Region (&gt; 1,000 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen.
</p>

<hr>
</div>
<div class="container manual-page" id="run_app">

<a href="#run_app" class="help-page-title"><h2>Run the Shiny Application</h2></a>

<h3>Description</h3>

<p>Allows package to be a Shiny app and package at the same time.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">run_app<span class="token punctuation">(</span>
  onStart <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  options <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enableBookmarking <span class="token operator">=</span> <span class="token string">"server"</span><span class="token punctuation">,</span>
  uiPattern <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>onStart</code></td>
<td>
<p>A function that will be called before the app is actually run.
This is only needed for <code>shinyAppObj</code>, since in the <code>shinyAppDir</code>
case, a <code>global.R</code> file can be used for this purpose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Named options that should be passed to the <code>runApp</code> call
(these can be any of the following: "port", "launch.browser", "host", "quiet",
"display.mode" and "test.mode"). You can also specify <code>width</code> and
<code>height</code> parameters which provide a hint to the embedding environment
about the ideal height/width for the app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enableBookmarking</code></td>
<td>
<p>Can be one of <code>"url"</code>, <code>"server"</code>, or
<code>"disable"</code>. The default value, <code>NULL</code>, will respect the setting from
any previous calls to  <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>. See <code><a href="https://rstudio.r-universe.dev/manual/shiny.html#enableBookmarking">enableBookmarking()</a></code>
for more information on bookmarking your app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uiPattern</code></td>
<td>
<p>A regular expression that will be applied to each <code>GET</code>
request to determine whether the <code>ui</code> should be used to handle the
request. Note that the entire request path must match the regular
expression in order for the match to be considered successful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to golem_opts.
See <code>?golem::get_golem_options</code> for more details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Normally R Shiny apps are not R packages -
The server just sources all .R files found in the /R/ folder,
and then runs what is found in app.R (if that is found / it is a one-file Shiny app).
This R Shiny app, however, is shared as an R package,
via the golem package approach,
which provides the useful features of a package and
useful features that the golem package enables.
</p>
<p>There is still an app.R script in the package root
 note there is no function called app()  
which lets RStudio Connect source the app.R script
to launch this shiny app.
</p>
<p>The way this works is that there is a file called
</p>
<p>_disable_autoload.R in the /R/ folder
</p>
<p>to tell the server to not source all the source .R files,
since they are already in the installed package.
Then they get loaded from the package because
the app.R script here says this:
</p>
<div class="sourceCode"><pre>pkgload::load_all(export_all = FALSE,helpers = FALSE,attach_testthat = FALSE) 
</pre></div>
<p>with the shinyApp() call wrapped in shiny::runApp() rather than in app()
</p>
<p>Also, app_runYYYY() is the same as YYYY::run_app() in case that is useful.
</p>
<p>See https://thinkr-open.github.io/golem/
</p>

<hr>
</div>
<div class="container manual-page" id="sitepoints_example">

<a href="#sitepoints_example" class="help-page-title"><h2>data.table of points as example of sitepoints for EJAM</h2></a>

<h3>Description</h3>

<p>data.table of points as example of sitepoints for EJAM
</p>

<hr>
</div>
<div class="container manual-page" id="sites2blocks_example">

<a href="#sites2blocks_example" class="help-page-title"><h2>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance</h2></a>

<h3>Description</h3>

<p>data.table of output of <code>getblocknearby()</code>, each row is a unique site-block-distance
</p>

<hr>
</div>
<div class="container manual-page" id="stateinfo">

<a href="#stateinfo" class="help-page-title"><h2>data.frame of state abbreviations and state names (50+DC+PR; not AS, GU, MP, VI, UM)</h2></a>

<h3>Description</h3>

<p>52 rows and 5 variables: ST is the 2-letter abbreviation,
statename is the State name (and ftpname is the name as used on Census FTP site).
</p>


<h3>Details</h3>

<p>column names: "ST"        "statename" "ftpname"   "FIPS.ST"   "REGION"
</p>
<p>Some datasets lack PR. (72)
Many datasets lack these:  AS, GU, MP, VI (codes "60" "66" "69" "78")
Almost all datasets lack UM. (74)
</p>
<div class="sourceCode"><pre>    72 PR                 Puerto Rico
    66 GU                        Guam 
    69 MP    Northern Mariana Islands  
    78 VI         U.S. Virgin Islands 
    74 UM U.S. Minor Outlying Islands  
</pre></div>
<p>stateinfo &lt;- structure(list(
ST = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT",
"DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY",
"LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV",
"NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI",
"SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY",
# "AS", "GU", "MP","VI"
# "UM", #### U.S. Minor Outlying Islands
# "US",
"PR"),
</p>
<p>statename = c("Alabama", "Alaska", "Arizona", "Arkansas",
"California", "Colorado", "Connecticut", "Delaware", "District of Columbia",
"Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana",
"Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
"Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri",
"Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey",
"New Mexico", "New York", "North Carolina", "North Dakota", "Ohio",
"Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina",
"South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia",
"Washington", "West Virginia", "Wisconsin", "Wyoming",
# "American Samoa", "Guam", "Northern Mariana Islands", "U.S. Virgin Islands",
# "U.S. Minor Outlying Islands",
# "United States",
"Puerto Rico"),
</p>
<p>ftpname = c("Alabama", "Alaska", "Arizona", "Arkansas", "California",
"Colorado", "Connecticut", "Delaware", "DistrictOfColumbia",
"Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana",
"Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
"Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri",
"Montana", "Nebraska", "Nevada", "NewHampshire", "NewJersey",
"NewMexico", "NewYork", "NorthCarolina", "NorthDakota", "Ohio",
"Oklahoma", "Oregon", "Pennsylvania", "RhodeIsland", "SouthCarolina",
"SouthDakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia",
"Washington", "WestVirginia", "Wisconsin", "Wyoming",
# NA, NA, NA, NA,
# NA,                 ####  U.S. Minor Outlying Islands
# "UnitedStates",
"PuertoRico"),
</p>
<p>FIPS.ST = c("01", "02", "04", "05", "06", "08", "09", "10",
"11", "12", "13", "15", "16", "17", "18", "19", "20", "21", "22",
"23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33",
"34", "35", "36", "37", "38", "39", "40", "41", "42", "44", "45",
"46", "47", "48", "49", "50", "51", "53", "54", "55", "56",
# "60", "66", "69", "78",
# "74",       ####  U.S. Minor Outlying Islands
# NA,         #### US
"72"),
REGION = c(4, 10, 9, 6, 9, 8, 1, 3, 3, 4, 4, 9, 10, 5, 5,
7, 7, 4, 6, 1, 3, 1, 5, 5, 4, 7, 8, 7, 9, 1, 2, 6, 2, 4, 8, 5,
6, 10, 3, 1, 4, 8, 4, 6, 8, 1, 3, 10, 3, 5, 8,
# NA, NA, NA, NA,
# NA,                ##### U.S. Minor Outlying Islands
# NA,                # US
2)
), row.names = c(NA, -52L), class = "data.frame")
</p>

<hr>
</div>
<div class="container manual-page" id="statestats">

<a href="#statestats" class="help-page-title"><h2>data.table of 100 percentiles and means for each US State and PR and DC.</h2></a>

<h3>Description</h3>

<p>data.table of 100 percentiles and means
for each US State and PR and DC (approx 5,300 rows)
for all the block groups in that zone (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen.
</p>

<hr>
</div>
<div class="container manual-page" id="summarize_blockcount">

<a href="#summarize_blockcount" class="help-page-title"><h2>Get summary stats on counts of blocks (unique vs doublecounted) near sites</h2></a>

<h3>Description</h3>

<p>Get summary stats on counts of blocks (unique vs doublecounted) near sites
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">summarize_blockcount<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like sites2blocks_example</p>
</td>
</tr></table>
<h3>Value</h3>

<p>A list of stats
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">summarize_blockcount<span class="token punctuation">(</span>sites2blocks_example<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="summarize_blocks_per_site">

<a href="#summarize_blocks_per_site" class="help-page-title"><h2>Get summary stats on counts of blocks near various sites</h2></a>

<h3>Description</h3>

<p>Tells you # of blocks near avg site,
how many sites have only 1 block nearby, or have &lt;30 nearby, etc.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">summarize_blocks_per_site<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"siteid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of getblocksnearby()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>

<hr>
</div>
<div class="container manual-page" id="summarize_sites_per_block">

<a href="#summarize_sites_per_block" class="help-page-title"><h2>Get summary stats on how many sites are near various blocks (residents)</h2></a>

<h3>Description</h3>

<p>Get summary stats on how many sites are near various blocks (residents)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">summarize_sites_per_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> varname <span class="token operator">=</span> <span class="token string">"blockid"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The output of <code><a href="#getblocksnearby">getblocksnearby()</a></code> like sites2blocks_example</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>colname of variable in data.table x that is the one to summarize by</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>invisibly, a list of stats
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_100_dt">

<a href="#testpoints_100_dt" class="help-page-title"><h2>Random test points data.table with columns lat lon site</h2></a>

<h3>Description</h3>

<p>Random test points data.table with columns lat lon site
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_1000_dt">

<a href="#testpoints_1000_dt" class="help-page-title"><h2>Random test points data.table with columns lat lon site</h2></a>

<h3>Description</h3>

<p>Random test points data.table with columns lat lon site
</p>

<hr>
</div>
<div class="container manual-page" id="testpoints_blockpoints">

<a href="#testpoints_blockpoints" class="help-page-title"><h2>Get some random US locations as points to try out/ for testing</h2></a>

<h3>Description</h3>

<p>Get some random US locations as points to try out/ for testing
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">testpoints_blockpoints<span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> weighting <span class="token operator">=</span> <span class="token string">"geo"</span><span class="token punctuation">,</span> ST <span class="token operator">=</span> is.null<span class="token punctuation">,</span> as.dt <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>how many points do you want?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>geo means each block is equally likely, pop means the points
are population weighted (Census 2020 pop) so they represent a random sample of
where US residents live - the average person.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>can be a character vector of 2 letter State abbreviations to pick from only some States</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.dt</code></td>
<td>
<p>if TRUE (default), a data.table, but if FALSE then a data.frame</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>see as.dt paramter. It returns a table with columns blockid, lat, lon
</p>

<hr>
</div>
<div class="container manual-page" id="usastats">

<a href="#usastats" class="help-page-title"><h2>data.table of 100 percentiles and means</h2></a>

<h3>Description</h3>

<p>data.table of 100 percentiles and means (about 100 rows)
in the USA overall, across all locations (e.g., block groups in <a href="#blockgroupstats">blockgroupstats</a>)
for a set of indicators such as percent low income.
Each column is one indicator (or specifies the percentile).
</p>
<p>This should be similar to the lookup tables in the gdb on the FTP site of EJScreen.
</p>

<hr>
</div>
<div class="container manual-page" id="write_pctiles_lookup">

<a href="#write_pctiles_lookup" class="help-page-title"><h2>create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total</h2></a>

<h3>Description</h3>

<p>create lookup table of percentiles 0 to 100 and mean for each indicator by State or USA total
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write_pctiles_lookup<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  zone.vector <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zoneOverallName <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
  wts <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate
mean, sd, and percentiles, for each zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone.vector</code></td>
<td>
<p>optional names of states or regions, for example. same length as wts, or rows in mydf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zoneOverallName</code></td>
<td>
<p>optional. Default is USA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>not used in EJScreen percentiles anymore</p>
</td>
</tr>
</table>
<hr>
</div>
</div>
    <footer><p>Rendered with postdoc 1.2.0</p></footer>
  </body>
</html>
