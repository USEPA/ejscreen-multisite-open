bugs and edits


bug - download of site by site report fails now, with "Warning: Error in setnames: Can't assign 255 names to a 254 column data.table" - maybe caused by recent changes to variable names in map_headernames?

bug - used golem::run_dev() and tried to analyze NAICS 32411 (409 points, 1 mile), and got "R Session Aborted - R encountered a fatal error. The session was terminated"   after console said "Finding nearby Census blocks."

bug - summary report text about radius in miles is currently updating as soon as a user changes the radius via slider, but that should only update after the user hits Start button and gets new results for the new radius. 

In the summary report, this text should provide a live weblink: For additional information, see: www.epa.gov/environmentaljustice 

In the barplots, color used for "Average person in US" should be something neutral like gray or pale blue to indicate it is the reference group, not red. Also, it should be listed first or last among the bars. 

When data gets updated, update text everywhere to say "EJScreen Version 2.12" -- everywhere meaning long report, header of short summary report, documention, etc. - But remove mention of that in most places if possible and have one or only a small number of places where the actual vintage of datasets is stated and elsewhere just point to that, so that very few places have to be updated yearly / each time EJScreen is updated.

In the barplots of envt raw data, find a way to make visible the Demographic Raw data view -- right now there are too many plots crammed into not enough vertical space.

In the barplots of envt raw data, can the y axis be different for each barplot? otherwise you can't see them all since the scales are so different across indicators when using raw value instead of percentile. 

In the summary report barplot, make the font bigger for the y axis label and numbers - as big as will fit. Make the font on the title bigger also as long as it fits

map popup on summary report page should use long headernames as the indicator labels, not the "friendly" names like ratio.avg.pctlowinc, maybe via the mapfast( "ej" ) approach.

In the summary report header/title, add the EPA Region and the State name, as seen on the EJScreen reports.


In the summary report, the barplot does not need the x axis label saying "Indicator" so just remove that word.

In the summary report, the barplot title: Replace the title with this: "Demographics at the Analyzed Locations Compared to US Overall"

In the summary report footnote on each of the tables, replace the text "Avg. in state is the average over all these residents of their state's overall (avg.) value. Percentile in state is the average person's state percentile." It should be changed to say, "Avg. in state means the average indicator value, among all the residents at these sites, using the statewide value in each resident's state. Percentile in state means the same, but using the site-specific value (expressed as a percentile) where each resident lives." 

In the summary report title, change "Estimated total population" to say "Population"

In the barplots of EJ indexes raw data provide a way to show supplementary EJ indexes not just regular ones. This could be via radio button showing 4 or 5 options:  Demographic (maybe split into two or more groups as the EJScreen report expands to include more variables and users will be able to add their own indicators - at least Overall Demographics, Race/Ethnicity Subgroups, Environmental, EJ, Supplementary EJ Indexes.

In the barplots, add 3 more options to the data type list, to allow these Data Type options: Raw, Ratio to US, Ratio to State, Percentile in US, Percentile in State. 

In the barplots, somehow account for the fact that EJ indexes cannot be shown as raw values, only as percentiles (or ratios of percentiles? need to clarify what that would be -- the ratio of raw scores or the ratio of percentiles? probably ratio of percentiles, but need to discuss/ confirm)

In the summary report, is there a way to allow user to click header in a table to sort on that column (as in interactive tables made via datatable)?  I suggest first replacing the header that says "Selected Variables" with the text that says "Pollution and Sources" or "Socioeconomic Indicators" so that that info is no longer stored in a special row below the header. 

In the barplots, change "Average person" label (green now) to say "Average person at these sites" and add footnote or detailed documentation somewhere explaining that Average site really means the average site's average resident (the average resident's score is calculated at each site as the site-specific population-weighted mean, and then the arithmetic mean of those site-specific scores is calculated), while the "average person at these sites" means the average person among all the residents who are at any one or more of the sites, counting each person only once even if they live near more than one site. 


